---
title: "使用者 Account 控制項的運作方式"
description: "Windows Server 安全性"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-tpm
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: da83ddb2-6182-417c-aa8e-0b47b2e17d13
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 7f5ad234959ebfe0687b8bc10f9e43f2092252f2
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/17/2017
---
# <a name="how-user-account-control-works"></a>使用者 Account 控制項的運作方式

>適用於：Windows Server（以每年次管道）、Windows Server 2016

使用者 Account 控制項 (UAC) 損壞電腦可以協助防止惡意程式 （也稱為 「 惡意程式碼），並協助組織部署更容易管理的桌面。 使用 UAC，應用程式和工作永遠執行的安全性部分非系統管理員帳號，除非系統管理員明確授與系統管理員等級系統的存取權。 UAC 可以封鎖自動安裝未經授權的應用程式和系統設定避免不慎的變更。

## <a name="uac-process-and-interactions"></a>UAC 程序與互動
每個應用程式需要系統管理員存取權杖必須提示同意系統管理員。 一個例外是之間的父系和子女處理程序的關係。 子女的處理程序繼承使用者存取權杖父系處理程序。 不過，家長及子女處理程序，必須具有相同的完整性層級。 Windows Server 2012，將它們整合等級保護處理程序。 整合等級的信任的度量單位。 [高] 完整性應用程式是執行修改系統資料，例如的磁碟分割應用程式中，「 低 「 完整性應用程式可執行的工作，可能會危害作業系統，例如網頁瀏覽器時的工作。 使用較低的完整性層級的應用程式無法修改具有更高版本整合等級的應用程式中的資料。 當標準使用者嘗試執行的應用程式需要系統管理員存取權杖時，UAC 需要使用者提供有效的系統管理員認證。

以更加了解此程序發生請務必查看 Windows Server 2012 登入程序的詳細資料。

### <a name="windows-server-2012-logon-process"></a>Windows Server 2012 登入程序
下圖示範如何系統管理員的身分登入程序 mca 標準使用者登入程序。

![圖示範如何系統管理員的身分登入程序 mca 標準使用者登入程序](../media/How-User-Account-Control-Works/UACWindowsLogonProcess.gif)

根據預設，標準使用者系統管理員存取資源並執行的應用程式的標準使用者安全性部分。 當使用者登入電腦時，系統會建立使用者存取預付的碼。 存取權杖包含層級的存取權限授與使用者，包括特定安全性識別碼 (Sid) 以及 Windows 權限的相關資訊。

當系統管理員的身分登入時，兩個不同的存取權杖建立的使用者： 標準使用者權杖存取和系統管理員存取預付碼。 存取標準使用者權杖包含相同的特定使用者的資訊以系統管理員存取權杖，但 Windows 管理權移除了。 標準使用者存取權杖用來開始應用程式，並執行管理工作 （使用者標準應用程式）。 標準使用者存取權杖然後用來顯示桌面 (Explorer.exe)。 Explorer.exe 是所有其他使用者車載機起始處理程序繼承他們存取權杖父系處理程序。 如此一來，所有的應用程式執行一般的使用者的使用者提供同意或核准使用完整的系統管理存取權杖應用程式認證。

群組成員的系統管理員的使用者可以登入，瀏覽網頁，並讀取電子郵件時使用標準使用者權杖存取。 當系統管理員必須執行的工作自動需要系統管理員存取權杖、 Windows Server 2012 提示 \ [核准的使用者。 此提示稱為提高權限提示，並可以使用 [本機安全性原則嵌入式管理單元 (Secpol.msc) 或群組原則設定其行為。

> [!NOTE]
> 字詞 」 提高 」 來參考提示使用者同意，或使用完整的系統管理員存取權杖認證 Windows Server 2012 中的程序。

### <a name="the-uac-user-experience"></a>UAC 使用者體驗
時，UAC 會支援時，標準使用者的使用者體驗是不同的系統管理員核准模式中的系統管理員。 建議且更安全的方法執行 Windows Server 2012 是讓您的主要使用者帳號標準帳號。 一般的使用者身分執行可協助以最大化安全性受管理的環境。 與建的 UAC 提高權限元件標準使用者可以輕鬆地執行管理工作本機系統管理員帳號輸入有效的憑證。 預設值，建標準使用者的 UAC 提高權限元件是 credential 提示。

另一個是系統管理員核准模式中的系統管理員身分執行一般的使用者身分執行。 與建的 UAC 提高權限元件本機系統管理員群組成員可以輕鬆地提供核准執行管理工作。 預設值，建 UAC 提高權限元件管理員，管理核准模式中的稱為同意提示。 可以使用 [本機安全性原則嵌入式管理單元 (Secpol.msc) 或群組原則設定的 UAC 提高權限提示行為。

**同意和認證提示**

Windows Server 2012 UAC 支援，會提示您的同意，或在程式或工作需要完整的系統管理員存取權杖開始之前會提示輸入有效的本機系統管理員的認證。 此提示可確保您可以自動安裝任何惡意軟體。

**同意提示**

同意提示使用者想要執行的工作需要使用者的系統管理員存取預付碼時顯示。 以下是同意 UAC 提示的螢幕擷取畫面。

![同意 UAC 提示螢幕擷取畫面](../media/How-User-Account-Control-Works/UACConsentPrompt.gif)

**Credential 提示**

認證命令提示字元中會呈現標準使用者嘗試執行的工作需要使用者的系統管理員存取預付碼。 可以使用本機安全性原則嵌入式管理單元 (Secpol.msc) 或群組原則設定預設提示標準使用者的行為。 系統管理員也可能需要提供認證來設定使用者 Account 控制項： 行為將值設定為 [命令提示字元中，輸入認證管理員核准模式原則中的系統管理員權限提示。

下列螢幕擷取畫面就的 UAC credential 提示。

![螢幕擷取畫面顯示的 UAC credential 提示範例](../media/How-User-Account-Control-Works/UACCredentialPrompt.gif)

**UAC 提高權限提示**

UAC 提高權限提示是不同的色彩，將特定應用程式，就如立即驗證的應用程式的潛在的安全性風險。 當系統管理員身分完整存取預付碼執行嘗試應用程式時，Windows Server 2012 第一次分析判斷及其發行者的可執行檔。 應用程式第一次分成三類根據的可執行檔發行者： Windows Server 2012，驗證的發行者 （簽署），並不驗證的發行者 （簽署）。 下圖顯示 Windows Server 2012 如何判斷要對使用者顯示的色彩提高權限提示。

提高權限提示編碼如下：

-   紅色背景紅色 shield 圖示： 應用程式群組原則中封鎖或封鎖發行者。

-   藍色背景 shield 藍色和金會員圖示： 的是 Windows Server 2012 管理應用程式，例如 [控制台] 項目。

-   藍色背景藍色 shield 圖示： 應用程式已使用的驗證碼，並信任的樹系的本機電腦。

-   黃色背景黃色 shield 圖示： 未經簽署的應用程式，或是簽署，但尚未信任的本機電腦。

**Shield 圖示**

某些控制台項目，例如**的日期和時間屬性**，包含的系統管理員身分和標準使用者操作組合。 標準使用者都可以檢視時鐘和變更的時區，但所需完整的系統管理員存取預付碼變更本機系統時間。 以下是的螢幕擷取畫面**的日期和時間屬性**[控制台] 項目。

![螢幕擷取畫面顯示 * * 的日期和時間屬性 * * 控制台項目](../media/How-User-Account-Control-Works/UACShieldIcon.gif)

在 shield 圖示**變更日期和時間**按鈕表示程序，需要存取權杖完整的系統管理員，且將會顯示的 UAC 提高權限提示。

**保護提高權限提示**

提高權限程序進一步受到引導安全桌面的提示。 同意和認證提示在 Windows Server 2012 預設會顯示在安全的桌面。 僅限 Windows 處理程序可以存取安全桌面。 適用於更高安全性的我們建議事物**使用者 Account 控制項： 切換到安全桌面提高權限提示時**原則設定支援。

當可執行檔要求權限時，也稱為使用者桌面互動式桌面切換到安全桌面。 安全桌面暗使用者桌面，而會顯示，必須先回應提高權限提示。 當使用者按下 [是] 或桌面否，切換回使用者桌面。

惡意程式碼可呈現的安全桌面，但使用者 Account 控制 imitation： 行為的原則設定的系統管理員核准模式] 中的系統管理員權限提示同意設定為 [命令提示字元中，如果使用者 imitation 上按一下 [是] 的惡意程式碼不會獲得提高權限。 如果原則設定設定為 [命令提示字元中輸入認證，模仿認證命令提示字元中的惡意程式碼可以收集使用者的認證。 不過，惡意軟體不能取得提高權限，系統會有其他減少控制收割後的密碼更的使用者介面的惡意程式碼保護。

當惡意程式碼可能會呈現的安全桌面 imitation 時，除非先前的電腦上安裝的惡意程式碼的使用者，無法發生此問題。 使用者時，UAC 會支援，需要系統管理員存取權杖處理程序以無訊息方式無法安裝，因為必須明確地提供同意按一下**[是]**或提供系統管理員認證。 特定的 UAC 提高權限提示行為是仰賴群組原則。

## <a name="uac-architecture"></a>UAC 架構
下圖詳細的 UAC 架構。

![圖表詳細的 UAC 架構](../media/How-User-Account-Control-Works/UACArchitecture.gif)

若要更加了解每個元件，檢視如下表所示：

|Component|描述|
|-------|--------|
|**使用者**||
|使用者執行操作，因而需要權限|如果作業會變更系統檔案或登錄，稱為 「 模擬。 所有其他作業通話 ShellExecute。|
|ShellExecute|ShellExecute 呼叫 CreateProcess。 從 CreateProcess ERROR_ELEVATION_REQUIRED 錯誤尋找 ShellExecute。 如果您收到錯誤，ShellExecute 呼叫應用程式資訊服務嘗試執行要求的作業提升權限提示。|
|CreateProcess|在應用程式需要權限，CreateProcess 取消 ERROR_ELEVATION_REQUIRED 的電話。|
|**系統**||
|應用程式資訊服務|系統服務，可協助開始需要一個或多個提高權限來執行，例如 [本機管理工作，使用者權限的應用程式和應用程式，需要更高版本完整性層級。 同意這類應用程式權限提高需要與 （根據群組原則），以系統管理員的使用者完整存取權杖建立新的處理的應用程式的應用程式資訊服務可協助開始使用者提供給執行這項操作。|
|ActiveX 安裝提高權限|如果未安裝 ActiveX，系統會檢查 UAC 滑層級。 如果已安裝 ActiveX，**使用者 Account 控制項： 切換到安全桌面提高權限提示時**已選取的群組原則設定。|
|檢查 UAC 滑層級|UAC 現在會有四種層級選擇通知和滑使用選擇通知的層級：<br /><br /><ul><li>高<br /><br />    如果滑為**通知**，系統會檢查是否已支援安全桌面。</li><li>媒體<br /><br />    如果滑設定為**預設通知我的程式，請試著變更我的電腦時，只**、**使用者 Account 控制項： 僅限提高已簽章與驗證的可執行檔**核取原則設定：<br /><br /><ul><li>原則設定時，如果被執行公用基礎結構 (PKI) 認證路徑驗證指定可執行檔之前，允許執行。</li><li>如果不是原則設定支援 （預設值） PKI 認證路徑驗證不執行之前，允許執行特定的可執行檔。 **使用者 Account 控制項： 切換到安全桌面提高權限提示時**核取群組原則設定。</li></ul></li><li>低<br /><br />    如果滑設定為**的程式，請試著變更我的電腦時，才，請通知我 （執行變暗的桌面）**，稱為 「 CreateProcess。</li><li>不要通知<br /><br />    如果滑為**永遠不會通知我時**，UAC 提示將永遠不會通知時嘗試安裝程式或想要在電腦上的任何變更。 **重要事項：**不建議使用此設定。 此設定為相同設定**使用者 Account 控制項： 行為的系統管理員核准模式中的系統管理員權限提示**原則設定，以**Elevate 不會提示**。</li></ul>|
|支援的安全桌面|**使用者 Account 控制項： 切換到安全桌面提高權限提示時**核取原則設定：<br /><br />-如果尚未安全桌面，無論提示行為原則設定的系統管理員和標準使用者安全桌面移所有提升權限要求。<br />-如果不支援安全桌面，是所有提升權限要求移至互動式使用者的桌面，並使用適用於系統管理員和標準使用者每一位使用者的設定。|
|CreateProcess|CreateProcess 呼叫 AppCompat、 融合，以及安裝程式偵測評估在應用程式需要權限。 可執行檔再檢查以判斷其要求的執行層級，會儲存在應用程式資訊清單檔中。 CreateProcess 如果要求的執行層級的資訊清單中指定不符合存取預付碼將會失敗，並傳回 ShellExecute 錯誤 (ERROR_ELEVATION_REQUIRED)。 |
|AppCompat|AppCompat 資料庫會將資訊儲存在應用程式的應用程式的相容性修正項目。|
|融合|融合資料庫儲存的應用程式資訊清單描述應用程式的資訊。 若要新增新的要求的執行層級欄位更新資訊清單結構描述。|
|偵測安裝程式|安裝程式偵測偵測設定可執行檔，避免未經使用者的確認和同意執行從安裝。|
|**核心**||
|模擬|模擬技術確保的不相容應用程式執行動作不無訊息方式執行無法執行或失敗的原因無法判斷的方式。 UAC 也會提供檔案及登錄模擬和寫入區域受保護的應用程式的登入。|
|系統檔案及登錄|每個使用者的檔案及登錄模擬重新導向至 amc 每一台電腦登錄和檔案寫入要求相當於每個使用者的位置。 朗讀要求會重新導向至模擬每個使用者位置秒第一次，並在每一台電腦的位置。|

有是從先前的 Windows 版本的 Windows Server 2012 uac 變更。 新滑將不會將 UAC 完全關閉。 將新的設定：

-   請繼續執行的 UAC 服務。

-   原因所有提高權限要求車載機起始，而不會顯示在 UAC 提示將 [自動核准系統管理員。

-   自動拒絕標準使用者的所有提升權限要求。

> [!IMPORTANT]
> 您必須以完全停用 UAC 停用原則**使用者 Account 控制項： 以系統管理員核准模式執行的所有管理員**。

> [!WARNING]
> 量身打造的應用程式將無法在 Windows Server 2012 時，UAC 會停用。

### <a name="virtualization"></a>模擬
在企業環境中的系統管理員嘗試安全系統，因為許多行營運 (LOB) 應用程式使用只標準使用者存取權杖設計。 如此一來，IT 系統管理員不需要的 UAC 支援執行 Windows Server 2012 時取代大部分的應用程式。

 Windows Server 2012 包含不相容的 UAC 且需要系統管理員身分存取預付碼才能正常執行的應用程式的檔案和登錄模擬技術。 模擬確保甚至不相容的 UAC 的應用程式與 Windows Server 2012 相容。 不相容的 UAC 管理應用程式嘗試至受保護的 directory，例如程式的檔案，撰寫時 UAC 提供應用程式嘗試變更資源自己模擬的檢視。 模擬的複製會保留使用者的設定檔中。 這項策略建立不同模擬執行的不相容應用程式的每個使用者的檔案的複本。

大部分的應用程式工作正常運作，利用模擬功能。 雖然模擬允許大部分的應用程式執行時，它是短期修正程式，而不是長期方案。 應用程式開發人員應該修改相容與 Windows Server 2012 商標計畫儘速，而非依賴檔案、 資料夾及登錄模擬他們應用程式。

模擬不是下列案例中的選項：

1.  模擬不適用於，較高的完整的系統管理存取權杖執行的應用程式。

2.  模擬支援只 32 位元應用程式。 64 位元非提升權限的應用程式只會接收拒絕存取的訊息時使用者想要取得 Windows 物件控點 （的唯一）。 原生 Windows 64 位元應用程式的相容性的 UAC，以及將資料寫入正確的位置。

3.  如果應用程式包括層級屬性要求的執行的應用程式資訊清單模擬已停用應用程式。

### <a name="request-execution-levels"></a>要求執行層級
應用程式資訊清單會告訴您，並指出應用程式應該要繫結至執行階段共用和私人以並排組件的 XML 檔案。 在 Windows Server 2012，應用程式資訊清單會包含 UAC 應用程式的相容性目的的項目。 管理應用程式在應用程式資訊清單中，項目提示權限存取的使用者存取權杖給使用者。 雖然不應用程式資訊清單中的項目，大部分管理應用程式使用來執行修改而應用程式的相容性的修正。 應用程式的相容性的修正會資料庫項目，可讓應用程式的不相容的 UAC，來與 Windows Server 2012 正常運作。

所有的 UAC 相容應用程式應該會有的應用程式資訊清單新增要求的執行層級。 在應用程式需要系統管理員系統的存取權，然後將應用程式要求執行 「 需要系統管理員 」 的層級確保系統辨識管理應用程式與程式，而且執行所需的權限提高步驟。 要求的執行層級指定的應用程式所需的權限。

### <a name="installer-detection-technology"></a>安裝程式偵測技術
安裝程式是設計用來部署軟體的應用程式。 大部分的安裝程式寫入系統目錄和登錄鍵。 這些受保護的系統位置的通常只是由系統管理員可以在安裝程式偵測技術，這表示您的使用者標準不能安裝應用程式不足存取寫入。 Windows Server 2012 啟發偵測到安裝程式與要求的認證管理員或的系統管理員使用者從 \ [核准才能執行的存取權限。 Windows Server 2012 啟發也會偵測更新及解除安裝應用程式的程式。 UAC 的設計目的是無法安裝未經使用者同意正在執行的同意因為安裝程式寫入登錄和檔案系統的受保護的區域。

安裝程式偵測功能僅適用於：

-   32 位元可執行檔。

-   應用程式，而不需要執行要求層級的屬性。

-   執行一般的使用者與支援的 UAC 互動式處理程序。

建立 32 位元處理程序之前，下列屬性會檢查以判斷它是安裝程式：

-   檔案名稱包含關鍵字，例如 「 安裝，「 「 設定 」 或 「 更新 」。

-   版本資源欄位包含下列關鍵字： 廠商、 公司名稱、 Product 名稱、 描述檔案、 原始檔名、 內部名稱和匯出名稱。

-   關鍵字以並排資訊清單中的 embedded 的可執行檔中。

-   關鍵字特定 StringTable 項目中的可執行檔的連結。

-   主要屬性資源指令碼資料中連結的可執行檔中。

-   有目標的位元組序列的可執行檔中。

> [!NOTE]
> 關鍵字和位元組序列的已從一般的各種不同的安裝程式技術觀察到的特性。

> [!NOTE]
> 使用者 Account 控制項： 偵測安裝應用程式，並提示必須安裝程式來偵測安裝程式的偵測功能的權限提高原則設定的。 此設定預設會讓和可以在本機使用設定本機安全性原則嵌入式管理單元 (Secpol.msc) 或群組原則 (Gpedit.msc) 設定針對網域、 滑鼠或特定的群組。


