---
title: 適用于主控者的受防護網狀架構與受防護的 VM 規劃指南
ms.prod: windows-server
ms.topic: article
ms.assetid: 392af37f-a02d-4d40-a25d-384211cbbfdd
manager: dongill
author: nirb-ms
ms.author: nirb
ms.technology: security-guarded-fabric
ms.openlocfilehash: 829d6a3efef082e35c6a4f98e0ba9e4b70c27a93
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/08/2020
ms.locfileid: "80856471"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-tenants"></a>租使用者的受保護網狀架構與受防護的 VM 規劃指南

>適用于： Windows Server 2019、Windows Server （半年通道）、Windows Server 2016

本主題著重于想要保護其虛擬機器（Vm）的 VM 擁有者，以符合規範和安全性目的。 無論 Vm 是在主機服務提供者的受防護網狀架構或私人保護網狀架構上執行，VM 擁有者都必須控制其受防護 Vm 的安全性層級，其中包括維護必要時將其解密的能力。

使用受防護的 Vm 時，需要考慮三個區域：

- Vm 的安全性層級
- 用來保護它們的密碼編譯金鑰
- 防護資料-用來建立受防護 Vm 的機密資訊 

## <a name="security-level-for-the-vms"></a>Vm 的安全性等級

部署受防護的 Vm 時，必須選取兩個安全性層級的其中一個：

- 受防護 
- 支援加密

受防護和加密支援的 Vm 皆已附加虛擬 TPM，而執行 Windows 的 Vm 則受到 BitLocker 保護。 主要差異在於受防護的 Vm 會封鎖網狀架構系統管理員的存取，而加密支援的 Vm 則允許網狀架構系統管理員與一般 VM 相同的存取層級。 如需這些差異的詳細資訊，請參閱[受防護的網狀架構與受防護的 vm 總覽](guarded-fabric-and-shielded-vms.md)。 

如果您想要從遭入侵的網狀架構保護 VM （包括遭到入侵的系統管理員），請選擇 [**受防護的 vm** ]。 它們應該用於網狀架構系統管理員和網狀架構本身不受信任的環境中。 如果您想要符合的相容性列可能需要待用加密和網路上的 VM 加密（例如，在即時移轉期間），請選擇 [**加密支援的 vm** ]。

加密支援的 Vm 非常適合在網狀架構系統管理員完全受信任的環境中，但加密仍然是必要條件。

您可以在受防護的網狀架構上，甚至是在相同的 Hyper-v 主機上，執行一般 Vm、受防護的 Vm 和加密支援的 Vm 混合。 

VM 受防護或加密是否受支援取決於建立 VM 時選取的防護資料。 VM 擁有者會在建立防護資料時設定安全性層級（請參閱[防護資料](#shielding-data)一節）。
請注意，一旦進行這種選擇，當 VM 保留在虛擬化網狀架構上時，就無法變更。

## <a name="cryptographic-keys-used-for-shielded-vms"></a>用於受防護 Vm 的密碼編譯金鑰

受防護的 Vm 會受到保護，避免使用加密的磁片，以及可由下列專案解密的各種加密元素：

- 擁有者金鑰–這是由 VM-擁有者所維護的密碼編譯金鑰，通常用於最後手段的復原或疑難排解。 VM 擁有者負責維護安全位置中的擁有者金鑰。
- 一或多個監護人（主機守護者金鑰）–每個守護者都代表一個虛擬化網狀架構，其中的擁有者會授權執行受防護的 Vm。 企業通常會有主要和嚴重損壞修復（DR）虛擬化網狀架構，而且通常會授權其受防護的 Vm 在兩者上執行。 在某些情況下，公用雲端提供者可能會主控次要（DR）網狀架構。 任何受防護網狀架構的私密金鑰只會在虛擬化網狀架構上維護，而其公開金鑰則可供下載並包含在其守護者內。 

**如何? 建立擁有者金鑰？** 擁有者金鑰會以兩個憑證來表示。 用於加密的憑證和用於簽署的憑證。 您可以使用自己的 PKI 基礎結構來建立這兩個憑證，或從公開憑證授權單位單位（CA）取得 SSL 憑證。 基於測試目的，您也可以在從 Windows 10 或 Windows Server 2016 開始的任何電腦上建立自我簽署憑證。

**您應該擁有多少個擁有者金鑰？** 您可以使用單一擁有者金鑰或多個擁有者金鑰。 最佳做法會針對共用相同安全性、信任或風險層級以及系統管理控制的一組 Vm，建議使用單一擁有者金鑰。 您可以為所有已加入網域的受防護 Vm 共用單一擁有者金鑰，並將該擁有者金鑰與網域系統管理員進行管理。

**我可以針對主機守護者使用自己的金鑰嗎？** 是，您可以將自己的金鑰「帶入」主機服務提供者，並將該金鑰用於受防護的 Vm。 這可讓您使用您的特定金鑰（與使用主機服務提供者金鑰），而且可以在您擁有需要遵守的特定安全性或法規時使用。 基於金鑰的用途，主機守護者金鑰應該與擁有者金鑰不同。

## <a name="shielding-data"></a>防護資料

防護資料包含部署受防護或加密支援的 Vm 所需的秘密。 將一般 Vm 轉換為受防護的 Vm 時，也會使用它。

防護資料是使用 [防護資料檔案] [檔案] 建立，並儲存在 VM 擁有者上傳至受保護網狀架構的 PDK 檔案中。

受防護的 Vm 可協助防範受到入侵之虛擬化網狀架構的攻擊，因此我們需要一個安全的機制來傳遞敏感的初始化資料，例如系統管理員的密碼、網域加入認證或 RDP 憑證，而不會向虛擬化網狀架構本身或其系統管理員顯示這些資訊。 此外，防護資料包含下列各項：

1. 安全性等級–受防護或加密-支援
2. 可執行 VM 的受信任主機保護者的擁有者和清單
3. 虛擬機器初始化資料（unattend.xml、RDP 憑證）
4. 可在虛擬化環境中建立 VM 之受信任的已簽署範本磁片清單 

建立受防護或加密支援的 VM 或轉換現有的 VM 時，系統會要求您選取防護資料，而不會提示您輸入機密資訊。

**我需要多少防護資料檔案？** 單一防護資料檔案可用於建立每個受防護的 VM。 不過，如果指定的受防護 VM 要求四個專案中的任一個不同，則需要額外的防護資料檔案。 例如，您可能會有一個 IT 部門的防護資料檔案，以及 HR 部門的不同防護資料檔案，因為其初始系統管理員密碼和 RDP 憑證不相同。

雖然可能會針對每個受防護的 VM 使用個別的防護資料檔案，但這不一定是最佳選擇，而且應該因正確的理由而完成。 例如，如果每個受防護的 VM 都必須有不同的系統管理員密碼，請改為考慮使用密碼管理服務或工具，例如[Microsoft 的本機系統管理員密碼解決方案（LAPS）](https://www.microsoft.com/download/details.aspx?id=46899)。

## <a name="creating-a-shielded-vm-on-a-virtualization-fabric"></a>在虛擬化網狀架構上建立受防護的 VM

有數個選項可讓您在虛擬化網狀架構上建立受防護的 VM （以下與受防護和加密支援的 Vm 有關）：

1. 在您的環境中建立受防護的 VM，並將它上傳至虛擬化網狀架構
2. 從虛擬化網狀架構上已簽署的範本建立新的受防護 VM
3. 防護現有的 VM （現有的 VM 必須是第2代，而且必須執行 Windows Server 2012 或更新版本）

從範本建立新的 Vm 是一般做法。 不過，由於用來建立新的受防護 VM 的範本磁片位於虛擬化網狀架構上，因此需要額外的措施，以確保它不會遭到惡意網狀架構系統管理員或網狀架構上執行的惡意程式碼的篡改。 此問題已使用已簽署的範本磁片來解決-已簽署的範本磁片及其磁片簽章是由受信任的系統管理員或 VM 擁有者所建立。 建立受防護的 VM 時，會將範本磁片的簽章與指定的防護資料檔案中包含的簽名碼進行比較。 如果任何防護資料檔案的簽章符合範本磁片的簽章，部署程式就會繼續進行。 如果找不到相符的項，部署程式就會中止，確保 VM 密碼不會因為不信任的範本磁片而遭到入侵。

使用已簽署的範本磁片來建立受防護的 Vm 時，有兩個選項可用：

1. 使用虛擬化提供者所提供的現有已簽署範本磁片。 在此情況下，虛擬化提供者會維護已簽署的範本磁片。
2. 將已簽署的範本磁片上傳至虛擬化網狀架構。 VM 擁有者負責維護已簽署的範本磁片。 


