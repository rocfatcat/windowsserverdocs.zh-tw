---
title: Windows 驗證中的認證程序
description: Windows Server 安全性
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 48c60816-fb8b-447c-9c8e-800c2e05b14f
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 52d50a1bb6bfbe9d35146f362a2a5184df0a6504
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839859"
---
# <a name="credentials-processes-in-windows-authentication"></a>Windows 驗證中的認證程序

>適用於：Windows Server （半年通道），Windows Server 2016

這個參考主題適合 IT 專業人員說明 Windows 驗證如何處理認證。

Windows 認證管理是作業系統接收來自服務或使用者的認證並保護該資訊來驗證目標的未來簡報的程序。 在已加入網域的電腦，驗證的目標是在網域控制站。 驗證中使用的認證是真實性的證明的建立關聯的使用者身分識別以某種形式，例如憑證、 密碼或 PIN 的數位文件。

根據預設，Windows 認證會對安全性帳戶管理員 (SAM) 資料庫的本機電腦上，或針對已加入網域的電腦，透過 Winlogon 服務上的 Active Directory 進行驗證。 認證會透過所收集使用者輸入登入使用者介面上，或以程式設計方式透過應用程式開發介面 (API) 提供給驗證的目標。

本機安全性資訊會儲存在登錄中**HKEY_LOCAL_MACHINE\SECURITY**。 儲存的資訊包括原則設定，預設的安全性值和帳戶資訊，例如快取登入認證。 雖然防寫保護，也會在這裡，儲存在 SAM 資料庫中的複本。

下圖顯示所需的元件和路徑的認證需要透過系統來驗證使用者或處理程序的成功登入。

![此圖顯示所需的元件和認證需要透過系統來驗證使用者或登入成功的程序的路徑。](../media/credentials-processes-in-windows-authentication/AuthN_LSA_Architecture_Client.gif)

下表描述每個元件，可管理驗證程序，在 登入的認證。

**適用於所有的系統驗證元件**

|Component|描述|
|-------|--------|
|使用者登入|Winlogon.exe 會負責管理安全的使用者互動的可執行檔。 Winlogon 服務會藉由傳遞的認證收集使用者動作在安全桌面上 (登入 UI) 到本機安全性授權 (LSA) 透過 secur32.dll，藉此起始登入程序，適用於 Windows 作業系統。|
|應用程式登入|應用程式或服務不需要互動式登入的登入。 使用 secur32.dll，藉此而在啟動時，例如服務、 起始的處理序使用 Ksecdd.sys 核心模式中執行，以使用者模式執行由使用者初始化的大部分程序。<br /><br />如需有關使用者模式和核心模式的詳細資訊，請參閱本主題中的應用程式和使用者模式或服務和核心模式。|
|Secur32.dll|多個驗證提供者的驗證程序的基礎。|
|Lsasrv.dll|LSA 伺服器服務，同時強制執行安全性原則，並做為 LSA 的安全性封裝管理員。 LSA 包含 Negotiate 函式，這決定哪一個通訊協定成功之後會選取 NTLM 或 Kerberos 通訊協定。|
|安全性支援提供者|一組可以個別叫用一或多個驗證通訊協定的提供者。 一組預設的提供者可以變更每個版本的 Windows 作業系統中，而且可以撰寫自訂提供者。|
|Netlogon.dll|Net Logon 服務會執行的服務如下所示：<br /><br />-維護電腦的安全通道 （不是安全通道與混淆） 為網域控制站。<br />-將使用者的認證，透過安全通道傳遞給網域控制站，並傳回的網域安全性識別碼 (Sid) 和使用者的使用者權限。<br />-發行服務資源記錄中的 網域名稱系統 (DNS)，並使用 DNS 名稱解析為網域控制站的網際網路通訊協定 (IP) 位址。<br />-實作以同步處理主要網域控制站 (Pdc) 和備份網域控制站 (Bdc) 遠端程序呼叫 (RPC) 為基礎的複寫通訊協定。|
|Samsrv.dll|安全性帳戶管理員 (SAM)，儲存 本機安全性帳戶，它會強制執行本機預存的原則，並支援的 Api。|
|登錄|登錄包含一份 SAM 資料庫、 本機安全性原則設定，預設的安全性值和才可存取系統的帳戶資訊。|

本主題包含下列幾節：

-   [使用者登入的認證輸入](#BKMK_CrentialInputForUserLogon)

-   [應用程式和服務登入的認證輸入](#BKMK_CredentialInputForApplicationAndServiceLogon)

-   [本機安全性授權](#BKMK_LSA)

-   [快取的認證和驗證](#BKMK_CachedCredentialsAndValidation)

-   [認證的儲存體和驗證](#BKMK_CredentialStorageAndValidation)

-   [安全性帳戶管理員資料庫](#BKMK_SAM)

-   [本機網域和受信任的網域](#BKMK_LocalDomainsAndTrustedDomains)

-   [在 Windows 驗證的憑證](#BKMK_CertificatesInWindowsAuthentication)

## <a name="BKMK_CrentialInputForUserLogon"></a>使用者登入的認證輸入
在 Windows Server 2008 和 Windows Vista 中，圖形識別與驗證 (GINA) 架構已取代有了認證提供者模型，使得列舉透過登入圖格使用不同的登入類型。 以下將說明這兩種模型。

**圖形識別和驗證架構**

圖形識別與驗證 (GINA) 架構適用於 Windows Server 2003、 Microsoft Windows 2000 Server、 Windows XP 和 Windows 2000 Professional 作業系統。 在這些系統中，每個互動式登入工作階段會建立個別的 Winlogon 服務執行個體。 GINA 架構會載入 Winlogon 所使用的處理序空間、 接收和處理認證，並呼叫透過 LSALogonUser 驗證介面。

工作階段 0 中執行互動式登入的 Winlogon 的執行個體。 工作階段 0 裝載系統服務和其他重要的處理序，包括本機安全性授權 (LSA) 程序。

下圖顯示 Windows Server 2003、 Microsoft Windows 2000 Server、 Windows XP 和 Microsoft Windows 2000 Professional 的認證程序。

![此圖顯示 Windows Server 2003、 Microsoft Windows 2000 Server、 Windows XP 和 Microsoft Windows 2000 Professional 的認證程序](../media/credentials-processes-in-windows-authentication/AuthN_GINA_Architecture.gif)

**認證提供者架構**

認證提供者架構中指定的版本適用於**套用至**本主題開頭的清單。 在這些系統中，認證輸入的架構變更可延伸的設計為使用認證提供者中。 這些提供者是由不同的登入上的磚，安全桌面，允許任何數目的登入案例-不同的帳戶相同的使用者和不同的驗證方法，例如密碼、 智慧卡和生物識別技術來表示。

使用認證提供者架構中，Winlogon 永遠會啟動登入 UI 之後收到的安全注意事項序列事件。 登入 UI 會查詢每個認證提供者，提供者設定為列舉的不同認證類型的數目。 認證提供者可以選擇其中一個磚指定為預設值。 所有提供者已經列舉其圖格之後，登入 UI 它們向使用者顯示。 使用者所互動的圖格，以提供其認證。 登入 UI 會提交這些認證進行驗證。

認證提供者不會強制機制。 它們用來收集及序列化的認證。 本機安全性授權和驗證封裝會強制執行安全性。

認證提供者電腦上已註冊，且會負責下列：

-   描述驗證所需的認證資訊。

-   處理通訊和外部驗證授權單位的邏輯。

-   封裝的認證互動及網路登入。

封裝的認證互動及網路登入包括序列化的程序。 透過序列化認證登入 UI 上可以顯示多個登入圖格。 因此，您的組織可以控制登入顯示，例如使用者、 登入的目標系統、 網路和工作站鎖定/解除鎖定原則-透過使用自訂的認證提供者預先登入存取。 在相同電腦上，可以同時存在多個認證提供者。

單一登入 (SSO) 提供者可以開發，做為標準的認證提供者，或做為預先登入存取提供者。

每個 Windows 版本都包含一個預設認證提供者和一個預設預先登入存取提供者 (PLAP)，又稱為 SSO 提供者。 SSO 提供者可連接到網路之前登入本機電腦的使用者。 實作此提供者時，提供者不會列舉登入 UI 上的圖格。

SSO 提供者適用於下列案例：

-   **網路驗證和電腦登入是由不同的認證提供者處理。** 此案例中的不同版本包括：

    -   使用者可以選擇連線到網路，例如連接至虛擬私人網路 (VPN)，然後才能登入電腦，但不是需要建立此連線。

    -   擷取本機電腦上的互動式驗證期間所使用的資訊所需網路驗證。

    -   多個網路驗證後面的其他案例之一。 比方說，使用者向網際網路服務提供者 (ISP)、 向 VPN、，然後在本機登入使用其使用者帳戶認證。

    -   已停用快取的認證，並透過 VPN 遠端存取服務連線，才能在本機登入前驗證使用者。

    -   網域使用者並沒有設定已加入網域的電腦上的本機帳戶，而且必須建立遠端存取服務的連接，透過 VPN 連線之前完成互動式登入。

-   **網路驗證和電腦登入是由相同的認證提供者處理。** 在此案例中，使用者是需要連線到網路，接著再登入電腦。

**登入 圖格列舉**

認證提供者列舉登入圖格在下列情況：

-   指定在這些作業系統**適用於**本主題開頭的清單。

-   認證提供者列舉工作站登入的圖格。 認證提供者通常會序列化至本機安全性授權單位驗證的認證。 此程序會顯示特定的每個使用者和特定的圖格到每個使用者的目標系統。

-   登入和驗證架構可讓使用者能夠使用認證提供者所列舉的磚，以解除鎖定工作站。 一般而言，目前登入的使用者是 [預設] 圖格，但如果多個使用者登入，就會顯示多個圖格。

-   認證提供者列舉變更其密碼或其他個人資訊，例如 PIN 的使用者要求的回應中的磚。 一般而言，目前登入的使用者是 [預設] 圖格;不過，如果多個使用者登入，就會顯示多個圖格。

-   認證提供者列舉要用於驗證遠端電腦上已序列化的認證為基礎的圖格。 認證 UI 不使用相同的執行個體的提供者登入 UI、 解除鎖定的工作站，或變更密碼。 因此，無法在提供者的認證 UI 的執行個體之間維護狀態資訊。 此結構會導致每個遠端電腦登入，假設認證已正確地序列化一個圖格。 這種情況下也會在使用者帳戶控制 (UAC)，這有助於防止未經授權的變更的電腦才允許動作，可能會影響電腦的作業會提示使用者提供權限或系統管理員密碼或者，可以變更會影響電腦的其他使用者的設定。

下圖顯示在指定的作業系統的認證程序**套用至**本主題開頭的清單。

![顯示指定的作業系統的認證程序的圖表 * * 套用至 * * 本主題開頭的清單](../media/credentials-processes-in-windows-authentication/AuthN_CredMan_CredProv.gif)

## <a name="BKMK_CredentialInputForApplicationAndServiceLogon"></a>應用程式和服務登入的認證輸入
Windows 驗證被設計來管理應用程式或服務不需要使用者互動的認證。 在使用者模式中的應用程式是有限系統資源他們擁有存取權，而服務可以有不受限制地存取系統記憶體和外部的裝置。

系統服務和傳輸層級應用程式存取安全性支援提供者 (SSP) 透過安全性支援提供者介面 (SSPI) 在 Windows，可提供函式列舉系統上可用的安全性封裝，選取封裝，並使用該封裝來取得驗證的連線。

當用戶端/伺服器連接已經過驗證：

-   在用戶端連線的應用程式使用 SSPI 函式將認證傳送給伺服器`InitializeSecurityContext (General)`。

-   在伺服器端應用程式連接的 SSPI 函式會回應`AcceptSecurityContext (General)`。

-   SSPI 函式`InitializeSecurityContext (General)`和`AcceptSecurityContext (General)`之前所有必要的驗證訊息已交換為成功，或使驗證失敗，會重複。

-   已驗證的連線之後，在伺服器上的 LSA 會使用從用戶端的資訊來建置的安全性內容，其中包含存取權杖。

-   伺服器可以再呼叫 SSPI 函式`ImpersonateSecurityContext`來將存取權杖附加至服務的模擬執行緒。

**應用程式和使用者模式**

在 Windows 中的使用者模式由兩個系統能夠將 I/O 要求傳遞至適當的核心模式驅動程式所組成： 環境系統中，執行的許多不同類型的作業系統撰寫的應用程式和整數類資料的系統中，運作方式代表環境系統的系統特定函式。

整數類資料的系統管理作業的 system'specific 函式，代表環境系統，並由安全性系統處理序 (LSA)、 工作站服務，以及伺服器服務。 安全性系統處理序處理安全性權杖，授與或拒絕存取基礎資源的權限的使用者帳戶的權限，會處理登入要求起始登入驗證和判斷哪個系統資源的作業系統若要稽核的需求。

應用程式可以執行以使用者模式應用程式可以做任何主體時，包括安全性內容的本機系統 (SYSTEM) 中執行的位置。 應用程式也可以執行在核心模式中的安全性內容的本機系統 (SYSTEM) 中的應用程式可以執行。

SSPI 是可透過 secur32.dll，藉此模組，這是用來取得用於驗證、 訊息完整性和訊息隱私權的整合式的安全性服務 API。 它提供應用程式層級通訊協定及安全性通訊協定之間的抽象層。 SSPI 由於不同的應用程式需要不同的方式，用來識別或驗證使用者和不同的加密資料，因為它會透過網路傳輸的方式，提供存取動態連結程式庫 (Dll) 包含不同的驗證方法和密碼編譯函式。 這些 Dll 會呼叫安全性支援提供者 (Ssp)。

受管理的服務帳戶和虛擬帳戶中導入 Windows Server 2008 R2 和 Windows 7 為重要的應用程式，例如 Microsoft SQL Server 和 Internet Information Services (IIS) 提供自己的網域帳戶，隔離時不需系統管理員手動管理的服務主體名稱 (SPN) 和這些帳戶的認證。 如需有關這些功能，而且在驗證中的角色的詳細資訊，請參閱 <<c0> [ 受管理服務帳戶文件適用於 Windows 7 和 Windows Server 2008 R2](https://technet.microsoft.com/library/ff641731(v=ws.10).aspx)和[群組受控服務帳戶概觀](../group-managed-service-accounts/group-managed-service-accounts-overview.md).

**服務和核心模式**

即使在啟動它們的安全性內容中，執行大部分的 Windows 應用程式，這是使用者的不的服務，則為 true。 使用者啟動電腦時，許多 Windows 服務，例如網路和列印服務，會由服務控制程式啟動。 這些服務可能會以本機服務或本機系統身分執行，而且可能會繼續執行的最後一個的人類使用者登出之後。

> [!NOTE]
> 服務通常會執行在安全性內容中稱為本機系統 (SYSTEM)、 Network Service 或 Local Service。  Windows Server 2008 R2 引進了服務帳戶之下執行受管理的服務，都是網域主體。

開始之前的服務，服務控制站登入所使用的帳戶，指定服務，然後呈現服務的認證來驗證 LSA 中。 Windows 服務會實作服務控制管理員可用來控制服務的程式設計介面。 系統啟動時或手動使用服務控制計劃，可以自動啟動 Windows 服務。 比方說，當 Windows 用戶端電腦加入網域，電腦上的信差服務會連線到網域控制站，並開啟它的安全通道。 若要取得已驗證的連線，服務必須具有遠端電腦的本機安全性授權 (LSA) 信任的認證。 與網路中的其他電腦通訊時，LSA 使用認證的本機電腦的網域帳戶，在本機系統 」 與 「 網路服務的安全性內容中執行的所有其他服務一樣。 以系統身分執行，因此不需要呈現給 LSA 認證的本機電腦上的服務。

檔案 Ksecdd.sys 管理和加密這些認證，並使用 LSA 本機程序呼叫。 檔案類型 DRV （驅動程式），且為核心模式安全性支援提供者 (SSP)，在中指定的版本中已知**套用至**在本主題開頭的清單中，是 FIPS 140-2 層級 1 相容。

核心模式具有完整存取權之電腦的硬體和系統資源。 使用者模式的服務和應用程式存取他們不應該存取的作業系統的重要區域，就會停止核心模式。

## <a name="BKMK_LSA"></a>本機安全性授權
本機安全性授權 (LSA) 是驗證及登入本機電腦的使用者的受保護的系統程序。 颾魤 ㄛ LSA 會維護各方面資訊的本機安全性群組的電腦上 （這些層面統稱為 「 本機安全性原則），並提供各種服務的名稱和安全性識別碼 (Sid) 之間的轉譯。 安全性系統程序，本機安全性授權伺服器服務 (LSASS)，記錄的安全性原則和作用中之電腦系統上的帳戶。

LSA 會驗證使用者的身分識別依據發出的使用者帳戶的下列兩個實體：

-   **本機安全性授權單位。** LSA 可以檢查位於同一部電腦上的安全性帳戶管理員 (SAM) 資料庫，以驗證使用者的資訊。 本機使用者帳戶和本機群組的相關資訊，可以儲存任何工作站或成員伺服器。 不過，這些帳戶可以用於存取只有該工作站或電腦。

-   **本機網域或受信任網域的安全性授權。** LSA 連絡發出之帳戶的實體和要求驗證的帳戶有效，而且要求是來自帳戶的持有者。

本機安全性授權子系統服務 (LSASS) 會代表使用中 Windows 工作階段的使用者，將認證儲存在記憶體中。 預存的認證，讓使用者順暢地存取網路資源，例如檔案共用、 Exchange Server 信箱及 SharePoint 網站，而不必重新輸入其認證，針對每個遠端服務。

LSASS 可以使用多種形式儲存認證，包括：

-   可回復的已加密純文字

-   Kerberos 票證 （票證授權票證 (Tgt)，服務票證）

-   NT 雜湊

-   LAN Manager (LM) 雜湊

如果使用者登入 Windows 使用智慧卡，LSASS 就不會儲存純文字密碼，但它會儲存帳戶和智慧卡的純文字 PIN 對應的 NT 雜湊值。 如果為互動式登入所需的智慧卡啟用帳戶屬性，則會為帳戶自動產生隨機 NT 雜湊值，而不是原始的密碼雜湊。 設定屬性時自動產生的密碼雜湊不會變更。

使用者登入密碼的 LAN Manager (LM) 雜湊與相容的 Windows 型電腦時，這個驗證器存在於記憶體。

您不能停用在記憶體中純文字認證的儲存體，即使需要它們的認證提供者已被停用。

預存的認證直接相關聯的本機安全性授權子系統服務 (LSASS) 登入工作階段已啟動最後一個之後重新啟動並尚未關閉。 例如，當使用者執行下列其中一項動作時，會建立具有儲存的 LSA 認證的 LSA 工作階段：

-   登入本機工作階段或電腦上的遠端桌面通訊協定 (RDP) 工作階段

-   使用 [RunAs] 選項執行工作

-   在電腦上執行使用中的 Windows 服務

-   執行排程的工作或批次工作

-   使用遠端系統管理工具在本機電腦上執行工作

在某些情況下，LSA 密碼，這是祕密只有 SYSTEM 帳戶處理程序能夠存取的資料片段，會儲存在硬碟上。 部分這些密碼是重新開機後必須保留的認證，它們是以加密形式儲存在硬碟上。 儲存為 LSA 密碼的認證可能包括：

-   電腦的 Active Directory 網域服務 (AD DS) 帳戶的帳戶密碼

-   電腦上設定的 Windows 服務的帳戶密碼

-   已設定排程工作的帳戶密碼

-   IIS 應用程式集區及網站的帳戶密碼

-   Microsoft 帳戶的密碼

在 Windows 8.1 引進，用戶端作業系統額外 LSA 提供保護來防止讀取記憶體和插入未受保護的處理程序程式碼。 這項保護可以提升為 LSA 儲存和管理認證的安全性。

如需有關這些額外的保護設定的詳細資訊，請參閱 < [Configuring Additional LSA Protection](../credentials-protection-and-management/configuring-additional-lsa-protection.md)。

## <a name="BKMK_CachedCredentialsAndValidation"></a>快取的認證和驗證
驗證機制會依賴認證的呈現方式，在 登入的時間。 不過，當電腦已中斷連線的網域控制站，並展示使用者網域認證時，Windows 會使用快取認證的程序中的驗證機制。

每次使用者登入網域，Windows 會快取提供的認證，並將它們儲存在登錄中的作業系統安全性登錄區。

使用快取的認證，使用者可以登入網域成員而不必連接至該網域內的網域控制站。


## <a name="BKMK_CredentialStorageAndValidation"></a>認證的儲存體和驗證
您不一定適合用於不同的資源的存取權的一組認證。 比方說，系統管理員可能會想要使用系統管理，而不是使用者認證存取遠端伺服器時。 同樣地，如果使用者存取外部資源，例如銀行帳戶，他或她可以只使用其網域認證與不同的認證。 下列各節會說明認證管理的 Windows 作業系統的目前版本和 Windows Vista 和 Windows XP 作業系統之間的差異。

### <a name="remote-logon-credential-processes"></a>遠端登入認證程序
遠端桌面通訊協定 (RDP) 管理連線到遠端電腦使用遠端桌面用戶端，在 Windows 8 中所導入之使用者的認證。 以純文字形式的認證會傳送至目標主機，主機嘗試執行的驗證程序中，而且，如果成功，使用者連接到允許的資源。 RDP 不會將認證儲存在用戶端，但使用者的網域認證會儲存在 LSASS。

在 Windows Server 2012 R2 和 Windows 8.1 引進，受限的系統管理模式，提供額外的安全性，遠端登入案例。 遠端桌面的這個模式會導致無法執行網路登入挑戰-回應與 NT 單向函式 (NTOWF)，或在驗證遠端主機時，使用 Kerberos 服務票證的用戶端應用程式。 系統管理員驗證之後，系統管理員並沒有個別的帳戶認證 LSASS 中因為它們未提供至遠端主機。 相反地，系統管理員會有工作階段的電腦帳戶認證。 系統管理員不提供認證給遠端主機，因此動作會執行的電腦帳戶。 也會限制為電腦帳戶、 資源和系統管理員無法存取自己的帳戶使用的資源。

### <a name="automatic-restart-sign-on-credential-process"></a>自動重新啟動登入認證程序
當使用者登入 Windows 8.1 裝置上時，LSA 使用者將認證儲存在可存取只能由 LSASS.exe 加密記憶體中。 Windows 更新開始時自動重新啟動而不需要使用者目前狀態，這些認證會用來設定自動登入的使用者。

重新啟動之後，使用者會自動登入透過自動登入機制，，和電腦另外再鎖定來保護使用者的工作階段。 透過 Winlogon，將鎖定所起始的而認證管理由 LSA 的目的。 藉由自動登入，並在主控台上鎖定的使用者工作階段，使用者的鎖定螢幕的應用程式會重新啟動且可用。

如需 ARSO 的詳細資訊，請參閱[Winlogon 自動重新啟動登入&#40;ARSO&#41;](winlogon-automatic-restart-sign-on-arso.md)。

### <a name="stored-user-names-and-passwords-in-windows-vista-and-windows-xp"></a>儲存的使用者名稱和密碼的 Windows Vista 和 Windows XP
在 Windows Server 2008、 Windows Server 2003、 Windows Vista 和 Windows XP**預存使用者名稱和密碼**控制台 中簡化的管理和使用的登入認證，包括使用 X.509 憑證的多個設定組與智慧卡和 Windows Live 認證 （現在稱為 Microsoft 帳戶）。 認證-使用者的設定檔的一部分-直到需要儲存。 這個動作可以確保，如果一個密碼遭到入侵，它不會危害所有安全性，以增加每個資源為基礎的安全性。

使用者登入，並嘗試存取其他受密碼保護的資源，例如在伺服器上，共用之後，如果使用者的預設登入認證來存取，不足**預存使用者名稱和密碼**查詢. 使用正確的登入資訊的替代認證已存入**預存使用者名稱和密碼**，這些認證會用來存取。 否則，提示使用者提供新的認證，然後可供重複使用，稍後登入工作階段或後續的工作階段期間儲存。

下列限制：

-   如果**預存使用者名稱和密碼**包含無效或不正確的認證遭到拒絕特定的資源，資源的存取權，而**預存使用者名稱和密碼**對話方塊不會出現。

-   **儲存使用者名稱和密碼**儲存的認證只會針對 NTLM、 Kerberos 通訊協定、 Microsoft 帳戶 （先前稱為 Windows Live ID) 和安全通訊端層 (SSL) 驗證。 某些版本的 Internet Explorer 維護自己的快取，基本驗證。

這些認證會變成 \Documents and 您 Data\Microsoft\Credentials 目錄中的使用者的本機設定檔中加密的部分。 如此一來，這些認證可以與使用者如果漫遊使用者的網路原則支援漫遊使用者設定檔。 不過，如果使用者擁有的複本**預存使用者名稱和密碼**兩個不同的電腦和變更其中一部電腦上的資源相關聯的認證變更不會傳播至**儲存使用者名稱和密碼**第二部電腦上。

### <a name="windows-vault-and-credential-manager"></a>Windows 保存庫和認證管理員
認證管理員是在 Windows Server 2008 R2 和 Windows 7 引進，為控制台中的功能，來儲存和管理使用者名稱和密碼。 認證管理員可讓使用者在安全的 Windows 保存庫中儲存認證與其他系統和網站。 某些版本的 Internet Explorer 會使用這項功能來驗證網站。

使用認證管理員的認證管理是由本機電腦上的使用者所控制的。 使用者可以儲存和存放支援的瀏覽器及 Windows 應用程式的認證，便於在需要登入這些資源時使用。 在使用者的設定檔中的電腦上，認證會儲存在特殊加密的資料夾。 支援 （透過使用認證管理員 Api)，這項功能，例如網頁瀏覽器應用程式的應用程式會提供其他電腦和網站的正確認證，登入程序。

當網站、 應用程式或透過 NTLM 或 Kerberos 通訊協定的另一部電腦要求驗證，會出現一個對話方塊中選取**更新預設認證**或**儲存密碼**核取方塊。 支援認證管理員 Api 的應用程式會產生此對話方塊可讓使用者儲存在本機的認證。 如果使用者選取**儲存密碼**使用者的使用者名稱、 密碼和驗證服務正在使用的相關的資訊，會持續追蹤的核取方塊，認證管理員。

下一次使用服務時，認證管理員就會自動提供 Windows 保存庫中儲存的認證。 如果不接受這個認證，則會提示使用者輸入正確的存取資訊。 如果使用新的認證授與存取權時，認證管理員會覆寫先前的認證，以新的然後再將新的認證儲存 Windows 保存庫中。

## <a name="BKMK_SAM"></a>安全性帳戶管理員資料庫
安全性帳戶管理員 (SAM) 會儲存本機使用者帳戶和群組的資料庫。 存在於每個 Windows 作業系統中;不過，當電腦已加入網域，Active Directory 管理 Active Directory 網域中的網域帳戶。

例如，執行 Windows 作業系統的用戶端電腦參與網路網域的網域控制站進行通訊，即使沒有任何人的使用者登入。 若要起始通訊，電腦必須具有有效的帳戶網域中。 之前接受從電腦的通訊，網域控制站上的 LSA 來驗證電腦的身分識別，並接著建構電腦的安全性內容，就如同人性化的安全性主體。 此安全性內容會定義在特定電腦或使用者、 服務或網路上的電腦上的身分識別和能力的使用者或服務。 比方說，存取權杖包含在安全性內容內定義可存取的資源 （例如檔案共用或印表機） 和可由該主體的使用者、 電腦或服務上所執行的動作 （例如讀取、 寫入或修改）資源。

使用者或電腦的安全性內容有所不同從一部電腦到另一個，例如當使用者登入伺服器或工作站使用者自己的主要工作站以外。 也有可能從一個工作階段到另一個，例如當系統管理員修改使用者的權利與權限。 此外，安全性內容時，通常不同使用者或電腦正在以獨立的為基礎，在網路中，或做為 Active Directory 網域的一部分。

## <a name="BKMK_LocalDomainsAndTrustedDomains"></a>本機網域和受信任的網域
存在信任時兩個網域之間，針對每個網域的驗證機制會依賴來自其他網域驗證的有效性。 信任說明可提供對資源網域 （信任的網域） 中的共用資源的控制的存取，藉由驗證連入驗證要求是來自受信任的授權單位 （受信任的網域）。 如此一來，信任會做為橋接器，只讓已驗證的網域之間的驗證要求移動。

特定的信任的驗證要求的傳遞方式，端視其設定方式而定。 藉由提供每個網域中其他網域資源的存取可以藉由提供受信任的網域中信任的網域中，資源的存取，單向或雙向、 信任關係。 信任是也非轉移的在此情況下，只有兩個信任的夥伴網域之間，存在信任或可轉移的在此情況下信任自動延伸至其中一個夥伴所信任的任何其他網域。

如需有關驗證的網域和樹系信任關係資訊，請參閱[委派驗證以及信任關係](https://technet.microsoft.com/library/dn169022.aspx)。

## <a name="BKMK_CertificatesInWindowsAuthentication"></a>在 Windows 驗證的憑證
公開金鑰基礎結構 (PKI) 是軟體、 加密技術，處理序和服務，可讓組織可以保護本身的通訊與商務交易的組合。 PKI 能夠安全通訊與商務交易為基礎的數位簽章，之間已驗證的使用者和受信任的資源交換。

數位憑證是電子文件，其中包含其所屬的實體，它由所發出的實體、 唯一的序號或其他唯一的識別、 發行和到期日和數位指紋相關資訊。

驗證是判斷是否可以信任遠端主機的程序。 若要建立可信度，遠端主機必須提供一個可接受的驗證憑證。

遠端主機建立彼此的從憑證授權單位 (CA) 取得憑證。 CA，接著可以從較高的授權，這會建立信任鏈結的憑證。 若要判斷是否可信任的憑證，必須判斷的根 CA，識別應用程式，並將其再判斷它是否可信任中。

同樣地，在遠端主機或本機電腦必須判斷是否是真確的使用者或應用程式所提供的憑證。 透過 LSA 和 SSPI 使用者所提供的憑證會驗證本機登入本機電腦上、 在網路上，或在網域上評估，透過 Active Directory 中的憑證存放區。

若要產生一個憑證，驗證資料通過雜湊演算法，例如安全雜湊演算法 1 (SHA1)，來產生訊息摘要。 藉由使用寄件者的私密金鑰來證明訊息摘要由傳送者產生然後數位簽章的訊息摘要。

> [!NOTE]
> SHA1 是 Windows 7 和 Windows Vista 中，預設值，但已變更為 Windows 8 中的 SHA2。

**智慧卡驗證**

智慧卡技術是憑證型驗證的範例。 登入具有智慧卡的網路提供有力的驗證，因為它會使用加密型識別和證明所有權時驗證網域使用者。 Active Directory 憑證服務 (AD CS) 提供的密碼編譯基礎識別透過發行的每個智慧卡的登入憑證。

智慧卡驗證的相關資訊，請參閱[Windows 智慧卡技術參考](https://technet.microsoft.com/library/ff404297.aspx)。

Windows 8 中引進了虛擬智慧卡技術。 它會將智慧卡的憑證儲存在電腦，然後藉由使用裝置的防篡改信賴平台模組 (TPM) 安全性晶片可保護。 如此一來，電腦就會真的變成智慧卡必須接收使用者的 pin 碼才能進行驗證。

**遠端和無線驗證**

另一項技術使用憑證來驗證遠端與無線網路驗證。 網際網路驗證服務 (IAS) 和虛擬私人網路伺服器使用可延伸驗證通訊協定-傳輸層級安全性 (EAP-TLS)、 受保護的可延伸驗證通訊協定 (PEAP) 或網際網路通訊協定安全性 (IPsec)執行許多類型的網路存取權，包括虛擬私人網路 (VPN) 和無線連線的憑證型驗證。

如需在網路中的憑證為基礎的驗證資訊，請參閱[網路存取驗證與憑證](https://technet.microsoft.com/library/cc759575(WS.10).aspx)。

## <a name="BKMK_SeeAlso"></a>另請參閱
[Windows 驗證概念](https://technet.microsoft.com/library/d169018.aspx)


