---
ms.assetid: 6f50476c-a1f1-48fb-999b-76c4c3816496
title: 規劃危害因應措施
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 0f6a30c91590667a0894b52ec7c188a43bd5e351
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59835569"
---
# <a name="planning-for-compromise"></a>規劃危害因應措施

>適用於：Windows Server 2016 中，Windows Server 2012 R2 中，Windows Server 2012

*法律第一：沒有人認為不正確的任何項目可能會發生，直到它執行。* - [10 不變法則安全性管理](https://technet.microsoft.com/library/cc722488.aspx)  
  
在許多組織中的災害復原計劃專注於從區域性災害提供防護或導致遺失的運算服務的失敗中復原。 不過，當使用遭入侵的客戶，我們經常從蓄意入侵復原不存在其災害復原計劃中。 危害造成竊取智慧財產或刻意的解構 （例如利用邏輯界限 （例如，解構所有的 Active Directory 網域或所有的伺服器） 而不是實體界限時，這是特別是，則為 true解構的資料中心）。 雖然組織可能會定義初始的活動，才會在探索到遭到入侵時的事件回應計劃，這些計劃通常會省略復原遭到入侵，會影響整個運算基礎結構的步驟。  
  
Active Directory 使用者、 伺服器、 工作站和應用程式提供豐富的身分識別和存取管理功能，因為它是無可避免地作為攻擊目標。 如果攻擊者取得高特殊權限的存取權的 Active Directory 網域或網域控制站，該存取可以用來存取、 控制或甚至摧毀整個 Active Directory 樹系。  
  
本文已說明一些最常見的攻擊，針對 Windows 與 Active Directory 和因應對策，您可以實作以減少攻擊面，但唯有復原 Active Directory 的危害時，就是發生前，請做好遭到入侵。 本節著重於降低對技術的實作細節比本文件的前幾節及更高層級的建議可供您建立全面且完整的方法，來保護及管理您的組織要徑業務和 IT 資產。  
  
是否永遠不會遭到攻擊您的基礎結構，具有 resisted 嘗試的缺口，或具有拼裝攻擊和已完全洩露，您應該規劃無可避免的事實，您會一再遭受攻擊。 不可能防止攻擊，但它確實可以避免重大漏洞或批發洩露。 每個組織應該仔細評估其現有的風險管理應用程式，並進行必要的調整，以減少整體所佔的弱點可能會藉由在預防、 偵測、 內含項目及復原的平衡投資。  
  
若要建立有效的防禦功能，還能提供服務給使用者和取決於您的基礎結構和應用程式的企業，您可能需要考慮全新的方式，若要避免，偵測，和包含入侵您的環境中並再復原遭到入侵。 本文件中的建議與方法可能無法幫助您修復遭入侵的 Active Directory 安裝，但可協助您保護您的下一個。  
  
復原 Active Directory 樹系的建議會出現在[Windows Server 2012:規劃 Active Directory 樹系復原](https://www.microsoft.com/download/details.aspx?id=16506)。 您可以防止您新的環境，完全受到危害，但即使無法處理，您必須復原並重新取得控制您環境的工具。  
  
## <a name="rethinking-the-approach"></a>重新思考方法  
*法律編號八個：保護網路的困難度是其複雜度成正比。* - [10 不變法則安全性管理](https://technet.microsoft.com/library/cc722488.aspx)  
  
它是通常接受度，如果攻擊者取得系統、 系統管理員、 根或對等電腦的存取權，不論作業系統為何該電腦可以不再視為可信任，無論多少工作不會對 「 清除 」系統。 Active Directory 並無不同。 如果攻擊者取得特殊權限的存取權的網域控制站或高特殊權限的帳戶在 Active Directory 中，除非您有攻擊者會讓每個修改或已知的良好備份的記錄，您永遠不會還原至目錄完全可信任的狀態。  
  
當成員伺服器或工作站是入侵和攻擊者竄改時，電腦不再受信任、，但鄰近遭入侵的伺服器和工作站仍然是受信任。 一部電腦的危害並不表示所有的電腦遭到入侵。  
  
不過，在 Active Directory 網域中，所有網域控制站會都裝載相同的 AD DS 資料庫的複本。 如果單一網域控制站遭到入侵，攻擊者修改 AD DS 資料庫，這些修改會複寫每個其他網域控制站在網域中，並根據在其中進行修改，樹系的資料分割。 即使您重新安裝每個樹系中的網域控制站，您只需重新安裝 AD DS 資料庫所在的主機。 有人惡意修改 Active Directory 會一樣，它們會複寫到已運行多年的網域控制站複寫到全新安裝的網域控制站。  
  
在評估遭洩露的環境，我們常發現，什麼屬第一次的缺口 「 事件 」 實際上週之後，數個月，或甚至幾年之後觸發攻擊者一開始有入侵環境。 攻擊者通常取得長高特殊權限帳戶的認證，才能偵測到缺口，和他們用來危害 directory、 網域控制站、 成員伺服器、 工作站，這些帳戶，並甚至連接非 Windows系統。  
  
這些結果會一致 Verizon 的 2012年資料缺口調查報表中，指出所發現的數個錯誤：  
  
-   從外部代理程式詞幹分析的資料外洩的 98%  
  
-   85%的資料外洩花費數週或更多問題來探索  
  
-   92%的事件所探索到由協力廠商和  
  
-   缺口 97%是適當雖然簡單，或是中繼控制項。  
  
危害到稍早所述的程度是實際上無法修復，以及標準的建議，以 「 壓平合併，並重建 「 每個遭入侵的系統不只是可行或甚至可能被盜用或終結 Active Directory。 即使還原至已知的良好狀態時，不會排除允許在第一時間入侵環境的缺陷。  
  
雖然您必須保護您的基礎結構的各個層面，攻擊者只需要在您的防禦措施，以取得其所需的目標中找到足夠的缺陷。 如果您的環境是相當簡單且 contoso-pc，以及在過去妥善管理，然後實作稍早在本文件中提供的建議可能是簡單的主張。  
  
不過，我們發現，較舊、 較大，且更複雜的環境、 更有可能是這份文件中的建議會不可行或甚至根本不可能實作。 它是很難在事後保護基礎結構，比從頭開始，並建構能抵抗攻擊及洩露的環境。 但如先前所述，進行重建整個 Active Directory 樹系不小。 基於這些理由，我們建議更集中，鎖定目標的方法，來保護您的 Active Directory 樹系。  
  
而不是將焦點放在與嘗試修復所有的事情是 「 已中斷 」，請考慮對您的業務，並在您的基礎結構中最重要根據您設定的方法。 而不是嘗試修復填滿過時、 設定不正確的系統和應用程式的環境，請考慮建立新小型、 安全的環境到其中，您可以安全地移植使用者、 系統與資訊是最關鍵的程式商務。  
  
在本節中，我們會說明您可以建立原始的 AD DS 樹系做為 「 壽命船隻 」 或核心商務基礎結構的 「 安全儲存格 」 的方法。 原有的樹系是只是新安裝 Active Directory 樹系，通常僅限於大小和範圍，而且這會建置使用目前作業系統、 應用程式，以及所述的原則[減少作用目錄受攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)。  
  
藉由實作建議的組態設定的新建置的樹系中，您可以建立會從頭建置，設定與安全的設定和作法，AD DS 安裝，而且您可以降低隨附支援舊有系統的挑戰和應用程式。 雖然設計和實作原有的 AD DS 安裝的詳細的指示超出本文的範圍，您應該遵循一些一般原則和建立 「 安全儲存格 」 可在其中您存放您最重要的指導方針資產。 這些指導方針如下所示：  
  
1.  識別用於隔離和保護重要資產的原則。  
  
2.  定義有限的、 以風險為基礎的移轉計劃。  
  
3.  如有必要，請利用 「 nonmigratory 」 移轉。  
  
4.  實作 「 creative 解構。 」  
  
5.  隔離舊版系統和應用程式。  
  
6.  簡化使用者的安全性。  
  
### <a name="identifying-principles-for-segregating-and-securing-critical-assets"></a>識別原則隔離和保護重要資產  

建立房屋的重要資產的原有環境特性可能大不相同。 例如，您可以選擇建立原有的樹系，其中移轉只有 「 VIP 使用者 」 和 「 只有這些使用者可以存取的敏感性資料。 您可以建立原有的樹系，在其中您移轉不只有 VIP 使用者，但是您實作為系統管理樹系，實作原則中所述[減少 Active Directory 的攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)建立安全系統管理帳戶和可用來管理您舊版的樹系原有的樹系中的主機。 您可能會實作 「 特殊用途 」 的樹系裝載 VIP 帳戶、 特殊權限的帳戶和唯一的目標是要使其與較不安全隔離需要額外的安全性，例如執行 Active Directory 憑證服務 (AD CS) 伺服器的系統樹系。 最後，您可以實作原有的樹系會變成的實際位置，針對所有新的使用者、 系統、 應用程式和資料，可讓您將最終解除委任您透過損耗的舊版樹系。  
  
不論是否您原有的樹系包含少數幾個使用者和系統或其構成更積極的移轉的基礎，您應該遵循這些原則，您的計劃：  
  
1.  假設您舊版的樹系已遭入侵。  
  
2.  雖然您可以設定信任的原有的樹系的舊版環境未設定信任舊版的樹系中，一個原有環境。  
  
3.  不會移轉使用者帳戶或群組從舊版的樹系到原始環境如果有可能的帳戶的群組成員資格、 SID 歷程記錄或其他屬性可能已遭到惡意修改。 相反地，使用"nonmigratory 」 方法來填入原有的樹系。 （nonmigratory 方法稍後會說明這一節。）  
  
4.  不將舊版的樹系的電腦移轉至原有的樹系。 實作原有的樹系中的全新安裝的伺服器，全新安裝的伺服器上安裝應用程式，將應用程式資料移轉至新安裝的系統。 檔案伺服器、 將資料複製到新安裝的伺服器，使用新樹系中使用者和群組設定 Acl，然後建立列印伺服器以類似的方式。  
  
5.  不允許安裝舊版的作業系統或應用程式原有的樹系中。 如果無法更新並重新安裝應用程式，將它留在舊版的樹系，並考慮 creative 破壞，來取代應用程式的功能。  
  
### <a name="defining-a-limited-risk-based-migration-plan"></a>定義有限的、 以風險為基礎的移轉計劃  
建立有限制，以風險為基礎的移轉計劃只是表示在決定移轉到您原有的樹系，哪些使用者、 應用程式和資料，您應該識別的程度的話，您的組織已向公開的風險為基礎的移轉目標的使用者或系統遭到入侵。 VIP 使用者的帳戶是最有可能會成為攻擊目標應該儲存在原始樹系中。 提供原有的樹系，全新內建的伺服器上應該安裝重要的商務功能與高度機密的資料應該移至應用程式保護原有的樹系中的伺服器。  
  
如果您未在 Active Directory 環境中已經有清楚的大多數的關鍵業務的使用者、 系統、 應用程式和資料，請使用業務單位，來識別它們。 應該識別業務運作所需的任何應用程式，為應該在其執行關鍵應用程式，或儲存重要資料的任何伺服器。 藉由識別的使用者和持續運作您組織所需的資源，您可以建立自然優先要專注的資產的集合。  
  
### <a name="leveraging-nonmigratory-migrations"></a>利用 「 Nonmigratory 」 移轉  
您知道您的環境已遭入侵，是否會懷疑它遭到洩露，或只是不想要從舊版的 Active Directory 安裝的舊版資料和物件移轉至新的分支，請考慮非技術上執行的移轉方法「 移轉 」 的物件。  
  
### <a name="user-accounts"></a>使用者帳戶  
在傳統 Active Directory 移轉時從一個樹系之間，使用者物件上的 SIDHistory （SID 歷程記錄） 屬性用來儲存使用者的 SID，而且使用者已在舊版的樹系中的成員群組的 Sid。 如果使用者帳戶移轉至新的樹系，而且他們存取舊版的樹系中的資源，SID 歷程記錄中的 Sid 用來建立存取權杖，可讓使用者存取，他們有權存取之前已移轉之帳戶的資源。  
  
維護 SID 歷程記錄，不過，已證明有問題，在某些環境擴展使用者的目前和歷程記錄的 sid 的存取權杖，因此可能會導致語彙基元的膨脹。 語彙基元的膨脹是必須儲存在使用者的存取權杖的 Sid 數目會使用的問題，或超過權杖中的可用空間數量。  
  
權杖大小可以增加有限範圍，雖然權杖膨脹的終極解決方案是以減少與使用者帳戶相關聯的 Sid 數目是否合理化群組成員資格，消除 SID 歷程記錄或兩者的組合。 多個語彙基元的膨脹的詳細資訊，請參閱[MaxTokenSize 和 Kerberos 語彙基元膨脹](http://blogs.technet.com/b/shanecothran/archive/2010/07/16/maxtokensize-and-kerberos-token-bloat.aspx)。  
  
而不是從傳統環境移轉使用者 （特別是一個群組成員資格和 SID 歷程記錄可能遭到入侵） 藉由使用 SID 歷程記錄，需要考慮利用中繼資料目錄的應用程式，以將 「 移轉 」 的使用者，不用將 SID 歷程記錄到新的樹系。 使用者帳戶會建立新樹系中，您可以使用中繼資料目錄的應用程式，若要將帳戶對應到其對應的帳戶，在舊版的樹系中。  
  
若要提供新的使用者帳戶存取權的舊版的樹系中的資源，您可以使用的中繼資料目錄的工具來識別資源群組，其中使用者的舊帳戶被授與存取，並再將使用者的新帳戶新增至這些群組。 根據您在舊版的樹系中的群組策略，您可能需要建立資源存取的網域本機群組，或將現有的群組轉換為網域本機群組，以允許新的帳戶，以新增至資源群組。 藉由專注於最重要的應用程式和資料的第一次，並將它們移轉到新的環境 （不論有沒有 SID 歷程記錄），您可以限制舊版環境中所耗用的投入的量。  
  

  
### <a name="servers-and-workstations"></a>伺服器和工作站  
在傳統的移轉，從一個 Active Directory 樹系到另一個移轉的電腦通常是相當簡單相較於移轉使用者、 群組和應用程式。 根據電腦的角色，移轉至新的樹系可以是簡單，只要取消聯結舊的網域，並加入新的。 不過，移轉保持不變的電腦帳戶至原有的樹系失效的目的建立全新的環境。 而不是移轉 （可能遭到入侵、 設定不正確，或過期） 的電腦帳戶到新的樹系，全新應該在新的環境中安裝伺服器和工作站。 您可以從舊版的樹系中原有的樹系中，系統中的系統，但不是系統移轉資料，該存放資料。  
  
### <a name="applications"></a>應用程式  

應用程式會在一個樹系中任何移轉至另一個提供的最重要的挑戰，但如果"nonmigratory 」 移轉時，是最基本的原則應該套用的其中一個是原有的樹系中的應用程式應該是最新狀態，支援，以及全新安裝。 可能的話，就可以從舊的樹系中的應用程式執行個體移轉資料。 在其中應用程式無法 「 重新建立 「 原有的樹系中的情況下，在中，您應該考慮例如 creative 解構或舊版的應用程式隔離的方式下一節中所述。  
  
### <a name="implementing-creative-destruction"></a>實作有創意的解構  
Creative 解構是順序的描述損毀的先前所建立的經濟開發經濟效益詞彙。 近年來，一詞已對資訊技術。 它通常是指機制就會被淘汰的舊的基礎結構，不是藉由升級，但它完全新的項目取代。 2011年[Gartner Symposium ITXPO](http://www.gartner.com/technology/symposium/orlando/)的 Cio 和資深 IT 主管會呈現為降低成本並增加其索引鍵的佈景主題的其中一個有創意的解構的效率。 為程序的自然 outgrowth 可能會有安全性的改進。  

例如，組織可能會包含使用不同的應用程式執行類似的功能，有不同程度的現代化及廠商支援的多個業務單位。 在過去，IT 可能負責分別維護每個業務單位的應用程式，並嘗試找出哪一個應用程式提供最佳的功能，然後將資料移轉到，包含彙總工作與其他應用程式。  
  
在 creative 解構，而不是維護過時或重複的應用程式，您可以實作全新的應用程式，若要取代舊，請將資料移轉至新的應用程式，並解除委任舊的應用程式和其執行所在的系統。 在某些情況下，您可以實作的舊版應用程式的創意解構藉由部署新的應用程式，在您自己的基礎結構，但可能的話，您應該考慮改為移植應用程式以雲端為基礎的解決方案。  
  
藉由部署雲端應用程式來取代傳統的內部應用程式，不僅減少維護工作和成本，但您減少您組織的受攻擊面藉由消除舊版系統和出現弱點的應用程式若要利用的攻擊者。 此方法提供更快的方法，以取得所需的功能時同時消除舊版基礎結構中的目標組織。 雖然有創意的解構的原則不會套用到所有的 IT 資產，它會提供通常可行的選項，以同時部署強固、 安全、 雲端式應用程式時，排除傳統系統和應用程式。  
  
### <a name="isolating-legacy-systems-and-applications"></a>隔離舊版系統和應用程式  
移轉您的業務關鍵的使用者和系統原有的安全環境的自然 outgrowth 是較不重要的資訊和系統，將包含您舊版的樹系。 雖然在舊版的作業系統和維持在較不安全的環境中的應用程式可能呈現提升權限遭到入侵的風險，但它們也代表降低受危害的嚴重性。 藉由隸屬和現代化您的重要的商務資產，您可以專注於部署有效的管理和監視時不需要以符合舊版的設定及通訊協定。  
  
當您有隸屬您原有的樹系的重要資料時，您可以評估選項，以進一步隔離舊版系統和 「 主要 」 的 AD DS 樹系中的應用程式。 雖然您可能會實作 creative 破壞，來取代一個應用程式和其執行所在的伺服器，在其他情況下您可能會考慮進一步的隔離，最不安全的系統和應用程式。 例如，應用程式，會使用少數幾個使用者，但這需要傳統的認證，例如 LAN Manager 雜湊可移轉至一個小型網域您會建立以支援您有沒有取代選項的系統。  
  
藉由從它們強制執行舊版的設定實作的網域中移除這些系統，您接著可以增加網域的安全性設定，以支援只有目前的作業系統和應用程式。 雖然最好是解除委任舊有系統和應用程式盡可能。 如果解除委任，只需不適用舊版的人口的一小區段分離到不同的 「 網域 」 （或稱 「 樹系 」） 可讓您執行累加式改進舊版安裝的其餘部分。  
  
### <a name="simplifying-security-for-end-users"></a>為使用者簡化安全性  
在大部分的組織，通常在組織中具有其角色由於最敏感資訊的存取權的使用者會有最少的時間來投入學習複雜的存取限制和控制項。 雖然您應該在組織中有完整安全性教育計劃的所有使用者，您也應該專注於使方式很簡單，盡可能使用藉由實作透明且簡化原則的使用者控制項的安全性遵守。  
  
例如，您可以定義的原則，在其中主管和其他 Vip 才能使用安全的工作站存取敏感性資料和系統，允許使用者使用他們的其他裝置來存取較不敏感的資料。 這是要記住，使用者的簡單原則，但您可以實作一些後端的控制項，可協助強制執行的方法。  

您可以使用[驗證機制保證](https://technet.microsoft.com/library/dd391847(v=WS.10).aspx)以允許存取敏感性資料，只有其登入，使用智慧卡，讓安全系統，以及使用 IPsec，而且使用者權限限制，以控制使用者從中他們可以連線到敏感性資料的儲存機制的系統。 您可以使用[Microsoft 資料分類工具組](https://www.microsoft.com/download/details.aspx?id=27123)若要建置穩固的檔案分類基礎結構，而且您可以實作[動態存取控制](http://blogs.technet.com/b/windowsserver/archive/2012/05/22/introduction-to-windows-server-2012-dynamic-access-control.aspx)限制對基礎資料存取存取嘗試，轉譯技術控制項中的商務規則的特性。  
  
從使用者的觀點來看，存取從受保護的系統 「 如同，」 的敏感性資料，並嘗試執行此作業的不安全的系統從"就不會 」。 不過，監視及管理您的環境的觀點而言，您就可協助建立可辨識的模式中使用者如何存取敏感性資料和系統，讓您更輕鬆地偵測出異常的存取嘗試。  
  
在 使用者防禦冗長且複雜的密碼已導致沒有足夠的密碼原則，特別是針對 VIP 使用者的環境考慮替代的方法，來驗證，不論是透過智慧卡 (其中有多種板型規格和其他功能加強驗證）、 生物特徵辨識的控制項，例如手指撥動讀卡機或甚至驗證資料保護的受信任平台模組 (TPM) 晶片中使用者的電腦。 雖然多重要素驗證不會防止認證竊取攻擊，如果電腦已遭感染的藉由為使用者提供簡單易用的驗證控制項，您可以指派更強固的密碼給使用者的帳戶的傳統使用者名稱和密碼的控制項不靈活。  
