---
ms.assetid: 6f50476c-a1f1-48fb-999b-76c4c3816496
title: 規劃危害因應措施
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: d3d08e954b7a2a9ce58eb61dec54f2848ab68c12
ms.sourcegitcommit: 083ff9bed4867604dfe1cb42914550da05093d25
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/14/2020
ms.locfileid: "75949167"
---
# <a name="planning-for-compromise"></a>規劃危害因應措施

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

*第一條定律：沒有人認為可能發生的任何錯誤。* - [安全性管理的10個不可變法則](https://technet.microsoft.com/library/cc722488.aspx)  
  
許多組織中的嚴重損壞修復計畫，著重于從導致計算服務遺失的區域性災難或失敗中復原。 不過，在與遭入侵的客戶合作時，我們通常會發現在其嚴重損壞修復計畫中不會有刻意洩露的復原。 特別是當洩露會導致智慧財產權遭竊或利用邏輯界限（例如，銷毀所有 Active Directory 網域或所有伺服器）而非實體界限（例如資料中心的銷毀）。 雖然組織可能會有事件回應計畫，以定義在發現洩露時要採取的初始活動，但這些計畫通常會省略會影響整個運算基礎結構的危害復原的步驟。  
  
因為 Active Directory 為使用者、伺服器、工作站和應用程式提供豐富的身分識別和存取管理功能，所以攻擊者一定會將其設為目標。 如果攻擊者取得 Active Directory 網域或網域控制站的高特殊許可權存取權，就可以利用該存取權來存取、控制或甚至摧毀整個 Active Directory 樹系。  
  
本檔已討論過 Windows 的一些最常見的攻擊，以及您可以執行來減少受攻擊面的 Active Directory 和對策，但是在 Active Directory 的完整入侵時，唯一要復原的方法是已準備好在發生之前進行入侵。 本節的重點不在於本檔先前章節的技術執行詳細資料，還有更多關於高階建議的資訊，可讓您用來建立全面、完整的方法來保護及管理貴組織的關鍵商務和 IT 資產。  
  
無論您的基礎結構從未遭受攻擊、resisted 嘗試的缺口，或是 succumbed 攻擊並已完全洩露，您都應該規劃不容易遭到入侵的可能性。 您無法預防攻擊，但確實可以避免嚴重的缺口或大規模的入侵。 每個組織都應該仔細評估其現有的風險管理計劃，並進行必要的調整，藉由在預防、偵測、內含專案和復原方面達到平衡的投資，協助降低整體的弱點等級。  
  
若要建立有效的防禦，同時對依賴您基礎結構和應用程式的使用者和企業提供服務，您可能需要考慮 novel 的方法來防止、偵測並包含您環境中的漏洞，然後再進行復原。入侵。 本檔中的方法與建議可能無法協助您修復遭盜用的 Active Directory 安裝，但可協助您保護下一個。  
  
Windows Server 2012 中會顯示覆原 Active Directory 樹系的建議[：規劃 Active Directory 樹](https://www.microsoft.com/download/details.aspx?id=16506)系復原。 您可能可以防止新的環境完全遭到入侵，但是即使您無法這樣做，您還是可以使用工具來復原和重新取得環境的控制權。  
  
## <a name="rethinking-the-approach"></a>重新思考方法  
*定律號碼8：網路防禦的困難在於其複雜性。* - [安全性管理的10個不可變法則](https://technet.microsoft.com/library/cc722488.aspx)  
  
一般來說，如果攻擊者已取得電腦的系統、管理員、根目錄或對等的存取權（無論作業系統為何），該電腦就無法再被視為值得信任，無論是多少努力「清理」筆記本電腦. Active Directory 並無不同。 如果攻擊者已在 Active Directory 中取得網域控制站或高許可權帳戶的特殊許可權存取權，除非您有一筆記錄，其中包含攻擊者所進行的每項修改或已知良好的備份，否則您絕對無法將目錄還原至完整的值得信賴的狀態。  
  
當成員伺服器或工作站遭到攻擊者入侵並改變時，電腦就不再值得信任，但是鄰近的無危害伺服器和工作站仍然可以受到信任。 一部電腦的危害並不代表所有電腦都會遭到入侵。  
  
不過，在 Active Directory 網域中，所有網域控制站都會裝載相同 AD DS 資料庫的複本。 如果單一網域控制站遭到入侵，且攻擊者修改 AD DS 資料庫，則這些修改會複寫到網域中的其他所有網域控制站，並根據進行修改的磁碟分割（樹系）。 即使您重新安裝樹系中的每個網域控制站，您只需要重新安裝 AD DS 資料庫所在的主機。 對於 Active Directory 的惡意修改，將會輕易地複寫到全新安裝的網域控制站，因為它們會複寫到已執行多年的網域控制站。  
  
在評估遭入侵的環境時，我們通常會發現在幾周、幾個月或甚至幾年之後，攻擊者一開始就會觸發第一個缺口「事件」。 攻擊者通常會在偵測到缺口之前，取得高許可權帳戶的認證，並利用這些帳戶來危害目錄、網域控制站、成員伺服器、工作站，甚至是連線非 Windows系統工程.  
  
這些結果與 Verizon 的2012資料缺口調查報告中的幾個發現一致，這表示：  
  
-   從外部代理程式詞幹分析的98% 資料缺口  
  
-   85% 的資料缺口花費數周或更多時間來探索  
  
-   協力廠商探索到92% 的事件，以及  
  
-   97% 的漏洞是透過簡單或中繼控制項肇因。  
  
稍早所述的程度的洩露實際上是無法修復的問題，而在 Active Directory 遭到入侵或損毀的情況下，「簡維和重建」的標準建議也不是可行的。 即使還原到已知的良好狀態，也不會讓環境在一開始就遭到入侵。  
  
雖然您必須保護基礎結構的每個層面，但攻擊者只需要在您的防禦中找出足夠的瑕疵，就能達到其所需的目標。 如果您的環境相當簡單且初始化，而且在經過妥善管理的情況下，則執行本檔稍早所提供的建議可能是直接的做法。  
  
不過，我們發現較舊、較大且更複雜的環境，這是本檔中的建議可能不可行或甚至無法執行的可能性。 比起從頭開始，以及建立可抵抗攻擊和危害的環境，在實際的情況之下，保護基礎結構會更加困難。 但如先前所述，重建整個 Active Directory 樹系並不是很小的事。 基於這些理由，建議您採用更具針對性的目標方法來保護您的 Active Directory 樹系。  
  
並不是專注于並嘗試修正「中斷」的所有專案，而是考慮依據您的業務和基礎結構中最重要的動作來排定優先順序的方法。 請考慮建立新的小型安全環境，讓您可以安全地將最重要的使用者、系統和資訊移植到您的，而不是嘗試補救已過期、設定錯誤的系統和應用程式的環境。公司.  
  
在本節中，我們會說明一種方法，讓您建立初始化 AD DS 樹系，做為核心商務基礎結構的「生命船」或「安全資料格」。 初始化樹系只是新安裝的 Active Directory 樹系，通常會在大小和範圍內受到限制，而且是使用目前的作業系統、應用程式，以及[減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)中所述的原則所建立的。  
  
藉由在新建立的樹系中執行建議的設定，您可以建立從全新建立的 AD DS 安裝，並提供安全的設定和作法，而且可以減少支援舊版系統的挑戰，以及應用程式. 雖然 AD DS 初始化的設計和執行的詳細指示不在本檔的討論範圍內，但您應該遵循一些一般的原則和指導方針來建立「安全資料格」，您可以在其中存放最重要的固定資產. 這些指導方針如下：  
  
1.  識別用來隔離和保護重要資產的原則。  
  
2.  定義有限、以風險為基礎的遷移計畫。  
  
3.  視需要運用「nonmigratory」遷移。  
  
4.  實行「創意的銷毀」。  
  
5.  找出舊版的系統和應用程式。  
  
6.  簡化終端使用者的安全性。  
  
### <a name="identifying-principles-for-segregating-and-securing-critical-assets"></a>識別用來隔離和保護重要資產的原則  

您所建立用來存放重要資產的初始化環境特性，可能會有很大的差異。 例如，您可以選擇建立初始化樹系，只遷移使用者只能存取的 VIP 使用者和敏感性資料。 您可以建立初始化樹系，而不只遷移 VIP 使用者，而是將其實作為系統管理樹系，並實行[降低 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)來建立安全的系統管理帳戶和主機（可用於從初始化樹系管理舊版樹系）中所述的原則。 您可以執行「專門建立」的樹系，其中裝載 VIP 帳戶、特殊許可權帳戶，以及需要額外安全性的系統，例如執行 Active Directory 憑證服務（AD CS）的伺服器，其唯一目的是將它們與較不安全的隔離。樹系. 最後，您可能會執行初始化樹系，使其成為所有新使用者、系統、應用程式和資料的實際位置，讓您最終可以透過流失解除委任舊版樹系。  
  
無論您的初始化樹系是否包含少數的使用者和系統，或其構成更積極的遷移基礎，您都應該遵循規劃中的下列原則：  
  
1.  假設您的舊版樹系已遭入侵。  
  
2.  請勿將初始化環境設定為信任舊版樹系，雖然您可以將舊版環境設定為信任初始化樹系。  
  
3.  如果可能已惡意修改帳戶的群組成員資格、SID 歷程記錄或其他屬性，請不要將使用者帳戶或群組從舊版樹系遷移至初始化環境。 相反地，請使用 "nonmigratory" 方法來填入初始化樹系。 （本節稍後會說明 Nonmigratory 方法）。  
  
4.  請勿將電腦從舊版樹系遷移至初始化樹系。 在初始化樹系中執行全新安裝的伺服器，在全新安裝的伺服器上安裝應用程式，並將應用程式資料移轉至新安裝的系統。 若是檔案伺服器，請將資料複製到全新安裝的伺服器，使用新樹系中的使用者和群組來設定 Acl，然後以類似的方式建立列印伺服器。  
  
5.  不允許在初始化樹系中安裝舊版作業系統或應用程式。 如果應用程式無法更新並安裝在最新的版本中，請將它保留在舊版樹系中，並考慮有創意的銷毀方式來取代應用程式的功能。  
  
### <a name="defining-a-limited-risk-based-migration-plan"></a>定義以風險為基礎的有限遷移計畫  
建立有限、以風險為基礎的遷移計畫，只是表示在決定要遷移至初始化樹系的使用者、應用程式和資料時，您應該根據組織公開的風險程度來識別遷移目標（如果其中一個使用者或系統遭到入侵。 其帳戶最有可能設為目標的 VIP 使用者，應該存放在初始化樹系中。 提供重要商務功能的應用程式應該安裝在初始化樹系中全新建立的伺服器上，而高度敏感的資料則應該移至初始化樹系中的安全伺服器。  
  
如果您還沒有清楚瞭解 Active Directory 環境中大部分的業務關鍵使用者、系統、應用程式和資料，請與業務單位合作來識別它們。 應該識別企業運作所需的任何應用程式，就像執行重要應用程式或儲存重要資料的任何伺服器一樣。 藉由識別組織繼續運作所需的使用者和資源，您可以建立自然優先順序的資產集合，以專注于您的工作。  
  
### <a name="leveraging-nonmigratory-migrations"></a>利用「Nonmigratory」遷移  
無論您是否知道您的環境已遭到入侵、懷疑其已遭入侵，或只是不想將舊版的資料和物件從舊版 Active Directory 安裝遷移到新的，請考慮不是技術上的遷移方法「遷移」物件。  
  
### <a name="user-accounts"></a>[使用者帳戶]  
在傳統的 Active Directory 從一個樹系遷移至另一個樹系時，使用者物件上的 SIDHistory （SID 歷程記錄）屬性會用來儲存使用者的 SID，以及使用者在舊版樹系中屬於其成員之群組的 Sid。 如果使用者帳戶已遷移至新的樹系，且他們存取舊版樹系中的資源，則 SID 歷程記錄中的 Sid 會用來建立存取權杖，讓使用者能夠在遷移帳戶之前存取他們擁有存取權的資源。  
  
不過，維護 SID 歷程記錄在某些環境中已證明有問題，因為以目前和歷史的 Sid 填入使用者的存取權杖，可能會導致權杖膨脹。 權杖膨脹是一項問題，其中必須儲存在使用者的存取權杖中的 Sid 數目會使用或超過權杖中可用的空間量。  
  
雖然權杖大小可以增加到有限的範圍，但權杖膨脹的最終解決方案是減少與使用者帳戶相關聯的 Sid 數目，不論是藉由合理化群組成員資格、排除 SID 歷程記錄或兩者的組合。 如需有關權杖膨脹的詳細資訊，請參閱[MaxTokenSize 和 Kerberos 權杖膨脹](https://blogs.technet.com/b/shanecothran/archive/2010/07/16/maxtokensize-and-kerberos-token-bloat.aspx)。  
  
使用 SID 歷程記錄，而不是從舊版環境（特別是群組成員資格和 SID 歷程記錄可能會遭到入侵的人）遷移使用者，請考慮利用中繼目錄應用程式來「遷移」使用者，而不需要攜帶 SID 歷程記錄進入新樹系。 在新樹系中建立使用者帳戶時，您可以使用中繼目錄應用程式，將帳戶對應至舊版樹系中的對應帳戶。  
  
若要為新的使用者帳戶提供舊版樹系中資源的存取權，您可以使用中繼目錄工具來識別已授與使用者的舊版帳戶存取權的資源群組，然後將使用者的新帳戶新增至這些群組。 視舊版樹系中的群群組原則而定，您可能需要建立用於資源存取的網域本機群組，或將現有的群組轉換為網域本機群組，以允許將新的帳戶新增至資源群組。 藉由先將重點放在最重要的應用程式和資料，並將其遷移至新的環境（不論是否使用 SID 歷程記錄），您可以限制在舊版環境中所耗費的工作量。  
  

  
### <a name="servers-and-workstations"></a>伺服器和工作站  
相較于遷移使用者、群組和應用程式，在傳統的從一個 Active Directory 樹系遷移到另一個樹系時，遷移電腦通常相當簡單。 視電腦角色而定，遷移至新樹系的方式就像是退出舊網域並加入新的領域一樣簡單。 不過，將電腦帳戶原封不動地遷移到初始化樹系，因而無法建立全新的環境。 您應該在新的環境中全新安裝伺服器和工作站，而不是將電腦帳戶（可能遭盜用、設定錯誤或過時）遷移至新的樹系。 您可以將來自舊版樹系中系統的資料移轉至初始化樹系中的系統，但不能將資料存放在該系統中。  
  
### <a name="applications"></a>應用程式  

應用程式可以在任何從一個樹系遷移至另一個樹系時帶來最大的挑戰，但在「nonmigratory」遷移的情況下，您應該套用的最基本原則之一是初始化樹系中的應用程式應該是最新的，支援和全新安裝。 資料可以在可能的情況下，從舊樹系中的應用程式實例進行遷移。 在初始化樹系中無法「重新建立」應用程式的情況下，您應該考慮如下列章節所述的方法，像是創意的銷毀或隔離繼承應用程式。  
  
### <a name="implementing-creative-destruction"></a>執行創意性的銷毀  
創意性銷毀是一種經濟術語，描述先前訂單的銷毀所建立的經濟開發。 最近幾年來，這一期已套用至資訊技術。 這通常是指排除舊的基礎結構所用的機制，而不是藉由升級，而是以全新的東西取代。 2011 [Gartner SYMPOSIUM ITXPO](http://www.gartner.com/technology/symposium/orlando/)針對 cio 和資深 IT 主管呈現了創意，做為成本降低和效率增加的其中一個關鍵主題。 安全性的增強功能可能是程式的天然 outgrowth。  

例如，組織可能是由多個使用不同應用程式來執行類似功能的業務單位所組成，並具有不同程度的現代化和廠商支援。 在過去，它可能會負責個別維護每個業務單位的應用程式，而合併工作則是由嘗試找出哪一個應用程式提供最佳功能，然後將資料移轉到其他應用程式。  
  
在創意性終結中，您可以完全執行全新的應用程式，以取代舊的應用程式，將資料移轉至新的應用程式，並解除委任舊的應用程式及其執行的系統，而不是維護過時或多餘的應用程式。 在某些情況下，您可以藉由在自己的基礎結構中部署新的應用程式，來執行傳統應用程式的具創意性終結，但可能的話，您應該考慮改為將應用程式移植到雲端式解決方案。  
  
藉由部署雲端式應用程式來取代舊版內部應用程式，您不僅可以減少維護工作和成本，還可以排除存在弱點的舊版系統和應用程式，以降低組織的攻擊面。供攻擊者利用。 這種方法可讓組織更快速地取得所需的功能，同時也能排除基礎結構中的舊版目標。 雖然創意性終結的原則不適用於所有 IT 資產，但它提供了一種可排除舊版系統和應用程式的可行選項，同時又能同時部署強大、安全的雲端式應用程式。  
  
### <a name="isolating-legacy-systems-and-applications"></a>隔離舊版系統和應用程式  
將業務關鍵使用者和系統移轉至初始化安全環境的天然 outgrowth，是您的舊版樹系將包含較不重要的資訊和系統。 雖然舊版的系統和應用程式在較不安全的環境中可能會帶來更高的危害風險，它們也代表降低的漏洞嚴重性。 藉由 rehoming 和現代化您的重要商務資產，您可以專注于部署有效的管理和監視，而不需要配合舊版設定和通訊協定。  
  
當您將重要資料重新隸屬至初始化樹系時，您可以評估選項，進一步隔離「主要」 AD DS 樹系中的舊版系統和應用程式。 雖然您可能會執行創意的析構來取代一個應用程式及其執行所在的伺服器，但在其他情況下，您可能會考慮額外隔離最低安全性系統和應用程式。 例如，少數使用者使用的應用程式，但需要舊版認證（例如 LAN Manager 雜湊），可以遷移至您所建立的小型網域，以支援沒有取代選項的系統。  
  
藉由將這些系統從強制執行舊版設定的網域中移除，您接著可以藉由將它們設定為僅支援目前的作業系統和應用程式來增加網域的安全性。 不過，最好是盡可能解除委任舊版系統和應用程式。 如果解除委任僅適用于您舊版擴展的小型區段，則將它隔離到不同的網域（或樹系）可讓您在舊版安裝的其餘部分中執行累加式改良功能。  
  
### <a name="simplifying-security-for-end-users"></a>簡化終端使用者的安全性  
在大部分的組織中，因為組織中的角色本質而能夠存取最敏感資訊的使用者，通常會有最少的時間來學習複雜的存取限制和控制項。 雖然您應該為組織中的所有使用者提供全方位的安全性教育計畫，但您也應該專注于讓安全性變得更容易使用，方法是執行透明的控制項，並簡化使用者的原則。滿足.  
  
例如，您可以定義一個原則，讓主管和其他 Vip 需要使用安全的工作站來存取敏感性資料和系統，以使用其他裝置來存取較不敏感的資料。 這是讓使用者記住的簡單原則，但是您可以執行一些後端控制項，以協助強制執行此方法。  

您可以使用[驗證機制保證](https://technet.microsoft.com/library/dd391847(v=WS.10).aspx)，只有在使用者使用智慧卡登入安全系統時，才允許他們存取機密資料，而且可以使用 IPsec 和使用者權限限制來控制可連線到敏感性資料存放庫的系統。 您可以使用[Microsoft 資料分類工具](https://www.microsoft.com/download/details.aspx?id=27123)組來建立健全的檔案分類基礎結構，而且您可以根據存取嘗試的特性來執行[動態存取控制](https://blogs.technet.com/b/windowsserver/archive/2012/05/22/introduction-to-windows-server-2012-dynamic-access-control.aspx)，以限制資料的存取，將商務規則轉譯為技術控制項。  
  
從使用者的觀點來看，從安全的系統存取機密資料「直接運作」，然後從不安全的系統中嘗試這麼做。」 不過，從監控和管理環境的觀點來看，您可以在使用者如何存取機密資料和系統時，協助您建立可識別的模式，讓您更輕鬆地偵測異常的存取嘗試。  
  
在使用者抵抗長時間複雜密碼的環境中，如果密碼原則不足，特別是針對 VIP 使用者，請考慮使用其他方法進行驗證，不論是透過智慧卡（有許多外型規格，以及具有強化驗證的其他功能）、生物特徵辨識控制項（例如手指式讀取器），或甚至是由使用者電腦中的可信賴平臺模組（TPM）晶片所保護的驗證資料。 雖然多重要素驗證不會防止認證竊取攻擊，但如果電腦已遭入侵，藉由提供使用者便於使用的驗證控制項，您就可以將更健全的密碼指派給傳統使用者的使用者帳戶名稱和密碼控制項很困難。  
