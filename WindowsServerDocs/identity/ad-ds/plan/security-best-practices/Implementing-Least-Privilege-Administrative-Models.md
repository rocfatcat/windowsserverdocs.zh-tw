---
ms.assetid: 7a7ab95c-9cb3-4a7b-985a-3fc08334cf4f
title: 實作最低權限管理模型
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 08/09/2018
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: c8655c7bac977bf94add1531d299e2fa17ef530d
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/08/2020
ms.locfileid: "80821241"
---
# <a name="implementing-least-privilege-administrative-models"></a>實作最低權限管理模型

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

下列摘錄是來自[系統管理員帳戶安全性規劃指南](https://technet.microsoft.com/library/cc162797.aspx)，第一次發行于1999年4月1日：

> 「大部分的安全性相關訓練課程和檔會討論最低許可權原則的執行，但組織很少會遵循它。 此原則很簡單，而且套用它的影響會大幅增加您的安全性並降低您的風險。 原則規定，所有使用者都應該以具有完成目前工作所需之絕對最低許可權的使用者帳戶登入，而不需要進行其他動作。 這麼做可提供保護，防止惡意程式碼在其他攻擊中。 此原則適用于電腦和這些電腦的使用者。   
> 「這個原則的運作原因之一，就是它會強制您進行一些內部研究。 例如，您必須判斷電腦或使用者真正需要的存取權限，然後加以執行。 對於許多組織而言，這項工作一開始可能就好像很棒，不過，若要成功保護您的網路環境，這是必要的步驟。
> 「您應該授與所有網域系統管理員使用者在最低許可權概念下的網域許可權。 例如，如果系統管理員使用特殊許可權帳戶登入，且不小心執行病毒程式，則病毒會擁有本機電腦和整個網域的管理存取權。 如果系統管理員已使用未具許可權（非管理）帳戶登入，則病毒的損毀範圍只會是本機電腦，因為它是以本機電腦使用者的身分執行。
> 「在另一個範例中，即使樹系之間有信任關係，您授與網域層級系統管理員許可權的帳戶也不能在另一個樹系中具有較高的許可權。 如果攻擊者設法危害一個受管理的樹系，這項策略可協助預防廣泛的損害。 組織應定期審核其網路，以防止未經授權的許可權提升。」  

以下摘錄來自[Microsoft Windows 安全性資源套件](https://www.microsoftpressstore.com/store/microsoft-windows-security-resource-kit-9780735621749)，第一次在2005中發佈：  

> 「一律將安全性視為授與執行工作所需的最低許可權。 如果有太多許可權的應用程式應該受到危害，攻擊者可能會擴大攻擊，而不是應用程式達到最少量許可權的情況。 例如，檢查網路系統管理員意外開啟會啟動病毒的電子郵件附件的結果。 如果系統管理員使用網域系統管理員帳戶登入，則病毒會在網域中的所有電腦上具有系統管理員許可權，因此不受限制地存取網路上幾乎所有的資料。 如果系統管理員是使用本機系統管理員帳戶登入，則病毒會在本機電腦上具有系統管理員許可權，因此可以存取電腦上的任何資料，並在電腦上安裝金鑰-筆劃記錄軟體等惡意軟體。 如果系統管理員使用一般使用者帳戶登入，則病毒只會存取系統管理員的資料，而且將無法安裝惡意軟體。 藉由使用讀取電子郵件所需的最低許可權，在此範例中，可能會大幅降低危害的範圍。」  

## <a name="the-privilege-problem"></a>許可權問題

先前的摘錄中所述的原則並不會變更，但是在評估 Active Directory 的安裝時，我們會發現有過多的帳戶已被授與執行日常工作所需的權利和許可權。 環境的大小會影響過高許可權帳戶的未經處理數目，但 proportionmidsized 目錄可能會有數十個帳戶在最具許可權的群組中，而大型安裝可能會有數百或甚至數千個。 有幾個例外，無論攻擊者的技能和利器複雜，攻擊者通常會遵循最低抵抗的路徑。 只有在和較簡單的機制失敗或由防禦者阻撓時，它們才會增加其工具和方法的複雜度。  

可惜的是，在許多環境中，最少抵抗的路徑已證明是過度使用具有廣泛和深層許可權的帳戶。 廣泛的許可權是許可權和許可權，可讓帳戶在整個環境的大型跨區段執行特定活動，例如，技術支援人員可能會被授與許可權，讓他們能夠在許多使用者帳戶上重設密碼。  

深層許可權是適用于擴展區段的強大許可權，例如在伺服器上提供工程師系統管理員許可權，讓他們可以執行修復。 廣泛許可權或深層許可權都不一定是危險的，但是當網域中的許多帳戶永久授與廣泛且深度的許可權時，如果只有一個帳戶遭到入侵，就可以快速地將環境重新設定為攻擊者的用途，或甚至終結基礎結構的大型區段。  

傳遞雜湊攻擊是一種認證竊取攻擊的常見方式，因為執行它們的工具既免費又方便使用，而且許多環境都容易受到攻擊。 不過，傳遞雜湊攻擊並不是真正的問題。 問題的關鍵在於是雙重的：  

1. 攻擊者通常可以輕鬆地在單一電腦上取得深層許可權，然後將該許可權廣泛地傳播到其他電腦。  
2. 在計算環境中，通常會有太多的永久帳戶具有高層級的許可權。

即使消除了傳遞雜湊攻擊，攻擊者也只會使用不同的策略，而不是不同的策略。 與其植入包含認證竊取工具的惡意程式碼，他們可能會植入按鍵的惡意程式碼，或利用任何其他方法來捕捉在整個環境中功能強大的認證。 無論策略為何，目標都維持不變：具有廣泛和深層許可權的帳戶。  

只有在遭到入侵的環境中 Active Directory，才能授與過多許可權。 當組織已開發出授與所需更多許可權的習慣時，通常會在整個基礎結構中找到，如下列各節所述。  

## <a name="in-active-directory"></a>在 Active Directory

在 Active Directory 中，通常會發現 EA、DA 和 BA 群組包含過多的帳戶數目。 最常見的情況是，組織的 EA 群組包含最少的成員，而 DA 群組通常會包含 EA 群組中的使用者數目乘數，而系統管理員群組通常會包含比其他群組的擴展更多的成員。 這通常是因為系統管理員的「許可權較小」，而不是 DAs 或 EAs。 雖然授與每個群組的權利與許可權不同，但應該有效地將其視為功能強大的群組，因為其中一個成員可以讓自己或自己成為其他兩個成員。  

## <a name="on-member-servers"></a>在成員伺服器上

當我們在許多環境中取得成員伺服器上本機系統管理員群組的成員資格時，我們發現成員資格範圍從少數本機和網域帳戶到數十個嵌套群組，在擴充時，會顯示在伺服器上具有本機系統管理員許可權的數百個或數千個帳戶。 在許多情況下，具有大型成員資格的網域群組會嵌套在成員伺服器的本機系統管理員群組中，而不會考慮到可以修改網域中這些群組成員資格的任何使用者，都可以獲得群組已在本機 Administrators 群組中的所有系統的管理控制。  

## <a name="on-workstations"></a>在工作站上

雖然在許多環境中，工作站的本機系統管理員群組中通常會有比成員伺服器更少的成員，但在許多環境中，使用者會被授與其個人電腦上本機 Administrators 群組的成員資格。 發生這種情況時，即使已啟用 UAC，那些使用者也會對其工作站的完整性呈現提高許可權的風險。  

> [!IMPORTANT]  
> 您應該仔細考慮使用者是否需要其工作站上的系統管理許可權，如果有的話，最好是在系統管理員群組成員的電腦上建立個別的本機帳戶。 當使用者需要提高許可權時，他們可以出示該本機帳戶的認證以提高許可權，但因為該帳戶是本機帳戶，所以不能用來危害其他電腦或存取網域資源。 不過，就像任何本機帳戶一樣，本機特殊許可權帳戶的認證應該是唯一的;如果您在多個工作站上使用相同的認證來建立本機帳戶，您會將電腦公開到傳遞雜湊的攻擊。  

## <a name="in-applications"></a>在應用程式中

在目標是組織的智慧財產的攻擊中，已授與應用程式內強大許可權的帳戶可以鎖定為允許外泄資料。 雖然可存取敏感性資料的帳戶可能已被授與網域或作業系統中的較高許可權，但可以操控應用程式設定或存取應用程式所提供之資訊的帳戶也不會有風險。  

## <a name="in-data-repositories"></a>在資料存放庫中

就像其他目標一樣，尋求存取檔和其他檔案格式之智慧財產權的攻擊者可以鎖定控制檔案存放區存取權的帳戶、可直接存取檔案的帳戶，或甚至能夠存取檔案的群組或角色。 例如，如果使用 Active Directory 群組來儲存檔案伺服器，並將存取權授與檔，則可以修改群組成員資格的攻擊者可以將遭入侵的帳戶新增至群組，並存取合約檔。 在應用程式（例如 SharePoint）提供檔存取權的情況下，攻擊者可以如先前所述，將應用程式設為目標。  

## <a name="reducing-privilege"></a>降低許可權

較大且更複雜的環境，就越難以管理和保護。 在小型組織中，審查和減少許可權可能是相當簡單的做法，但組織中使用的每個額外伺服器、工作站、使用者帳戶和應用程式都會新增另一個必須受到保護的物件。 由於妥善保護組織 IT 基礎結構的每個層面可能會很困難，甚至不可能發生問題，您應該先將重點放在其許可權建立最大風險的帳戶上，這通常是 Active Directory 中的內建特殊許可權帳戶和群組，以及工作站和成員伺服器上的特殊許可權本機帳戶。  

### <a name="securing-local-administrator-accounts-on-workstations-and-member-servers"></a>保護工作站和成員伺服器上的本機系統管理員帳戶

雖然本檔著重于保護 Active Directory （如先前所述），但對目錄的大部分攻擊都是針對個別主機的攻擊而開始。 無法提供保護成員系統上本機群組的完整指導方針，但您可以使用下列建議來協助保護工作站和成員伺服器上的本機系統管理員帳戶。  

#### <a name="securing-local-administrator-accounts"></a>保護本機系統管理員帳戶

在目前處於主流支援的所有 Windows 版本上，預設會停用本機系統管理員帳戶，讓帳戶無法用於傳遞雜湊和其他認證竊取攻擊。 不過，在包含舊版作業系統或已啟用本機系統管理員帳戶的網域中，可以使用這些帳戶，如先前所述，以在成員伺服器和工作站之間傳播危害。 基於這個理由，建議您針對已加入網域之系統上的所有本機系統管理員帳戶使用下列控制項。  

[附錄 H：保護本機系統管理員帳戶和群組](../../../ad-ds/plan/security-best-practices/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups.md)中提供了如何執行這些控制項的詳細指示。 不過，在進行這些設定之前，請先確定環境中目前未使用本機系統管理員帳戶來執行電腦上的服務，或執行不應使用這些帳戶的其他活動。 請先徹底測試這些設定，然後再于生產環境中執行。  

#### <a name="controls-for-local-administrator-accounts"></a>本機系統管理員帳戶的控制項

內建的系統管理員帳戶絕不能用來做為成員伺服器上的服務帳戶，而且也不應該用來登入本機電腦（除非是在安全模式中，即使帳戶已停用，仍允許使用）。 執行此處所述之設定的目標，是要防止每台電腦的本機系統管理員帳戶無法使用，除非先反轉保護控制項。 藉由執行這些控制項並監視系統管理員帳戶的變更，您可以大幅降低以本機系統管理員帳戶為目標的攻擊成功的可能性。  

##### <a name="configuring-gpos-to-restrict-administrator-accounts-on-domain-joined-systems"></a>設定 Gpo 來限制已加入網域之系統上的系統管理員帳戶

在您建立的一或多個 Gpo 中，以及連結至每個網域中的工作站和成員伺服器 Ou，將系統管理員帳戶新增至**電腦設定 \ \windows 設定 \** 使用者權限 \ 許可權指派中的下列使用者權限：  

- 拒絕從網路存取這台電腦
- 拒絕以批次工作登入
- 拒絕以服務方式登入
- 拒絕透過遠端桌面服務登入

當您將系統管理員帳戶新增至這些使用者權限時，請指定您要以標記帳戶的方式新增本機系統管理員帳戶或網域的系統管理員帳戶。 例如，若要將 NWTRADERS 網域的系統管理員帳戶新增至這些拒絕許可權，請將該帳戶輸入為**NWTRADERS\Administrator**，或流覽至 NWTRADERS 網域的系統管理員帳戶。 為確保您限制本機系統管理員帳戶，請在 [群組原則物件編輯器] 的 [使用者權限] 設定中輸入**Administrator** 。  

> [!NOTE]  
> 即使已重新命名本機系統管理員帳戶，仍會套用原則。  

這些設定可確保電腦的系統管理員帳戶無法用來連線到其他電腦，即使它不小心或遭到惡意啟用也一樣。 使用本機系統管理員帳戶的本機登入無法完全停用，您也不應該嘗試這麼做，因為電腦的本機系統管理員帳戶是設計用來在嚴重損壞修復案例中使用。  

如果成員伺服器或工作站脫離網域，而沒有其他本機帳戶授與系統管理許可權，則電腦可以開機進入安全模式，可以啟用 Administrator 帳戶，然後帳戶就可以用來在電腦上生效修復。 當修復完成時，應該再次停用系統管理員帳戶。  

### <a name="securing-local-privileged-accounts-and-groups-in-active-directory"></a>保護 Active Directory 中的本機特殊許可權帳戶和群組

*第六條法則：電腦的安全，只有系統管理員值得信任。* - [十個不變的安全性法則（版本2.0）](https://technet.microsoft.com/security/hh278941.aspx)  

此處提供的資訊旨在提供一般指導方針來保護 Active Directory 中的最高許可權內建帳戶和群組。 如需詳細的逐步指示，請參閱附錄[D：保護內建的系統管理員帳戶 Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)中的附錄[E：保護 Active Directory 中的 Enterprise admins 群組](../../../ad-ds/plan/security-best-practices/Appendix-E--Securing-Enterprise-Admins-Groups-in-Active-Directory.md)、[附錄 F：保護 Active Directory 中的 Domain admins 群組](../../../ad-ds/plan/security-best-practices/Appendix-F--Securing-Domain-Admins-Groups-in-Active-Directory.md)和[附錄 G：在 Active Directory 中保護系統管理員群組](../../../ad-ds/plan/security-best-practices/Appendix-G--Securing-Administrators-Groups-in-Active-Directory.md)。  

在您執行上述任何設定之前，您也應該徹底測試所有設定，以判斷它們是否適用于您的環境。 並非所有組織都能夠執行這些設定。  

#### <a name="securing-built-in-administrator-accounts-in-active-directory"></a>在 Active Directory 中保護內建的系統管理員帳戶

在 Active Directory 中的每個網域中，系統會在建立網域的過程中建立系統管理員帳戶。 此帳戶預設為網域中 Domain Admins 和 Administrator 群組的成員，如果網域是樹系根域，則此帳戶也是 Enterprise Admins 群組的成員。 使用網域的本機系統管理員帳戶應該只保留給初始組建活動，以及可能發生的嚴重損壞修復案例。 為確保內建的系統管理員帳戶可用來在無法使用其他帳戶的情況下生效修復，您不應該變更樹系中任何網域中系統管理員帳戶的預設成員資格。 相反地，您應該遵循指導方針來協助保護樹系中每個網域的系統管理員帳戶。 如需如何執行這些控制項的詳細指示，請參見[Active Directory 中的內建系統管理員帳戶](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)。  

#### <a name="controls-for-built-in-administrator-accounts"></a>內建系統管理員帳戶的控制項

執行此處所述之設定的目標是要避免每個網域的系統管理員帳戶（而不是群組）可供使用，除非有一些控制項是相反的。 藉由執行這些控制項並監視系統管理員帳戶的變更，您可以利用網域的系統管理員帳戶，大幅降低攻擊成功的可能性。 對於樹系中每個網域的系統管理員帳戶，您應該設定下列設定。  

##### <a name="enable-the-account-is-sensitive-and-cannot-be-delegated-flag-on-the-account"></a>在帳戶上啟用「必須區分帳戶，無法委派」旗標

根據預設，Active Directory 中的所有帳戶都可以委派。 委派可讓電腦或服務出示已向其他電腦驗證的帳號憑證，以代表帳戶取得服務。 當您啟用 [此**帳戶是機密的，而且無法**在網域型帳戶上委派] 屬性時，帳戶的認證無法呈現給網路上的其他電腦或服務，這會限制利用委派在其他系統上使用帳號憑證的攻擊。  

##### <a name="enable-the-smart-card-is-required-for-interactive-logon-flag-on-the-account"></a>在帳戶上啟用 [互動式登入需要智慧卡] 旗標

當您啟用帳戶的**互動式登入屬性所需的智慧卡**時，Windows 會將帳戶的密碼重設為120個字元的隨機值。 藉由在內建的系統管理員帳戶上設定此旗標，您可確保帳戶的密碼不僅冗長且複雜，也不知道任何使用者。 在技術上，您必須先建立帳戶的智慧卡，才能啟用此屬性，但如果可能的話，應該先為每個系統管理員帳戶建立智慧卡，再設定帳戶限制，而智慧卡應該儲存在安全的位置。  

雖然**互動式登入旗標需要設定智慧卡才能**重設帳戶的密碼，但不會防止具有許可權的使用者重設帳戶的密碼，其方式是將帳戶設定為已知的值，並使用帳戶的名稱和新密碼來存取網路上的資源。 因此，您應該在帳戶上執行下列額外的控制項。  

##### <a name="configuring-gpos-to-restrict-domains-administrator-accounts-on-domain-joined-systems"></a>將 Gpo 設定為在已加入網域的系統上限制網域的系統管理員帳戶

雖然停用網域中的系統管理員帳戶會使帳戶有效率地無法使用，但您應該在帳戶不小心或惡意啟用的情況下，對帳戶執行其他限制。 雖然這些控制項最終會由系統管理員帳戶反轉，但目標是要建立控制措施，使攻擊者的進度變慢，並限制帳戶所能帶來的損害。  

在您建立的一或多個 Gpo 中，並連結到每個網域中的工作站和成員伺服器 Ou，請將每個網域的系統管理員帳戶新增至**電腦設定 \ \windows 設定 \ 使用者權限 \ 使用授權指派**中的下列使用者權利：  

- 拒絕從網路存取這台電腦  
- 拒絕以批次工作登入  
- 拒絕以服務方式登入  
- 拒絕透過遠端桌面服務登入  

> [!NOTE]  
> 當您將本機系統管理員帳戶新增到此設定時，您必須指定要設定本機系統管理員帳戶或網域系統管理員帳戶。 例如，若要將 NWTRADERS 網域的本機系統管理員帳戶新增至這些拒絕許可權，您必須將該帳戶輸入為**NWTRADERS\Administrator**，或流覽至 NWTRADERS 網域的本機系統管理員帳戶。 如果您在群組原則物件編輯器的這些使用者權限設定中輸入**Administrator** ，則會限制套用 GPO 的每部電腦上的本機系統管理員帳戶。  
>
> 建議您在成員伺服器和工作站上限制本機系統管理員帳戶，方法與網域系統管理員帳戶相同。 因此，您通常應該將樹系中每個網域的系統管理員帳戶，以及本機電腦的系統管理員帳戶新增至這些使用者權限設定。 

##### <a name="configuring-gpos-to-restrict-administrator-accounts-on-domain-controllers"></a>設定 Gpo 以限制網域控制站上的系統管理員帳戶

在樹系中的每個網域中，應修改預設網域控制站原則或連結至網域控制站 OU 的原則，以將每個網域的系統管理員帳戶新增至**電腦設定 \ \windows 設定 \ 使用者權限 \ 許可權指派**中的下列使用者權利：  

- 拒絕從網路存取這台電腦  
- 拒絕以批次工作登入  
- 拒絕以服務方式登入  
- 拒絕透過遠端桌面服務登入  

> [!NOTE]  
> 這些設定會確保本機系統管理員帳戶無法用來連線到網域控制站，雖然帳戶（如果啟用的話）可以在本機登入網域控制站。 由於此帳戶應該只在嚴重損壞修復案例中啟用和使用，因此預期會有至少一個網域控制站的實體存取權，或可使用遠端存取網域控制站之許可權的其他帳戶。  

##### <a name="configure-auditing-of-built-in-administrator-accounts"></a>設定內建系統管理員帳戶的審核

當您已保護每個網域的系統管理員帳戶並予以停用時，您應該設定審核來監視帳戶的變更。 如果已啟用帳戶，則會重設其密碼，或對帳戶進行任何其他修改，並將警示傳送給負責管理 AD DS 的使用者或小組，以及組織中的事件回應小組。  

### <a name="securing-administrators-domain-admins-and-enterprise-admins-groups"></a>保護系統管理員、網域系統管理員和 Enterprise Admins 群組

#### <a name="securing-enterprise-admin-groups"></a>保護企業系統管理員群組

「企業系統管理員」群組（位於樹系根域中）每日不應包含任何使用者，但網域的本機系統管理員帳戶可能例外，前提是它會受到保護（如先前所述），以及[附錄 D：在 Active Directory 中保護內建的系統管理員帳戶](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)。  

需要 EA 存取時，其帳戶需要 EA 許可權的使用者應該暫時放入 Enterprise Admins 群組中。 雖然使用者使用的是高許可權帳戶，但他們的活動應該經過審核，最好是執行變更的使用者，以及另一位使用者觀察變更，以將意外誤用或設定錯誤的可能性降到最低。 當活動完成時，應該從 EA 群組中移除帳戶。 這可以透過手動程式和記載的進程、協力廠商的特殊許可權身分識別/存取管理（PIM/PAM）軟體或兩者的組合來達成。 建立可用來控制許可權群組成員資格的帳戶的指導方針 Active Directory 中提供了[用於認證竊取的吸引](../../../ad-ds/plan/security-best-practices/Attractive-Accounts-for-Credential-Theft.md)人，以及詳細指示，請見[附錄 I：在 Active Directory 中建立受保護帳戶和群組的管理帳戶](../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md)。  

根據預設，企業系統管理員在樹系的每個網域中，都是內建 Administrators 群組的成員。 移除每個網域中系統管理員群組的 Enterprise Admins 群組是不適當的修改，因為萬一發生樹系嚴重損壞修復的情況，就可能需要 EA 許可權。 如果已從樹系中的系統管理員群組移除 Enterprise Admins 群組，則應該將其新增至每個網域中的 Administrators 群組，並執行下列其他控制項：  

- 如先前所述，Enterprise Admins 群組不應每天包含任何使用者，但樹系根域的系統管理員帳戶可能例外，這應該會受到保護，如[Active Directory 中的內建系統管理員帳戶的保護](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)中所述。  
- 在連結到包含每個網域中成員伺服器和工作站之 Ou 的 Gpo 中，EA 群組應新增至下列使用者權限：  
   - 拒絕從網路存取這台電腦  
   - 拒絕以批次工作登入  
   - 拒絕以服務方式登入  
   - 拒絕本機登入  
   - 拒絕透過遠端桌面服務登入。  

這將導致 EA 群組的成員無法登入成員伺服器和工作站。 如果使用跳躍伺服器來管理網域控制站和 Active Directory，請確定跳躍伺服器位於未連結限制 Gpo 的 OU 中。  

- 如果對 EA 群組的屬性或成員資格進行任何修改，則應該將審核設定為傳送警示。 這些警示應至少傳送給負責 Active Directory 系統管理和事件回應的使用者或小組。 您也應該定義暫時填入 EA 群組的進程和程式，包括執行群組的合法擴展時的通知程式。  
  
#### <a name="securing-domain-admins-groups"></a>保護網域系統管理員群組

就像 Enterprise Admins 群組一樣，只有在組建或嚴重損壞修復的情況下，才需要 Domain Admins 群組的成員資格。 在 DA 群組中應該不會有每日的使用者帳戶，但網域的本機系統管理員帳戶除外，如[Active Directory 中的內建系統管理員帳戶的保護](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)中所述。  
  
需要存取 DA 時，需要此存取層級的帳戶應該暫時放在有問題之網域的 DA 群組中。 雖然使用者使用的是高許可權帳戶，但您應該使用一位使用者執行變更來進行審核，並最好執行這些變更，而另一位使用者則觀察這些變更，以將意外誤用或設定錯誤的可能性降到最低。 當活動完成時，應該從 Domain Admins 群組中移除帳戶。 這可以透過手動程式和記載的進程、透過協力廠商的特殊許可權身分識別/存取管理（PIM/PAM）軟體或兩者的組合來達成。 [附錄 I：在 Active Directory 中建立受保護帳戶和群組的管理帳戶](../../../ad-ds/manage/component-updates/../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md)中提供的指導方針，說明如何建立可用來控制 Active Directory 中特殊許可權群組成員資格的帳戶。  
  
根據預設，網域系統管理員會在其各自網域中的所有成員伺服器和工作站上，群組的成員。 此預設的嵌套不應修改，因為它會影響支援性和嚴重損壞修復選項。 如果已從成員伺服器上的本機系統管理員群組中移除網域系統管理員群組，則應該透過連結的 Gpo 中受限制的群組設定，將它們新增到網域中每個成員伺服器和工作站上的 Administrators 群組。 下列一般控制項（[附錄 F：保護 Active Directory 中的 Domain Admins 群組](../../../ad-ds/plan/security-best-practices/Appendix-F--Securing-Domain-Admins-Groups-in-Active-Directory.md)中的深度）也應加以執行。  

針對樹系中每個網域的 Domain Admins 群組：  

1. 從 DA 群組移除所有成員，但網域內建的系統管理員帳戶可能有例外，前提是它已受到保護，如 Active Directory 中的內[建系統管理員帳戶的保護](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)中所述。  
2. 在連結到包含每個網域中成員伺服器和工作站之 Ou 的 Gpo 中，必須將 DA 群組新增至下列使用者權限：  
   - 拒絕從網路存取這台電腦  
   - 拒絕以批次工作登入  
   - 拒絕以服務方式登入  
   - 拒絕本機登入  
   - 拒絕透過遠端桌面服務登入  
  
   這會讓 DA 群組的成員無法登入成員伺服器和工作站。 如果使用跳躍伺服器來管理網域控制站和 Active Directory，請確定跳躍伺服器位於未連結限制 Gpo 的 OU 中。  

3. 如果對此 DA 群組的屬性或成員資格進行任何修改，則應該將審核設定為傳送警示。 這些警示應至少傳送給負責 AD DS 系統管理和事件回應的使用者或小組。 您也應該定義暫時填入 DA 群組的進程和程式，包括執行群組的合法擴展時的通知程式。  

#### <a name="securing-administrators-groups-in-active-directory"></a>保護 Active Directory 中的系統管理員群組

就像 EA 和 DA 群組一樣，只有在組建或嚴重損壞修復的情況下，才需要 Administrators （BA）群組中的成員資格。 除了網域的本機系統管理員帳戶（如[Active Directory 中的內建系統管理員帳戶保護中](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)所述），系統管理員群組中應該不會有每日的使用者帳戶。  

當需要系統管理員存取權時，需要此存取層級的帳戶應該暫時放在有問題之網域的 Administrators 群組中。 雖然使用者使用的是高許可權帳戶，但您應該在執行變更的使用者和另一個使用者觀察變更的情況下執行活動，以將意外誤用或設定錯誤的可能性降到最低。 當活動完成時，應立即從 Administrators 群組中移除帳戶。 這可以透過手動程式和記載的進程、透過協力廠商的特殊許可權身分識別/存取管理（PIM/PAM）軟體或兩者的組合來達成。  

根據預設，系統管理員會在其各自的網域中，擁有大部分 AD DS 物件的擁有者。 在具有擁有權或取得物件擁有權之功能的組建和嚴重損壞修復案例中，可能需要此群組的成員資格。 此外，DAs 和 EAs 會藉由其系統管理員群組中的預設成員資格，繼承許多許可權和許可權。 Active Directory 中的特殊許可權群組的預設群組嵌套不應修改，而且每個網域的系統管理員群組都應該受到保護，如[附錄 G：保護 Active Directory 中的 Administrators 群組](../../../ad-ds/plan/security-best-practices/Appendix-G--Securing-Administrators-Groups-in-Active-Directory.md)和下列一般指示所述。  

1. 移除 Administrators 群組中的所有成員，但網域的本機系統管理員帳戶可能有例外，前提是它已受到保護，如[Active Directory 中的內建系統管理員帳戶的保護](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md)中所述。  
2. 網域系統管理員群組的成員永遠不需要登入成員伺服器或工作站。 在每個網域中連結到工作站和成員伺服器 Ou 的一或多個 Gpo 中，系統管理員群組應新增至下列使用者權限：  
   - 拒絕從網路存取這台電腦  
   - 拒絕以批次工作登入，  
   - 拒絕以服務方式登入  
   - 這將導致系統管理員群組的成員無法用來登入或連線到成員伺服器或工作站（除非第一次違反多個控制項），其中的認證可能會被快取，因而遭到入侵。 許可權帳戶永遠不能用來登入較低許可權的系統，而且強制這些控制措施會針對一些攻擊提供保護。  

3. 在樹系中每個網域的網域控制站 OU 上，系統管理員群組應被授與下列使用者權限（如果他們還沒有這些許可權），這將允許 Administrators 群組的成員執行整個樹系嚴重損壞修復案例所需的功能：  
   - 從網路存取這台電腦  
   - 允許本機登入  
   - 允許透過遠端桌面服務登入  

4. 若對 Administrators 群組的屬性或成員資格進行任何修改，則應該將審核設定為傳送警示。 這些警示應至少傳送給負責 AD DS 系統管理之小組的成員。 警示也應該傳送給安全性小組的成員，而且應該定義程式來修改 Administrators 群組的成員資格。 具體來說，這些程式應該包含一個程式，在系統管理員群組進行修改時，安全性小組會收到通知，以便在傳送警示時，不會產生警告。 此外，當系統管理員群組已完成，且使用的帳戶已從群組中移除時，處理常式會通知安全性小組。  

> [!NOTE]  
> 當您對 Gpo 中的 Administrators 群組執行限制時，Windows 除了網域的 Administrators 群組之外，還會將設定套用至電腦的本機系統管理員群組成員。 因此，在系統管理員群組上執行限制時，您應該小心。 雖然禁止網路，但系統管理員群組成員的批次和服務登入都是建議的作法，而不是透過遠端桌面服務來限制本機登入或登入。 封鎖這些登入類型可能會封鎖本機 Administrators 群組成員的電腦的合法管理。 下列螢幕擷取畫面顯示封鎖內建本機和網域系統管理員帳戶誤用的設定，以及濫用內建的本機或網域系統管理員群組。 請注意，[**拒絕登入遠端桌面服務**] 使用者權限不包含 [系統管理員] 群組，因為將它包含在此設定中，也會針對屬於本機電腦之 Administrators 群組成員的帳戶封鎖這些登入。 如果電腦上的服務設定為在本節所述之任何特殊許可權群組的內容中執行，則執行這些設定可能會導致服務和應用程式失敗。 因此，如同本節中的所有建議，您應該徹底測試環境中的適用性設定。  
>
> ![最低版權管理模型](media/Implementing-Least-Privilege-Administrative-Models/SAD_3.gif)  

### <a name="role-based-access-controls-rbac-for-active-directory"></a>Active Directory 以角色為基礎的存取控制（RBAC）

一般而言，角色型存取控制（RBAC）是一種機制，可將使用者分組，並根據商務規則提供資源的存取權。 在 Active Directory 的情況下，針對 AD DS 執行 RBAC 是建立角色的程式，以委派許可權和許可權來允許角色成員執行日常管理工作，而不會授與他們過多的許可權。 Active Directory 的 RBAC 可以透過原生工具和介面來設計和執行，方法是利用您可能已擁有的軟體、購買協力廠商產品或這些方法的任何組合。 本節不會提供逐步指示來執行 Active Directory 的 RBAC，而是討論您在 AD DS 安裝中選擇執行 RBAC 的方法時所應考慮的因素。  

#### <a name="native-approaches-to-rbac-for-active-directory"></a>RBAC for Active Directory 的原生方法

在最簡單的 RBAC 執行中，您可以將角色實作為 AD DS 群組，並將許可權和許可權委派給群組，讓他們能夠在指定的角色範圍內執行每日系統管理。  

在某些情況下，Active Directory 中的現有安全性群組可用來授與許可權給作業功能的適當權利和許可權。 例如，如果您的 IT 組織中的特定員工負責管理和維護 DNS 區域和記錄，委派這些責任就像為每個 DNS 系統管理員建立帳戶，然後將它新增至 Active Directory 中的 DNS Admins 群組一樣簡單。 與更高許可權的群組不同的是，DNS Admins 群組在 Active Directory 上有幾個強大的許可權，雖然此群組的成員已被委派許可權，讓他們能夠管理 DNS，而且仍然受到入侵和不當使用，因而導致權限提高。

在其他情況下，您可能需要建立安全性群組，並將許可權委派給 Active Directory 物件、檔案系統物件和登錄物件，以允許群組成員執行指定的系統管理工作。 例如，如果您的技術支援人員負責重設遺忘的密碼、協助使用者連線問題，以及疑難排解應用程式設定，您可能需要將 Active Directory 中使用者物件的委派設定與允許服務台使用者遠端連線到使用者電腦的許可權結合，以查看或修改使用者的設定。 針對您定義的每個角色，您應該識別：  

1. 角色成員在每天執行的工作，以及較不常執行的工作。  
2. 在哪些系統上以及角色的應用程式成員應被授與許可權。  
3. 哪些使用者應該被授與角色的成員資格。  
4. 如何執行角色成員資格的管理。  

在許多環境中，手動建立以角色為基礎的存取控制來管理 Active Directory 環境，可能是執行和維護的挑戰。 如果您已清楚定義管理 IT 基礎結構的角色和責任，您可能會想要利用其他工具來協助您建立可管理的原生 RBAC 部署。 例如，如果您的環境中使用 Forefront Identity Manager （FIM），您可以使用 FIM 自動建立和擴展系統管理角色，這可以簡化進行中的管理工作。 如果您使用 Microsoft Endpoint Configuration Manager 和 System Center Operations Manager （SCOM），您可以使用應用程式專屬的角色來委派管理和監視功能，同時在網域中的系統上強制執行一致的設定和審核。 如果您已執行公開金鑰基礎結構（PKI），您可以發行並要求負責管理環境之 IT 人員的智慧卡。 使用 FIM 認證管理（FIM CM），您甚至可以將角色和認證的管理結合為系統管理人員。  

在其他情況下，組織最好考慮部署協力廠商 RBAC 軟體，以提供「現成可用」的功能。 適用于 Active Directory、Windows 和非 Windows 目錄和作業系統之 RBAC 的商業、現成（COTS）解決方案是由許多廠商所提供。 在原生解決方案和協力廠商產品之間進行選擇時，您應該考慮下列因素：  

1. 預算：藉由使用您可能已擁有的軟體和工具來投資開發 RBAC，您可以減少部署解決方案所需的軟體成本。 不過，除非您的員工有經驗可以建立和部署原生 RBAC 解決方案，否則您可能需要參與諮詢資源來開發您的解決方案。 您應該謹慎衡量自訂開發解決方案的預期成本，以及部署「現成」解決方案的成本，特別是在您的預算有限的情況下。  
2. IT 環境的組成：如果您的環境主要是由 Windows 系統所組成，或者您已經利用 Active Directory 管理非 Windows 系統和帳戶，自訂的原生解決方案可能會為您的需求提供最佳解決方案。 如果您的基礎結構包含許多不是執行 Windows 且不受 Active Directory 管理的系統，您可能需要考慮從 Active Directory 環境，分別管理非 Windows 系統的選項。  
3. 解決方案中的許可權模式：如果產品將其服務帳戶放置在 Active Directory 中的高許可權群組中，而且未提供不需要將過多許可權授與 RBAC 軟體的選項，您就不會真正降低 Active Directory 攻擊面，只是在目錄中變更了最具特殊許可權的群組組合。 除非應用程式廠商可以提供服務帳戶的控制項，以將帳戶遭到入侵和惡意使用的機率降到最低，您可能會想要考慮其他選項。  

### <a name="privileged-identity-management"></a>權限身分管理

特殊許可權身分識別管理（PIM），有時也稱為特殊許可權帳戶管理（PAM）或特殊許可權認證管理（PCM），這是在您的基礎結構中管理特殊許可權帳戶的設計、結構和執行方法。 一般來說，PIM 提供的機制會授與許可權給帳戶，以執行組建或中斷修正功能，而不是讓許可權永久附加到帳戶。 無論是手動建立 PIM 功能，或是透過部署協力廠商軟體，都可以使用下列一或多項功能：  
  
- 認證 "vault"，其中特殊許可權帳戶的密碼會被「簽出」並指派初始密碼，然後在活動完成時「簽入」，此時會在帳戶上重新重設密碼。  
- 使用特殊許可權認證時的限時限制  
- 一次使用認證  
- 工作流程產生的許可權授與、執行的活動監視和報告，以及在活動完成或配置時間已過期時自動移除許可權  
- 以應用程式開發介面（Api）取代硬式編碼的認證，例如腳本中的使用者名稱和密碼，讓您可以視需要從保存庫取出認證  
- 自動管理服務帳戶認證  

### <a name="creating-unprivileged-accounts-to-manage-privileged-accounts"></a>建立無許可權帳戶以管理特殊許可權帳戶

管理特殊許可權帳戶的其中一項挑戰是，根據預設，可以管理特殊許可權和受保護帳戶和群組的帳戶是特殊許可權和受保護的帳戶。 如果您為 Active Directory 安裝執行適當的 RBAC 和 PIM 解決方案，解決方案可能會包含一些方法，讓您有效地 depopulate 目錄中最具特殊許可權群組的成員資格，並只在需要時暫時填入群組。  

不過，如果您執行的是原生 RBAC 和 PIM，您應該考慮建立沒有許可權的帳戶，並在需要時，使用唯一的功能來 Active Directory 填入和 depopulating 特殊許可權群組。 [附錄 I：在 Active Directory 中建立受保護帳戶和群組的管理帳戶](../../../ad-ds/manage/component-updates/../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md)會提供逐步指示，讓您用來建立用於此用途的帳戶。  

### <a name="implementing-robust-authentication-controls"></a>執行穩健的驗證控制項

*第六條法則：有人嘗試猜出您的密碼。* - [安全性管理的10個不可變法則](https://technet.microsoft.com/library/cc722488.aspx)  

傳遞雜湊和其他認證竊取攻擊並不是 Windows 作業系統特有的，也不是新的。 第一次傳遞雜湊攻擊是在1997中建立。 不過，在過去，這些攻擊需要自訂的工具、達到或遺漏成功，以及必要的攻擊者擁有相當高的技能。 引進了可自由使用且便於使用的工具，以原生方式解壓縮認證，最近幾年來增加認證竊取攻擊的數量和成功。 不過，認證竊取攻擊也不是用來做為認證目標和遭到入侵的唯一機制。  

雖然您應該執行控制措施來協助保護您免于認證竊取攻擊，但您也應該找出環境中最有可能被攻擊者鎖定的帳戶，並為這些帳戶執行健全的驗證控制。 如果您的最高許可權帳戶使用單一要素驗證，例如使用者名稱和密碼（這兩者都是「您知道的東西」，也就是一種驗證因素），則這些帳戶會受到弱式保護。 攻擊者只需要知道使用者名稱和帳戶相關密碼的知識，而且不需要傳遞雜湊攻擊，攻擊者就可以將使用者驗證為接受單一要素認證的任何系統。  

雖然執行多重要素驗證並不會保護您免于傳遞雜湊攻擊，但也可以將多重要素驗證與受保護的系統結合在一起。 如需有關實施受保護系統的詳細資訊，請閱讀如何[執行安全的管理主機](../../../ad-ds/plan/security-best-practices/Implementing-Secure-Administrative-Hosts.md)和驗證選項，將在下列各節中討論。  

#### <a name="general-authentication-controls"></a>一般驗證控制項

如果您尚未執行多重要素驗證（例如智慧卡），請考慮這麼做。 智慧卡會在公開/私密金鑰組中執行私密金鑰的硬體強制保護，以防止存取或使用使用者的私密金鑰，除非使用者向智慧卡出示適當的 PIN、密碼或生物識別識別碼。 即使遭入侵的電腦上的按鍵記錄器攔截到使用者的 PIN 或密碼，攻擊者還是可以重複使用 PIN 碼或密碼，該卡片也必須實際出現。

在長時間執行複雜密碼的情況下，由於使用者抵抗而難以實現，智慧卡提供一種機制，讓使用者可以在不容易受到暴力密碼破解或彩虹資料表攻擊的情況下，執行相當簡單的 Pin 或密碼。 智慧卡 Pin 不會儲存在 Active Directory 或本機 SAM 資料庫中，不過認證雜湊可能仍會儲存在已使用智慧卡進行驗證之電腦上的 LSASS 受保護記憶體中。  

#### <a name="additional-controls-for-vip-accounts"></a>VIP 帳戶的其他控制項

執行智慧卡或其他憑證型驗證機制的另一個優點是能夠利用驗證機制保證來保護 VIP 使用者可存取的機密資料。 在功能等級設定為 Windows Server 2012 或 Windows Server 2008 R2 的網域中，會提供驗證機制保證。 啟用時，當使用者的認證在使用以憑證為基礎的登入方法登入時進行驗證時，驗證機制保證會將系統管理員指定的全域群組成員資格新增至使用者的 Kerberos 權杖。  

這可讓資源管理員根據使用者是否使用以憑證為基礎的登入方法，以及使用的憑證類型，來控制對資源的存取，例如，檔案、資料夾和印表機。 例如，當使用者使用智慧卡登入時，可以指定使用者對網路上資源的存取權，與使用者未使用智慧卡（也就是使用者藉由輸入使用者名稱和密碼登入時的存取權）不同。 如需驗證機制保證的詳細資訊，請參閱[Windows Server 2008 R2 逐步指南中的 AD DS 的驗證機制保證](https://technet.microsoft.com/library/dd378897.aspx)。  

#### <a name="configuring-privileged-account-authentication"></a>設定特殊許可權帳戶驗證

在 [所有系統管理帳戶的 Active Directory] 中，啟用 [互動式登入] 屬性的 [**需要智慧卡**]，並針對帳戶的 [**帳戶**] 索引標籤上的任何屬性（例如，Cn、Name、SAMAccountName、userPrincipalName 和 userAccountControl）系統管理使用者物件，進行至少的變更審核。  

雖然在帳戶上設定 [**需要智慧卡以進行互動式登入**] 會將帳戶的密碼重設為120個字元的隨機值，而且需要智慧卡以進行互動式登入，但使用者仍然可以使用允許使用者變更帳戶密碼的許可權來覆寫該屬性，然後使用這些帳戶來建立非互動式登入，只需使用使用者名稱和密碼。  

在其他情況下，視在 Active Directory 憑證服務（AD CS）或協力廠商 PKI 的 Active Directory 和憑證設定中的帳戶設定而定，系統管理或 VIP 帳戶的使用者主要名稱（UPN）屬性可以針對特定類型的攻擊，如這裡所述。  

##### <a name="upn-hijacking-for-certificate-spoofing"></a>憑證詐騙的 UPN 劫持

雖然對公開金鑰基礎結構（Pki）的攻擊徹底討論不在本檔的範圍內，但對公開和私人 Pki 的攻擊會以指數方式增加，自2008起。 公用 Pki 的漏洞已廣泛地被公開，但對組織內部 PKI 的攻擊可能更豐富。 其中一種攻擊會利用 Active Directory 和憑證，讓攻擊者以可能很容易偵測到的方式來偽造其他帳戶的認證。  

向已加入網域的系統驗證憑證時，憑證中的 [主旨] 或 [主體別名（SAN）] 屬性的內容會用來將憑證對應至 Active Directory 中的使用者物件。 根據憑證的類型和其結構，憑證中的主旨屬性通常會包含使用者的一般名稱（CN），如下列螢幕擷取畫面所示。  

![最低版權管理模型](media/Implementing-Least-Privilege-Administrative-Models/SAD_4.gif)  

根據預設，Active Directory 藉由串連帳戶的名字 + "" + 姓氏來建立使用者的 CN。 不過，Active Directory 中使用者物件的 CN 元件不是必要或保證是唯一的，而且將使用者帳戶移至目錄中的不同位置會變更帳戶的辨別名稱（DN），這是目錄中物件的完整路徑，如先前螢幕擷取畫面的下方窗格所示。  

因為憑證主體名稱不一定是靜態或唯一的，所以主體別名的內容通常用來尋找 Active Directory 中的使用者物件。 從企業憑證授權單位單位（Active Directory 整合式 Ca）發給使用者之憑證的 SAN 屬性通常會包含使用者的 UPN 或電子郵件地址。 由於 Upn 在 AD DS 樹系中保證是唯一的，因此依 UPN 尋找使用者物件通常是在驗證過程中執行，不論是否有與驗證程式相關的憑證。  

攻擊者可以利用在驗證憑證的 SAN 屬性中使用 Upn 來取得詐騙憑證。 如果攻擊者遭入侵的帳戶能夠在使用者物件上讀取和寫入 Upn，則攻擊的執行方式如下：  

使用者物件（例如 VIP 使用者）上的 UPN 屬性會暫時變更為不同的值。 此時，SAM 帳戶名稱屬性和 CN 也可以變更，但這通常不是必要的，因為這是先前所述的原因。  

當目標帳戶上的 UPN 屬性變更時，已啟用過時的使用者帳戶或全新建立的使用者帳戶的 UPN 屬性會變更為原先指派給目標帳戶的值。 過時的已啟用使用者帳戶是一段長時間未登入，但尚未停用的帳戶。 這些攻擊者的目標是想要「在一般情況下隱藏」，原因如下：  

1. 由於帳戶已啟用，但最近尚未使用，因此使用此帳戶不太可能會觸發警示，因為啟用已停用的使用者帳戶可能會發生這種情況。  
2. 使用現有的帳戶不需要建立新的使用者帳戶，可能會由系統管理人員注意到。  
3. 仍啟用的過時使用者帳戶通常是各種安全性群組的成員，而且會被授與網路上資源的存取權，簡化存取，並將其與現有的使用者人口「混合」。  

現在已設定目標 UPN 的使用者帳戶，是用來向 Active Directory 憑證服務要求一個或多個憑證。  

取得攻擊者帳戶的憑證時，會將 "new" 帳戶和目標帳戶上的 Upn 傳回其原始值。  

攻擊者現在有一或多個憑證，可以向資源和應用程式提供驗證，就像使用者是帳戶暫時修改的 VIP 使用者一樣。 雖然攻擊者可以將憑證與 PKI 設為目標的所有方法，都不在本文的討論範圍內，但提供這種攻擊機制來說明為什麼您應該在 AD DS 中監視特殊許可權和 VIP 帳戶，以進行變更，特別是針對帳戶的 [**帳戶**] 索引標籤上的任何屬性變更（例如 cn、Name、SAMAccountName、UserPrincipalName 和 userAccountControl）。 除了監視帳戶之外，您還應該限制誰可以將帳戶修改為一組較小的系統管理使用者。 同樣地，應保護和監視系統管理使用者的帳戶，以進行未經授權的變更。  
