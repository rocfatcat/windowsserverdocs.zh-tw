---
ms.assetid: d7a4d2e1-217d-4ffc-93f0-817149bd9e7f
title: 危及系統安全的途徑
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: b2233a638aa0a422d5792f8c949c46ac8de099ba
ms.sourcegitcommit: 07c9d4ea72528401314e2789e3bc2e688fc96001
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/29/2020
ms.locfileid: "76822041"
---
# <a name="avenues-to-compromise"></a>危及系統安全的途徑

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

*第七條法則：最安全的網路是妥善管理的網路。* - [安全性管理的10個不可變法則](https://technet.microsoft.com/library/cc722488.aspx)  
  
在發生嚴重入侵事件的組織中，評量通常會顯示組織對 IT 基礎結構的實際狀態具有有限的可見度，這可能會因為其「記載」而變得很明顯。提示. 這些變異會引進弱點，讓環境暴露于洩露，而在入侵進入實際「擁有」環境的那一點之前，幾乎不會有探索風險。  
  
這些組織 AD DS 設定、公開金鑰基礎結構（Pki）、伺服器、工作站、應用程式、存取控制清單（Acl）和其他技術的詳細評量，會顯示錯誤設定和弱點，如果已補救，可能會阻止初始的洩露。  
  
IT 檔、進程和程式的分析，識別由攻擊者利用的系統管理實務缺口所引進的弱點，最終會取得用來徹底入侵 Active Directory 樹系的許可權。 完全遭入侵的樹系，攻擊者不僅會危害個別系統、應用程式或使用者帳戶，還會提升其存取權，以取得可修改或終結樹系所有層面的許可權層級。 當 Active Directory 安裝已危害到該程度時，攻擊者可以進行變更，讓他們在整個環境中維持狀態，或更糟地終結目錄以及它所管理的系統和帳戶。  
  
雖然後面的描述中經常會被利用的弱點不會受到 Active Directory 的攻擊，但可讓攻擊者在環境中建立據點，以用來執行許可權提升（也稱為許可權）提高許可權）攻擊，最終目標和危害 AD DS。  
  
本檔的這一節著重于說明攻擊者通常用來存取基礎結構，並最終啟動許可權提升攻擊的機制。 另請參閱下列各節：  
  
-   [減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)Active Directory 安全設定的詳細建議。  
  
-   [監視 Active Directory 危害的徵兆](../../../ad-ds/plan/security-best-practices/Monitoring-Active-Directory-for-Signs-of-Compromise.md)協助偵測危害的建議  
  
-   [規劃危害](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md)協助您針對基礎結構和商務觀點的攻擊進行準備的高階方法  
  
> [!NOTE]  
> 雖然本檔著重于屬於 AD DS 領域的 Active Directory 和 Windows 系統，但攻擊者很少只著重于 Active Directory 和 Windows。 在混合作業系統、目錄、應用程式和資料存放庫的環境中，通常會發現非 Windows 系統也遭到入侵。 特別是，如果系統在 Windows 和非 Windows 環境之間提供「橋接器」，例如 Windows 和 UNIX 或 Linux 用戶端所存取的檔案伺服器、提供驗證服務給多個作業系統的目錄，或跨不同目錄同步處理資料的 metadirectories。  
>   
> AD DS 是以集中式存取和設定管理功能為目標，而不只是對 Windows 系統提供，而是針對其他用戶端。 提供驗證和設定管理服務的任何其他目錄或應用程式都可以，而且會被判斷攻擊者的目標。 雖然本檔的重點在於可以降低 Active Directory 安裝遭到入侵的可能性，但每個包含非 Windows 電腦、目錄、應用程式或資料存放庫的組織也應該準備對這些系統的攻擊。  
  
## <a name="initial-breach-targets"></a>初始漏洞目標  
沒有人刻意建立 IT 基礎結構，讓組織暴露于入侵。 第一次建立 Active Directory 樹系時，通常是初始化且最新的。 隨著數年的通過和新的作業系統和應用程式被取得，它們就會新增至樹系。 隨著 Active Directory 所提供的管理能力優點，已將更多內容新增至目錄、更多人將其電腦或應用程式與 AD DS 整合，以及將網域升級，以支援最常提供的新功能目前的 Windows 作業系統版本。 不過，一段時間後也會發生什麼事，就算是新增了新的基礎結構，基礎結構的其他部分可能也不會一一一開始維護，系統和應用程式也能正常運作，因此不會收到而且組織會開始忘了它們尚未消除其舊版基礎結構。 根據我們在評估遭盜用的基礎結構、較舊、較大且更複雜的環境中所看到的內容，最有可能的情況是經常利用弱點的許多實例。  
  
無論攻擊者的動機為何，大部分資訊安全性漏洞都是一次洩露一或兩個系統。 這些初始事件或進入網路的進入點，通常會利用可能已經修正的弱點，而不是。 [2012 資料缺口調查報告（DBIR）](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf)，這是由 Verizon 風險小組與許多國家安全性機關及其他公司合作所產生的年度研究，說明96% 的攻擊「不太難」，而且「97% 的缺口是透過簡單或中繼控制肇因。」 這些發現可能是常見的惡意探索弱點的直接結果。  
  
### <a name="gaps-in-antivirus-and-antimalware-deployments"></a>防毒軟體和反惡意程式碼部署的間距  
*第8條法則：過期的惡意程式碼掃描程式，只比完全沒有掃描器來得好。* - [十個不變的安全性法則（版本2.0）](https://technet.microsoft.com/security/hh278941.aspx)  
  
組織的防毒軟體和反惡意程式碼部署的分析通常會顯示環境，其中大部分的工作站都設定了啟用和最新的防毒軟體和反惡意程式碼軟體。 例外狀況通常是不常連線到公司環境的工作站，或可能很容易部署、設定和更新防毒軟體和反惡意程式碼軟體的員工裝置。  
  
不過，伺服器的擴展通常會在許多遭入侵的環境中受到較不一致的保護。 如[2012 資料缺口調查](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf)中所述，所有資料的94% 都會與伺服器相關，這代表前一年增加了18%，而將惡意程式碼納入攻擊的69%。 在伺服器擴展中，發現防毒軟體和反惡意程式碼安裝的設定不一致、已過時、設定不正確，甚至是停用的情況並不常見。 在某些情況下，防毒軟體和反惡意程式碼軟體會由系統管理人員停用，但在其他情況下，攻擊者會在透過其他弱點危害伺服器後停用軟體。 當防毒軟體和反惡意程式碼軟體停用時，攻擊者會在伺服器上植入惡意程式碼，並專注于在伺服器擴展中傳播危害。  
  
這不只是為了確保您的系統受到最新的完整惡意程式碼保護所保護，同時也可監視系統以停用或移除防毒軟體和反惡意程式碼軟體，以及在其為時自動重新開機保護已手動停用。 雖然沒有防毒軟體和反惡意程式碼軟體可保證所有感染的防護和偵測，但已正確設定及部署的防毒程式和反惡意程式碼的執行可能會降低感染的可能性。  
  
### <a name="incomplete-patching"></a>不完整的修補  
*第三條法則：如果您沒有跟上安全性修正程式，您的網路將不會是您的長時間。* - [安全性管理的10個不可變法則](https://technet.microsoft.com/library/cc722488.aspx)  
  
Microsoft 會在每個月的第二個星期二發行安全性公告，不過，在少數情況下，安全性更新會在每月的安全性更新（也稱為「頻外」更新）之間發行，而此弱點是在判斷是否要造成的客戶系統的緊急風險。 無論小型企業是否將其 Windows 電腦設定為使用 Windows Update 來管理系統和應用程式修補，或大型組織使用 Microsoft Endpoint Configuration Manager 之類的管理軟體，根據詳細的來部署修補程式。階層式計畫，許多客戶會以相對及時的方式修補其 Windows 基礎結構。  
  
不過，少數的基礎結構只包含 Windows 電腦和 Microsoft 應用程式，而在遭入侵的環境中，通常會發現組織的修補程式管理原則包含間距。 這些環境中的 Windows 系統會以不一致的方式進行修補。 非 Windows 作業系統會偶爾修補（如果有的話）。 商業現成（COTS）應用程式包含修補程式存在但尚未套用的弱點。 網路裝置通常會使用出廠預設認證進行設定，而且在安裝後不會有任何固件更新年份。 不受其廠商支援的應用程式和作業系統通常會保持執行狀態，儘管它們無法再針對弱點進行修補。 這些未修補的系統都代表攻擊者的另一個可能的進入點。  
  
IT 的消費化引進了額外的挑戰，就是員工擁有的裝置用來存取公司擁有的資料，而組織可能幾乎無法控制員工個人裝置的修補和設定。 企業級硬體一般會隨附企業就緒的設定選項和管理功能，但在個別自訂和裝置選擇方面，成本較低。 以員工為主的硬體提供更廣泛的製造商、廠商、硬體安全性功能、軟體安全性功能、管理功能和設定選項，以及許多企業功能可能完全不存在。  
  
#### <a name="patch-and-vulnerability-management-software"></a>修補程式和弱點管理軟體  
如果有效的修補程式管理系統已適用于 Windows 系統和 Microsoft 應用程式，則已解決未修補的弱點建立的受攻擊面。 不過，除非非 Windows 系統、非 Microsoft 應用程式、網路基礎結構和員工裝置也會保持最新的修補程式和其他修正程式，否則基礎結構會變得很容易受到攻擊。 在某些情況下，應用程式的廠商可能會提供自動更新功能;在其他情況下，可能需要設計一種方法來定期取得和套用修補程式和其他修正。
  
### <a name="outdated-applications-and-operating-systems"></a>過期的應用程式和作業系統  
*「您不能預期有六年的舊版本的作業系統，可以保護您免于六個月的攻擊。」* -資訊安全專家，具備10年保護企業安裝的經驗  
  
雖然「取得最新、隨時保持最新」聽起來可能像是行銷片語，但過期的作業系統和應用程式在許多組織的 IT 基礎結構中會造成風險。 廠商仍然支援2003發行的作業系統，並提供更新來解決弱點，但該作業系統可能不包含較新版本作業系統中新增的安全性功能。 過時的系統甚至可能需要削弱特定的 AD DS 安全性設定，以支援這些電腦的較小功能。  
  
已不支援應用程式的廠商為了使用舊版驗證通訊協定而撰寫的應用程式，通常無法改良以支援更強的驗證機制。 不過，組織的 Active Directory 網域仍可能設定為儲存 LAN Manager 雜湊或可逆的加密密碼，以支援這類應用程式。 在引進較新作業系統之前撰寫的應用程式，可能無法正常運作，也無法在目前的作業系統上運作，而需要組織維護舊版和較舊的系統，在某些情況下，則完全不受支援的硬體和軟體。  
  
即使組織已將其網域控制站更新為 Windows Server 2012、Windows Server 2008 R2 或 Windows Server 2008，一般都是尋找成員伺服器擴展的重要部分，以執行 Windows Server 2003、Windows2000伺服器或 Windows NT Server 4.0 （完全不受支援）。 組織維護過時系統的時間愈久，功能集之間的差異會增加，而且可能會使生產系統不受支援。 此外，Active Directory 樹系的維護時間愈久，我們發現升級計畫中遺漏了舊版系統和應用程式。 這可能表示執行單一應用程式的單一電腦可能會引進網域或樹系的弱點，因為 Active Directory 設定為支援其舊版通訊協定和驗證機制。  
  
若要排除舊版系統和應用程式，您應該先專注于識別和編目它們，然後決定是否要升級或取代應用程式或主機。 雖然難以找到不支援或升級路徑的高度特殊化應用程式的替代專案，但您可以利用名為「創意損毀」的概念，將繼承應用程式取代為新的應用程式這會提供必要的功能。 本檔稍後的「正在進行危害的規劃」中有更深入的說明[規劃危害](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md)。  
  
### <a name="misconfiguration"></a>設定錯誤  
*第四條法則：在從未受到保護的電腦上安裝安全性修正，並不會有太大的好處。* - [安全性管理的10個不可變法則](https://technet.microsoft.com/library/cc722488.aspx)  
  
即使在系統通常會保持最新狀態和修補的環境中，我們通常會識別作業系統、電腦上執行的應用程式，以及 Active Directory 的間隙或錯誤配置。 有些錯誤的錯誤處理只會公開本機電腦來危害，但是在電腦「擁有」之後，攻擊者通常會專注于進一步將危害傳播到其他系統，最後再 Active Directory。 以下是一些常見的區域，我們會在其中識別引進風險的設定。  
  
#### <a name="in-active-directory"></a>在 Active Directory  
Active Directory 中最常成為攻擊者的帳戶，就是具有最高許可權群組的成員，例如網域系統管理員（DA）、企業系統管理員（EA）或內建系統管理員（BA）群組的成員。Directory. 這些群組的成員資格應縮減為最小的帳戶數目，讓這些群組的受攻擊面受到限制。 甚至可以排除這些特殊許可權群組中的「永久」成員資格;也就是說，您可以執行設定，讓您只在需要其網域和全樹系許可權時，才會暫時填入這些群組。 使用高許可權帳戶時，只能在指定的安全系統上使用，例如網域控制站或安全的管理主機。 以下提供可協助您執行這些設定的詳細資訊，以[減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)。  
  
當我們評估 Active Directory 中最高許可權群組的成員資格時，通常會發現這三個最具許可權的群組中有過多的成員資格。 在某些情況下，組織會在 DA 群組中擁有數十個或數百個帳戶。 在其他情況下，組織會直接將帳戶放入內建的系統管理員群組中，並認為群組「許可權較小」，而不是 DAs 群組。 不是。 我們經常會在樹系根域中找到一些 EA 群組的永久成員，儘管 EA 許可權很少且暫時是必要的事實。 即使這是有效的重複設定，在所有三個群組中尋找 IT 使用者的日常系統管理帳戶也是常見的。 如[減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)中所述，帳戶是否為其中一個群組或全部的永久成員，帳戶可以用來危害，甚至終結其所管理的 AD DS 環境和系統和帳戶。 在 Active Directory 中提供安全設定和使用特殊許可權帳戶的建議，以[減少 Active Directory 攻擊面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)。  
  
#### <a name="on-domain-controllers"></a>在網域控制站上  
當我們評估網域控制站時，通常會發現它們的設定和管理方式與成員伺服器不同。 網域控制站有時候會執行安裝在成員伺服器上的相同應用程式和公用程式，而不是因為在網域控制站上需要它們，但是因為應用程式是標準組建的一部分。 這些應用程式可能會在網域控制站上提供最少的功能，但會要求設定以開啟埠、建立高許可權服務帳戶，或將存取權授與使用者除了驗證和群組原則應用程式以外，不應連接到網域控制站。 在某些缺口中，攻擊者已使用已安裝在網域控制站上的工具，而不只是為了取得網域控制站的存取權，而是修改或損毀 AD DS 資料庫。  
  
當我們在網域控制站上解壓縮 Internet Explorer 設定時，我們發現使用者已使用具有高階許可權的帳戶登入 Active Directory，並已使用帳戶從網域存取網際網路和內部網路控制器. 在某些情況下，帳戶已在網域控制站上設定 Internet Explorer 設定，以允許下載網際網路內容，而可從網際網路網站下載免費軟體公用程式，並已安裝在網域控制站上。 根據預設，使用者和系統管理員已啟用 Internet Explorer 增強式安全性設定，但我們通常會發現系統管理員已停用這項功能。 當具有高許可權的帳戶存取網際網路，並將內容下載到任何電腦時，該電腦會面臨嚴重的風險。 當電腦是網域控制站時，整個 AD DS 安裝都會有風險。  
  
##### <a name="protecting-domain-controllers"></a>保護網域控制站  
應將網域控制站視為重要的基礎結構元件，安全地而更加嚴格，並設定為比檔案、列印和應用程式伺服器更嚴格。 網域控制站不應執行網域控制站運作所需的任何軟體，或不會保護網域控制站免于遭受攻擊。 不應允許網域控制站存取網際網路，而且安全性設定應由群組原則物件（Gpo）進行設定和強制執行。 保護網域控制站的安全安裝、設定和管理的詳細建議，是為了[防範攻擊](../../../ad-ds/plan/security-best-practices/Securing-Domain-Controllers-Against-Attack.md)。  
  
#### <a name="within-the-operating-system"></a>在作業系統內  
*第二條法則：如果不良的人可以改變電腦上的作業系統，則不是您的電腦。* - [十個不變的安全性法則（版本2.0）](https://technet.microsoft.com/security/hh278941.aspx)  
  
雖然某些組織會為不同類型的伺服器建立基準設定，並在安裝作業系統之後允許對其進行有限的自訂，但遭入侵環境的分析通常會發現大量部署于的伺服器臨機操作的方式，並手動和獨立設定。 兩部執行相同功能的伺服器之間的設定可能完全不同，因為伺服器沒有安全地設定。 相反地，伺服器設定基準可能會一致地強制執行，但也會一致地進行設定。也就是說，伺服器的設定方式，會在指定類型的所有伺服器上建立相同的弱點。 設定錯誤包括停用安全性功能、授與帳戶過多的權利和許可權（特別是服務帳戶）、在系統上使用相同的本機認證，以及允許安裝未經授權的應用程式和公用程式會建立自己的弱點。  
  
##### <a name="disabling-security-features"></a>停用安全性功能  
組織有時會停用具有 Advanced Security （WFAS）的 Windows 防火牆，而不是因為 WFAS 很容易設定或需要耗費大量工作的設定。 不過，從 Windows Server 2008 開始，在伺服器上安裝任何角色或功能時，預設會以角色或功能運作所需的最低許可權來設定，而 Windows 防火牆會自動設定為支援角色或功能。 藉由停用 WFAS （而不是在其位置使用另一個主機型防火牆），組織會增加整個 Windows 環境的受攻擊面。 周邊防火牆針對直接以網際網路為目標環境的攻擊提供一些保護，但它們不會保護惡意探索其他攻擊媒介的攻擊，例如[磁片磁碟機下載](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx)攻擊，或源自內部網路上其他遭入侵系統的攻擊。  
  
伺服器上的使用者帳戶控制（UAC）設定有時會停用，因為系統管理人員會發現干擾性的提示。 雖然[Microsoft 支援服務文章 2526083](https://support.microsoft.com/kb/2526083)說明在 Windows Server 上可能停用 uac 的案例，但除非您執行的是 Server core 安裝（其設計已停用 uac），否則您不應該在伺服器上停用 uac，而不需要謹慎考慮和研究。  
  
在其他情況下，伺服器設定會設定為較不安全的值，因為組織會將過時的伺服器設定套用至新的作業系統，例如將 Windows Server 2003 基準套用到執行 Windows Server 2012 的電腦、Windows伺服器 2008 R2 或 Windows Server 2008，而不會變更基準以反映作業系統中的變更。 部署新的作業系統時，請檢查安全性變更和設定，以確保所實行的設定適用，且適用于新的作業系統，而不是在新的作業系統上攜帶舊的伺服器基準。  
  
##### <a name="granting-excessive-privilege"></a>授與過多許可權  
在幾乎每個我們已評估的環境中，對 Windows 系統上的本機和網域型帳戶會授與過多的許可權。 使用者會被授與其工作站上的本機系統管理員許可權，成員伺服器會執行所設定許可權超過其所需功能的服務，而跨伺服器擴展的本機 Administrators 群組則包含數十個或甚至數百個本機和網域帳戶。 只在電腦上洩露一個特殊許可權帳戶，可讓攻擊者危害登入電腦之每個使用者和服務的帳戶，並收集並利用認證將危害傳播到其他系統。  
  
雖然傳遞雜湊（PTH）和其他認證竊取攻擊目前是普遍的，這是因為有可自由使用的工具，可讓您在攻擊者取得系統管理員時，簡單且輕鬆地解壓縮其他特殊許可權帳戶的認證。或電腦的系統層級存取。 即使沒有工具可讓您從登入會話收集認證，具有電腦存取權的攻擊者也可以輕鬆地安裝按鍵記錄器，以捕捉按鍵、螢幕擷取畫面和剪貼簿內容。 具有電腦特殊許可權存取權的攻擊者可以停用反惡意程式碼軟體、安裝 rootkit、修改受保護的檔案，或在電腦上安裝惡意程式碼以自動進行攻擊，或將伺服器轉換成[磁片磁碟機](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx)。  
  
用來將缺口延伸到單一電腦以外的策略會有所不同，但傳播危害的關鍵是取得額外系統的高特殊許可權存取權。 藉由減少具有任何系統之特殊許可權存取權的帳戶數目，您不僅可以減少該電腦的攻擊面，還能降低攻擊者從電腦收集寶貴認證的可能性。  
  
##### <a name="standardizing-local-administrator-credentials"></a>將本機系統管理員認證標準化  
在安全性專家中，在 Windows 電腦上的本機系統管理員帳戶重新命名時，有很長的爭論。 有關本機系統管理員帳戶的重要事項，就是在多部電腦上設定是否使用相同的使用者名稱和密碼。  
  
如果本機系統管理員帳戶在伺服器之間命名為相同的值，且指派給帳戶的密碼也設定為相同的值，攻擊者就可以在一部電腦上解壓縮帳戶的認證，系統管理員或系統層級的存取權已取得。 攻擊者一開始不需要洩露系統管理員帳戶;他們只需要洩露屬於本機 Administrators 群組成員的使用者帳戶，或是設定為以 LocalSystem 身分或以系統管理員許可權執行的服務帳戶。 然後，攻擊者就可以將系統管理員帳戶的認證解壓縮，然後將網路登入中的認證重新播放到網路上的其他電腦。  
  
只要有另一部電腦的本機帳戶具有與所顯示帳號憑證相同的使用者名稱和密碼（或密碼雜湊），登入嘗試就會成功，而攻擊者會取得目的電腦的特殊許可權存取權。 在目前的 Windows 版本中，[預設會停用](https://technet.microsoft.com/library/cc753450.aspx)內建的系統管理員帳戶，但在舊版作業系統中，此帳戶預設為啟用。  
  
> [!NOTE]  
> 有些組織故意設定本機系統管理員帳戶，以確保在系統鎖定所有其他特殊許可權帳戶時，會提供「安全」功能。 不過，即使已停用本機系統管理員帳戶，而且沒有其他可啟用帳戶或以系統管理員許可權登入系統的帳戶，系統還是可以開機進入安全模式，而內建的本機系統管理員帳戶可以重新啟用，如[Microsoft 支援服務文章 814777](https://support.microsoft.com/kb/814777)中所述。 此外，如果系統仍成功套用 Gpo，則可以將 GPO 修改為（暫時）重新啟用系統管理員帳戶，或將限制的群組設定為將網域型帳戶新增至本機系統管理員群組。 可以執行修復，而且系統管理員帳戶可以再次停用。 若要有效避免使用內建本機系統管理員帳號憑證的橫向入侵，必須為本機系統管理員帳戶設定唯一的使用者名稱和密碼。 若要透過 GPO 部署本機系統管理員帳戶的唯一密碼，請參閱 technet 上的透過[gpo 管理內建的系統管理員帳戶密碼的解決方案](https://technet.microsoft.com/mt227395.aspx)。  
  
##### <a name="permitting-installation-of-unauthorized-applications"></a>允許安裝未經授權的應用程式  
*第一條法則：如果不良的人可以說服您在電腦上執行他的程式，這不是完全是您的電腦而已。* - [十個不變的安全性法則（版本2.0）](https://technet.microsoft.com/security/hh278941.aspx)  
  
無論組織是否跨伺服器部署一致的基準設定，都不應該允許安裝不屬於伺服器定義角色的應用程式。 藉由允許安裝不屬於伺服器指定功能的軟體，伺服器會暴露于不小心或惡意的軟體安裝，以增加伺服器的受攻擊面、引進應用程式弱點，或造成系統不穩定。  
  
#### <a name="applications"></a>應用程式  
如先前所述，應用程式通常會安裝並設定為使用所授與的許可權比應用程式實際需要更多的帳戶。 在某些情況下，應用程式的檔會指定服務帳戶必須是伺服器本機系統管理員群組的成員，或者必須設定為在 LocalSystem 的內容中執行。 這通常不是因為應用程式需要這些許可權，但因為判斷應用程式的服務帳戶所需的許可權和許可權需要投入額外的時間和工作。 如果應用程式未以應用程式所需的最低許可權和其設定的功能來安裝，則系統會暴露于利用應用程式許可權的攻擊，而不會對作業系統本身進行任何攻擊。  
  
### <a name="lack-of-secure-application-development-practices"></a>缺乏安全的應用程式開發實務  
有基礎結構可支援商務工作負載。 在自訂應用程式中執行這些工作負載時，確保應用程式是使用安全的最佳作法來開發，是非常重要的。 全企業事件的根本原因分析，通常會顯示初始的洩露會透過自訂應用程式（特別是網際網路對向）而受到影響。 這些危害大部分都是透過洩露已知的攻擊來完成，例如 SQL 插入（SQLi）和跨網站腳本（XSS）攻擊。  
  
SQL 插入式攻擊是一種應用程式弱點，可讓使用者定義的輸入修改傳遞至資料庫以執行的 SQL 語句。 您可以透過應用程式中的欄位、參數（例如查詢字串或 cookie）或其他方法來提供此輸入。 此插入的結果是，提供給資料庫的 SQL 語句基本上與開發人員所預期的不同。 例如，用於評估使用者名稱/密碼組合的一般查詢：  
  
`SELECT userID FROM users WHERE username = 'sUserName' AND password = 'sPassword'`  
  
當資料庫伺服器收到這種情況時，它會指示伺服器查看 users 資料表，並傳回任何使用者名稱和密碼符合使用者所提供的 userID 記錄（可能是透過某種登入形式）。 在此情況下，開發人員的目的自然是只有在使用者可以提供正確的使用者名稱和密碼時，才會傳回有效的記錄。 如果其中一個不正確，資料庫伺服器將找不到相符的記錄並傳回空的結果。  
  
當攻擊者執行非預期的動作（例如提供自己的 SQL 來取代有效的資料）時，就會發生此問題。 因為 SQL 是由資料庫伺服器即時地進行轉譯，所以插入的程式碼會如同開發人員將它放在自己的一樣處理。 例如，如果攻擊者為使用者識別碼和**xyz**或**1 = 1**輸入**系統管理員**做為密碼，則資料庫所處理的結果語句會是：  
  
`SELECT userID FROM users WHERE username = 'administrator' AND password = 'xyz' OR 1=1`  
  
當資料庫伺服器處理此查詢時，將會在查詢中傳回資料表中的所有資料列，因為 1 = 1 一律會評估為 True，因此如果已知或提供正確的使用者名稱和密碼，就不會有任何影響。 最後的結果是，使用者將以使用者資料庫中的第一位使用者的身分登入。在大部分情況下，這會是系統管理使用者。  
  
除了直接登入，這類格式不正確的 SQL 語句可用來加入、刪除或變更資料，或甚至是從資料庫中卸載（刪除）整個資料表。 在最極端的情況下，SQLi 與過多的許可權結合，可以執行作業系統命令以建立新的使用者、下載攻擊工具，或採取任何其他攻擊者選擇的動作。  
  
在跨網站腳本中，此弱點會在應用程式的輸出中引進。 攻擊的起點是攻擊者將格式不正確的資料提供給應用程式，但在此情況下，格式不正確的資料是由受害者的瀏覽器所執行的腳本編寫程式碼（例如 JavaScript）的形式。 惡意探索 XSS 弱點可以讓攻擊者在啟動瀏覽器的使用者內容中，執行目標應用程式的任何功能。 XSS 攻擊通常是由網路釣魚電子郵件發動，可讓使用者按一下連結，以連線至應用程式並執行攻擊代碼。  
  
在線上銀行和電子商務案例中，攻擊者通常會利用 XSS 來進行購買，或在惡意探索的使用者內容中傳送金錢。 在自訂 web 式身分識別管理應用程式的目標攻擊案例中，它可以讓攻擊者建立自己的身分識別、修改許可權和許可權，並導致系統入侵。  
  
雖然跨網站腳本和 SQL 插入的完整討論已超出本文的範圍，但[開放式 Web 應用程式安全性專案（OWASP）](https://www.owasp.org/index.php/Main_Page)會發佈前10大的清單，其中包含弱點和對策的深入討論。  
  
不論基礎結構安全性的投資為何，如果設計不佳的應用程式部署在該基礎結構內，環境就會容易遭受攻擊。 即使是妥善保護的基礎結構，通常也無法為這些應用程式攻擊提供有效的對策。 就問題而言，設計不佳的應用程式可能需要授與服務帳戶過多的許可權，應用程式才能運作。  
  
Microsoft 安全性開發週期 (SDL) （SDL）是一組結構化的流程式控制制，可在應用程式的生命週期內，于完成的需求收集和擴充之前，先改善安全性，然後再將其解除委任。 從安全性的觀點來看，有效安全性控制的整合並不重要，確保應用程式安全性符合成本和排程的效率非常重要。 評估應用程式中是否有安全性問題有效地完成程式碼時，組織只需在部署應用程式之前或甚至之後，才決定應用程式安全性的決策。 組織可以選擇在生產環境中部署應用程式之前，先解決應用程式瑕疵的問題、產生成本和延遲，或者可以在生產環境中部署應用程式，並提供已知的安全性瑕疵，使組織得以入侵。  
  
有些組織會針對每個問題，在 $10000 以上的實際執行程式碼中修正安全性問題的完整成本，而開發不具有效 SDL 的應用程式則可以平均每100000行的高嚴重性問題。 在大型應用程式中，成本會快速提升。 相較之下，許多公司在 SDL 的最後程式碼審查階段，會針對每100000行的程式碼設定一個不到一個問題的基準測試，並以生產環境中高風險應用程式的零問題為目標。  
  
實行 SDL 藉由在應用程式的需求收集和設計方面納入安全性需求來改善安全性，為高風險應用程式提供威脅模型;需要有效的開發人員訓練和監視;和需要清楚、一致的程式碼標準和實務。 SDL 的淨影響在於應用程式安全性的重大改進，同時降低開發、部署、維護和解除委任應用程式的成本。 雖然 SDL 設計與實施的詳細討論已超出本檔的範圍，但請參閱[Microsoft 安全性開發週期 (SDL)](https://www.microsoft.com/security/sdl/default.aspx) ，以取得詳細的指引和資訊。  
  


