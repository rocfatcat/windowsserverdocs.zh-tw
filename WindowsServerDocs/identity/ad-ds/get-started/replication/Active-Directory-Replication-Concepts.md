---
ms.assetid: 4cc9c16c-1928-4dce-a3a8-6229be28eb65
title: Active Directory 複寫概念
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 087dee7c914b81d97c6cf3a2ea985d809cb57fe6
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59812349"
---
# <a name="active-directory-replication-concepts"></a>Active Directory 複寫概念

>適用於：Windows Server 2016 中，Windows Server 2012 R2 中，Windows Server 2012

設計站台拓樸之前, 先熟悉一些 Active Directory 複寫概念。  
  
-   [連接物件](#BKMK_1)  
  
-   [KCC](#BKMK_2)  
  
-   [容錯移轉功能](#BKMK_3)  
  
-   [Subnet](#BKMK_4)  
  
-   [站台](#BKMK_5)  
  
-   [站台連結](#BKMK_6)  
  
-   [站台連結橋接器](#BKMK_7)  
  
-   [站台連結轉移性](#BKMK_8)  
  
-   [通用類別目錄伺服器](#BKMK_9)  
  
-   [萬用群組成員資格快取](#BKMK_10)  
  
## <a name="BKMK_1"></a>連接物件  
連接物件是 Active Directory 物件，表示從來源網域控制站到目的網域控制站複寫連線。 網域控制站的單一站台成員，在站台以 Active Directory 網域服務 (AD DS) 中的伺服器物件。 每個伺服器物件有子系，表示複寫在站台中的網域控制站的 NTDS 設定物件。  
  
連接物件是目的地伺服器上的 NTDS 設定物件的子系。 兩個網域控制站之間進行複寫，伺服器物件，其中之一必須連接物件，表示從其他的輸入的複寫。 所有的網域控制站的複寫連接會儲存為底下的 NTDS 設定物件的連接物件。 連接物件會識別複寫來源伺服器，包含複寫排程，以及指定的複寫傳輸。  
  
知識一致性檢查程式 (KCC) 會自動建立連線物件，但它們也可以建立以手動方式。 KCC 所建立的連線物件會出現在 Active Directory 站台及服務嵌入式管理單元做為**<automatically generated>** 而會被視為足夠在正常作業情況下。 由系統管理員建立的連線物件會以手動方式建立連線物件。 手動建立的連接物件建立時，系統管理員所指派的名稱識別。 當您修改**<automatically generated>** 連接物件，您將它轉換成由系統管理員修改過的連接物件和物件出現在表單中的 GUID。 KCC 不會手動或修改過的連接物件的變更。  
  
## <a name="BKMK_2"></a>KCC  
KCC 是內建的程序會在所有網域控制站上執行，並產生 Active Directory 樹系的複寫拓撲。 KCC 會建立不同的複寫拓撲取決於是否複寫站台 （站台內） 內，或站台 （站台間） 之間。 KCC 也會動態調整以容納新的網域控制站，移除現有的網域控制站，以和站台，變更成本與排程，從網域控制站和網域控制站新增拓撲暫時無法使用或處於錯誤狀態。  
  
在網站中，可寫入網域控制站之間的連線會一律會排列在雙向通道，與其他的快顯連線，以減少大型的網站延遲。 相反地，站台間拓撲是分層跨越樹狀結構，這表示一個站台間連線的每個目錄分割的任何兩個站台之間存在，而且通常不包含快顯連線。 如需有關擴展樹狀結構和 Active Directory 複寫拓撲的詳細資訊，請參閱 Active Directory 複寫拓撲技術參照 ([https://go.microsoft.com/fwlink/?LinkID=93578](https://go.microsoft.com/fwlink/?LinkID=93578))。  
  
每個網域控制站，KCC 會建立複寫路由，藉由建立定義來自其他網域控制站連線的單向的輸入的連線物件。 相同站台中的網域控制站，KCC 建立連線物件自動不需要管理員介入。 當您有多個站台時，設定站台之間，站台連結，並在每個網站的單一 KCC 自動建立以及站台之間的連線。  
  
### <a name="kcc-improvements-for-windows-server-2008-rodcs"></a>Windows Server 2008 Rodc 的 KCC 增強功能  

有多個以容納新的、 可用的唯讀網域控制站 (RODC)，在 Windows Server 2008 的 KCC 改進。 RODC 的典型部署案例是分公司。 在此案例中最常部署的 Active Directory 複寫拓撲取決於中樞和支點設計、 多個站台中的分公司網域控制站複寫使用少量的中樞站台的 bridgehead 伺服器的何處。  
  
在此案例中部署 RODC 的優點之一是單向複寫。 Bridgehead 伺服器不需要複寫從 RODC，進而減少系統管理和網路使用量。  
  
不過，反白顯示的中樞輪輻拓撲，在舊版的 Windows Server 作業系統上的系統管理挑戰之一是在中樞內新增新的 bridgehead 網域控制站之後, 沒有任何自動化的機制重新發佈分公司網域控制站和中樞網域控制站，以善用新的中樞網域控制站之間的複寫連線。  
  
Windows Server 2003 網域控制站，您可以透過重新平衡工作負載使用 Windows Server 2003 分支辦公室部署指南從 Adlb.exe 之類的工具 ([https://go.microsoft.com/fwlink/?LinkID=28523](https://go.microsoft.com/fwlink/?LinkID=28523))。  
  
對於 Windows Server 2008 Rodc，正常運作的 KCC 提供一些重新平衡，因而不需使用額外的工具，例如 Adlb.exe。 預設會啟用新功能。 您可以停用它將在 RODC 上設定下列登錄機碼：  
  
**HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters**  
  
**「 允許隨機 BH 負載平衡 」**  
**1 = 啟用 （預設值），0 = 停用**  
  
如需有關這些 KCC 增強功能的運作方式的詳細資訊，請參閱 < 規劃與部署 Active Directory 網域服務為分公司 ([https://go.microsoft.com/fwlink/?LinkId=107114](https://go.microsoft.com/fwlink/?LinkId=107114))。  
  
## <a name="BKMK_3"></a>容錯移轉功能  
站台，請確定複寫會路由傳送網路失敗和離線網域控制站。 在指定的時間間隔來調整 AD DS 中發生變更的複寫拓撲的 KCC 執行，例如當加入新的網域控制站和新建立的網站。 KCC 會檢閱現有的連線，來判斷是否未使用任何連線的複寫狀態。 如果連接未運作因為失敗的網域控制站，KCC 自動建置暫時連線其他複寫協力電腦 （如果有的話） 以確保會發生複寫。 如果在站台中的所有網域控制站無法使用，KCC 便會自動建立網域控制站，從另一個站台之間的複寫連線。  
  
## <a name="BKMK_4"></a>子網路  
子網路是一組邏輯 IP 位址指派給 TCP/IP 網路區段。 子網路群組來識別其網路上的實體附近的電腦。 AD DS 中的子網路物件會識別用來將電腦對應到站台的網路位址。  
  
## <a name="BKMK_5"></a>站台  
站台是 Active Directory 物件，代表具有高度可靠且快速的網路連線的一或多個 TCP/IP 子網路。 站台資訊可讓系統管理員設定 Active Directory 存取權和複寫最佳化的實體網路的使用方式。 站台物件是一組子網路，與相關聯，而且樹系中的每個網域控制站的 Active Directory 站台，根據其 IP 位址與相關聯。 站台可以裝載來自多個網域，網域控制站和網域可以表示多個站台。  
  
## <a name="BKMK_6"></a>站台連結  
站台連結是 Active Directory 物件，代表修改 KCC 用來建立 Active Directory 複寫連線的邏輯路徑。 站台連結物件代表一組可以統一的成本，透過指定的站台間傳輸進行通訊的站台。  
  
站台連結中包含的所有站台會被視為連線透過相同的網路類型。 站台必須以手動方式連結至其他站台使用站台連結，以便在一個站台的網域控制站可以從另一個站台中的網域控制站複寫目錄變更。 因為站台連結未對應到由實體網路上的網路封包，在複寫期間的實際路徑，則您不需要建立備援的站台連結，以改善 Active Directory 複寫效率。  
  
當兩個站台連線的站台連結時，複寫系統會自動建立所呼叫的 bridgehead 伺服器中每個站台的特定網域控制站之間的連線。 在 Windows Server 2008 中，所有網域控制站的站台裝載相同的目錄磁碟分割都會被選取做為 bridgehead 伺服器。 KCC 所建立的複寫連線隨機分散到站台以共用複寫的工作負載中的所有候選 bridgehead 伺服器。 根據預設，隨機的選取處理程序發生一次，當連線物件第一次會新增至站台。  
  
## <a name="BKMK_7"></a>站台連結橋接器  
站台連結橋接器是 Active Directory 物件，代表一組的站台連結，其所有站台可以通訊使用一般的傳輸。 站台連結橋接器，讓不會直接連接透過與彼此進行複寫的通訊連結的網域控制站。 一般來說，站台連結橋接器對應至一個路由器 （或一組的路由器） IP 網路上。  
  
根據預設，KCC 可以形成的可轉移的路由，透過共通有某些站台的所有站台連結。 如果已停用此行為，每個站台連結代表其本身不同且隔離的網路。 可視為單一路由的站台連結的集合會透過站台連結橋接器來表示。 每個橋接器代表網路流量隔離的通訊環境。  
  
站台連結橋接器是一種機制來以邏輯方式表示站台之間可轉移的實體連線。 站台連結橋接器允許 KCC 使用包含的站台任何的連結組合來判斷最便宜的方法，來保留站台內的目錄分割的相互連接。 站台連結橋接器並不會提供實際連線到網域控制站。 如果移除站台連結橋接器，透過結合的站台連結的複寫會繼續直到 KCC 移除連結。  
  
站台連結橋接器才需要站台包含網域控制站裝載並沒有同時裝載在相鄰網站中，網域控制站的目錄磁碟分割，但裝載該目錄磁碟分割的網域控制站位於一或多個其他站台在樹系。 相鄰網站定義為包含在單一站台連結中任何兩個或多個站台。  
  
站台連結橋接器邏輯之間建立連接兩個站台連結，提供兩個已中斷連線的網站，使用過渡期的站台之間的可轉移的路徑。 站台間拓撲產生器 (ISTG) 目的，橋接器會表示實體連線，使用暫時網站。 橋接器並不表示暫時的站台的網域控制站會提供複寫路徑。 不過，這就是如果過渡期的站台包含網域控制站裝載複寫目錄磁碟分割，則會發生此情況，在此情況下的站台連結橋接器不需要。  
  
新增的每個站台連結成本，建立產生的路徑的加總的成本。 如果過渡期的站台不包含裝載目錄磁碟分割的網域控制站和較低的成本連結不存在，就會使用站台連結橋接器。 如果過渡期的站台包含網域控制站裝載目錄磁碟分割，兩個已中斷連線的站台會設定暫時的網域控制站的複寫連線，並使用橋接器。  
  
## <a name="BKMK_8"></a>站台連結轉移性  
根據預設所有站台連結是可轉移的或 「 橋接 」。 當站台連結橋接，且排程重疊時，KCC 建立判斷站台之間，站台透過站台連結沒有直接連接，但會以可轉移方式透過連線的網域控制站複寫協力電腦的複寫連線一般站台的集合。 這表示您可以透過組合的站台連結的任何其他站台連線的任何網站。  
  
一般情況下，對於完全路由的網路，您不需要建立任何站台連結橋接器，除非您想要控制複寫變更的流程。 如果您的網路未完全路由，應建立站台連結橋接器，以避免可能的複寫嘗試。 為特定傳輸的所有站台連結以隱含方式屬於該傳輸的單一站台連結橋接器。 預設橋接的站台連結會自動發生，而沒有 Active Directory 物件代表該橋接器。 **橋接所有站台連結**IP 和 Simple Mail Transfer Protocol (SMTP) 的站台間傳輸容器的屬性中找到的設定，可讓您實作自動站台連結橋接。  
  
> [!NOTE]  
> 在 AD ds; 的未來版本中，不支援 SMTP 複寫因此，不建議在 [SMTP] 容器中建立站台連結物件。  
  
## <a name="BKMK_9"></a>通用類別目錄伺服器  
通用類別目錄伺服器是網域控制站的樹系中，儲存所有物件的相關資訊，讓應用程式可以搜尋 AD DS，而不會參考儲存要求的資料的特定網域控制站。 所有的網域控制站，例如通用類別目錄伺服器會儲存架構與設定目錄分割的完整、 可寫入複本和網域目錄磁碟分割，它裝載網域的完整、 可寫入複本。 此外，通用類別目錄伺服器會儲存部分、 唯讀複本的每個其他的網域樹系中。 部分、 唯讀的網域的複本包含每個物件中的網域，但屬性 （這些最常用於搜尋之物件的屬性） 的子集。  
  
## <a name="BKMK_10"></a>萬用群組成員資格快取  
萬用群組成員資格快取，可讓網域控制站，以快取使用者的萬用群組成員資格資訊。 您可以啟用快取萬用群組成員資格所執行的 Windows Server 2008 利用 Active Directory 站台及服務嵌入式管理單元的網域控制站。  
  
啟用萬用群組成員資格快取，就不需要在網域中，網路頻寬使用量降到最低，因為網域控制站不需要複寫的所有物件樹系中的每一個站台的通用類別目錄伺服器。 因為驗證的網域控制站不一定需要存取以取得萬用群組成員資格資訊的通用類別目錄，它也會降低登入時間。 如需何時使用萬用群組成員資格快取的詳細資訊，請參閱[規劃通用類別目錄伺服器位置](../../../ad-ds/plan/Planning-Global-Catalog-Server-Placement.md)。  
  


