---
ms.assetid: 4cc9c16c-1928-4dce-a3a8-6229be28eb65
title: Active Directory 複寫概念
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: ccc1801ba325fec4d7273b503ccb799966122b99
ms.sourcegitcommit: 9a6a692a7b2a93f52bb9e2de549753e81d758d28
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/18/2019
ms.locfileid: "72591077"
---
# <a name="active-directory-replication-concepts"></a>Active Directory 複寫概念

>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

在設計網站拓撲之前，請先熟悉一些 Active Directory 複寫概念。  
  
-   [Connection 物件](#BKMK_1)  
  
-   [KCC](#BKMK_2)  
  
-   [容錯移轉功能](#BKMK_3)  
  
-   [對子](#BKMK_4)  
  
-   [點](#BKMK_5)  
  
-   [站台連結](#BKMK_6)  
  
-   [站台連結橋](#BKMK_7)  
  
-   [站台連結傳遞](#BKMK_8)  
  
-   [通用類別目錄伺服器](#BKMK_9)  
  
-   [萬用群組成員資格快取](#BKMK_10)  
  
## <a name="BKMK_1"></a>Connection 物件  
連線物件是一個 Active Directory 物件，代表從來源網域控制站到目的地網域控制站的複寫連接。 網域控制站是單一網站的成員，並在網站中以 Active Directory Domain Services （AD DS）中的伺服器物件表示。 每個伺服器物件都有一個子 NTDS 設定物件，代表網站中複寫的網域控制站。  
  
連線物件是目的地伺服器上 NTDS 設定物件的子系。 若要讓複寫在兩個網域控制站之間發生，其中一個伺服器物件必須擁有代表來自另一個之輸入複寫的 connection 物件。 網域控制站的所有複寫連接都會儲存為 NTDS 設定物件下的連線物件。 Connection 物件可識別複寫來源伺服器、包含複寫排程，並指定複寫傳輸。  
  
知識一致性檢查程式（KCC）會自動建立連線物件，但也可以手動建立。 KCC 所建立的連線物件會在 [Active Directory 網站和服務] 嵌入式管理單元中顯示為 **<automatically generated>** ，並在正常操作條件下被視為適當。 系統管理員所建立的連線物件會以手動方式建立連線物件。 手動建立的連線物件是由系統管理員在建立時指派的名稱所識別。 當您修改 **<automatically generated>** 連線物件時，會將它轉換成系統管理員修改的連線物件，並以 GUID 的形式顯示該物件。 KCC 不會對手動或修改的連線物件進行變更。  
  
## <a name="BKMK_2"></a>KCC  
KCC 是在所有網域控制站上執行的內建程式，會產生 Active Directory 樹系的複寫拓撲。 KCC 會根據複寫是否發生在網站（站上）或網站間（站上），來建立不同的複寫拓撲。 KCC 也會動態調整拓撲，以配合新增網域控制站的加入、移除現有的網域控制站、在網站間移動網域控制站、變更成本和排程，以及網域控制站暫時無法使用或處於錯誤狀態。  
  
在網站內，可寫入網域控制站之間的連線一律會以雙向環形排列，並以額外的快捷方式連線來減少大型網站中的延遲。 相反地，網站間拓撲是跨越樹狀結構的分層，這表示每個目錄分割的兩個網站之間存在一個站間連線，而且通常不會包含快捷方式連接。 如需跨越樹狀結構和 Active Directory 複寫拓撲的詳細資訊，請參閱 Active Directory 複寫拓撲技術參考（[ https://go.microsoft.com/fwlink/?LinkID=93578](https://go.microsoft.com/fwlink/?LinkID=93578)）。  
  
在每個網域控制站上，KCC 會建立一個單向的輸入連線物件來定義來自其他網域控制站的連線，藉以建立複寫路由。 對於相同網站中的網域控制站，KCC 會自動建立連線物件，而不需要系統管理介入。 當您有多個網站時，您可以設定網站之間的站台連結，而每個網站中的單一 KCC 也會自動在網站之間建立連線。  
  
### <a name="kcc-improvements-for-windows-server-2008-rodcs"></a>Windows Server 2008 Rodc 的 KCC 改良功能  

有一些 KCC 改良功能可容納 Windows Server 2008 中新推出的唯讀網域控制站（RODC）。 RODC 的典型部署案例是分公司。 此案例中最常部署的 Active Directory 複寫拓撲是以中樞和輪輻的設計為基礎，其中多個網站的分支網域控制站會使用中樞網站中的少數橋頭伺服器進行複寫。  
  
在此案例中部署 RODC 的其中一個優點是單向複寫。 不需要從 RODC 複寫橋頭伺服器，這樣可以減少系統管理和網路使用量。  
  
不過，舊版 Windows Server 作業系統上的中樞輪輻拓撲反白顯示的一個管理挑戰，是在中樞新增新的橋頭網域控制站之後，沒有自動機制可重新發佈分支網域控制站與中樞網域控制站之間的複寫連線，以利用新的中樞網域控制站。  
  
對於 Windows Server 2003 網域控制站，您可以從 Windows Server 2003 Branch Office 部署指南（[ https://go.microsoft.com/fwlink/?LinkID=28523](https://go.microsoft.com/fwlink/?LinkID=28523)）使用如 Adlb 的工具，重新平衡工作負載。  
  
對於 Windows Server 2008 Rodc，KCC 正常運作會提供一些重新平衡，因此不需要使用額外的工具，例如 Adlb。 預設會啟用新功能。 您可以藉由在 RODC 上新增下列登錄機碼來停用它：  
  
**HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters**  
  
**"Random BH Loadbalancing 允許"**  
**1 = 已啟用（預設值），0 = 已停用**  
  
如需有關這些 KCC 如何改善的詳細資訊，請參閱規劃和部署分公司的 Active Directory Domain Services （[ https://go.microsoft.com/fwlink/?LinkId=107114](https://go.microsoft.com/fwlink/?LinkId=107114)）。  
  
## <a name="BKMK_3"></a>容錯移轉功能  
網站可確保複寫會根據網路失敗和離線網域控制站來路由傳送。 KCC 會依照指定的間隔執行，以調整 AD DS 中發生之變更的複寫拓撲，例如新增新的網域控制站和建立新的網站時。 KCC 會檢查現有連接的複寫狀態，以判斷是否有任何連線無法運作。 如果連線因為網域控制站失敗而無法運作，則 KCC 會自動建立與其他複寫協力電腦的暫時連線（如果有的話），以確保會進行複寫。 如果網站中的所有網域控制站都無法使用，則 KCC 會自動從另一個網站的網域控制站之間建立複寫連線。  
  
## <a name="BKMK_4"></a>對子  
子網是指派一組邏輯 IP 位址的 TCP/IP 網路區段。 子網會以識別其在網路上實體鄰近性的方式來群組電腦。 AD DS 中的子網物件可識別用來將電腦對應至網站的網路位址。  
  
## <a name="BKMK_5"></a>點  
網站是 Active Directory 物件，代表一或多個具有高度可靠且快速網路連線的 TCP/IP 子網。 網站資訊可讓系統管理員設定 Active Directory 存取和複寫，以優化實體網路的使用。 網站物件會與一組子網相關聯，而且樹系中的每個網域控制站都會根據其 IP 位址與 Active Directory 網站相關聯。 網站可以裝載來自多個網域的網域控制站，而且網域可以在一個以上的網站中表示。  
  
## <a name="BKMK_6"></a>站台連結  
站台連結是 Active Directory 物件，代表 KCC 用來建立 Active Directory 複寫之連接的邏輯路徑。 站台連結物件代表一組可透過指定的網站間傳輸以統一成本進行通訊的網站。  
  
站台連結中包含的所有網站都會被視為透過相同的網路類型來連線。 網站必須使用站台連結手動連結至其他網站，讓一個網站中的網域控制站可以從另一個網站中的網域控制站複寫目錄變更。 由於站台連結不會對應到複寫期間實體網路上的網路封包所採用的實際路徑，因此您不需要建立重複的網站連結來改善 Active Directory 複寫效率。  
  
當兩個網站透過站台連結進行連線時，複寫系統會在每個名為「橋頭伺服器」的網站中，自動建立特定網域控制站之間的連接。 在 Windows Server 2008 中，裝載相同目錄磁碟分割的網站中的所有網域控制站，都是選取做為橋頭伺服器的候選項目。 KCC 所建立的複寫連接會隨機散發至網站中的所有候選橋頭伺服器，以共用複寫工作負載。 根據預設，只有當連線物件第一次新增至網站時，隨機選取程式才會發生一次。  
  
## <a name="BKMK_7"></a>站台連結橋  
站台連結橋接器是一種 Active Directory 物件，代表一組站台連結，其網站可使用一般傳輸進行通訊。 站台連結橋部透過通訊連結，讓未直接連線的網域控制站彼此複寫。 通常，站台連結橋接器會對應到 IP 網路上的路由器（或一組路由器）。  
  
根據預設，KCC 可以透過任何和所有網站連結（共通個網站）來形成可轉移路由。 如果停用此行為，則每個站台連結都代表它自己的相異和隔離網路。 可視為單一路由的站台連結集合會透過站台連結橋接器來表示。 每個橋接器代表網路流量的隔離通訊環境。  
  
站台連結橋接器是一種以邏輯方式表示網站間可轉移實體連線的機制。 站台連結橋接可讓 KCC 使用內含站台連結的任意組合，來判斷在這些網站中保存目錄分割的最低成本路由。 站台連結橋不會提供與網域控制站的實際連線能力。 如果移除站台連結橋，則透過合併的站台連結進行的複寫會繼續進行，直到 KCC 移除連結為止。  
  
只有在網站包含主控目錄分割的網域控制站，而該目錄磁碟分割並未同時裝載于相鄰網站中的網域控制站上，但主控該目錄磁碟分割的網域控制站位於的一或多個其他網站中時，才需要站台連結橋接器樹系。 連續的網站會定義為包含在單一站台連結中的任兩個或多個網站。  
  
站台連結橋會建立兩個站台連結之間的邏輯連線，使用暫時網站在兩個已中斷連線的網站之間提供可轉移的路徑。 基於網站間拓撲產生器（ISTG）的目的，橋接器隱含地使用暫時的網站來連接實體。 橋接器並不表示暫時網站中的網域控制站將提供複寫路徑。 不過，如果過渡網站包含裝載要複寫之目錄磁碟分割的網域控制站，就會發生這種情況，在此情況下不需要站台連結橋。  
  
新增每個站台連結的成本，為產生的路徑建立總和成本。 如果預備網站未包含裝載目錄分割的網域控制站，且成本較低的連結不存在，則會使用站台連結橋。 如果過渡網站包含主控目錄磁碟分割的網域控制站，兩個已中斷連線的網站會設定與過渡網域控制站的複寫連線，而不會使用橋接器。  
  
## <a name="BKMK_8"></a>站台連結傳遞  
根據預設，所有站台連結都是可轉移的，或「橋接」。 當站台連結已橋接且排程重迭時，KCC 會建立複寫連線，以決定網站間的網域控制站複寫協力電腦，其中的網站不會透過站台連結直接連線，而是透過一組通用網站。 這表示您可以透過網站連結的組合，將任何網站連線到任何其他網站。  
  
一般來說，對於完全路由的網路，除非您想要控制複寫變更的流程，否則不需要建立任何站台連結橋。 如果您的網路未完全路由，則應該建立站台連結橋，以避免不可能的複寫嘗試。 特定傳輸的所有站台連結，會隱含屬於該傳輸的單一站台連結橋。 站台連結的預設橋接會自動發生，而且不會有任何 Active Directory 物件代表該橋接器。 [**橋接所有站台連結**] 設定（位於 IP 和簡易郵件傳送通訊協定（SMTP）網站間傳輸容器的屬性中），會執行自動站台連結橋接。  
  
> [!NOTE]  
> 在未來的 AD DS 版本中，將不會支援 SMTP 複寫;因此，不建議在 SMTP 容器中建立站台連結物件。  
  
## <a name="BKMK_9"></a>通用類別目錄伺服器  
通用類別目錄伺服器是一個網域控制站，它會儲存樹系中所有物件的相關資訊，讓應用程式可以搜尋 AD DS，而不需要參考儲存所要求資料的特定網域控制站。 就像所有網域控制站一樣，通用類別目錄伺服器會儲存架構和設定目錄分割的完整、可寫入複本，以及它所裝載之網域的完整、可寫入複本。 此外，通用類別目錄伺服器會儲存樹系中每個其他網域的部分唯讀複本。 部分、唯讀的網域複本包含網域中的每個物件，但只有屬性的子集（最常用於搜尋物件的屬性）。  
  
## <a name="BKMK_10"></a>萬用群組成員資格快取  
萬用群組成員資格快取可讓網域控制站快取使用者的萬用群組成員資格資訊。 您可以使用 [Active Directory 網站和服務] 嵌入式管理單元，啟用執行 Windows Server 2008 的網域控制站來快取萬用群組成員資格。  
  
啟用萬用群組成員資格快取，不需要網域中每個網站上的通用類別目錄伺服器，因為網域控制站不需要複寫位於樹系中的所有物件，因此可將網路頻寬使用量降到最低。 它也會減少登入次數，因為驗證網域控制站不一定需要存取通用類別目錄來取得萬用群組成員資格資訊。 如需有關何時使用萬用群組成員資格快取的詳細資訊，請參閱[規劃通用類別目錄伺服器位置](../../../ad-ds/plan/Planning-Global-Catalog-Server-Placement.md)。  
  


