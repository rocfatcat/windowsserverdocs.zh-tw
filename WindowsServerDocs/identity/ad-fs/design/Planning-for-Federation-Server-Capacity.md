---
ms.assetid: 7013fc21-9ced-4f9d-9588-cb04d6d60924
title: 規劃同盟伺服器容量
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 5801196921c1f7632725dfddb2a5c8c2bf4ae2b5
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/08/2020
ms.locfileid: "80858621"
---
# <a name="planning-for-federation-server-capacity"></a>規劃同盟伺服器容量

同盟伺服器的容量規劃可協助您評估：  
  
-   哪些因素會增加 AD FS 設定資料庫的大小。  
  
-   每部同盟伺服器的適當硬體需求。  
  
-   要在每個組織中放置的同盟伺服器數目。  
  
同盟伺服器會將安全性權杖發行給使用者。 這些權杖會提供給信賴憑證者使用。 同盟伺服器會在驗證使用者之後，或在收到先前由夥伴同盟服務所發行的安全性權杖之後，發出安全性權杖。 當使用者一開始登入同盟應用程式時，或當他們的安全性權杖在存取同盟應用程式時過期時，會向同盟服務要求安全性權杖。  
  
同盟伺服器的設計目的是為了配合使用 Microsoft 網路負載平衡 \(NLB\) 技術的高\-可用性伺服器陣列設定。 伺服器陣列設定中的同盟伺服器可以獨立服務要求，而不需要存取每個要求的任何一般伺服器陣列元件。 因此，向外延展同盟伺服器部署時，不會產生額外的負擔。  
  
**相關**  
  
-   針對重要或高\-可用性部署的任務\-，建議您在每個夥伴組織中建立一個小型同盟伺服器陣列，每個伺服器陣列至少要有兩部同盟伺服器，才能提供容錯功能。  
  
-   隨著高可用性和相應放大同盟伺服器的需求，相應放大是針對特定同盟服務處理每秒要求數高的建議方法。 除了本指南的基本設定外，擴充不太可能會產生大量的容量處理增益。  
  
## <a name="ad-fs-configuration-database-size-and-growth"></a>AD FS 設定資料庫大小和成長  
AD FS 設定資料庫的大小通常會被視為很小，而且資料庫大小不一定是 AD FS 部署的主要考慮。  AD FS 設定資料庫的確切大小，主要取決於信任關係的數目，以及相關聯的信任\-相關的中繼資料，例如宣告、宣告規則，以及為每個信任所設定的監視設定。 當設定資料庫中的信任專案數目增加時，就需要更多的磁碟空間。  
  
如需 AD FS 設定資料庫的其他部署資訊，請參閱[AD FS 部署拓撲考慮](AD-FS-Deployment-Topology-Considerations.md)。  
  
## <a name="memory-cpu-and-disk-space-requirements"></a>記憶體、CPU 和磁碟空間需求  
幸運的是，同盟伺服器的記憶體、CPU 和磁碟空間需求很低，而且不可能是硬體決策的驅動因素。 如需硬體需求的詳細資訊，請參閱[附錄 A：檢查 AD FS 需求](Appendix-A--Reviewing-AD-FS-Requirements.md)。  
  
> [!NOTE]  
> 在 AD FS 產品小組所執行的測試中，使用以專用 SQL Server 設定的同盟伺服器陣列來儲存 AD FS 設定資料庫時，SQL Server 比起的整體負載會較低。 在使用四個\-同盟\-伺服器陣列（已設定為使用單一 SQL Server）的一項測試中，即使測試將同盟伺服器設為目標使用率，CPU 使用率也不會超過10%。  
  
## <a name="estimate-the-number-of-federation-servers-for-your-organization"></a><a name="bk_estimatefs"></a>估計貴組織的同盟伺服器數目  
為了簡化同盟伺服器的硬體規劃程式，AD FS 產品小組開發了 AD FS 容量規劃調整大小的試算表。 此 Excel 試算表包含計算機\-的功能，例如，將會採用您提供給您組織中使用者的預期使用方式資料，並為您的 AD FS 生產環境傳回建議的最佳同盟伺服器數目。  
  
> [!NOTE]  
> 這份試算表建議的同盟伺服器數目，是根據 AD FS 產品小組在測試期間所使用的硬體和網路規格而定。 因此，您必須在此內容中瞭解試算表所建議的同盟伺服器數目。  如需測試期間所使用之規格的詳細資訊，請參閱標題[為 AD FS 伺服器容量規劃](Planning-for-AD-FS-Server-Capacity.md)主題。  
  
### <a name="using-the-ad-fs-capacity-planning-sizing-spreadsheet"></a>使用 AD FS 容量規劃調整大小試算表  
當您使用此試算表時，您必須選取一個值，\(**40%** 、 **60%** 或**80%** \)，其最能代表您預期會在尖峰使用期間，將驗證要求傳送至同盟伺服器的總使用者百分比。  
  
然後，您必須選取一個值 \(**1 分鐘**、 **15 分鐘**或**1 小時**的\)，其最能代表您預期尖峰使用週期到最後的時間長度。 例如，您可以將40% 評估為在15分鐘內登入的使用者總數值，或60% 的使用者將在1小時內登入。 這些值一起定義會計算大小調整建議的尖峰負載設定檔。  
  
接下來，您必須根據使用者是否為，指定需要單一登入\-存取目標宣告\-感知應用程式的使用者總數：  
  
-   透過 Windows 整合式驗證，從實際連線到公司網路 \(的本機電腦登入 Active Directory\)  
  
-   透過 Windows 整合式驗證或使用者名稱和密碼，從未實際連線到公司網路的電腦進行遠端登入 Active Directory \(\)  
  
-   來自另一個組織並嘗試從信任的夥伴存取目標宣告\-感知應用程式  
  
-   從 SAML 2.0 識別提供者，並嘗試存取目標宣告\-感知應用程式  
  
#### <a name="how-to-use-this-spreadsheet"></a>如何使用此試算表  
您可以針對您打算部署的每個同盟伺服器陣列實例使用下列步驟，以判斷建議的同盟伺服器數目。  
  
1.  下載並開啟[適用于 Windows server 2012 R2 的 AD FS 容量規劃調整大小試算表](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacityPlanning.xlsx)，或[適用于 windows server 2016 的 AD FS 容量規劃調整大小試算表](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)。
  
2.  在**尖峰系統使用期間的右側儲存格中，我預期 [我的使用者驗證**] 資料格的百分比，按一下資料格，然後使用下拉\-向下箭號來選取您的預估系統使用率層級，也就是**40%** 、 **60%** 或**80%** 的部署。  
  
3.  在**下列時間範圍內**的右下方儲存格中，按一下資料格，然後使用下拉\-向下箭號來選取**1 分鐘**、 **15 分鐘**或**1 小時**，以選取尖峰負載的持續時間。  
  
4.  在 [**輸入估計的內部應用程式數目] \(例如 SharePoint \(2007 或 2010\) 或宣告感知 web 應用程式\)** 資料格右邊的儲存格中，輸入您將在組織中使用的內部應用程式數目。  
  
5.  在 [**輸入預估數目的線上應用程式 \(例如 Office 365 Exchange online、SharePoint online 或 Lync online\)** ] 資料格右邊的儲存格中，輸入您將在組織中使用的線上應用程式或服務數目。  
  
6.  在標題為 [**使用者數目**] 的資料格底下，于套用至範例應用程式案例的每個資料列上輸入一個數位，您的使用者將需要單一登入\-存取權。 此資料行應該包含已定義的使用者數目，而不是每秒的尖峰使用者數。 如果對應用程式的存取嘗試必須先經過主領域探索頁面，請輸入**Y**。如果您不確定此選項，請輸入**Y**。  
  
7.  請檢查下列建議的值：  
  
    1.  如需建議的同盟伺服器總數，請參閱以灰色反白顯示的右下方資料格。  
  
    2.  針對每個範例應用程式案例建議的伺服器數目，請參閱以灰色反白顯示之資料列上的儲存格。  
  
> [!NOTE]  
> 將會在標題為 [**建議的同盟伺服器總數**] 資料格右邊的儲存格中自動計算的值，其中包含的公式會將額外的20% 緩衝區新增至其前面每個個別資料列中所有值的總和總計。 新增到**同盟伺服器總數**的公式建議將此緩衝區中的資料格建立到您部署的同盟伺服器總數，讓伺服器陣列的整體負載不太可能達到其飽和點。  
  
## <a name="see-also"></a>另請參閱
[Windows Server 2012 中的 AD FS 設計指南](AD-FS-Design-Guide-in-Windows-Server-2012.md)
