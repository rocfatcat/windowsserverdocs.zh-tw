---
ms.assetid: 98c5ef45-2bcb-4f87-86c8-5ac6c16a6097
title: 權杖簽署憑證
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 02c126fe0792872298a5512abf850af41e1db826
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/27/2019
ms.locfileid: "71407918"
---
# <a name="token-signing-certificates"></a>權杖簽署憑證

同盟伺服器需要權杖\-簽署憑證，以防止攻擊者在嘗試取得同盟資源的未經授權存取時，改變或偽造安全性權杖。 與權杖\/ \-簽署憑證搭配使用的私用公開金鑰配對是任何同盟合作關係最重要的驗證機制，因為這些金鑰會驗證安全性權杖是由有效的夥伴所發行。同盟伺服器，而且權杖不會在傳輸期間修改。  
  
## <a name="token-signing-certificate-requirements"></a>權杖\-簽署憑證需求  
權杖\-簽署憑證必須符合下列需求，才能與 AD FS 搭配使用：  
  
-   若要讓\-權杖簽署憑證成功簽署安全性權杖，權杖\-簽署憑證必須包含私密金鑰。  
  
-   AD FS 服務帳戶必須能夠存取本機電腦之個人\-存放區中的權杖簽署憑證的私密金鑰。 安裝程式會負責此動作。 如果您後續變更權杖\- \-簽署憑證，您也可以使用 AD FS 管理嵌入式管理單元來確保此存取權。  
  
> [!NOTE]  
> 這是公開金鑰基礎結構\(PKI\)最佳做法，不會針對多個目的共用私密金鑰。 因此，請勿使用您在同盟伺服器上安裝的服務通訊憑證作為權杖\-簽署憑證。  
  
## <a name="how-token-signing-certificates-are-used-across-partners"></a>如何跨\-合作夥伴使用權杖簽署憑證  
每個\-權杖簽署憑證都包含密碼編譯私密金鑰和公開金鑰，這些金鑰是用\(來以私密金鑰\)做為安全性權杖，以數位方式簽署。 之後，當夥伴同盟伺服器收到這些金鑰之後，這些金鑰就會透過加密\(安全性權杖的\)公開金鑰來驗證其真實性。  
  
由於每個安全性權杖都是由帳戶夥伴進行數位簽署，因此資源夥伴可以確認安全性權杖確實是由帳戶夥伴發出，而且尚未修改。 數位簽章會由合作夥伴權杖\-簽署憑證的公開金鑰部分來驗證。 簽章經過驗證之後，資源同盟伺服器會為其組織產生自己的安全性權杖，並使用自己的權杖\-簽署憑證來簽署安全性權杖。  
  
針對同盟夥伴環境，當 CA 發出\-權杖簽署憑證時，請確定：  
  
1.  憑證撤銷會列出\(憑證\)的 crl 可以讓信賴憑證者和信任同盟伺服器的 Web 服務器存取。  
  
2.  信賴憑證者和信任同盟伺服器的 Web 服務器會根信任 CA 憑證。  
  
資源夥伴中的 Web 服務器會使用權杖\-簽署憑證的公開金鑰來驗證安全性權杖是否由資源同盟伺服器簽署。 Web 服務器接著允許適當的用戶端存取。  
  
## <a name="deployment-considerations-for-token-signing-certificates"></a>權杖\-簽署憑證的部署考慮  
當您在新的 AD FS 安裝中部署第一部同盟伺服器時，您必須\-取得權杖簽署憑證，並將它安裝在該同盟伺服器上的本機電腦個人憑證存儲中。 您可以從企業 CA\-或公用 ca 要求憑證，或建立自我\-簽署憑證，以取得權杖簽署憑證。  
  
當您部署 AD FS 伺服器陣列時，\-權杖簽署憑證會以不同的方式安裝，視您建立伺服器陣列的方式而定。  
  
當您取得部署的權杖\-簽署憑證時，可以考慮兩個伺服器陣列選項：  
  
-   一個權杖\-簽署憑證的私密金鑰會在伺服器陣列中的所有同盟伺服器之間共用。  
  
    在同盟伺服器陣列環境中，我們建議所有的同盟伺服器共用\(或重複\)使用相同的\-權杖簽署憑證。 您可以從同盟伺服器上\-的 CA 安裝單一權杖簽署憑證，然後匯出私密金鑰，前提是已發行的憑證已標示為可匯出。  
  
    如下圖所示，單一權杖\-簽署憑證的私密金鑰可與伺服器陣列中的所有同盟伺服器共用。 相較于下列「唯一的權杖\-簽署憑證」選項，此選項會降低成本（如果您打算從公用 CA 取得權杖\-簽署憑證）。  
  
![權杖簽署](media/adfs2_fedserver_certstory_3.gif)  
  
-   伺服器陣列中的每部\-同盟伺服器都有唯一的權杖簽署憑證。  
  
    當您在整個伺服器陣列中使用多個唯一的憑證時，該伺服器陣列中的每部伺服器都會使用自己唯一的私密金鑰來簽署權杖。  
  
    如下圖所示，您可以為伺服器陣列中的每\-一部同盟伺服器，取得個別的權杖簽署憑證。 如果您想要從公用 CA 取得權杖\-簽署憑證，此選項會更耗費資源。  
  
![權杖簽署](media/adfs2_fedserver_certstory_4.gif)  
  
如需當您使用 Microsoft 憑證服務作為企業 CA 時安裝憑證的相關資訊， [請參閱 IIS 7.0：在 IIS 7.0](https://go.microsoft.com/fwlink/?LinkId=108548)中建立網域伺服器憑證。  
  
如需有關從公用 CA 安裝憑證的詳細資訊，請參閱[要求網際網路伺服器憑證 (IIS 7)](https://go.microsoft.com/fwlink/?LinkId=108549)。  
  
如需有關安裝自我\-簽署憑證的詳細資訊，請參閱[IIS 7.0：在 IIS 7.0\- ](https://go.microsoft.com/fwlink/?LinkID=108271)中建立自我簽署的伺服器憑證。  
  
## <a name="see-also"></a>另請參閱
[Windows Server 2012 中的 AD FS 設計指南](AD-FS-Design-Guide-in-Windows-Server-2012.md)
