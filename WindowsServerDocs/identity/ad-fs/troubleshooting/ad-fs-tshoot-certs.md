---
title: AD FS 疑難排解-憑證
description: 本檔說明一般的憑證問題。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: cee87ce864e333b98e92fa64e939f2ead7edc156
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/10/2019
ms.locfileid: "70869194"
---
# <a name="ad-fs-troubleshooting---certificates"></a>AD FS 疑難排解-憑證
AD FS 需要下列憑證才能正常運作。  如果其中有任何一項未正確設定或設定，則可能會發生問題。  

## <a name="required-certificates"></a>必要的憑證
AD FS 需要下列憑證：



- **同盟信任**–這需要連結到互相信任的網際網路根憑證授權單位（CA）的憑證同時存在於宣告提供者和信賴憑證者同盟伺服器的根信任存放區中，也就是跨憑證的設計已實現，其中每個端已與其合作夥伴交換其根 CA，或已在適當的每一端匯入的自我簽署憑證。
- **權杖簽署**–每部同盟服務電腦都需要權杖簽署憑證。  宣告提供者權杖簽署憑證必須受到信賴憑證者同盟伺服器的信任。 從 RP 同盟伺服器接收權杖的所有應用程式，都必須信任信賴憑證者權杖簽署憑證。
- **安全通訊端層（SSL）** –同盟服務的 SSL 憑證必須存在於同盟伺服器 proxy 電腦上的受信任存放區中，且具備信任的憑證授權單位單位（CA）存放區的有效鏈。
- **憑證撤銷清單（CRL）** –針對已發佈 crl 的任何憑證，必須可存取所有需要存取憑證的用戶端和伺服器的 crl。

如果上述任何一項未正確設定，AD FS 將無法運作。

## <a name="common-things-to-check-with-certificates"></a>檢查憑證的一般事項
以下是可能發生，而且應該在嘗試解決憑證問題時進行驗證的專案清單。

- 請確定憑證是受信任的
    - SSL 憑證必須由用戶端信任
    - 權杖簽署憑證必須受信賴憑證者信任
- 檢查信任鏈-鏈中的每個憑證都必須是有效的。
- 確認憑證到期日
- 檢查憑證撤銷清單（CRL）協助工具
    - 請確定 [CDP] 欄位已填入
    - 手動流覽至 CDP
- 請確定尚未撤銷憑證

## <a name="common-certificate-errors"></a>一般憑證錯誤
下表列出常見的錯誤和可能的原因。

|Event - 事件|原因|解析度
|-----|-----|-----|
|事件 249-在憑證存放區中找不到憑證。 在憑證變換案例中，這可能會在同盟服務使用此憑證簽署或解密時造成失敗。|有問題的憑證不在本機憑證存放區中，或服務帳戶沒有憑證私密金鑰的許可權。|確定憑證已安裝在 AD FS 伺服器上的 LocalMAchine\My 存放區中。 請確定 AD FS 服務帳戶具有憑證私密金鑰的讀取權限。|
|事件 315-嘗試建立宣告提供者信任簽署憑證的憑證鏈時發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈。</br></br>憑證已過期或尚未生效。|請確認憑證有效，而且尚未被撤銷。</br></br>請確定 CRL 可供存取。|
|事件 316-嘗試為信賴憑證者信任簽署憑證建立憑證鏈時，發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈。</br></br>憑證已過期或尚未生效。|請確認憑證有效，而且尚未被撤銷。</br></br>請確定 CRL 可供存取。|
|事件 317-嘗試為信賴憑證者信任加密憑證建立憑證鏈時，發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈。</br></br>憑證已過期或尚未生效。|請確認憑證有效，而且尚未被撤銷。</br></br>請確定 CRL 可供存取。|
|事件 319-正在建立用戶端憑證的憑證鏈時發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈。</br></br>憑證已過期或尚未生效。|請確認憑證有效，而且尚未被撤銷。</br></br>請確定 CRL 可供存取。|
|事件 360-已對憑證傳輸端點提出要求，但要求未包含用戶端憑證。|發行用戶端憑證的根 CA 不受信任。</br></br>用戶端憑證已過期。</br></br>用戶端憑證為自我簽署且不受信任。|請確定發出用戶端憑證的根 CA 存在於受信任的根存放區中。</br></br>請確定用戶端憑證未過期。</br></br>如果用戶端憑證是自我簽署的，請確定已將其新增至受信任的憑證清單，或以受信任的憑證取代自我簽署的憑證。|
|事件 374-建立宣告提供者信任加密憑證的憑證鏈時發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈。</br></br>憑證已過期或尚未生效。|請確認憑證有效，而且尚未被撤銷。</br></br>請確定 CRL 可供存取。|
|事件 381-嘗試建立設定憑證的憑證鏈時發生錯誤。|設定在 AD FS 伺服器上使用的其中一個憑證已過期或已被撤銷。|確定所有已設定的憑證都尚未撤銷，而且尚未過期。|
|事件 385-AD FS 偵測到 AD FS 設定資料庫中的一或多個憑證必須以手動方式更新。|設定在 AD FS 伺服器上使用的其中一個憑證已過期或即將到期日。|以取代更新過期或即將過期的憑證。 （如果您使用自我簽署憑證，且已啟用自動憑證變換，則可能會忽略此錯誤，因為它會自行解決）。|
|事件 387-AD FS 偵測到同盟服務中指定的一或多個憑證無法供 AD FS Windows 服務所使用的服務帳戶存取。|AD FS 服務帳戶對一個或多個已設定憑證的私密金鑰沒有讀取權限。|確定 AD FS 服務帳戶具有所有已設定憑證之私密金鑰的讀取權限。|
|事件 389-AD FS 偵測到您的一或多個信任需要手動更新其憑證，因為它們已過期，或即將到期。|您設定的夥伴憑證之一已過期，或即將到期。 這可適用于宣告提供者信任或信賴憑證者信任。|如果您已手動建立此信任，請手動更新憑證設定。 如果您使用同盟中繼資料來建立信任，當夥伴更新憑證時，憑證就會自動更新。|




## <a name="next-steps"></a>後續步驟

- [AD FS 疑難排解](ad-fs-tshoot-overview.md)
 