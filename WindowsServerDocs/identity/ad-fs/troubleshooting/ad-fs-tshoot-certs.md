---
title: AD FS 疑難排解-憑證
description: 本文件說明典型的憑證問題。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 42fdce936bb4a6f25b456c4a96c7b99f650e6033
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59860579"
---
# <a name="ad-fs-troubleshooting---certificates"></a>AD FS 疑難排解-憑證
AD FS 需要下列憑證，才能正確運作。  如果其中任何尚未安裝或正確設定可能會發生問題。  

## <a name="required-certificates"></a>所需的憑證
AD FS 需要下列憑證：



- **同盟信任**– 這需要的憑證鏈結到相互信任的網際網路根憑證授權單位 (CA) 會出現在宣告提供者和信賴憑證者同盟伺服器的受信任的根存放區已實作交互憑證設計，每一端具有其夥伴，與交換根 CA 或自我簽署憑證已匯入每一端在適當的地方。
- **權杖簽署**– 每個同盟服務的電腦需要的權杖簽署憑證。  信賴憑證者的合作對象的同盟伺服器必須信任的宣告提供者權杖簽署憑證。 從 RP 同盟伺服器接收權杖的所有應用程式必須信任信賴憑證者的合作對象權杖簽署憑證。
- **安全通訊端層 (SSL)** – Federation Service 的 SSL 憑證必須存在於同盟伺服器 proxy 電腦上的受信任存放區，並對受信任的憑證授權單位 (CA) 存放區中的有效鏈結。
- **憑證撤銷清單 (CRL)** – 適用於任何憑證具有 CRL 發行，CRL 必須可供存取所有的用戶端和伺服器需要存取憑證。

如果上述任一未正確設定，AD FS 將無法運作。

## <a name="common-things-to-check-with-certificates"></a>若要檢查憑證的常見項目
以下是可能發生和嘗試解決憑證問題時，必須經過驗證的項目清單。

- 請確定憑證受到信任
    - SSL 憑證需要用戶端會信任
    - 權杖簽署憑證必須受到信任的信賴憑證者的合作對象
- 檢查信任鏈結-每個憑證鏈結必須為有效。
- 確認憑證到期日
- 檢查憑證撤銷清單 (CRL) 的協助工具
    - 請確定 [CDP] 欄位會填入
    - 以手動方式瀏覽至 CDP
- 請確定憑證尚未被撤銷

## <a name="common-certificate-errors"></a>常見的憑證錯誤
下表是一份常見錯誤和可能的原因。

|Event - 事件|原因|解析度
|-----|-----|-----|
|事件 249-憑證存放區中找不到憑證。 在憑證變換情況下，這可能導致失敗時 Federation Service 會簽署或解密使用此憑證。|在本機憑證存放區中，沒有憑證有問題或服務帳戶並沒有憑證的私密金鑰的權限。|請確認憑證已安裝在 LocalMAchine\My 存放區，在 AD FS 伺服器上。 請確定 AD FS 服務帳戶具有憑證的私密金鑰的讀取權限。|
|事件 315-嘗試建置簽署憑證的宣告提供者信任的憑證鏈結時，發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈結。</br></br>憑證已過期或尚未生效。|請確定憑證有效，且尚未被撤銷。</br></br>請確定 CRL 可存取。|
|事件 316-嘗試建置的信賴憑證者信任簽章憑證的憑證鏈結時，發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈結。</br></br>憑證已過期或尚未生效。|請確定憑證有效，且尚未被撤銷。</br></br>請確定 CRL 可存取。|
|事件 317-嘗試建置信賴憑證者的合作對象信任加密憑證的憑證鏈結時，發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈結。</br></br>憑證已過期或尚未生效。|請確定憑證有效，且尚未被撤銷。</br></br>請確定 CRL 可存取。|
|正在建置的用戶端憑證的憑證鏈結時，就會發生事件 319-發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈結。</br></br>憑證已過期或尚未生效。|請確定憑證有效，且尚未被撤銷。</br></br>請確定 CRL 可存取。|
|事件 360-要求的憑證傳輸端點，但要求不包含用戶端憑證。|不受信任的根 CA 發出的用戶端憑證。</br></br>用戶端憑證已過期。</br></br>用戶端憑證自我簽署，而且不受信任。|請確定根 CA 所發出的用戶端憑證的受信任的根存放區中。</br></br>請確定用戶端憑證未過期。</br></br>如果用戶端憑證是自我簽署，確保，到受信任的憑證，清單將它加入或取代受信任的憑證為自我簽署的憑證。|
|事件 374-為宣告提供者信任的加密憑證建置憑證鏈結時，發生錯誤。|憑證已被撤銷。</br></br>無法驗證憑證鏈結。</br></br>憑證已過期或尚未生效。|請確定憑證有效，且尚未被撤銷。</br></br>請確定 CRL 可存取。|
|事件 381-嘗試建置設定憑證的憑證鏈結時，發生錯誤。|其中一個設定為使用 AD FS 伺服器上的憑證已過期或已被撤銷。|請確定所有設定的憑證尚未被撤銷，且尚未過期。|
|事件 385-偵測到 AD FS，AD FS 組態資料庫中的一個或多個憑證，必須手動更新。|其中一個設定為使用 AD FS 伺服器上的憑證已過期或即將到期日。|使用替代項目來更新已過期或即將-至-過期的憑證。 （如果您使用自我簽署的憑證，並啟用自動憑證變換，忽略此錯誤可能是因為它會自行解決問題。）|
|事件 387-偵測到 AD FS，一或多個指定 Federation Service 中的憑證不是 AD FS Windows 服務所使用的服務帳戶可存取。|AD FS 服務帳戶並沒有一或多個已設定憑證的讀取權限的私用金鑰。|確認 AD FS 服務帳戶有讀取權限設定的所有憑證的私密金鑰。|
|事件 389-偵測到 AD FS，一或多個您信任的要求已過期或即將到期，因此手動更新其憑證。|其中一個設定的夥伴的憑證已過期或即將到期。 這可以套用至宣告提供者信任或信賴憑證者信任。|如果您手動建立此信任，請手動更新憑證設定。 如果您使用同盟中繼資料來建立信任時，憑證會在為協力廠商更新的憑證自動更新。|




## <a name="next-steps"></a>後續步驟

- [疑難排解 AD FS](ad-fs-tshoot-overview.md)
 