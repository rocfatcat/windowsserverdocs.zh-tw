---
title: "宣告規則語言的角色"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 07/07/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: dda9d148-d72f-4bff-aa2a-f2249fa47e4c
ms.technology: identity-adfs
ms.openlocfilehash: 206da33d33cbded0450db29615dc74eb1161cbce
ms.sourcegitcommit: 84a2bdcb92ba6af45781fab9727617e50fa5e911
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/07/2017
---
>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="the-role-of-the-claim-rule-language"></a>宣告規則語言的角色
Active Directory 同盟 Services (AD FS) 取得規則語言作為行為傳入的和傳出宣告的系統建置組塊時宣告引擎做為邏輯操作，以定義自訂規則理賠要求規則語言處理引擎。 如需詳細資訊，了解如何處理所有規則宣告引擎、查看[的角色宣告引擎的](The-Role-of-the-Claims-Engine.md)。  
  
## <a name="creating-custom-claim-rules-using-the-claim-rule-language"></a>建立自訂宣告規則使用語言理賠要求規則  
AD FS 提供系統管理員的選項，來定義自訂規則，他們可以用來判斷身分宣告理賠要求規則語言的行為。 您可以使用此主題中的理賠要求規則語言語法範例建立自訂規則列舉、新增、刪除，以及修改宣告貴組織的需求。 您可以將自訂規則建置理賠要求規則語言語法中輸入**傳送主張使用自訂取得**規則範本。  
  
規則會以分號彼此。  
  
如需有關使用規則自訂的時機，請查看[使用自訂理賠要求規則](When-to-Use-a-Custom-Claim-Rule.md)。  
  
## <a name="using-claim-rule-templates-to-learn-about-the-claim-rule-language-syntax"></a>若要深入了解理賠要求規則語言語法使用理賠要求規則範本  
AD FS 也提供一組預先定義的理賠要求發行和承認，您可以使用來執行一般規則範本取得規則理賠要求。 在**編輯取得規則**對話方塊中指定信任，您可以建立預先定義的規則-和檢視組成該規則理賠要求規則語言語法-，即可**檢視規則語言**該規則的索引標籤。 在本區段中使用的資訊和**檢視規則語言**技術可以提供深入了解如何建立您自己的自訂規則。  
  
如需詳細資訊理賠要求規則和理賠要求規則範本，請查看[的角色的取得規則](The-Role-of-Claim-Rules.md)。  
  
## <a name="understanding-the-components-of-the-claim-rule-language"></a>了解理賠要求規則語言的元件  
宣告規則語言包含下列元件，以「= > [電信業者：  
  
-   條件  
  
-   發行隱私權聲明  
  
### <a name="conditions"></a>條件  
您可以使用規則中條件，請輸入的宣告並判斷是否應該會執行規則的發行聲明。 條件代表必須評估邏輯運算式為 true，以執行規則主體部分。 如果這是遺失，假設邏輯 true;是的一定會執行規則的問候語。 條件組件包含條件結合一起搭配使用的邏輯電信業者的清單 (」與與」)。 必須評估清單中所有的條件為 true 評估整個條件部分為 true。 這個條件可以是宣告選擇電信業者或彙總函式通話。 這兩互相專屬，這表示，取得器，無法在單一規則條件部分結合彙總的功能。  
  
條件為選擇性規則。 例如，下列規則不需要的條件：  
  
```  
=> issue(type = "http://test/role", value = "employee");  
```  
  
有三種類型的條件：  
  
-   單一條件 — 這是最簡單的條件。 檢查有針對只有一個運算式;例如，windows 考慮名稱 = 使用者網域。  
  
-   多個條件，這個條件需要其他檢查處理多個運算式本文規則。例如，windows 考慮名稱 = 網域使用者和群組 = contosopurchasers。  
  
> [!NOTE]  
> 另一個條件存在，但它子集單一條件或多個條件。 這就是運算式 (Regex) 條件。 它用來輸入的運算式並符合運算式與指定的模式。 可以使用的方式是一個範例如下所示。  
  
下列範例顯示一些語法建構，為基礎的條件類型，您可以使用建立自訂規則。  
  
#### <a name="single--condition-examples"></a>單一-條件範例  
單一-運算式條件的如下表所示。 只需主張指定的宣告類型或指定的宣告類型的理賠要求檢查並取得值建構。  
  
|條件描述|條件語法範例|  
|-------------------------|----------------------------|  
|此規則具有檢查指定的宣告類型 (」http://test/name「) 的輸入宣告條件。 如果相符理賠要求輸入宣告中，規則複製的符合宣告或輸出宣告組宣告。|``` c: [type == "http://test/name"] => issue(claim = c );```|  
|此規則已條件檢查輸入宣告指定的宣告類型 (」http://test/name」)，以及取得值 (」Terry」)。 如果相符理賠要求輸入宣告中，規則複製的符合宣告或輸出宣告組宣告。|``` c: [type == "http://test/name", value == "Terry"] => issue(claim = c);```|  
  
更多的下一節，包括條件，用來檢查有多個宣告、條件檢查理賠要求的發行者和條件檢查的值符合運算式模式中顯示複雜的條件。  
  
#### <a name="multiple--condition-examples"></a>多個-條件範例  
下表中提供的範例的多個-運算式條件。  
  
|條件描述|條件語法範例|  
|-------------------------|----------------------------|  
|此規則具有來檢查有兩個輸入宣告、條件每一個都有指定的宣告類型（」http://test/name」和「http://test/email」）。 如果有兩個符合宣告輸入宣告，規則複製輸出宣告組名稱理賠要求。|``` c1: [type  == "http://test/name"] && c2: [type == "http://test/email"] => issue (claim  = c1 );```|  
  
#### <a name="regular--condition-examples"></a>一般-條件範例  
下表會提供一般，運算式的範例-型條件。  
  
|條件描述|條件語法範例|  
|-------------------------|----------------------------|  
|此規則具有條件，使用 e 檢查運算式-結尾的電子郵件宣告並」@fabrikam.com「。 如果輸入宣告中找到符合理賠要求，規則複製輸出宣告組符合理賠要求。|```c: [type  == "http://test/email", value  =~ "^. +@fabrikam.com$" ] => issue (claim  = c );```|  
  
### <a name="issuance-statements"></a>發行的聲明  
根據發行陳述處理自訂規則 (*問題*或*新增*) 您計畫理賠要求規則。 想要的結果，問題聲明而定，或新增聲明可寫入填入輸入的宣告組規則或輸出宣告設定。 使用新增聲明明確自訂規則會填入理賠要求時使用的問題聲明自訂宣告規則會填入宣告值這兩個輸入宣告設定和輸出中取得設定，值輸入，才能取得設定。 宣告值適用於只要未來規則理賠要求規則集中時，這非常有用。  
  
例如，圖，連入宣告被新增到輸入宣告設定宣告發行引擎。 當的第一個自訂宣告規則執行並滿意網域使用者的準則，宣告發行引擎處理規則使用新增聲明，並值的邏輯**編輯器]**輸入的宣告設定中新增了。 編輯器的值為輸入理賠要求將在因為規則 2 的成功處理問題隱私權聲明中的邏輯和產生為新的**Hello**的中新增了這兩個輸出取得設定與設定的使用規則中的下一步規則輸入宣告設定。 規則 3 現在可以使用所有在於輸入宣告設定為處理其邏輯輸入值。  
  
![AD FS 角色](media/adfs2_customrule.gif)  
  
#### <a name="claim-issuance-actions"></a>宣告發行動作  
規則主體表示宣告發行動作。 有兩種語言辨識理賠要求發行動作：  
  
-   **發行隱私權聲明：**問題聲明建立移至輸入及輸出取得集理賠要求。 例如，下列聲明問題新理賠要求根據其輸入的宣告設定：  
  
    ```c:[type == "Name"] => issue(type = "Greeting", value = "Hello " + c.value);```  
  
-   **新增隱私權聲明：**新增聲明建立新的只加入輸入的宣告設定集合理賠要求。 例如，下列隱私權聲明加入新理賠要求輸入的宣告集：  
  
    ```c:[type == "Name", value == "domain user"] => add(type = "Role", value = "Editor");``` 
  
發行聲明的規則定義宣告將會發出規則時符合的條件。 有兩種發行聲明引數和聲明行為相關形式：  
  
-   **一般**-一般發行聲明可發行主張使用規則對應值或來自宣告符合的條件的值。 一般發行隱私權聲明可以包含下列一或多個下列格式：  
  
    -   *取得複製*: 宣告複製輸出理賠要求將在建立宣告現有的複本。 此發行表單只合理時它加上「問題「發行聲明。 時它以 [新增] 的 \ [發行隱私權聲明結合，它不需任何作用。  
  
    -   *新的宣告*：這格式化 reates 新宣告，請提供的各種取得屬性的值。 必須指定 Claim.Type;所有其他宣告屬性是選擇性的。 此表單引數順序會略過。  
  
-   **屬性市集**：值，從屬性存放區擷取此表單建立主張。 也可透過單一發行聲明，這很重要，並讓網路或輸入/輸出 (I/O) 操作期間屬性擷取屬性商店建立多個宣告類型。 因此，它會限制原則引擎和屬性市集之間來回數目。 它也是法律建立多個宣告指定的宣告類型。 屬性網上商店退貨宣告特定的類型的多個值，發行聲明會自動建立每個傳回的宣告值理賠的要求。 屬性存放區實作使用參數引數替代查詢引數值參數引數所提供的版面配置。 預留位置使用相同的語法為.NET a0（）功能（例如，{1}、{2}，等等）。 這種發行的引數順序很重要，以及必須在下列文法規定的訂單。  
  
下表描述一些常見的語法建構這兩種類型的發行聲明中理賠要求規則。  
  
|發行隱私權聲明類型|發行隱私權聲明描述|發行隱私權聲明語法範例|  
|---------------------------|----------------------------------|-------------------------------------|  
|一般|下列規則一律會發出相同宣告時使用者的類型指定理賠要求和值：|```c: [type  == "http://test/employee", value  == "true"] => issue (type = "http://test/role", value = "employee");```|  
|一般|下列規則會轉換成另一個宣告類型。 請注意宣告符合的條件 [c] 的值為用於發行聲明。|```c: [type  == "http://test/group" ] => issue (type  = "http://test/role", value  = c.Value );```|  
|屬性網上商店|下列規則查詢 Active Directory 屬性網上商店使用連入宣告的值：|```c: [Type  == "http://test/name" ] => issue (store  = "Enterprise AD Attribute Store", types  =  ("http://test/email" ), query  = ";mail;{0}", param  = c.Value )```|  
|屬性網上商店|下列規則查詢先前所設定的結構化查詢的語言 (SQL) 屬性網上商店使用連入宣告的值：|```c: [type  == "http://test/name"] => issue (store  = "Custom SQL store", types  =  ("http://test/email","http://test/displayname" ), query  = "SELECT mail, displayname FROM users WHERE name ={0}", param  = c.value );```|  
  
#### <a name="expressions"></a>運算式  
運算式用於右側發行隱私權聲明參數和宣告選取器限制。 有幾種語言支援運算式。 所有運算式中的語言都的字串基礎，這表示它們字串需要做的輸入與產生字串。 數字或其他資料類型，例如的日期/時間，以運算式不受支援。 以下是運算式語言支援的類型：  
  
-   常字串：值，以在這兩個側邊報價（'）字元分隔的字串。  
  
-   字串全名連續運算式：結果是左右值全名連續所建立的字串。  
  
-   事件：函式由識別字，並且以逗號傳遞參數-運算式中括弧分隔的清單 (」（)」)。  
  
-   宣告的屬性存取點變數名稱屬性名稱的格式：值的辨識理賠要求屬性，指定的變數價值的結果。 變數必須先繫結至宣告選取器之前用於這種方式。 您不能使用繫結至宣告選取器中限制該相同宣告選擇器的變數。  
  
適用於存取下列理賠要求屬性︰  
  
-   Claim.Type  
  
-   Claim.Value  
  
-   Claim.Issuer  
  
-   Claim.OriginalIssuer  
  
-   Claim.ValueType  
  
-   Claim.Properties\[property\_name\]（這個屬性如果理賠要求屬性收藏中找不到屬性 _name 傳回空字串。 )  
  
若要撥打電話運算式中，您可以使用 RegexReplace 函式。 這項功能會輸入的運算式，並比對指定的模式。 如果符合模式，相符項目的輸出會取代取代值。  
  
#### <a name="exists-functions"></a>有函式  
存在函式可用於條件評估是否符合的條件存在於輸入宣告設定理賠要求。 如果有任何符合宣告，發行聲明呼叫一次。 下列範例中，在 [來源] 理賠要求發出一次，如果已設定為「MSFT「發行者輸入的宣告設定收藏中的至少一個理賠要求，不論是有許多方式主張發行者為「MSFT」。 使用這項功能將可避免從發行重複宣告。  
  
```  
exists([issuer == "MSFT"])  
   => issue(type = "origin", value = "Microsoft");  
```  
  
## <a name="rule-body"></a>本文規則  
規則主體可能包含只有單一發行聲明。 如果不使用存在函式條件，規則主體是每當符合的條件部分執行一次。  
  
## <a name="additional-references"></a>其他參考資料  
[建立傳送主張使用自訂規則規則](https://technet.microsoft.com/library/dd807049.aspx)  
  

