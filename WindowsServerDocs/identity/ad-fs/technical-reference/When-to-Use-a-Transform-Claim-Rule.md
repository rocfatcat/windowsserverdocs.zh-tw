---
ms.assetid: 77aa61bf-9c04-4889-a5d2-6f45bc1b8bd2
title: "使用轉換理賠要求規則"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: c7b7ea2c8d9a08a4cbf6c89c2de2482043efe25b
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/12/2017
---
>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="when-to-use-a-transform-claim-rule"></a>使用轉換理賠要求規則
傳出宣告類型對應傳入宣告類型，然後再套用執行的動作，會判斷何種輸出應該會發生的值，連入宣告源自您需要時，您可以使用在 Active Directory 同盟服務 \(AD FS\) 本規則。 當您使用此規則時，您通過或轉換宣告符合下列規則邏輯操作，根據其中一個選項，您設定在規則，如下表所示。  
  
|規則選項|邏輯規則|  
|---------------|--------------|  
|通過所有輸入宣告|如果輸入宣告類型等於*指定宣告類型*和值等*的任何值*，然後傳遞傳出宣告輸入等透過主張*指定宣告類型*|  
|使用不同的傳出宣告值取代傳入宣告值|如果傳入宣告類型等於*指定宣告類型*和值等*指定宣告值*，然後轉換理賠要求的新傳出宣告值*指定宣告值*與傳出宣告類型及*指定宣告類型*|  
|使用新的電子郵件 e\ 尾碼取代連入 e\ 郵件尾碼宣告|如果傳入宣告類型等於*指定宣告類型*和值等*任何尾碼值*，然後轉換理賠要求的新傳出宣告值*指定尾碼值*與傳出宣告類型及*指定宣告類型*|  
  
下列章節提供基本簡介取得規則，並提供時使用此規則有關的進一步詳細資料。  
  
## <a name="about-claim-rules"></a>關於理賠要求規則  
宣告規則表示商務邏輯操作，將需要連入宣告、 適用於條件的執行個體 \ （如果 x 然後 y\） 和產生傳出宣告依據條件的參數。 下列清單輪廓重要您進一步讀取之前，您必須知道的相關的提示取得規則本主題中：  
  
-   AD FS snap\ 中管理，在理賠要求規則只能建立使用理賠要求規則範本  
  
-   宣告規則處理程序傳入宣告直接從宣告提供者 \ （例如 Active Directory 或其他聯盟 Service\） 或接受的輸出從轉換宣告提供者信任規則。  
  
-   宣告發行引擎順序特定的規則集中處理理賠要求規則。 藉由設定優先順序規則，可以進一步改善或篩選宣告專特定的規則設定中的上一個規則。  
  
-   宣告規則範本一律會要求您指定傳入宣告類型。 不過，您可以使用單一規則相同宣告類型處理多個理賠要求值。  
  
如需詳細資訊理賠要求規則及宣告規則集合，請查看[的角色的取得規則](The-Role-of-Claim-Rules.md)。 如需規則的處理方式的相關資訊，請查看[的角色宣告引擎的](The-Role-of-the-Claims-Engine.md)。 宣告規則集合的處理方式的相關資訊，請查看[的角色宣告管線的](The-Role-of-the-Claims-Pipeline.md)。  
  
## <a name="pass-through-all-claim-values"></a>通過所有宣告值  
當使用此動作，請所有傳入宣告值來指定傳入宣告類型的輸入，對應至傳出宣告類型指定為傳出宣告傳送到同盟服務登入的發行前。  
  
例如，當規則設定使用**通過所有取得值**選項邏輯操作，連入取得類型的群組並指定傳出宣告類型的角色，從發行者 flow 中的所有傳入宣告值複製到新的傳出宣告宣告類型的角色與排列。  
  
## <a name="transforming-a-claim"></a>轉換理賠要求  
AD FS、 字詞在*宣告轉換*來取代一個傳入取得不同傳出宣告數值值。 這是此功能可以讓傳入理賠要求規則轉換。 在此規則的屬性，您可以設定條件轉換不同傳出宣告值根據指定傳入宣告類型輸入值。  
  
例如，如圖，規則條件的設定值來取代連入值不同傳出宣告時，群組的所有傳入宣告類型對應至新傳出宣告類型的角色。 在這種情形下，連入宣告值的購買取代系統的新傳出宣告值  
  
![使用轉換](media/adfs2_transform.gif)  
  
您也可以使用此規則套用條件，將所有連入宣告取代指定的 e\ 電子郵件尾碼值，以新值。 例如，您可以設定條件中變更所有宣告值，以 sales.corp.fabrikam.com fabrikam.com 此規則。  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>宣告提供者信任上設定此規則  
當您使用信任宣告提供者時，連入宣告宣告提供者轉換可信度對等可以設定此規則。 宣告類型或取得的值可以在組織中宣告提供者比組織中有不同的意義。 您可以使用此規則標準化來自宣告提供者，使其傳出宣告對等可以了解信賴的值與宣告類型。  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>信賴的派對信任上設定此規則  
當您使用信賴的派對信任時，可以設定此規則来轉換的特定信賴宣告。 宣告類型，或者取得值特定信賴，可能會有不同的意義以及此規則可讓您變更單一信賴的值與傳出宣告類型。  
  
## <a name="how-to-create-this-rule"></a>如何建立本規則  
建立使用理賠要求規則語言或使用**轉換取得連入**AD FS 管理 snap\ 中的 [規則範本。 此規則範本提供下列設定選項：  
  
-   指定名稱理賠要求規則  
  
-   轉換指定傳出宣告類型特定傳入宣告類型  
  
-   通過所有宣告值  
  
-   使用不同的傳出宣告值取代傳入宣告值  
  
-   使用新的電子郵件 e\ 尾碼取代連入 e\ 郵件尾碼宣告  
  
如需如何建立此範本後續的指示操作，[建立轉換連入宣告規則](https://technet.microsoft.com/library/dd807068.aspx)中的 AD FS 部署。  
  
## <a name="using-the-claim-rule-language"></a>使用語言理賠要求規則  
如果必須從的多個連入宣告 content 建構傳出宣告，您必須改為使用自訂規則。 如果傳出宣告宣告值必須為基礎的值，連入宣告的但包含其他 content，您還必須在此環境來使用自訂規則。 如需詳細資訊，請查看[使用自訂理賠要求規則](When-to-Use-a-Custom-Claim-Rule.md)。  
  
### <a name="examples-of-how-to-construct-a-transform-rule-syntax"></a>如何建立轉換規則語法的範例  
當使用理賠要求規則語言語法轉換宣告，您可以設定轉換成新的對應值宣告的屬性。 例如下列規則變更角色宣告的值 「 系統管理員 」 的 「 根 「 同時保留相同宣告類型：  
  
```  
c:[type == “https://schemas.microsoft.com/ws/2008/06/identity/claims/role”, value == “Administrators”]  => issue(type = c.type, value = “root”);  
```  
  
一般運算式也可用於宣告轉換。 例如，下列規則會網域設定 windows 使用者名稱宣告網域 \\ 使用者格式 fabrikam:  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] => issue(type = c.type, value = regexreplace(c.value, "(?<domain>[^\\]+)\\(?<user>.+)", "FABRIKAM\${user}"));  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>建立自訂規則最佳做法  
宣告轉換可以選擇性套用到使用 [基本篩選功能選取主張。 每個理賠要求屬性用於篩選可指定值，注意事項如下：  
  
|取得屬性|描述|  
|------------------|---------------|  
|值類型，值，鍵入|指派將最常使用這些屬性。 必須指定至少輸入和值轉換結果理賠要求。|  
|發行者|宣告規則語言允許理賠要求的發行者的設定，這通常不建議。 理賠要求的發行者則不會序列化權杖中。 預付碼收到時所有宣告的發行者屬性是設定同盟伺服器簽署預付碼。 因此，設定理賠要求的發行者規則中將不會影響到預付碼和後宣告封裝權杖中的設定將會遺失。 位置設定的理賠要求發行者合理的唯一案例是它設宣告提供者規則設定和設定為規則參考此特定的值與撰寫信賴廠商規則特定的值。 如果發行者屬性未明確設定理賠要求規則宣告發行引擎將其設為 [本機授權單位 」 中的值。|  
|OriginalIssuer|同樣地發行者，以 OriginalIssuer 通常不應明確指派值。 然而發行者 OriginalIssuer 屬性序列化在權杖中，但權杖消費者的如果設定時，它會包含識別碼聯盟伺服器的初次發行理賠要求。|  
|屬性|上一節所述，屬性包理賠要求的未保存在權杖，因此如果後續的本機原則前往參考屬性中儲存的資訊，應該只完成屬性的設定。|  
  
如需有關如何使用理賠要求規則語言，請查看[角色取得規則語言的](The-Role-of-the-Claim-Rule-Language.md)。  
  

