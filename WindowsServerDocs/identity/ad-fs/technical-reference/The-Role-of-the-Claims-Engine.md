---
ms.assetid: 8b15d44e-e4e6-4510-aa91-cc7ec7161b0a
title: "宣告引擎的角色"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 930b6f8034f17d8902104419042f944b82e90b4f
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/03/2017
---
>適用於：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="the-role-of-the-claims-engine"></a>宣告引擎的角色
其高層級，在 Active Directory 同盟服務 \(AD FS\) 宣告引擎是 rule\ 型引擎專門用來提供及處理宣告要求同盟服務。 宣告引擎是負責規則集合的每個執行您所設定的聯盟的信任關係的所有，並將結果輸出，宣告管線同盟服務中的唯一實體。  
  
更多的邏輯概念宣告管線時的 end\ to\ 結束處理程序這一條宣告，理賠要求規則的自訂宣告流程宣告規則執行處理程序期間，您可以使用實際管理項目。 如需管線程序，請查看[的角色宣告管線的](The-Role-of-the-Claims-Pipeline.md)。  
  
如圖的接受傳入宣告 \(acceptance rules\)，動作授權宣告要求 \(authorization rules\) 和發行傳出宣告 \(issuance rules\) 透過聯盟的信任關係您在組織中的所有理賠要求規則執行宣告引擎。  
  
![AD FS 角色](media/adfs2_enginepipeline.gif)  
  
## <a name="claim-rules-execution-process"></a>宣告規則執行處理程序  
當您設定宣告提供者信任或信賴信任理賠要求規則的組織，可信任做為理賠要求規則 set\(s\) 為的連入宣告閘道管理員叫用套用所需來判斷是否發行任何主張和的發行宣告理賠要求規則邏輯操作，宣告引擎。  
  
下一節列出每個步驟流程宣告透過宣告規則執行處理程序期間發生引擎。 每個步驟，如下所示，就會發生的每個階段宣告管線程序中所述。 包含下列步驟：  
  
-   步驟 1 – 初始設定  
  
-   步驟 2 – 執行  
  
-   步驟 3-執行結果  
  
如需管線程序，請查看[的角色宣告管線的](The-Role-of-the-Claims-Pipeline.md)。  
  
### <a name="step-1--initialization"></a>步驟 1 – 初始設定  
宣告規則執行處理程序的第一個步驟，宣告引擎接受宣告傳入的第一次將它們新增到*輸入宣告設定*。 輸入的宣告設定很類似只要所需的處理程序會需要該資料，以便擷取可暫時儲存的資料用於記憶體中的快取。 輸入的宣告組規則執行完成後，會捨棄的資料。  
  
#### <a name="adding-a-claim-to-the-input-claim-set-for-a-rule-set"></a>新增輸入宣告規則設定的設定來理賠要求  
需要暫時宣告資料儲存在記憶體時處理宣告規則集合相關聯的邏輯時輸入的宣告設定建立宣告引擎。 宣告引擎複製的所有規則集合中的第一個規則由來擷取輸入的宣告組傳入宣告。  
  
例如，在下圖宣告引擎會顯示的 A 宣告傳入的 B 宣告並將它們複製到輸入的宣告設定。 仍在輸入的宣告設定之後，宣告引擎擷取和做的第一次理賠要求規則集中規則中的邏輯輸入處理宣告和 B。  
  
![AD FS 角色](media/adfs2_context1.gif)  
  
宣告規則集合中的所有規則都共用理賠要求輸入一組相同。 共用輸入的宣告設定，如此便會影響的設定中的所有後續規則可以加入該設定的每個規則。  
  
### <a name="step-2--execution"></a>步驟 2 – 執行  
在此步驟宣告規則處理程序，理賠要求規則執行時所宣告引擎時間順序會逐步的所有規則特定規則設定一個從一次。 每個規則規則集合中的只執行一次，並執行中他們會從最上面底部 AD FS 管理 snap\-中的 [編輯理賠要求規則對話方塊中顯示為的順序。 處理理賠要求規則規則頂端設定的第一次，然後執行的所有規則直到然後處理後續規則。  
  
宣告規則定義理賠要求規則語言時，包含兩個組件條件和發行的隱私權聲明。 宣告引擎第一次處理程序使用的資料在輸入的條件部分取得集，判斷是否規則中指定的條件適用於包含在輸入宣告取得設定 \（符合的條件規則的宣告稱為符合 claims\）。 如果找不到任何符合宣告宣告引擎執行發行相符宣告每一組規則的陳述。 發行聲明規則的可以執行下列其中一項下列符合主張使用工作：  
  
1.  複製輸出理賠要求將符合理賠要求  
  
2.  轉換宣告欄位輸入的宣告集合中建立新的宣告或評估和輸出取得設定。  
  
3.  使用為鍵符合 claim\(s\) 查詢從屬性商店中輸入的宣告組建立新 claim\(s\) 或中輸入輸出取得集的詳細資訊。  
  
#### <a name="adding-a-claim-to-the-output-claim-set-for-a-rule-set"></a>新增到設定規則集輸出宣告理賠要求  
*輸出取得設定*是一開始空白，很重要，因為宣告引擎只會傳回宣告輸出宣告執行程序完成之後，設定中的記憶體中的位置。 這表示任何主張只存在於輸入宣告設定，並不輸出理賠要求將在將會被忽略的時間計算傳出宣告一最後一組時。  
  
#### <a name="adding-a-claim-to-both-claim-sets-for-a-rule-set"></a>新增至兩個理賠要求集理賠要求規則集合  
宣告規則的處理，是輸入中新增任何取得設定或兩個輸入中取得設定和輸出宣告根據聲明規則的發行聲明中所使用的設定。 這些陳述為是指理賠要求規則語言*新增*或*的問題*。  
  
如果*新增*使用聲明，宣告新增輸入的宣告集及宣告將會存在，只為了執行存在執行完成後將會停止。 如果*問題*使用聲明，宣告新增輸入的宣告設定和輸出理賠要求將和宣告將會退還輸出宣告只要執行完成設定。 如需有關這些聲明，請查看[的角色理賠要求規則語言的](The-Role-of-the-Claim-Rule-Language.md)。  
  
如果規則集中規則條件部分輸入理賠要求將在任何宣告不符合，規則的發行隱私權聲明部分則，輸出理賠要求將或輸入的宣告設定，因此加入任何主張。 下圖和對應步驟顯示宣告引擎會執行規則轉換時的行為：  
  
![AD FS 角色](media/adfs2_context2.gif)  
  
1.  連入宣告會新增至輸入宣告設定宣告引擎。  
  
2.  第一個規則執行時，它會看到和 B 宣告，這是在該時間中輸入的唯一宣告取得設定，並處理的條件規則 1 規則邏輯一部分。  
  
3.  A 宣告輸入理賠要求將在因為判斷規則條件為 true \（符合宣告 A\），並加入新 C 理賠要求為兩個輸入宣告設定和輸出取得設定。  
  
4.  規則 2 現在可以使用 A、B 和 C 宣告 \（輸入中的所有宣告都取得 set\）做為處理其邏輯輸入。  
  
如需宣告轉換的詳細資訊，請查看[使用轉換理賠要求規則](When-to-Use-a-Transform-Claim-Rule.md)。  
  
### <a name="step-3--execution-result"></a>步驟 3-執行結果  
之後，已中指定的規則集執行的所有規則，索賠項目最終將會出現在輸出理賠要求將會開始理賠要求規則集執行的最後階段。 此時，宣告引擎會設定為規則集執行的輸出輸出宣告的操作。 從這個一點是宣告管線接手並將此最終輸出移至下一個階段中的程序。  
  
## <a name="sending-the-execution-output-to-the-claims-pipeline"></a>宣告管線傳送執行輸出  
當宣告引擎處理程序規則設定，規則設定已在記憶體中，輸入自己專用的位置，以及輸出取得設定。 這表示的輸入與輸出取得使用規則一組設定的不同的輸入與輸出取得另一個規則集合中所使用的設定。  
  
整個程序完成執行的提供規則集之後 \（步驟 1、2 和 3\）的新發行的傳出宣告 \ (的輸出理賠要求 set\ content) 將會做為輸入宣告管線中的下一步規則。 如此一來宣告傳送從為另一部規則集合，請輸入一個規則的輸出中，如下所示。  
  
![AD FS 角色](media/adfs2_enginecontexts.gif)  
  
> [!NOTE]  
> 雖然發行規則設定也是管線重要階段，圖不會顯示它只針對簡化圖示。 如圖的顯示發行規則設定，以及它如何納入宣告管線，[的角色宣告管線的](The-Role-of-the-Claims-Pipeline.md)。  
  
此時，請接受規則的輸出管線用來最後一組宣告由管線，也就是授權規則處理中的第二個階段接受規則。 此時，整個取得規則執行程序 \ (步驟 1、2、3 above\) 會重新授權規則集。 此循環持續發行規則設定時，才 \ 完成之後（pipeline\ 的最後一個階段）。  
  
之後，已從發行規則集引擎傳回最終傳出宣告，會將封裝到 SAML 預付碼和同盟服務將會傳送到 client 的預付碼。  
  
## <a name="processing-authorization-rules"></a>正在處理授權規則  
如果理賠要求規則集合正在執行步驟 2 宣告規則執行處理程序的期間，包含的授權規則 \（的有不同的輸入及輸出取得比接受或發行 rules\ 集，）然後判斷是否授權權杖者取得的安全性權杖同盟服務從給定的信賴根據要求者的宣告執行這些授權規則。  
  
授權規則的目標是發行允許或拒絕根據使用者是否允許的特定信賴取得預付碼，或不理賠要求。 如下所示，輸出授權執行的管線用來判斷發行規則集合是否執行或不 — 依據是否允許 and\ 日或拒絕宣告-授權執行輸出本身不會做為宣告規則集合輸入，但。  
  
![AD FS 角色](media/adfs2_authorization.gif)  
  
如需有關宣告授權資訊，請查看[使用授權理賠要求規則](When-to-Use-an-Authorization-Claim-Rule.md)。  
  

