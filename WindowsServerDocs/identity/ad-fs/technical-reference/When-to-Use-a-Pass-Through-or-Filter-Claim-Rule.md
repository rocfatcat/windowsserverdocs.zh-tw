---
ms.assetid: 606df285-259c-4c6b-8583-9aca1d614c43
title: 使用傳遞或篩選宣告規則的時機
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 09f26e256793d30936496f7a936550acb7b20025
ms.sourcegitcommit: 0b5fd4dc4148b92480db04e4dc22e139dcff8582
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/24/2019
ms.locfileid: "66188348"
---
# <a name="when-to-use-a-pass-through-or-filter-claim-rule"></a>使用傳遞或篩選宣告規則的時機
您可以使用這項規則中 Active Directory Federation Services \(AD FS\)當您需要採取特定的傳入宣告類型，然後再套用，以決定應該發生何種輸出動作根據傳入宣告中的值。 當您使用此規則時，您會根據您在規則中設定的選項之一，傳遞或篩選任何與下表中的規則邏輯相符的宣告。  
  
|規則選項|規則邏輯|  
|---------------|--------------|  
|傳遞所有宣告值|如果傳入宣告類型等於*指定的宣告類型*，且值等於*任何值*，則會傳遞該宣告|  
|僅傳遞特定宣告值|如果傳入宣告類型等於*指定的宣告類型*，且值等於*指定的宣告值*，則會傳遞該宣告|  
|傳遞符合特定電子宣告值\-郵件尾碼值|如果傳入宣告類型等於*指定的宣告類型*，且值等於*指定的尾碼值*，則會傳遞該宣告|  
|僅傳遞以特定值開頭的宣告值|如果傳入宣告類型等於*指定的宣告類型*，且值以*指定的宣告值*開頭，則會傳遞該宣告|  
  
下列章節提供宣告規則的基本介紹，並進一步提供如何使用此規則的詳細資訊。  
  
## <a name="about-claim-rules"></a>關於宣告規則  
宣告規則表示商務邏輯，會收取傳入宣告，對其套用條件的執行個體\(若 x 則 y\)和產生根據條件參數傳出宣告。 在您進一步閱讀本主題之前，請先閱讀下列清單，其中會概述關於宣告規則您應該知道的重要秘訣：  
  
-   在 AD FS 管理嵌入式管理單元\-，宣告規則只能建立使用宣告規則範本  
  
-   宣告規則處理程序內送宣告直接從宣告提供者\(Active Directory 或其他同盟服務等\)或宣告提供者信任上從輸出的接受轉換規則。  
  
-   宣告規則的處理方式，是由宣告發行引擎依時間先後順序按照指定的規則集處理。 藉由設定規則優先順序，您可以進一步精簡或篩選由特定規則集內的上一個規則所產生的宣告。  
  
-   宣告規則範本一律會要求您指定傳入宣告類型。 不過，您可以使用單一規則和同一宣告類型處理多個宣告值。  
  
如需詳細的宣告規則和宣告規則集的相關資訊，請參閱[規則的角色宣告](The-Role-of-Claim-Rules.md)。 如需有關規則的處理方式的詳細資訊，請參閱 < [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md)。 宣告規則集的處理方式的詳細資訊，請參閱[The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md)。  
  
## <a name="pass-through-all-claim-values"></a>傳遞所有宣告值  
使用此動作時，將會以傳出宣告的形式傳遞指定宣告類型的所有傳入宣告值。 例如，當傳入宣告類型指定為角色宣告類型時，所有的傳入宣告值會個別複製到新的傳出宣告，且傳出宣告的類型為「角色」。  
  
## <a name="filtering-a-claim"></a>篩選宣告  
在 AD FS 的詞彙*宣告篩選*方法來篩選或限制傳入宣告值，以便只有特定的值會傳遞，或透過傳送為連出宣告。 此功能的運作有賴 [傳遞或篩選傳入宣告]  規則範本。 在此規則的屬性內，您可以設定篩選傳入值的條件，而只讓與您指定的條件相符的值傳遞。  
  
例如，您可以使用此規則，在傳入宣告類型符合「角色」宣告類型時僅傳遞符合宣告值「購買者」的宣告，或者您可以僅發出關於使用者名稱的宣告，而不是包含使用者身分證號碼的宣告。  
  
當您使用具有此規則的篩選條件時，所有的傳入宣告都會受到檢查，以判斷哪些宣告符合規則所設定的條件。 所有其他宣告都會被忽略，如此只有符合所選宣告類型的指定宣告值會傳遞。  
  
比方說下, 圖所示，規則設定與條件來篩選只連入宣告與 UPN 做為索引鍵，當宣告類型，也結尾@fabrikam.com，其他所有的連入宣告都會被忽略，除非它們符合此準則。 這包括宣告類型為 E 的傳入宣告\-即使其宣告值結尾的電子郵件地址@fabrikam.com。 在此情況下，只包含值的宣告Nick@fabrikam.com傳送到信賴憑證者的合作對象。  
  
![使用傳遞的時機經由](media/adfs2_filter.gif)  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>在宣告提供者信任上設定此規則  
當您使用宣告提供者信任時，可將此規則設定為只會傳遞符合特定條件約束的宣告提供者所傳入的宣告。 例如，您可能想要只接受電子\-來自宣告提供者的郵件宣告; 因此，您會使用此規則範本，以接受電子\-郵件結束宣告提供者的網域名稱系統中的宣告類型\(DNS\)名稱。  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>在信賴憑證者信任上設定此規則  
當您使用信賴憑證者信任時，可將此規則設定為會傳遞或篩選將傳送給信賴憑證者的傳出宣告。 有些信賴憑證者可能不了解特定的宣告類型，或是某些宣告可能包含不應傳送給特定信賴憑證者的敏感性資訊。 此規則範本可協助您針對特定的信賴憑證者信任強制執行這些原則。  
  
## <a name="how-to-create-this-rule"></a>如何建立此規則  
您建立此規則使用宣告規則語言，或使用 「 傳遞或篩選傳入宣告 」 規則範本中的 AD FS 管理嵌入式管理單元\-中。 這個規則範本提供下列設定選項：  
  
-   指定宣告規則名稱  
  
-   指定傳入宣告類型  
  
-   傳遞所有宣告值  
  
-   僅傳遞特定宣告值  
  
-   傳遞符合特定電子宣告值\-郵件尾碼值  
  
-   僅傳遞以特定值開頭的宣告值  
  
如需有關如何建立此範本的詳細資訊，請參閱[建立規則來傳遞或篩選傳入宣告](https://technet.microsoft.com/library/dd807060.aspx)AD FS 部署指南中。  
  
## <a name="using-the-claim-rule-language"></a>使用宣告規則語言  
如果只有在宣告值符合自訂模式時才應傳送宣告，您必須使用自訂規則。 如需詳細資訊，請參閱「使用自訂規則的時機」。  
  
### <a name="examples-of-how-to-construct-a-pass-through-or-filter-rule-syntax"></a>說明如何建構傳遞或篩選規則語法的範例  
一個簡單的篩選規則會篩選根據前述其中一個屬性來篩選宣告。 例如，下列規則將會傳遞所有電子\-郵件宣告：  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”]  => issue(claim  = c);  
```  
  
篩選可依邏輯 AND\-ed 放在一起。 例如，下列規則將會接受所有的電子\-郵件宣告值 johndoe@fabrikam.com:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value == “johndoe@fabrikam.com “]  => issue(claim  = c);  
```  
  
在上述範例中，篩選器一律使用等號比較運算子。 宣告規則語言支援下列運算子：  
  
-   \=\= \- 等於\(案例\-機密\)  
  
-   \!\= \- 不等於\(案例\-機密\)  
  
-   \=~\- 規則運算式比對  
  
-   \!~ \- 規則運算式的非\-比對  
  
例如，下列規則將會接受所有的電子\-郵件不是由本機同盟伺服器簽發的宣告具有尾碼為 boeing.com 的：  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value =~ “^.*@boeing\.com$” , issuer != “LOCAL AUTHORITY”]  => issue(claim  = c);  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>建立自訂規則的最佳做法  
篩選可以套用到每個宣告的一或多個屬性，如下表所說明。  
  
|宣告屬性|描述|  
|------------------|---------------|  
|類型|宣告類型\(通常是以 Uri 表示\)反映中關於宣告中應傳達哪種資訊的同盟夥伴之間的隱含協議。 例如，宣告的輸入 http:\/\/schemas.xmlsoap.org\/ws\/2005年\/05\/身分識別\/宣告\/emailaddress 將包含 e\-地址的使用者。|  
|值|宣告的值。 例如，屬於類型 http 宣告：\/\/schemas.xmlsoap.org\/ws\/2005年\/05\/識別\/宣告\/emailaddress 可能的值 johndoe@fabrikam.com|  
|ValueType|ValueType 代表對宣告值中包含的資訊進行解譯的方式。 ValueType 通常會設為 http:\/\/www.w3.org\/2001年\/XMLSchema\#字串，但宣告值可能包含 Base64Binary 編碼資料\(比方說，映像\)或日期、 布林值，等等。|  
|簽發者|簽發者代表上次發出使用者相關宣告的一方。 如果是在宣告提供者同盟伺服器上取得宣告，則所有宣告的簽發者都會設定為「本機授權」。 如果事由同盟提供者同盟伺服器接收宣告，則宣告的簽發者會設定為簽署權杖之宣告提供者的宣告提供者識別碼。 因此，在對接收自宣告提供者的宣告處理規則時，所有宣告的簽發者都會設為相同的值。 當撰寫信賴憑證者的規則時，可使用簽發者屬性來區分來自不同宣告提供者的宣告。|  
|OriginalIssuer|此宣告屬性可用來傳達原本發出宣告的的同盟伺服器。 原始簽發者宣告的簽發者屬性設定的最後一個簽署權杖的同盟伺服器，因為是在其中宣告流經多個同盟伺服器的案例中有用\(比方說，信賴憑證者合作對象接收到權杖從同盟提供者同盟伺服器可能會想要哪個宣告提供者同盟伺服器已驗證使用者\)|  
|屬性|除了上述的五個屬性外，每個宣告也都有可儲存具名屬性的屬性包。 這些屬性不會序列化到權杖中，且只能在單一同盟伺服器的範圍內，用來傳遞宣告發行管線元件之間的資訊。 例如，在宣告提供者規則處理期間設定屬性，然後在信賴憑證者規則中加以參照。|  
  

