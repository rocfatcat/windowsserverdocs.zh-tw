---
title: 效能調整網路介面卡
description: 本主題是 Windows Server 2016 的網路子系統效能調整指南的一部分。
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 0b9b0f80-415c-4f5e-8377-c09b51d9c5dd
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: d6d54f33108d1cdb936b02fc556acca1e5518b9b
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59861529"
---
# <a name="performance-tuning-network-adapters"></a>效能調整網路介面卡

>適用於：Windows Server （半年通道），Windows Server 2016

您可以使用本主題以效能調整網路介面卡安裝在執行 Windows Server 2016 的電腦中。

根據下列變數，決定網路介面卡的正確調整設定：

- 網路介面卡及其功能集  

- 伺服器執行的工作負載類型  

- 伺服器硬體和軟體資源  

- 您的伺服器效能目標  

如果您的網路介面卡提供調整選項，您便可以根據上述參數，將網路輸送量和資源使用情況最佳化來達到最佳輸送量。  

下列小節描述一些效能調整選項。  

##  <a name="bkmk_offload"></a> 啟用卸載功能

調整網路介面卡卸載功能通常會有好處。 不過，有時候，網路介面卡並沒有強大到足以處理高輸送量卸載功能。

>[!IMPORTANT]
>請勿使用卸載特徵**IPsec 工作卸載**或是**TCP Chimney 卸載**。 這些技術在 Windows Server 2016 中，已被取代，且可能產生不良影響，伺服器和網路效能。 此外，這些技術可能不支援 Microsoft 在未來。

例如，啟用分割卸載可能會降低某些網路介面卡上的最大可持續輸送量，因為硬體資源有限的緣故。 不過，如果輸送量降低預計不會造成限制，您就應該啟用卸載功能，即使是此類型的網路介面卡。

>[!NOTE]
> 某些網路介面卡必須啟用卸載功能，才能獨立啟用傳送和接收路徑。

##  <a name="bkmk_rss_web"></a> 啟用接收端調整 (RSS) 的 Web 伺服器

當伺服器上的網路介面卡比邏輯處理器少時，RSS 可以改善 Web 延展性和效能。 當所有網路流量都會通過支援 RSS 的網路介面卡時，可以同時在不同 CPU 處理來自不同連線的連入 Web 要求。

請務必注意，由於 RSS 和超文字傳輸通訊協定中的邏輯\(HTTP\)的負載分配，效能可能會大幅降低的 RSS 功能的網路介面卡接受有一個在伺服器上的 web 流量或多個支援 RSS 的網路介面卡。 在這種情況下，您應該使用支援 RSS 的網路介面卡，或是在網路介面卡內容 [進階內容] 索引標籤上停用 RSS。若要判斷網路介面卡是否支援 RSS，您可以檢視網路介面卡內容 [進階內容] 索引標籤上的 RSS 資訊。

### <a name="rss-profiles-and-rss-queues"></a>RSS 設定檔和 RSS 佇列

預設的預先定義的 RSS 設定檔是 NUMA 靜態的可從舊版作業系統中變更預設行為。 若要開始使用 RSS 設定檔，您可以檢閱可用的設定檔，以了解它們何時可以派上用場，以及如何將它們套用到您的網路環境和硬體。

例如，如果您開啟 [工作管理員] 並檢視您伺服器上的邏輯處理器，而它們在接收流量上似乎未獲得充分利用，您可以嘗試將 RSS 佇列數目從預設值 2 增加至您網路介面卡所支援的最大值。 您的網路介面卡可能會在驅動程式中提供變更 RSS 佇列數目的選項。

##  <a name="bkmk_resources"></a> 增加網路介面卡資源

針對允許手動設定資源 (例如接收和傳送緩衝區) 的網路介面卡，您應該增加配置的資源。 

某些網路介面卡會將其接收緩衝區設低以節省來自主機的配置記憶體。 低的值會導致丟棄封包和降低效能。 因此，對於大量接收的情況，建議您將接收緩衝區的值增加到最大。

>[!NOTE]
>如果網路介面卡沒有顯示手動資源設定，表示它是以動態方式設定資源，或是將資源設定為無法變更的固定值。

### <a name="enabling-interrupt-moderation"></a>啟用插斷仲裁

為了控制插斷仲裁，某些網路介面卡會顯示不同的插斷仲裁層級、緩衝區聯合參數 (有時會分別針對傳送和接收緩衝區) 或兩者都顯示。

您應該考慮為 CPU 密集型工作負載啟用插斷仲裁，並在主機 CPU 節約與延遲相對於增加的主機 CPU 節約之間考量取捨，因為插斷越多，延遲就越少。 如果網路介面卡並不執行插斷仲裁，但是有顯示緩衝區聯合，則增加聯合緩衝區數目可讓每個傳送或接收獲得更多緩衝區，進而改善效能。

##  <a name="bkmk_low"></a> 低延遲封包處理效能微調

許多網路介面卡都有提供將作業系統引起的延遲最佳化的選項。 延遲係指網路驅動程式處理連入封包到網路驅動程式將封包傳送回去之間的經歷時間。 此時間通常是以微秒為單位。 相較之下，用於長距離封包傳輸的傳輸時間通常是以毫秒為單位\(重要性順序較大\)。 這項調整不會縮短封包在傳輸上所花的時間。

以下是一些適用於精細度到微秒之網路的效能調整建議。

- 將定電腦 BIOS 設定成 [高效能]，且停用 C-State。 不過，請注意，這與系統和 BIOS 相依，某些系統在讓作業系統控制電源管理的情況下可以提供較高的效能。 您可以檢查和調整電源管理設定從**設定**或使用**powercfg**命令。 如需詳細資訊，請參閱[Powercfg 命令列選項](https://technet.microsoft.com/library/cc748940.aspx)

- 將作業系統電源管理設定檔設定為 [高效能系統]。 請注意，如果系統 BIOS 已經設定為停用作業系統對電源管理的控制，這將會無法正常運作。

- 啟用靜態卸載，例如 UDP 總和檢查碼、TCP 總和檢查碼及傳送大型卸載 (LSO)。

- 如果流量是多重串流的形式 (例如大量多點傳送接收)，請啟用 RSS。

-   針對要求最低可能延遲的網路卡驅動程式，請停用 [插斷仲裁] 設定。 請記住，這可能會使用較多的 CPU 時間，而這就是它的代價。

- 在與處理封包的程式 (使用者執行緒) 所使用之核心共用 CPU 快取的核心處理器上，處理網路介面卡插斷和 DPC。 CPU 親和性調整可用來將處理程序導向特定邏輯處理器並搭配 RSS 設定來完成這項作業。 將相同的核心用於插斷、DPC 及使用者模式執行緒會讓效能隨著負載增加而變差，因為 ISR、DPC 及執行緒會爭相使用該核心。

##  <a name="bkmk_smi"></a> 系統管理插斷

許多硬體系統會使用系統管理中斷\(SMI\)針對各種維護功能，包括報告的錯誤修正碼\(ECC\)記憶體錯誤、 舊版 USB 相容性、 風扇控制和 BIOS 控制電源管理。 

SMI 是系統上優先順序最高的插斷並且會讓 CPU 進入管理模式，當它執行插斷服務例行工作 (通常包含在 BIOS 中) 時，會比所有其他活動都優先。

遺憾的是，這可能導致產生 100 微秒或更長的延遲尖峰。 

如果您需要達到最低延遲，您應該向硬體提供者要求一個可將 SMI 盡可能降到最低限度的 BIOS 版本。 這些通常被稱為「低延遲 BIOS」或「無 SMI BIOS 」。 在某些情況下，硬體平台不可能將 SMI 活動全部消除，因為會使用它來控制必要的功能 (例如冷卻風扇)。

>[!NOTE]
>作業系統無法控制 SMI，因為邏輯處理器是在特殊的維護模式下執行，這會防止作業系統介入。

##  <a name="bkmk_tcp"></a> 效能調整 TCP

 您可以使用下列項目來調整 TCP 效能。

###  <a name="bkmk_tcp_params"></a>  TCP 接收視窗自動微調

Windows Server 2008 以前, 網路堆疊使用有限的整體潛在連線輸送量固定大小接收端窗口 （65,535 個位元組）。 TCP 堆疊的其中一個最重要變更就是 TCP 接收窗口自動調整。 

當您使用 TCP 接收視窗為固定的大小，您可以計算單一連線的總輸送量：

**可達成總輸送量 （位元組） = TCP 接收視窗大小，以位元組為單位\*(1 / 連線延遲時間，以秒為單位)**

例如，可達成總輸送量才有 10 毫秒延遲的連線 51 Mbps\(大型公司網路基礎結構的合理值\)。 

不過，如果使用自動調整，便可調整接收端窗口，就能成長到符合傳送者的需求。 它有可能讓連線達到 1 Gbps 的連線的全線速率。 在過去可能受到可達成總輸送量限制的網路使用案例，現在則可以充分使用網路。

#### <a name="deprecated-tcp-parameters"></a>已被取代的 TCP 參數

從 Windows Server 2003 的下列登錄設定不受支援，而且會忽略在較新版本。

所有這些設定都有下列的登錄位置：

    ```  
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters  
    ```  

- TcpWindowSize

- NumTcbTablePartitions  

- MaxHashTableSize  



###  <a name="bkmk_wfp"></a> Windows 篩選平台

Windows 篩選平台 (WFP) 導入 Windows Vista 和 Windows Server 2008 中提供的 Api 來建立封包處理篩選的非 Microsoft 獨立軟體廠商 (Isv)。 範例包括防火牆和防毒軟體。

>[!NOTE]
>撰寫得不好的 WFP 篩選器可能會大幅降低伺服器的網路效能。 如需詳細資訊，請參閱 <<c0> [ 移植的封包處理驅動程式和應用程式到 WFP](https://msdn.microsoft.com/windows/hardware/gg463267.aspx) Windows 開發人員中心。


本指南中的所有主題的連結，請參閱[網路子系統效能調整](net-sub-performance-top.md)。
