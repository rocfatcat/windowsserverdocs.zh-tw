---
title: 將 NPS 作為 RADIUS 伺服器規劃
description: 本主題提供有關 Windows Server 2016 中的網路原則伺服器 RADIUS 伺服器部署規劃的資訊。
manager: brianlic
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: bbcf3338f2cd6d8662a84faf263b486e31b140e5
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405336"
---
# <a name="plan-nps-as-a-radius-server"></a>將 NPS 作為 RADIUS 伺服器規劃

>適用於：Windows Server (半年度管道)、Windows Server 2016

當您以遠端驗證撥入使用者服務（RADIUS）伺服器的形式部署網路原則伺服器 \(NPS @ no__t-1 時，NPS 會針對本機網域和信任的網域，執行連線要求的驗證、授權和帳戶處理。本機網域。 您可以使用這些規劃指導方針來簡化您的 RADIUS 部署。

這些規劃指導方針不包括您想要將 NPS 部署為 RADIUS proxy 的情況。 當您將 NPS 部署為 RADIUS proxy 時，NPS 會將連線要求轉送到執行 NPS 的伺服器或遠端網域、不受信任的網域或兩者中的其他 RADIUS 伺服器。 

在您將 NPS 部署為網路上的 RADIUS 伺服器之前，請使用下列指導方針來規劃您的部署。

- 規劃 NPS 設定。

- 規劃 RADIUS 用戶端。

- 規劃驗證方法的使用。

- 規劃網路原則。

- 規劃 NPS 帳戶處理。

## <a name="plan-nps-configuration"></a>規劃 NPS 設定

您必須決定 NPS 是哪個網域的成員。 針對多網域環境，NPS 可以針對所屬網域中的使用者帳戶，以及信任該 NPS 之本機網域的所有網域，驗證其認證。 若要允許 NPS 在授權程式期間讀取使用者帳戶的撥入內容，您必須將 NPS 的電腦帳戶新增至每個網域的 RAS 和 Nps 群組。

在決定 NPS 的網域成員資格之後，必須使用 RADIUS 通訊協定，將伺服器設定為與 RADIUS 用戶端（也稱為網路存取伺服器）進行通訊。 此外，您可以設定 NPS 記錄在事件記錄檔中的事件種類，也可以輸入伺服器的描述。

### <a name="key-steps"></a>主要步驟

在規劃 NPS 設定的過程中，您可以使用下列步驟。

- 判斷 NPS 用來從 RADIUS 用戶端接收 RADIUS 訊息的 RADIUS 埠。 預設埠為 RADIUS 驗證訊息的 UDP 埠1812和1645，以及用於 RADIUS 帳戶處理訊息的埠1813和1646。

- 如果 NPS 設定了多個網路介面卡，請決定您想要允許 RADIUS 流量使用的介面卡。

- 判斷您想要 NPS 在事件記錄檔中記錄的事件種類。 您可以記錄拒絕的驗證要求、成功的驗證要求，或這兩種類型的要求。

- 判斷您是否要部署一個以上的 NPS。 若要針對 RADIUS 型驗證和帳戶處理提供容錯功能，請使用至少兩個 Nps。 一個 NPS 用來作為主要 RADIUS 伺服器，另一個則用來做為備份。 然後，每個 RADIUS 用戶端都會在這兩個 Nps 上設定。 如果主要 NPS 變成無法使用，RADIUS 用戶端就會將存取要求訊息傳送至替代 NPS。

- 規劃用來將一個 NPS 設定複製到其他 Nps 的腳本，以節省管理額外負荷，並避免伺服器的設定不正確。 NPS 提供 Netsh 命令，可讓您將匯入的全部或部分 NPS 設定複製到另一個 NPS。 您可以在 Netsh 提示字元中手動執行命令。 不過，如果您將命令順序儲存為腳本，如果您決定要變更伺服器設定，可以在日後執行腳本。

## <a name="plan-radius-clients"></a>規劃 RADIUS 用戶端

RADIUS 用戶端是網路存取伺服器，例如無線存取點、虛擬私人網路（VPN）伺服器、802.1 X 功能交換器和撥號伺服器。 將連線要求訊息轉寄到 RADIUS 伺服器的 RADIUS proxy 也是 RADIUS 用戶端。 NPS 支援所有符合 RADIUS 通訊協定的網路存取伺服器和 RADIUS proxy，如 RFC 2865 「遠端驗證撥入使用者服務（RADIUS）」和 RFC 2866 「RADIUS 帳戶處理」中所述。

>[!IMPORTANT]
>存取用戶端（例如用戶端電腦）不是 RADIUS 用戶端。 只有支援 RADIUS 通訊協定的網路存取伺服器和 proxy 伺服器為 RADIUS 用戶端。

此外，無線存取點和交換器都必須能夠 802.1 X 驗證。 如果您想要部署可延伸的驗證通訊協定 \(EAP @ no__t-1 或受保護的可延伸驗證通訊協定 \(PEAP @ no__t-3，存取點和交換器必須支援使用 EAP。

若要測試無線存取點的 PPP 連線基本互通性，請將存取點和存取用戶端設定為使用密碼驗證通訊協定（PAP）。 使用其他以 PPP 為基礎的驗證通訊協定（例如 PEAP），直到您已經測試過您想要用來存取網路的使用者。

### <a name="key-steps"></a>主要步驟

在規劃 RADIUS 用戶端時，您可以使用下列步驟。

- 記錄您必須在 NPS 中設定的廠商特定屬性（Vsa）。 如果您的網路存取伺服器需要 Vsa，請在 NPS 中設定網路原則時，記錄 VSA 資訊以供稍後使用。 

- 記錄 RADIUS 用戶端和 NPS 的 IP 位址，以簡化所有裝置的設定。 當您部署 RADIUS 用戶端時，您必須將其設定為使用 RADIUS 通訊協定，並將 NPS IP 位址輸入為驗證服務器。 當您設定 NPS 與 RADIUS 用戶端通訊時，您必須在 NPS 嵌入式管理單元中輸入 RADIUS 用戶端 IP 位址。

- 針對 RADIUS 用戶端和 NPS 嵌入式管理單元中的設定建立共用密碼。 在 NPS 中設定 RADIUS 用戶端時，您必須使用共用密碼或密碼來設定 RADIUS 用戶端，同時也會在 NPS 嵌入式管理單元中輸入。

## <a name="plan-the-use-of-authentication-methods"></a>規劃驗證方法的使用

NPS 同時支援密碼型和以憑證為基礎的驗證方法。 不過，並非所有的網路存取伺服器都支援相同的驗證方法。 在某些情況下，您可能會想要根據網路存取的類型來部署不同的驗證方法。

例如，您可能會想要為您的組織部署無線和 VPN 存取，但針對每種類型的存取，請使用不同的驗證方法：適用于 VPN 連線的 EAP-TLS，因為 EAP 具備傳輸層安全性（EAP-TLS）所提供的強大安全性，以及適用于 802.1 X 無線連線的 PEAP ms-chap v2。

PEAP 與 Microsoft 挑戰交握驗證通訊協定第2版（PEAP-MS-CHAP v2）提供名為快速重新連線的功能，特別設計用於可攜式電腦和其他無線裝置。 快速重新連線可讓無線用戶端在相同網路上的無線存取點之間移動，而不需要在每次與新的存取點建立關聯時重新驗證。 這可為無線使用者提供更好的體驗，並可讓他們在存取點之間移動，而不必重新輸入其認證。
基於快速重新連線以及 PEAP ms-chap v2 所提供的安全性，PEAP ms-chap v2 是一個邏輯選擇，做為無線連線的驗證方法。

針對 VPN 連線，EAP-TLS 是以憑證為基礎的驗證方法，它會提供強大的安全性來保護網路流量，即使它是透過網際網路從家用或行動電腦傳輸到組織的 VPN 伺服器也一樣。

### <a name="certificate-based-authentication-methods"></a>以憑證為基礎的驗證方法

以憑證為基礎的驗證方法有提供強大安全性的優點;而且它們的缺點是比密碼驗證方法更容易部署。

PEAP ms-chap v2 和 EAP-TLS 兩者都是以憑證為基礎的驗證方法，但它們之間有許多差異，以及它們的部署方式。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS 使用憑證進行用戶端和伺服器驗證，而且需要您在組織中部署公開金鑰基礎結構（PKI）。 部署 PKI 可能很複雜，而且需要規劃階段，而不是規劃使用 NPS 做為 RADIUS 伺服器。

使用 EAP-TLS，NPS 會向憑證授權單位單位 \(CA @ no__t-1 註冊伺服器憑證，而憑證會儲存在本機電腦的憑證存放區中。 在驗證過程中，當 NPS 將其伺服器憑證傳送到存取用戶端以證明其身分識別給存取用戶端時，就會進行伺服器驗證。 存取用戶端會檢查各種憑證內容，以判斷憑證是否有效，以及是否適合在伺服器驗證期間使用。 如果伺服器憑證符合最低伺服器憑證需求，而且是由存取用戶端信任的 CA 所發出，則表示 NPS 已由用戶端成功驗證。

同樣地，當用戶端將其用戶端憑證傳送至 NPS 以向 NPS 證明其身分識別時，就會在驗證程式期間進行用戶端驗證。 NPS 會檢查憑證，而且如果用戶端憑證符合最低用戶端憑證需求，而且是由 NPS 信任的 CA 所發出，則 NPS 會成功驗證存取用戶端。

雖然伺服器憑證必須儲存在 NPS 的憑證存放區中，但用戶端或使用者憑證可以儲存在用戶端的憑證存放區或智慧卡上。

若要讓此驗證程式成功，所有電腦都必須在本機電腦和目前使用者的「信任的根憑證授權單位」憑證存放區中，擁有貴組織的 CA 憑證。

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP-MS-CHAP v2 會使用憑證來進行伺服器驗證，以及以密碼為基礎的認證來進行使用者驗證。 因為憑證僅用於伺服器驗證，所以您不需要部署 PKI，即可使用 PEAP ms-chap v2。 當您部署 PEAP-MS-CHAP v2 時，您可以使用下列兩種方式的其中一種來取得 NPS 的伺服器憑證：

- 您可以安裝 Active Directory 憑證服務（AD CS），然後將憑證自動註冊到 Nps。 如果您使用此方法，您也必須向連線到網路的用戶端電腦註冊 CA 憑證，使其信任發行至 NPS 的憑證。

- 您可以向公用 CA （例如 VeriSign）購買伺服器憑證。 如果您使用此方法，請確定您選取的是用戶端電腦已信任的 CA。 若要判斷用戶端電腦是否信任 CA，請開啟用戶端電腦上的 [憑證] Microsoft Management Console （MMC）嵌入式管理單元，然後查看本機電腦和目前使用者的 [受信任的根憑證授權單位] 存放區。 如果這些憑證存放區中有來自 CA 的憑證，用戶端電腦會信任 CA，因此會信任 CA 所發行的任何憑證。

在採用 PEAP ms-chap v2 的驗證過程中，當 NPS 將其伺服器憑證傳送到用戶端電腦時，就會進行伺服器驗證。 存取用戶端會檢查各種憑證內容，以判斷憑證是否有效，以及是否適合在伺服器驗證期間使用。 如果伺服器憑證符合最低伺服器憑證需求，而且是由存取用戶端信任的 CA 所發出，則表示 NPS 已由用戶端成功驗證。

使用者驗證會在嘗試連線到網路類型密碼認證並嘗試登入的使用者時進行。 NPS 會接收認證並執行驗證和授權。 如果使用者已通過驗證並成功授權，而且用戶端電腦已成功驗證 NPS，則會授與連線要求。

### <a name="key-steps"></a>主要步驟

在規劃使用驗證方法的期間，您可以使用下列步驟。

- 識別您打算提供的網路存取類型，例如無線、VPN、802.1 X 支援的交換器和撥號存取。

- 決定您想要用於每種存取類型的驗證方法或方法。 建議您使用以憑證為基礎的驗證方法，以提供強大的安全性;不過，部署 PKI 可能並不實用，因此其他驗證方法可能會提供您的網路所需的更佳平衡。

- 如果您要部署 EAP-TLS，請規劃 PKI 部署。 這包括規劃您要用於伺服器憑證和用戶端電腦憑證的憑證範本。 其中也包含決定如何向網域成員和非網域成員電腦註冊憑證，以及判斷您是否想要使用智慧卡。

- 如果您要部署 PEAP-MS-CHAP v2，請決定是否要安裝 AD CS 以對 Nps 發出伺服器憑證，或是否要從公用 CA （例如 VeriSign）購買伺服器憑證。

### <a name="plan-network-policies"></a>規劃網路原則

NPS 會使用網路原則來判斷從 RADIUS 用戶端接收的連線要求是否已獲授權。 NPS 也會使用使用者帳戶的撥入屬性來進行授權判斷。

因為網路原則會依其出現在 NPS 嵌入式管理單元中的順序進行處理，所以請規劃在原則清單中先放置限制最嚴格的原則。 NPS 會針對每個連線要求，嘗試符合原則的條件與連線要求屬性。 NPS 會依序檢查每個網路原則，直到找到相符的。 如果找不到相符的，則會拒絕連接要求。

### <a name="key-steps"></a>主要步驟

在規劃網路原則時，您可以使用下列步驟。

- 判斷網路原則慣用的 NPS 處理順序，從最嚴格限制到最不嚴格。

- 判斷原則狀態。 原則狀態的值可以是 [已啟用] 或 [已停用]。 如果已啟用原則，NPS 會在執行授權時評估原則。 如果原則未啟用，就不會進行評估。

- 判斷原則類型。 當原則的條件與連線要求相符時，您必須判斷原則是否設計為授與存取權，或原則是否設計為在連線要求符合原則的條件時拒絕存取。 例如，如果您想要明確拒絕 Windows 群組成員的無線存取，您可以建立網路原則來指定群組、無線連線方法，以及其原則類型設定為 [拒絕存取]。

- 判斷您是否想要 NPS 忽略以原則為基礎之群組成員的使用者帳戶的撥入屬性。 當此設定未啟用時，使用者帳戶的撥入內容會覆寫網路原則中所設定的設定。 例如，如果設定的網路原則會授與使用者存取權，但該使用者之使用者帳戶的撥入內容設為拒絕存取，則會拒絕使用者存取。 但是，如果您啟用原則類型設定 [略過使用者帳戶撥入內容]，則會將網路的存取權授與相同的使用者。

- 判斷原則是否使用原則來源設定。 此設定可讓您輕鬆地指定所有存取要求的來源。 可能的來源包括終端機服務閘道（TS 閘道）、遠端存取服務器（VPN 或撥號）、DHCP 伺服器、無線存取點，以及健康情況登錄授權單位伺服器。 或者，您也可以指定廠商特定的來源。

- 判斷必須符合才能套用網路原則的條件。

- 判斷當連線要求符合網路原則的條件時，所套用的設定。

- 判斷您是否要使用、修改或刪除預設網路原則。

## <a name="plan-nps-accounting"></a>規劃 NPS 帳戶處理

NPS 可讓您以三種格式記錄 RADIUS 帳戶處理資料，例如使用者驗證和帳戶處理要求：IAS 格式、與資料庫相容的格式，以及 Microsoft SQL Server 記錄。 

IAS 格式和資料庫相容的格式會在本機 NPS 上以文本檔案格式建立記錄檔。 

SQL Server 記錄功能可讓您記錄到 SQL Server 2000 或 SQL Server 2005 XML 相容的資料庫，延伸 RADIUS 帳戶處理以利用記錄到關係資料庫的優點。

### <a name="key-steps"></a>主要步驟

在規劃 NPS 帳戶處理期間，您可以使用下列步驟。

- 判斷您是否要將 NPS 帳戶處理資料儲存在記錄檔或 SQL Server 資料庫中。

### <a name="nps-accounting-using-local-log-files"></a>使用本機記錄檔的 NPS 帳戶處理

記錄檔案中的使用者驗證和帳戶處理要求主要用於連線分析和計費，而且也可做為安全性調查工具，提供您在之後追蹤惡意使用者活動的方法。遭受.

### <a name="key-steps"></a>主要步驟

使用本機記錄檔規劃 NPS 帳戶處理期間，您可以使用下列步驟。

- 決定您要用於 NPS 記錄檔的文本檔案格式。

- 選擇您想要記錄的資訊類型。 您可以記錄帳戶處理要求、驗證要求和定期狀態。

- 決定您要儲存記錄檔的硬碟位置。

- 設計您的記錄檔案備份解決方案。 儲存記錄檔的硬碟位置應該是可讓您輕鬆備份資料的位置。 此外，您應該針對儲存記錄檔的資料夾設定存取控制清單（ACL），以保護硬碟位置。

- 決定您想要建立新記錄檔的頻率。 如果您想要根據檔案大小建立記錄檔，請在 NPS 建立新的記錄檔之前，判斷允許的檔案大小上限。

- 判斷如果硬碟的儲存空間用盡，NPS 是否要刪除較舊的記錄檔。

- 決定您要用來查看帳戶處理資料和產生報告的應用程式。

### <a name="nps-sql-server-logging"></a>NPS SQL Server 記錄

當您需要會話狀態資訊、建立報表和分析資料，以及集中管理和簡化您的帳戶處理資料時，會使用 NPS SQL Server 記錄。

NPS 可讓您使用 SQL Server 記錄，將從一或多個網路存取伺服器接收的使用者驗證和帳戶處理要求，記錄到執行 Microsoft SQL Server 桌面引擎之電腦上的資料來源 \(MSDE 2000 @ no__t-1 或任何版本 SQL Server 晚于 SQL Server 2000。

計量資料會從 XML 格式的 NPS 傳遞至資料庫中的預存程式，同時支援結構化查詢語言 \(SQL @ no__t-1 和 XML \(SQLXML @ no__t-3。 在符合 XML 標準的 SQL Server 資料庫中記錄使用者驗證和帳戶處理要求，可讓多個 Nps 有一個資料來源。

### <a name="key-steps"></a>主要步驟

在使用 NPS SQL Server 記錄來規劃 NPS 帳戶處理期間，您可以使用下列步驟。

- 判斷您或組織的其他成員是否有 SQL Server 2000 或 SQL Server 2005 關係資料庫開發經驗，並瞭解如何使用這些產品來建立、修改、管理和管理 SQL Server 資料庫。

- 判斷 SQL Server 是否安裝在 NPS 或遠端電腦上。

- 設計您將在 SQL Server 資料庫中使用的預存程式，以處理包含 NPS 計量資料的傳入 XML 檔案。

- 設計 SQL Server 資料庫複寫結構和流程。

- 決定您要用來查看帳戶處理資料和產生報告的應用程式。

- 規劃使用會在所有會計要求中傳送類別屬性的網路存取伺服器。 類別屬性會在「接受存取」訊息中傳送給 RADIUS 用戶端，適用于將帳戶處理要求訊息與驗證會話相互關聯。 如果類別屬性是由帳戶處理要求訊息中的網路存取伺服器所傳送，則可以用來比對帳戶處理和驗證記錄。 屬性唯一-序號、服務重新開機時間和伺服器位址的組合，必須是伺服器接受之每個驗證的唯一識別。

- 規劃使用支援暫時帳戶處理的網路存取伺服器。

- 規劃使用會傳送帳戶處理和帳戶處理關閉訊息的網路存取伺服器。

- 規劃使用支援儲存和轉送帳戶處理資料的網路存取伺服器。 當網路存取伺服器無法與 NPS 通訊時，支援這項功能的網路存取伺服器可以儲存計量資料。 當 NPS 可供使用時，網路存取伺服器會將儲存的記錄轉送至 NPS，藉由不提供這項功能的網路存取伺服器，提供更高的帳戶處理可靠性。

- 規劃一律在網路原則中設定 [帳戶過渡間隔] 屬性。 [帳戶-過渡間隔] 屬性會設定網路存取伺服器所傳送的每個暫時更新之間的間隔時間（以秒為單位）。 根據 RFC 2869，[帳戶-過渡間隔] 屬性的值不得小於60秒或一分鐘，而且不應小於600秒或10分鐘。 如需詳細資訊，請參閱 RFC 2869 的「RADIUS 延伸模組」。

- 確定已在您的 Nps 上啟用定期狀態記錄。

