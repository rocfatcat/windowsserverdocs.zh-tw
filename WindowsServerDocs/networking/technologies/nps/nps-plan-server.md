---
title: 將 NPS 作為 RADIUS 伺服器規劃
description: 本主題提供 Windows Server 2016 中的 < 規劃的網路原則伺服器 RADIUS 伺服器部署的相關資訊。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5fd89ef8d95735b8cbe1334ba51ed0059595dbc3
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839169"
---
# <a name="plan-nps-as-a-radius-server"></a>將 NPS 作為 RADIUS 伺服器規劃

>適用於：Windows Server （半年通道），Windows Server 2016

當您部署網路原則伺服器\(NPS\)為遠端驗證撥號使用者服務 (RADIUS) 伺服器，NPS 會執行驗證、 授權和帳戶處理連接要求的本機網域和網域本機網域信任的。 您可以使用下列規劃指導方針，以簡化您的 RADIUS 部署。

這些計劃的指導方針不包含您要部署 NPS 做為 RADIUS proxy 的情況。 當您部署 NPS 做為 RADIUS proxy 時，NPS 會轉寄連線要求到遠端網域、 不受信任的網域，或這兩者執行 NPS 或其他 RADIUS 伺服器的伺服器。 

將 NPS 部署為 RADIUS 伺服器的網路上之前，請使用下列指導方針來規劃您的部署。

- 計劃 NPS 設定。

- 規劃 RADIUS 用戶端。

- 規劃驗證方法使用。

- 規劃網路原則。

- 計劃 NPS 帳戶處理。

## <a name="plan-nps-configuration"></a>計劃 NPS 設定

您必須決定哪一個網域中的 NPS 是成員。 多重網域環境中，NPS 可以驗證它是成員的網域中的使用者帳戶以及信任 NPS 的本機網域的所有網域的認證。 若要讓 NPS 在授權程序期間讀取使用者帳戶撥入內容，您必須將 NPS 的電腦帳戶加入 RAS 及 NPSs 群組每個網域。

確定 NPS 的網域成員資格之後，伺服器必須設定 RADIUS 用戶端，也稱為 「 網路存取伺服器，使用 RADIUS 通訊協定與通訊。 此外，您可以設定的事件類型，NPS 記錄在事件記錄檔，您可以輸入伺服器的描述。

### <a name="key-steps"></a>主要步驟

在規劃 NPS 設定，您可以使用下列步驟。

- 判斷 NPS 用來接收自 RADIUS 用戶端的 RADIUS 訊息的 RADIUS 連接埠。 預設連接埠是 UDP 連接埠 1812年與 1645 用於 RADIUS 驗證訊息和連接埠 1813年與 1646 用於 RADIUS 帳戶處理訊息。

- 如果 NPS 設定為使用多張網路介面卡，判斷哪些您想要允許 RADIUS 流量的配接器。

- 決定您想要 NPS 事件記錄檔中記錄的事件類型。 您可以記錄已拒絕的驗證要求，成功的驗證要求或這兩種類型的要求。

- 決定您要部署多個 NPS。 若要提供 RADIUS 型驗證和帳戶處理的容錯功能，使用至少兩個 NPSs。 一個 NPS 做為主要 RADIUS 伺服器，另一個則用做為備份。 在這兩個 NPSs 然後設定每個 RADIUS 用戶端。 如果無法使用主要的 NPS，RADIUS 用戶端再傳送 Access-request 訊息給替代的 NPS。

- 規劃用來將一個 NPS 設定複製到其他 NPSs 儲存系統管理額外負荷，並防止不正確的設定伺服器的指令碼。 NPS 提供可讓您複製全部或一部分的 NPS 設定匯入到另一部 NPS 的 Netsh 命令。 您可以在 Netsh 提示字元中，以手動方式執行命令。 不過，如果您儲存在您的命令順序做為指令碼時，您可以在日後執行指令碼如果您決定變更伺服器組態。

## <a name="plan-radius-clients"></a>計劃 RADIUS 用戶端

RADIUS 用戶端網路存取伺服器，例如無線存取點、 虛擬私人網路 (VPN) 伺服器、 802.1 X 支援交換器和撥號伺服器。 RADIUS proxy，轉寄連線要求訊息到 RADIUS 伺服器，也是 RADIUS 用戶端。 NPS 支援所有的網路存取伺服器及 RADIUS proxy，符合 RADIUS 通訊協定，RFC 2865 「 遠端驗證撥入使用者服務 (RADIUS) 」 中所述及 RFC 2866「radius 「 RADIUS 計量 」。

>[!IMPORTANT]
>存取用戶端，例如用戶端電腦不是 RADIUS 用戶端。 只有網路存取伺服器和 proxy 伺服器可支援 RADIUS 通訊協定是 RADIUS 用戶端。

此外，無線存取點及交換器必須能夠 802.1x 驗證。 如果您想要部署 「 可延伸驗證通訊協定\(EAP\)或 受保護的可延伸驗證通訊協定\(PEAP\)，存取點及交換器必須支援使用 EAP。

若要測試的無線存取點的 PPP 連線的基本交互操作性，設定的存取點和存取用戶端使用密碼驗證通訊協定 (PAP)。 使用其他以 PPP 為基礎的驗證通訊協定，例如 PEAP，直到您已經測試過您想要使用的網路存取的項目。

### <a name="key-steps"></a>主要步驟

為 RADIUS 用戶端的規劃，您可以使用下列步驟。

- 您必須在 NPS 中設定文件特定廠商屬性 (Vsa)。 如果您的網路存取伺服器需要的 Vsa，記錄的 VSA 資訊供日後使用，當您在 NPS 中設定您的網路原則。 

- 文件 RADIUS 用戶端，以及您的 NPS 簡化的所有裝置組態的 IP 的位址。 當您部署您的 RADIUS 用戶端時，您必須設定他們使用 RADIUS 通訊協定中，輸入與驗證伺服器的 NPS IP 位址。 然後當您設定 NPS 與您的 RADIUS 用戶端通訊時，您必須輸入 RADIUS 用戶端 IP 位址 NPS 嵌入式管理單元。

- RADIUS 用戶端與 NPS 嵌入式管理單元，請建立組態的共用的密碼。 使用共用的密碼或密碼，您也將輸入至 NPS 嵌入式管理單元在 NPS 中設定 RADIUS 用戶端時，您必須設定 RADIUS 用戶端。

## <a name="plan-the-use-of-authentication-methods"></a>計劃使用的驗證方法

NPS 支援這兩個密碼為基礎和以憑證為基礎的驗證方法。 不過，並非所有的網路存取伺服器支援相同的驗證方法。 在某些情況下，您可能想要部署不同的驗證方法為基礎的網路存取類型。

例如，您可能要部署無線及 VPN 存取權，為您的組織，但使用不同的驗證方法來存取每一種：EAP TLS VPN 連線，因為具有傳輸層安全性 (EAP-TLS) 的 EAP 提供，增強式安全性和 802.1x 無線連線的 PEAP MS-CHAP v2。

PEAP 與 Microsoft Challenge Handshake 驗證通訊協定版本 2 (PEAP MS-CHAP v2) 提供一個功能稱為快速重新連線，專為搭配可攜式電腦和其他無線裝置。 快速重新連線可讓無線用戶端它們關聯新存取點而不需要重新驗證每次在相同網路上的無線存取點之間移動。 這會為無線使用者提供更好的體驗，並允許它們而不必重新輸入其認證的存取點之間移動。
因為快速重新連線和安全性，PEAP MS-CHAP v2 提供，PEAP MS-CHAP v2 做為無線連線的驗證方法是合理的選擇。

針對 VPN 連線，EAP-TLS 是提供保護網路流量，即使在從住家或行動電腦到您組織的 VPN 伺服器在網際網路上傳輸的增強式安全性的憑證型驗證方法。

### <a name="certificate-based-authentication-methods"></a>憑證型驗證方法

憑證型驗證方法的優點是提供增強式安全性;而且他們的缺點是更難部署比密碼型驗證方法。

PEAP MS-CHAP v2 與 EAP-TLS 憑證式驗證方法，但有許多差異以及部署所在的方式。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS 使用憑證進行用戶端和伺服器驗證，而且需要您在組織中部署公開金鑰基礎結構 (PKI)。 部署 PKI 可能很複雜，並需要計劃的階段無關的規劃 NPS 作為 RADIUS 伺服器。

使用 EAP-TLS，NPS 會註冊伺服器憑證的憑證授權單位\(CA\)，和憑證會儲存在本機電腦憑證存放區中。 在驗證過程中，NPS 會將其伺服器憑證傳送至存取用戶端存取用戶端證明其識別身分進行伺服器驗證。 存取用戶端會檢查以判斷憑證是否有效且適合使用伺服器驗證期間的各種憑證內容。 如果伺服器憑證符合最小的伺服器憑證需求，以及存取用戶端所信任的 CA 所發出，則 NPS 是成功驗證的用戶端中。

同樣地，用戶端驗證過程中發生驗證時用戶端會將其用戶端憑證給 NPS 證明其識別身分的 NPS。 NPS 會檢查憑證，而且如果用戶端憑證符合最低用戶端憑證需求，以及由 NPS 信任的 CA 所發出，存取用戶端會驗證成功 nps。

雖然需要伺服器憑證會儲存在 NPS 上的憑證存放區中，用戶端或使用者憑證可以儲存在其中一個憑證存放區用戶端或智慧卡上。

驗證處理序中才會成功，它是必要的所有電腦會在本機電腦和目前使用者的受信任的根憑證授權單位憑證存放區中都有您組織的 CA 憑證。

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP MS-CHAP v2 會使用憑證進行伺服器驗證和使用者驗證的密碼認證。 因為憑證只用於伺服器驗證，您不需要部署 PKI，才能使用 PEAP MS-CHAP v2。 當您部署 PEAP MS-CHAP v2 時，則您可以在下列兩種方式之一來取得 nps 伺服器憑證：

- 您可以安裝 NPSs Active Directory 憑證服務 (AD CS)，然後按一下 自動註冊憑證。 如果您使用這個方法時，您也必須註冊 CA 憑證，用戶端電腦連線到網路，以便他們信任的憑證發行給 NPS。

- 您可以從例如 VeriSign 公用 CA 購買伺服器憑證。 如果您使用這個方法時，請確定您選取用戶端電腦已經信任的 CA。 若要判斷用戶端電腦是否信任的 CA，請開啟 憑證 Microsoft Management Console (MMC) 嵌入式管理單元的用戶端電腦上，然後檢視 受信任的根憑證授權單位存放區為本機電腦和目前的使用者。 如果沒有這些憑證存放區中 CA 的憑證，用戶端電腦會信任 CA，進而信任由 CA 所核發的任何憑證。

在驗證過程中使用 PEAP MS-CHAP v2，NPS 會將其伺服器憑證傳送到用戶端電腦進行伺服器驗證。 存取用戶端會檢查以判斷憑證是否有效且適合使用伺服器驗證期間的各種憑證內容。 如果伺服器憑證符合最小的伺服器憑證需求，以及存取用戶端所信任的 CA 所發出，則 NPS 是成功驗證的用戶端中。

使用者驗證發生於使用者嘗試連線到的網路類型密碼型認證，並嘗試將登入。 NPS 收到的認證，並執行驗證和授權。 如果使用者已驗證及授權成功，而且用戶端電腦成功驗證 NPS，則會授與連線要求。

### <a name="key-steps"></a>主要步驟

使用的驗證方法的規劃，您可以使用下列步驟。

- 找出您打算提供，例如無線、 VPN、 802.1 X 支援交換器的網路存取和撥號存取的類型。

- 決定您想要用於每一種存取方法的驗證方法。 建議您使用憑證式驗證方法，提供增強式安全性;不過，它可能不夠實際要部署的 PKI，讓其他驗證方法可能會提供較佳的平衡，您需要為您的網路。

- 如果您要部署 EAP-TLS，計劃 PKI 部署。 這包括規劃您要使用伺服器憑證和用戶端電腦憑證的憑證範本。 它也包含決定如何註冊網域成員與非網域成員電腦，並判斷您是否想要使用智慧卡的憑證。

- 如果您要部署 PEAP MS-CHAP v2，判斷是否要安裝 AD CS 發出伺服器憑證，您 NPSs 或是否要從公用 CA，例如 VeriSign 購買伺服器憑證。

### <a name="plan-network-policies"></a>規劃網路原則

NPS 會使用網路原則，以判斷是否已獲授權接收自 RADIUS 用戶端的連線要求。 NPS 也會使用使用者帳戶撥入內容的授權決定。

因為 NPS 嵌入式管理單元的出現順序來處理網路原則，打算先放置您最嚴格的原則，在原則清單中。 針對每個連接要求時，NPS 會嘗試比對條件的連線要求內容的原則。 NPS 會檢查在順序中的每個網路原則，直到找到相符項目。 如果找不到相符項目，則會拒絕連線要求。

### <a name="key-steps"></a>主要步驟

在規劃網路原則，您可以使用下列步驟。

- 判斷網路原則，最嚴格到最不嚴格的慣用的 NPS 處理順序。

- 判斷原則狀態。 原則狀態可以有的值，啟用或停用。 如果已啟用原則，NPS 會評估原則時執行授權。 如果未啟用此原則，則不會評估。

- 判斷原則類型。 您必須決定是否原則設計來授與的存取原則的條件符合連線要求，或原則拒絕存取時的連線要求符合原則的條件而設計。 例如，如果您想要明確拒絕的無線存取 Windows 群組的成員，您可以建立網路原則，指定群組中，無線網路連線方法中，而且有類型設定為 拒絕存取的原則。

- 決定是否要讓 NPS 在略過的原則所依據的群組成員的使用者帳戶撥入內容。 當未啟用此設定時，使用者帳戶撥入內容覆寫網路原則中設定的設定。 比方說，如果已設定網路原則授與存取權給使用者，但該使用者的使用者帳戶撥入內容設定為拒絕存取，使用者就會拒絕存取。 但是，如果您啟用的原則類型設定略過使用者帳戶撥入屬性中，相同的使用者會授與存取網路。

- 判斷原則是否使用原則的 [來源] 設定。 此設定可讓您輕鬆地指定所有存取要求的來源。 可能的來源為終端機服務閘道 （TS 閘道） 」、 「 遠端存取伺服器 （透過 VPN 或撥號） 」、 「 DHCP 伺服器 」、 「 無線存取點和 「 健康情況登錄授權單位伺服器。 或者，您可以指定廠商特定的來源。

- 決定要套用的網路原則的順序必須符合的條件。

- 決定如果連線要求符合網路原則的條件會套用的設定。

- 決定您是否要使用、 修改或刪除預設網路原則。

## <a name="plan-nps-accounting"></a>計劃 NPS 帳戶處理

NPS 提供三種格式登 RADIUS 帳戶處理資料，例如使用者驗證及帳戶處理要求的能力：IAS 格式、 資料庫相容的格式和 Microsoft SQL Server 記錄。 

IAS 格式和資料庫相容的格式建立本機 NPS 上的記錄檔中的文字檔案格式。 

SQL Server 記錄可記錄到 SQL Server 2000 或 SQL Server 2005 XML 相容的資料庫，擴充 RADIUS 帳戶處理來利用關聯式資料庫的記錄。

### <a name="key-steps"></a>主要步驟

用於 NPS 帳戶處理的規劃，您可以使用下列步驟。

- 判斷您是否要在記錄檔或 SQL Server 資料庫中儲存 NPS 帳戶處理資料。

### <a name="nps-accounting-using-local-log-files"></a>使用本機記錄檔的 NPS 帳戶處理

錄製使用者驗證和帳戶處理要求記錄檔中的主要用於連線分析及計費用途，並也可做為安全性調查工具，提供您方法，以追蹤惡意使用者之後的活動攻擊。

### <a name="key-steps"></a>主要步驟

用於 NPS 帳戶處理使用本機記錄檔的規劃，您可以使用下列步驟。

- 決定您想要用於 NPS 記錄檔的文字檔案格式。

- 選擇您想要記錄的資訊類型。 您可以記錄帳戶處理要求、 驗證要求，以及定期狀態。

- 決定您想要用來儲存您的記錄檔的硬碟位置。

- 設計您的記錄檔備份解決方案。 您用來儲存您的記錄檔的硬碟位置應該是可讓您輕鬆地將您的資料備份的位置。 此外，藉由設定儲存的記錄檔的資料夾存取控制清單 (ACL) 應受到保護的硬碟位置。

- 決定您想要建立新的記錄檔的頻率。 如果您想要根據檔案大小建立記錄檔，判斷允許 nps 建立新的記錄檔之前的最大檔案大小。

- 決定是否要刪除較舊的記錄檔，如果儲存空間用盡硬碟的 NPS。

- 決定您想要使用以檢視計量資料，並產生報告的應用程式的應用程式。

### <a name="nps-sql-server-logging"></a>NPS SQL 伺服器記錄

您需要工作階段狀態資訊，用於建立報表和資料分析用途，並集中和簡化管理的帳戶處理資料時，會使用 NPS SQL 伺服器記錄。

NPS 提供使用 SQL Server 記錄到記錄的使用者驗證和帳戶處理要求，從一或多個網路存取伺服器接收到執行 Microsoft SQL Server Desktop Engine 的電腦上的資料來源的能力\(MSDE 2000\)，或任何版本的 SQL Server 晚於 SQL Server 2000。

計量資料會從傳遞 NPS 以 XML 格式預存的程序，在資料庫中，支援這兩個結構化的查詢語言\(SQL\)和 XML \(SQLXML\)。 錄製使用者驗證和帳戶處理 XML 相容的 SQL Server 資料庫中的要求可讓多個 NPSs 有一個資料來源。

### <a name="key-steps"></a>主要步驟

在計劃期間用於 NPS 帳戶處理使用 NPS SQL Server 記錄功能，您可以使用下列步驟。

- 判斷您或您組織的另一個成員是否有 SQL Server 2000 或 SQL Server 2005 的關聯式資料庫開發體驗，而且您了解如何使用這些產品，來建立、 修改、 管理和管理 SQL Server 資料庫。

- 決定是否要在 NPS 上或遠端電腦上，安裝 SQL Server。

- 設計預存程序，您會使用 SQL Server 資料庫中，來處理傳入的 XML 檔案包含 NPS 帳戶處理資料。

- 設計的 SQL Server 資料庫複寫結構與流程。

- 決定您想要使用以檢視計量資料，並產生報告的應用程式的應用程式。

- 規劃使用網路存取伺服器傳送的類別屬性中所有的帳戶處理要求。 類別屬性傳送到 RADIUS 用戶端在 Access-accept 訊息中，並可用於驗證的工作階段相互關聯 Accounting-request 訊息。 如果在帳戶處理要求訊息中的網路存取伺服器傳送的類別屬性，它可用來比對的帳戶處理及驗證的記錄。 屬性唯一-序號服務重新開機時間和伺服器位址的組合必須是伺服器接受每次驗證的唯一識別。

- 規劃使用網路存取伺服器支援過渡期的計量。

- 計劃使用帳戶處理開啟及帳戶處理關閉訊息傳送的網路存取伺服器。

- 規劃使用網路存取伺服器，支援儲存和轉送的計量資料。 網路存取伺服器無法與 NPS 通訊時，支援這項功能的網路存取伺服器可以儲存計量資料。 當 NPS 可用時，網路存取伺服器轉送給預存的記錄 NPS 中，透過網路存取伺服器不提供這項功能提供提升的可靠性，在 帳戶處理。

- 若要一律在網路原則中設定 Acct 過渡間隔屬性的計劃。 Acct 過渡間隔屬性會設定間隔 （以秒為單位） 之間的網路存取伺服器傳送的每個過渡期更新。 根據 RFC 2869 Acct 過渡間隔屬性的值不得小於 60 秒或一分鐘的時間，並不能小於 600 秒或 10 分鐘的時間。 如需詳細資訊，請參閱 RFC 2869，「 RADIUS 擴充功能。 」

- 確定定期狀態記錄已啟用您 NPSs 上。

