---
ms.assetid: ''
title: 追蹤的 Windows 時間
description: 許多磁區中的法規都需要系統能夠追蹤到 UTC。  這表示系統的位移可以與 UTC 相對證明。
author: shortpatti
ms.author: dacuo
manager: dougkim
ms.date: 10/17/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 307739042426088fa92c50e6ea4dc5d2a744f15a
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405217"
---
# <a name="windows-time-for-traceability"></a>追蹤的 Windows 時間
>適用於：Windows Server 2016 1709 版或更新版本，以及 Windows 10 1703 或更新版本


許多磁區中的法規都需要系統能夠追蹤到 UTC。  這表示系統的位移可以與 UTC 相對證明。  若要啟用法規遵循案例，Windows 10 （1703版或更高版本）和 Windows Server 2016 （1709版或更高版本）提供新的事件記錄檔，以從作業系統的角度提供一張圖片，以構成對所採取之動作的瞭解系統時鐘。  這些事件記錄檔會持續針對 Windows 時間服務產生，並可加以檢查或封存以供日後分析。

這些新的事件可讓您回答下列問題：

* 系統時鐘是否已改變
* 是否已修改時鐘頻率
* Windows 時間服務設定是否已修改

## <a name="availability"></a>可用性

這些改良功能包含在 Windows 10 1703 版或更高版本，以及 Windows Server 2016 1709 或更高版本中。

## <a name="configuration"></a>組態

不需要進行任何設定，就能實現這項功能。  這些事件記錄檔預設會啟用，而且可以在 [**應用程式和服務 Log\Microsoft\Windows\Time-Service\Operational** ] 通道下的 [事件檢視器] 中找到。


## <a name="list-of-event-logs"></a>事件記錄檔清單

下一節將概述記錄在可追蹤性案例中使用的事件。

# <a name="257tab257"></a>[257](#tab/257)
當 Windows 時間服務（W32Time）啟動時，會記錄此事件，並記錄目前時間、目前滴答計數、執行時間設定、時間提供者和目前時脈速率的相關資訊。

|||
|---|---|
|事件描述 |服務啟動 |
|詳細資料 |在 W32time 啟動時發生 |
|記錄的資料 |<ul><li>目前時間（UTC）</li><li>目前的滴答計數</li><li>W32Time 設定</li><li>時間提供者設定</li><li>頻率</li></ul> |
|節流機制  |無。 每次服務啟動時，就會引發這個事件。 |

**範例:**
```
W32time service has started at 2018-02-27T04:25:17.156Z (UTC), System Tick Count 3132937.
```

**命令：**

您也可以使用下列命令來查詢這項資訊

*W32Time 和時間提供者設定*
```
w32tm.exe /query /configuration
```

*頻率*
```
w32tm.exe /query /status /verbose
```


# <a name="258tab258"></a>[258](#tab/258)
當 Windows 時間服務（W32Time）停止時，會記錄此事件，並記錄目前時間和滴答計數的相關資訊。

|||
|---|---|
|事件描述 |服務停止 |
|詳細資料 |在 W32time 關機時發生 |
|記錄的資料 |<ul><li>目前時間（UTC）</li><li>目前的滴答計數</li></ul> |
|節流機制  |無。 每次服務停止時，就會引發此事件。 |

**範例文字：** 
`W32time service is stopping at 2018-03-01T05:42:13.944Z (UTC), System Tick Count 6370250.`

# <a name="259tab259"></a>[259](#tab/259)
此事件會定期記錄其目前的時間來源清單及其選擇的時間來源。  此外，它也會記錄目前的滴答計數。  每當時間來源變更時，就不會引發此事件。  本檔稍後列出的其他事件會提供這項功能。

|||
|---|---|
|事件描述 |NTP 用戶端提供者定期狀態 |
|詳細資料 |NTP 用戶端所使用的時間來源清單 |
|記錄的資料 |<ul><li>可用的時間來源</li><li>記錄時所選擇的參考時間伺服器</li><li>目前的滴答計數</li></ul>  |
|節流機制  |每8小時記錄一次。 |

**範例文字：** NTP 用戶端提供者定期狀態：

Ntp 用戶端接收來自下列 NTP 伺服器的時間資料：

server1. fabrikam .com，0x8 （ntp. m | 0x8 | [：：]： 123-> [IPAddress]：123） server2 .com，0x8 （ntp | 0x8 | [：：]： 123-> [IPAddress]：123）; 而選擇的參考時間伺服器是 Server1. fabrikam .com，0x8 （ntp | 0x8 | [：：]： 123-> [IPAddress]：123）（RefID：0x08d6648e63）。 系統滴答計數13187937

**命令**您也可以使用下列命令來查詢這項資訊

*識別對等*
`w32tm.exe /query /peers`

# <a name="260tab260"></a>[260](#tab/260)

|||
|---|---|
|事件描述 |時間服務設定和狀態 |
|詳細資料 |W32time 會定期記錄其設定和狀態。 這相當於呼叫：<br><br>`w32tm /query /configuration /verbose`<br>或<br>`w32tm /query /status /verbose` |
|節流機制  |每8小時記錄一次。 |

# <a name="261tab261"></a>[261](#tab/261)
當使用 SetSystemTime API 修改系統時間時，這會記錄每個實例。

|||
|---|---|
|事件描述 |已設定系統時間 |
|節流機制  |無。<br><br>這種情況在具有合理時間同步處理的系統上很少發生，而且我們想要在每次發生時加以記錄。 我們會在記錄此事件時忽略 TimeJumpAuditOffset 設定，因為該設定的目的是要在 Windows 系統事件記錄檔中節流事件。 |

# <a name="262tab262"></a>[262](#tab/262)

|||
|---|---|
|事件描述 |系統時鐘頻率已調整 |
|詳細資料 |當時鐘處於關閉同步處理時，W32time 會持續修改系統時鐘頻率。 我們想要在不 overrunning 事件記錄檔的情況下，捕獲對時鐘頻率的「合理」調整。 |
|節流機制  |不會記錄低於 TimeAdjustmentAuditThreshold 的所有時鐘調整（分鐘 128 = 每百萬個部分，預設 = 800 個部分）。<br><br>2 PPM 使用目前細微性進行的頻率變更時，時鐘精確度會產生120微秒/秒變更。<br><br>在同步處理的系統上，大部分的調整都會低於此層級。 如果您想要更細微的追蹤，可以調整這項設定，或者您可以使用 PerfCounters，或者兩者都可以。 |

# <a name="263tab263"></a>[263](#tab/263)

|||
|---|---|
|事件描述 |變更時間服務設定或載入的時間提供者清單。 |
|詳細資料 |重新讀取 W32time 設定可能會導致在記憶體中修改某些重要的設定，而這可能會影響時間同步處理的整體精確度。<br><br>在重新讀取其設定時，W32time 會記錄每個發生的問題，這會對時間同步處理造成潛在的影響。 |
|節流機制  |無。<br><br>只有在系統管理員或 GP 更新變更時間提供者，然後觸發 W32time 時，才會發生此事件。 我們想要記錄每個設定的變更實例。 |


# <a name="264tab264"></a>[264](#tab/264)

|||
|---|---|
|事件描述 |NTP 用戶端所使用的時間來源變更 |
|詳細資料 |當時間伺服器/對等變更狀態（**擱置-> 同步處理**、**同步 > 無法**連線或其他轉換）時，NTP 用戶端會使用時間伺服器/對等的目前狀態來記錄事件 |
|節流機制  |最大頻率-每5分鐘一次，以保護記錄不會受到暫時性問題和不正確的提供者執行的限制。 |

# <a name="265tab265"></a>[265](#tab/265)

|||
|---|---|
|事件描述 |時間服務來源或層次號碼變更 |
|詳細資料 |W32time 時間來源和層次編號是時間追蹤的重要因素，而且必須記錄這些變更。 如果 W32time 沒有時間來源，而且您尚未將其設定為可靠的時間來源，則會停止廣告做為時間伺服器，並以設計方式回應具有某些無效參數的要求。 此事件對於追蹤 NTP 拓撲中的狀態變更而言非常重要。 |
|節流機制  |無。 |


# <a name="266tab266"></a>[266](#tab/266)

|||
|---|---|
|事件描述 |要求重新同步處理時間 |
|詳細資料 |這會觸發此操作：<ul><li>發生網路變更時</li><li>系統從連線待命/休眠狀態返回</li><li>當我們未同步處理很長一段時間時</li><li>系統管理員發出重新同步命令</li></ul>這項作業會導致立即失去微調時間同步精確度，因為它會造成 NTP 用戶端清除其篩選器。 |
|節流機制  |最大頻率-每5分鐘一次。<br><br>壞的網路卡（或不良的腳本）可能會重複觸發此作業，並導致記錄檔變得不知所措。 因此，必須對此事件進行節流。<br><br>請注意，精確的時間同步處理需要5分鐘以上才能達成，而節流不會遺失導致時間精確度遺失之原始事件的相關資訊。  |

---
