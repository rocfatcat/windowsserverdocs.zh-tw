---
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Windows 時間服務的運作方式
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: 67c3471a726df354e0faa9e3aced491c4084e9e3
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59864339"
---
# <a name="how-the-windows-time-service-works"></a>Windows 時間服務的運作方式

>適用於：Windows Server 2016 中，Windows Server 2012 R2，Windows Server 2012 中，Windows 10 或更新版本

**這一節**  
  
-   [Windows Time 服務架構](#w2k3tr_times_how_rrfo)  
  
-   [Windows 時間服務時間通訊協定](#w2k3tr_times_how_ekoc)  
  
-   [Windows 時間服務程序和互動](#w2k3tr_times_how_izcr)  
  
-   [Windows 時間服務所使用的網路連接埠](#w2k3tr_times_how_ydum)  
  
> [!NOTE]  
> 本主題說明僅 Windows 時間服務 (W32Time) 的運作方式。 如需有關如何設定 Windows 時間服務的資訊，請參閱 <<c0> [ 設定為高精確度的系統](configuring-systems-for-high-accuracy.md)。
  
> [!NOTE]  
> 在 Windows Server 2003 和 Microsoft Windows 2000 Server 中，目錄服務稱為 Active Directory 目錄服務。 在 Windows Server 2008 和更新版本中，目錄服務稱為 Active Directory 網域服務 (AD DS)。 本主題的其餘部分請參閱 AD DS，但這項資訊也適用於 Active Directory。  
  
雖然 Windows 時間服務不是實際的實作的網路時間通訊協定 (NTP)，它會使用複雜的演算法套件，以確保在整個網路的電腦上的時鐘會盡可能精確的 NTP 規格中定義。 在理想情況下，AD DS 網域中的所有電腦時鐘與授權的電腦的時間都同步。 許多因素可能會影響網路上的時間同步處理。 下列因素通常會影響同步處理 AD DS 中的精確度：  
  
-   網路狀況  
  
-   電腦的硬體時鐘的精確度  
  
-   Windows 時間服務可用的 CPU 和網路資源數量  
  
> [!IMPORTANT]  
> 在 Windows Server 2016 之前, W32Time 服務並非設計時間緊迫的應用程式的需求。  不過，Windows Server 2016 的更新現在可讓您實作的解決方案 1 毫秒精確度您網域中的。  請參閱[Windows 2016 正確時間](accurate-time.md)並[來設定 Windows 時間服務的高精確度的環境支援界限](support-boundary.md)如需詳細資訊。  
  
設定同步處理其時間小於常見問題，或未加入網域的電腦，根據預設，與 time.windows.com 同步處理。  因此，很難保證在有間歇性的電腦或沒有網路連線的時間精確度。  
  
AD DS 樹系有預定的時間同步處理階層。 Windows 時間服務同步處理與頂端最精確的參考時鐘在階層中的電腦之間的時間。 如果在電腦上設定一個以上的時間來源，Windows 時間就會使用 NTP 演算法來選取最佳的時間來源為基礎的電腦能夠與該時間來源同步處理來源設定。 Windows 時間服務不支援網路廣播或多點傳送的對等電腦的同步處理。 如需這些 NTP 功能的詳細資訊，請參閱 RFC 1305 IETF RFC 資料庫中。  
  
每一部執行 Windows 時間服務的電腦會使用服務，以維護最準確的時間。 根據預設，所做為時間用戶端屬於網域成員電腦，因此，在大部分情況下不需要設定 Windows 時間服務。 不過，Windows 時間服務可以設定為指定的參考時間來源，從要求的時間，而且也可以提供給用戶端的時間。
  
電腦的時間是正確的程度就稱為 stratum。 最低 stratum 層級或其中一個 stratum，都會佔用最精確的時間來源 （例如硬體時鐘） 在網路上。 此準確的時間來源被稱為參考時鐘。 取得直接從參考的時鐘時間的 NTP 伺服器都會佔用一個層級高於參考時鐘 stratum。 取得時間從 NTP 伺服器的資源是兩個步驟，即可參考日以繼夜地和因此佔用是兩個 stratum 高於最精確的時間來源，等等。 電腦 stratum 數字會增加，它的系統時鐘的時間可能會較不精確。 因此，任何電腦的 stratum 層級是程度最精確的時間來源同步處理該電腦的指標。  
  
當 W32Time Manager 收到時間範例時，它會使用特殊的演算法中 NTP 判斷哪一個時間範例為最適合使用。 時間服務也會使用另一組演算法來決定哪一個設定的時間來源最精確的。 時的時間服務判定是哪一個時間範例，根據上述的準則，它就會調整的本機電腦時鐘速率，以允許它整合正確的時間。 如果本機電腦時鐘與選取的精確時間範例 （也稱為時間扭曲） 之間的時間差異太大，無法藉由調整的本機電腦時鐘速度更正，時間服務會設定本機電腦時鐘到正確的時間。 這項調整時鐘速度或直接的時鐘時間的變更稱為時鐘專業領域。  
  
## <a name="w2k3tr_times_how_rrfo"></a>Windows Time 服務架構  
Windows 時間服務是由下列元件所組成：  
  
-   服務控制管理員  
  
-   Windows 時間服務管理員  
  
-   時鐘專業領域  
  
-   時間提供者  
  
下圖顯示 Windows 時間服務的架構。  
  
**Windows Time 服務架構**  
  
![Windows Time](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)
  
服務控制管理員會負責啟動和停止 Windows 時間服務。 Windows 時間服務管理員負責初始化 NTP 時間提供者隨附於作業系統的動作。 Windows 時間服務管理員控制的 Windows 時間服務的所有函式和所有時間樣本的聯合。 除了提供目前系統狀態資訊，例如目前的時間來源或最後一次系統時鐘已更新，Windows 時間服務管理員也會負責建立事件記錄檔中的事件。  
  
時間同步處理程序包含下列步驟：  
  
-   輸入提供者要求，並從設定 NTP 時間來源接收時間範例。  
  
-   這些時間範例接著會傳遞至 Windows 時間服務管理員，收集所有範例資料並將它們傳遞給時鐘的專業領域子元件。  
  
-   時鐘的專業領域子元件適用於 NTP 演算法會導致選取的最佳時間範例。  
  
-   時鐘專業領域子元件會調整系統時鐘指最準確的時間的時間，藉由調整時脈頻率，或直接變更時間。  
  
如果電腦已指定為時間伺服器，它可以傳送至要求在此程序中的任何時間點的時間同步處理的任何電腦的時間。  
  
## <a name="w2k3tr_times_how_ekoc"></a>Windows 時間服務時間通訊協定  

時間通訊協定決定程度兩部電腦的時鐘同步處理。 時間通訊協定負責判斷最佳的可用時間資訊，並結合以確保一致的時間會維護不同的系統上的時鐘。  
  
Windows 時間服務會使用網路時間通訊協定 (NTP)，來協助在網路上同步處理時間。 NTP 是網際網路時間通訊協定，其中包含所需的同步處理時鐘的專業領域演算法。 NTP 是更精確的時間通訊協定比簡單網路時間通訊協定 (SNTP)，可在部分版本的 Windows;不過 W32Time 會繼續支援 SNTP 啟用回溯相容性的執行 SNTP 為基礎的時間服務，例如 Windows 2000 的電腦。  
  
### <a name="network-time-protocol"></a>網路時間通訊協定  
網路時間通訊協定 (NTP) 是預設值的時間同步處理在作業系統中的 Windows 時間服務所使用的通訊協定。 NTP 是容錯、 高調整性的時間通訊協定，也是最常用於同步處理電腦時鐘，使用指定的時間參考的通訊協定。  
  
NTP 時間同步處理會發生一段時間，並牽涉到透過網路的 NTP 封包傳送。 NTP 封包會包含在用戶端和參與的伺服器上的時間範例納入同步處理時間的時間戳記。  
  
NTP 依賴參考時鐘來定義要使用最準確的時間，並同步處理所有參考時鐘網路上的時鐘。 NTP 通用的標準使用 Coordinated Universal Time (UTC)，目前的時間。 UTC 的時區無關，並讓 NTP 到時區設定不論全球任何地方使用。  
  
#### <a name="ntp-algorithms"></a>NTP 演算法  
NTP 包含兩種演算法、 時鐘篩選的演算法和時鐘選取演算法，以協助判斷最佳的時間範例 Windows 時間服務。 仔細檢查時間範例，接收來自查詢的時間來源，並判斷每個來源的最佳時間範例旨在時鐘篩選演算法。 將時鐘選取演算法接著會判斷網路上最精確的時間伺服器。 這項資訊接著會傳遞給時鐘的專業領域演算法，使用時的網路延遲和電腦的時鐘誤差所造成的錯誤補償更正電腦的本機電腦時鐘所收集的資訊中。  
  
NTP 演算法是在輕至中等網路和伺服器負載的情況下最正確的。 如同網路傳輸時間列入考量的任何演算法，NTP 演算法可能會不佳的極大的網路壅塞的情況下執行。 如需 NTP 演算法的詳細資訊，請參閱 RFC 1305 IETF RFC 資料庫中。  
  
#### <a name="ntp-time-provider"></a>NTP 時間提供者  
Windows 時間服務已完成的時間同步處理封裝可支援各種不同的硬體裝置和時間通訊協定。 若要啟用這項支援，服務會使用隨插即用的時間提供者。 時間提供者是負責任一取得準確的時間戳記 （從網路或硬體） 或透過網路提供給其他電腦的時間戳記。  
  
NTP 提供者是隨附於作業系統的標準時間提供者。 NTP 提供者遵循指定的 NTP 用戶端和伺服器，第 3 版和標準，而且可與 SNTP 用戶端和伺服器與 Windows 2000 和其他 SNTP 用戶端的回溯相容性互動。 NTP 中的提供者的 Windows 時間服務是由下列兩個部分所組成：  
  
-   **NtpServer 輸出提供者。** 這是為網路上用戶端要求的回應時間伺服器。  
  
-   **NtpClient 輸入提供者。** 這是時間用戶端會從其他來源的硬體裝置或 NTP 伺服器，取得時間資訊，可能會傳回可用於同步處理的本機時鐘時間範例。  
  
雖然這些兩個提供者的實際操作密切相關，它們會顯示獨立時間服務。 從 Windows 2000 Server、 Windows 電腦連線到網路時，它會設定為 NTP 用戶端。 此外，電腦執行 Windows 時間服務嘗試只與網域控制站或以手動方式指定的時間來源同步處理時間，依預設。 這些是時間的慣用的時間提供者，因為它們是時間的可供使用且安全來源。  
  
#### <a name="ntp-security"></a>NTP 安全性  

AD DS 樹系內的 Windows 時間服務依賴標準的網域安全性功能，可強制執行時間資料的驗證。 網域成員電腦與本機網域控制站做為時間伺服器之間傳送的 NTP 封包的安全性根據共用金鑰驗證。 Windows 時間服務會使用電腦的 Kerberos 工作階段金鑰來建立已驗證的簽章會透過網路傳送的 NTP 封包。 內部網路登入的安全通道時，就不會傳輸 NTP 封包。 相反地，當電腦從網域階層中的網域控制站要求時，Windows 時間服務需要驗證用的時間。 網域控制站然後已驗證來自 Net Logon 服務的工作階段金鑰的 64 位元值的形式傳回所需的資訊。 如果傳回的 NTP 封包不會使用電腦的工作階段金鑰進行簽署，或不正確地簽署，則會拒絕的時間。 所有這類驗證失敗會記錄在事件記錄檔。 如此一來，Windows 時間服務提供 AD DS 樹系中的 NTP 資料安全性。  
  
一般而言，Windows 時間用戶端會自動會取得準確的時間同步處理來自相同網域中的網域控制站。 在樹系中，子網域的網域控制站與在其父系網域的網域控制站同步處理時間。 時間伺服器傳回時已驗證的 NTP 封包到用戶端要求時，封包會簽署透過網域間信任帳戶所定義的 Kerberos 工作階段金鑰。 新的 AD DS 網域加入樹系，和 Net Logon 服務所管理的工作階段金鑰時，會建立網域間信任帳戶。 如此一來，在樹系根網域中設定為可靠的網域控制站會成為所有父和子網域的網域控制站和間接網域樹狀目錄中的所有電腦的已驗證的時間來源。  
  
Windows 時間服務可以設定為樹系之間運作，但請務必注意，此設定不安全。 比方說，NTP 伺服器可能使用不同的樹系中。 不過，因為該電腦位於不同的樹系中，是用來簽署與驗證 NTP 封包沒有 Kerberos 工作階段金鑰。 若要取得準確的時間同步處理，從不同的樹系中的電腦，用戶端必須對該電腦的網路存取，時間服務必須設定為使用其他樹系中的特定時間來源。 如果用戶端以手動方式設定為存取時間從自己的網域階層外的 NTP 伺服器，用戶端和伺服器之間傳送時間的 NTP 封包未經過驗證，，，因此不安全。 即使有樹系信任的實作中，Windows 時間服務並不安全跨樹系。 雖然 Net Logon 的安全通道是 Windows 時間服務的驗證機制，但不支援跨樹系的驗證。  
  
#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>Windows 時間服務所支援的硬體裝置  
硬體架構的時鐘，例如 GPS 或無線電時鐘通常會用為高度精確的參考時鐘裝置中。 根據預設，Windows 時間服務 NTP 時間提供者不支援直接連線到電腦的硬體裝置，雖然可以建立以軟體為基礎獨立的時間提供者支援此類型的連線。 這種類型的提供者，搭配 Windows 時間服務，可以提供的可靠且穩定階段參考。  
  
硬體裝置，例如 cesium 時鐘或全球定位系統 (GPS) 接收者，遵循標準，以取得正確定義的時間，提供正確的目前時間。 Cesium 時鐘極為穩定並不會受到一些因素，例如溫度、 壓力、 或溼度，但也是非常耗費資源。 GPS 接收器運作更便宜，同時也是正確的參考時鐘。 GPS 接收器會取自取自 cesium 時鐘時間的附屬組件中的時間。 而不是獨立的時間提供者使用，Windows 時間伺服器可以藉由連接到外部 NTP 伺服器，透過電話或網際網路連接到在硬體裝置取得它們的時間。 例如美國海軍天文台的組織提供連接到極為可靠的參考時鐘的 NTP 伺服器。  
  
許多的 GPS 接收器和其他時間裝置可以當做網路上的 NTP 伺服器。 您可以設定您的 AD DS 樹系同步處理從這些外部硬體裝置的時間，同時也扮演網路上的 NTP 伺服器時，才。 若要這樣做，請設定網域控制站做為主要網域控制站 (PDC) 模擬器，您要與 GPS 裝置所提供的 NTP 伺服器同步處理的樹系根目錄中。 若要這樣做，請參閱[樹系根網域中的 PDC 模擬器上設定 Windows 時間服務](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)。  
  
### <a name="simple-network-time-protocol"></a>簡易網路時間通訊協定  
簡單的網路時間通訊協定 (SNTP) 是精確度的簡化的時間通訊協定，以供伺服器和用戶端不需要的程度 NTP 提供。 SNTP，NTP 的更基本版本是 Windows 2000 中使用的主要階段通訊協定。 SNTP 和 NTP 的網路封包格式完全相同，因為兩種通訊協定是互通的。 這兩個主要差異是 SNTP 沒有複雜的篩選系統 NTP 提供與錯誤管理。 如需簡易網路時間通訊協定的詳細資訊，請參閱 RFC 1769 IETF RFC 資料庫中。  
  
### <a name="time-protocol-interoperability"></a>時間通訊協定互通性  
Windows 時間服務可以在執行 Windows 2000，Windows XP 和 Windows Server 2003 之電腦的混合式環境中操作，因為 Windows 2000 中使用的 SNTP 通訊協定是與 Windows XP 和 Windows Server 2003 中的 NTP 通訊協定互通。  
  
在 Windows NT Server 4.0 中，稱為 TimeServ，時間服務同步處理 Windows NT 4.0 網路上的時間。 TimeServ 是附加元件提供的功能做為屬於*Microsoft Windows NT 4.0 Resource Kit*並不提供 Windows Server 2003 所需的時間同步處理的可靠性程度。  
  
Windows 時間服務可以與執行 Windows NT 4.0，因為它們可以執行 Windows 2000 或 Windows Server 2003; 的電腦與同步處理時間的電腦相互作用不過，執行 Windows 2000 或 Windows Server 2003 的電腦不會自動探索 Windows NT 4.0 時間伺服器。 例如，如果您的網域設定為使用網域階層式方法，以同步處理來同步處理時間，而且您想要同步處理時間，與 Windows NT 4.0 網域控制站的網域階層中的電腦，您必須設定這些項目以手動方式來同步處理與 Windows NT 4.0 網域控制站的電腦。  
  
Windows NT 4.0 會使用簡單的機制，比 Windows 時間服務所使用的時間同步處理。 因此，若要確保準確的時間同步處理，透過您的網路，建議您將任何 Windows NT 4.0 網域控制站升級為 Windows 2000 或 Windows Server 2003。  
  
## <a name="w2k3tr_times_how_izcr"></a>Windows 時間服務程序和互動  

Windows 時間服務被設計來在網路上電腦的時鐘進行同步處理。 網路時間同步處理程序，也稱為 「 時間聚合，就會發生在網路為每個電腦的存取時間更精確的時間伺服器。 時間聚合牽涉到的授權伺服器提供 NTP 封包的形式的用戶端電腦的目前時間的程序。 封包中提供的資訊會指出是否需要調整，讓它更精確的伺服器與同步處理，會對電腦的目前時鐘時間。  
  
時間整合程序的一部分，網域成員會嘗試與位於相同網域中任何網域控制站同步處理時間。 如果電腦是網域控制站，它會嘗試與更多授權的網域控制站同步處理。  
  
只有 Windows XP Home Edition 或未加入網域的電腦執行的電腦不會嘗試與網域階層中，同步處理，但根據預設，若要取得從 time.windows.com 的時間會設定。  
  
若要建立執行 Windows Server 2003 做授權的電腦，電腦必須設定為可靠時間來源。 根據預設，會安裝在 Windows Server 2003 網域的第一個網域控制站會自動設定為可靠時間來源。 因為它是網域系統授權的電腦時，它必須設定為同步處理與外部時間來源，而非網域階層中。 也根據預設，所有其他成員的 Windows Server 2003 網域會設定為網域階層與同步處理。  
  
您已建立的 Windows Server 2003 網路之後，您可以設定下列選項的其中一個用於同步處理 Windows 時間服務：  
  
-   網域階層架構的同步處理  
  
-   手動指定的同步處理來源  
  
-   所有可用的同步處理機制  
  
-   任何同步處理。  
  
每個同步處理類型是由下列一節所述。  
  
### <a name="domain-hierarchy-based-synchronization"></a>網域階層架構的同步處理  

以網域階層為基礎的同步處理會使用 AD DS 網域階層找不到可靠的來源用來同步處理時間。 Windows 時間服務根據網域階層，決定每個時間伺服器的精確度。 Windows Server 2003 樹系中保留主要網域控制站 (PDC) 模擬器操作主機角色，位於樹系根網域的電腦會保留最佳的時間來源的位置，除非已設定另一個可靠時間來源。 下圖說明網域階層中的電腦之間的時間同步處理的路徑。  
  
**在 AD DS 階層中的時間同步處理**  
![Windows 時間](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_ntw_adhc.gif)
  
#### <a name="reliable-time-source-configuration"></a>可靠的時間來源設定  
設定為可靠時間來源的電腦識別為時間服務的根目錄。 時間服務的根目錄是網域的授權伺服器，並且通常會設定來擷取外部 NTP 伺服器或硬體裝置的時間。 時間伺服器可以設定為可靠時間來源，以最佳化時間在整個網域階層中的傳輸方式。 如果網域控制站設定為可靠時間來源，Net Logon 服務會在宣告該網域控制站做為可靠時間來源登入網路時。 當時間來源同步處理與尋找其他網域控制站時，請他們選擇的可靠來源先如果有的話。  
  
#### <a name="time-source-selection"></a>選擇的時間來源  
時間來源選取程序可以在網路上建立兩個問題：  
  
-   額外的同步處理循環。  
  
-   在 網路流量增加的磁碟區。  
  
當時間維持一致的網域控制站的群組，並持續而不需要與其他的可靠時間來源的重新同步處理兩者之間共用相同的時間，就會發生同步處理網路中的循環。 Windows 時間服務的時間來源選取演算法被設計來防止這類問題。  
  
電腦會使用下列方法之一來識別與同步處理的時間來源：  
  
-   如果電腦不是網域的成員，它必須與指定的時間來源同步處理設定。  
  
-   如果電腦是成員伺服器或工作站，在網域中，根據預設，它會遵循 AD DS 階層，並與它目前正在執行的 Windows Time 服務的本機網域的網域控制站同步處理的時間。  
  
如果電腦是網域控制站，它會讓最多六個的查詢，以找出與同步處理的另一個網域控制站。 每個查詢設計來識別特定的屬性，例如網域控制站，特定的位置，類型為時間來源，而且是否為可靠時間來源。 時間來源也必須遵守下列限制：  
  
-   在父系網域的網域控制站時，可以只同步處理可靠時間來源。  
  
-   PDC 模擬器可以使用它自己網域中的可靠時間來源或在父系網域中任何網域控制站同步處理。  
  
如果網域控制站無法同步處理正在查詢的網域控制站的型別，則查詢不會進行。 網域控制站會知道它可以取得時間，才進行查詢的電腦的型別。 比方說，本機的 PDC 模擬器不會嘗試查詢數字三或六個因為網域控制站不會嘗試與本身進行同步處理。  
  
下表列出的網域控制站可尋找時間來源，以及所做之查詢的順序。  
  
**網域控制站時間來源查詢**  
  
|查詢數目|網域控制站|Location|時間來源的可靠性|  
|----------------|---------------------|------------|------------------------------|  
|1|父系網域控制站|在 站台|偏好可靠時間來源，但它可以與同步處理不可靠的時間來源時，所有可用。|  
|2|本機網域控制站|在 站台|只會與可靠時間來源同步。|  
|3|本機 PDC 模擬器|在 站台|不適用。<br /><br />網域控制站不會嘗試與本身進行同步處理。|  
|4|父系網域控制站|站台外|偏好可靠時間來源，但它可以與同步處理不可靠的時間來源時，所有可用。|  
|5|本機網域控制站|站台外|只會與可靠時間來源同步。|  
|6|本機 PDC 模擬器|站台外|不適用。<br /><br />網域控制站不會嘗試與本身進行同步處理。| 
  
**注意**  
  
-   電腦永遠不會同步處理與本身。 如果嘗試同步處理的電腦本機的 PDC 模擬器，它不會嘗試查詢 3 或 6。  
  
每個查詢會傳回一份可用來做為時間來源的網域控制站。 Windows 時間指派每個網域控制站被查詢的可靠性和網域控制站的位置為基礎的分數。 下表列出每種類型的網域控制站的 Windows 時間所指派的分數。  
  
**分數判斷**  
  
|網域控制站狀態|分數|  
|----------------------------|---------|  
|位於相同的站台的網域控制站|8|  
|標示為可靠時間來源的網域控制站|4|  
|位於 父系網域的網域控制站|2|  
|PDC 模擬器網域控制站|1|  
  
當 Windows 時間服務判定它已，最佳的可能分識別網域控制站時，會不進行任何更多的查詢。 時間服務所指派的分數是累計的這表示位在相同的站台是 PDC 模擬器接收的分數是 9 個。  
  
如果時間服務的根目錄不設定為與外部來源同步處理，在電腦的內部硬體時鐘會控管的時間。  
  
### <a name="manually-specified-synchronization"></a>手動指定的同步處理  
手動指定的同步處理可讓您指定單一對等或的電腦將會從中取得時間的對等電腦清單。 如果電腦不是網域的成員，它必須以手動方式設定與指定的時間來源同步處理。 是從網域階層進行同步處理的預設設定成員的電腦，以手動方式指定同步處理是網域的最有用的樹系根網域或未加入網域的電腦。 手動指定外部 NTP 伺服器同步處理與授權的電腦，讓您的網域提供可靠的時間。 不過，設定您的網域與硬體時鐘同步處理的授權電腦是實際上更適合用來提供最精確且安全的時間到您的網域。  
  
手動指定的時間來源不會通過驗證，除非特定時間提供者針對它們所撰寫，而且它們也容易受到攻擊。 此外，如果電腦同步處理以手動方式指定的來源，而不是其驗證的網域控制站，請在兩部電腦可能未執行同步處理，導致 Kerberos 驗證失敗。 這可能會造成其他需要網路驗證失敗，例如列印或檔案共用的動作。 如果只有樹系根目錄設定為與外部來源同步處理時，樹系內的所有其他電腦都能保持同步，讓重新執行攻擊變得困難。  
  
### <a name="all-available-synchronization-mechanisms"></a>所有可用的同步處理機制  

「 所有可用的同步處理機制 」 選項是網路上的使用者最有價值的同步處理方法。 這個方法允許與網域階層的同步處理，而且可能也會提供替代的時間來源，如果網域階層變得無法使用，視設定而定。 如果用戶端無法與網域階層中同步處理時間，時間來源會自動回復到指定的時間來源**NtpServer**設定。 這個方法的同步處理是最有可能提供給用戶端的準確的時間。  

### <a name="stopping-time-synchronization"></a>正在停止的時間同步處理  
有某些情況的下，您會想停止的電腦，從同步處理的時間。 例如，如果電腦嘗試透過 WAN 同步從網際網路上的時間來源，或從另一個網站，透過撥號連線時，就可以產生高成本的電話費用。 當您停用該電腦上的同步處理時，可防止電腦嘗試存取透過撥號連線的時間來源。  
  
您也可以停用同步處理，以避免產生的事件記錄檔中的錯誤。 電腦會嘗試與無法使用，時間來源同步處理每次它會產生錯誤事件記錄檔中。 如果時間來源會從網路上的已排程的維護，而且您不想要重新設定用戶端從其他來源進行同步處理，您可以停用在用戶端，以防止它嘗試時的時間伺服器同步處理的同步處理無法使用。  
  
它適合停用指定做為同步處理網路的電腦上的同步處理。 這表示 root 電腦會信任其本機電腦時鐘。 如果同步處理階層的根未設定為**NoSync** ，如果它無法與另一個時間來源同步處理，用戶端不會接受這台電腦送出，因為它的時間不能是受信任的封包。
  
唯一的時候即使它們未與另一個時間來源同步處理用戶端受信任的伺服器是已由用戶端識別為可靠時間伺服器。  
  
### <a name="disabling-the-windows-time-service"></a>停用 Windows Time 服務  
Windows 時間服務 (W32Time) 可以完全停用。 如果您選擇實作會使用 NTP 的第三方時間同步處理產品，您必須停用 Windows 時間服務。 這是因為所有的 NTP 伺服器需要存取使用者資料包通訊協定 (UDP) 連接埠 123，而且只要 Windows 時間服務執行 Windows Server 2003 作業系統上，連接埠 123 會維持保留狀態的 Windows 時間。  
  
## <a name="w2k3tr_times_how_ydum"></a>Windows 時間服務所使用的網路連接埠  
Windows 時間服務會識別可靠時間來源，取得時間資訊，並提供給其他電腦的時間資訊在網路上通訊。 它會執行這項通訊的 NTP 和 SNTP Rfc 所定義。  
  
**Windows 時間服務的通訊埠指派**  
  
|服務名稱|UDP|TCP|  
|----------------|-------|-------|  
|NTP|123|N/A|  
|SNTP|123|N/A|  
  
## <a name="see-also"></a>另請參閱  
[Windows 時間服務技術參考](windows-time-service-tech-ref.md)
[Windows 時間服務工具和設定](Windows-Time-Service-Tools-and-Settings.md)
[Microsoft Knowledge Base 文章 902229](https://go.microsoft.com/fwlink/?LinkId=186066)