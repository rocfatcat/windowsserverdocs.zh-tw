---
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Windows 時間服務的運作方式
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 2bf4a887218cd51e9c10954a75bbc1ba2112647f
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405146"
---
# <a name="how-the-windows-time-service-works"></a>Windows 時間服務的運作方式

>適用于： Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows 10 或更新版本

**本節內容**  
  
-   [Windows 時間服務架構](#windows-time-service-architecture)  
  
-   [Windows 時間服務時間通訊協定](#windows-time-service-time-protocols)  
  
-   [Windows 時間服務處理和互動](#windows-time-service-processes-and-interactions)  
  
-   [Windows 時間服務所使用的網路埠](#network-ports-used-by-windows-time-service)  
  
> [!NOTE]  
> 本主題僅說明 Windows Time 服務（W32Time）的運作方式。 如需如何設定 Windows 時間服務的相關資訊，請參閱設定[系統的高準確度](configuring-systems-for-high-accuracy.md)。
  
> [!NOTE]  
> 在 Windows Server 2003 和 Microsoft Windows 2000 Server 中，目錄服務的名稱 Active Directory 目錄服務。 在 Windows Server 2008 和更新版本中，目錄服務的名稱會 Active Directory Domain Services （AD DS）。 本主題的其餘部分請參閱 AD DS，但這項資訊也適用於 Active Directory。  
  
雖然 Windows 時間服務不是網路時間通訊協定（NTP）的精確執行，但它會使用在 NTP 規格中定義的複雜演算法套件，以確保網路上電腦的時鐘盡可能精確。 在理想情況下，AD DS 網域中的所有電腦時鐘都會與授權電腦的時間進行同步處理。 許多因素可能會影響網路上的時間同步處理。 下列因素通常會影響 AD DS 中同步處理的精確度：  
  
-   網路狀況  
  
-   電腦硬體時鐘的精確度  
  
-   Windows 時間服務可用的 CPU 和網路資源數量  
  
> [!IMPORTANT]  
> 在 Windows Server 2016 之前，W32Time 服務的設計不是為了符合時間緊迫的應用程式需求。  不過，Windows Server 2016 的更新現在可讓您在網域中執行1毫秒精確度的解決方案。  如需詳細資訊，請參閱[windows 2016 精確時間](accurate-time.md)和[支援界限，為高準確度環境設定 windows 時間服務](support-boundary.md)。  
  
預設會設定同步處理其時間較低或未加入網域的電腦，以與 time.windows.com 同步處理。  因此，無法保證具有間歇或沒有網路連線的電腦上的時間精確度。  
  
AD DS 樹系有預先決定的時間同步處理階層。 Windows 時間服務會在階層內的電腦之間同步處理時間，最精確的參考時鐘位於最上方。 如果電腦上設定了多個時間來源，Windows 時間會使用 NTP 演算法，根據電腦與該時間來源進行同步處理的能力，從設定的來源中選取最佳的時間來源。 Windows 時間服務不支援來自廣播或多播對等的網路同步處理。 如需這些 NTP 功能的詳細資訊，請參閱 IETF RFC 資料庫中的 RFC 1305。  
  
每一部執行 Windows Time 服務的電腦都會使用此服務來維持最精確的時間。 身為網域成員的電腦預設會作為時間用戶端，因此在大部分情況下，不需要設定 Windows 時間服務。 不過，Windows 時間服務可以設定為從指定的參考時間來源要求時間，也可以提供時間給用戶端。
  
電腦時間精確的程度稱為「層次」。 網路上最精確的時間來源（例如硬體時鐘）會佔用最低層次層級，或階層一。 這個精確的時間來源稱為「參考時鐘」。 從參考時鐘直接取得其時間的 NTP 伺服器會佔用一層高於參考時鐘的層次。 從 NTP 伺服器取得時間的資源是從參考時鐘開始的兩個步驟，因此佔用的階層高於最精確的時間來源，依此類推。 隨著電腦的層次號碼增加，其系統時鐘的時間可能會變得較不精確。 因此，任何電腦的階層層級都是指標，指出該電腦與最精確的時間來源同步處理的程度。  
  
當 W32Time 管理員收到時間範例時，它會使用 NTP 中的特殊演算法來判斷哪個時間樣本最適合使用。 時間服務也會使用另一組演算法來判斷哪些已設定的時間來源最精確。 當時間服務決定哪一個時間樣本最適合時，根據上述準則，它會調整本機時脈速率，讓它能夠與正確的時間交集。 如果 [本機時鐘] 和 [選取的精確時間] 範例（也稱為「時間誤差」）之間的時差太大，無法藉由調整本機時脈速率來修正，時間服務會將本機時鐘設定為正確的時間。 這種時脈速率或直接時鐘時間變更的調整稱為「時鐘專業領域」。  
  
## <a name="windows-time-service-architecture"></a>Windows Time 服務架構  
Windows 時間服務包含下列元件：  
  
-   服務控制管理員  
  
-   Windows 時間 Service Manager  
  
-   時鐘專業領域  
  
-   時間提供者  
  
下圖顯示 Windows 時間服務的架構。  
  
**Windows 時間服務架構**  
  
![Windows Time](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)
  
服務控制管理員負責啟動和停止 Windows 時間服務。 Windows 時間 Service Manager 會負責起始作業系統隨附之 NTP 時間提供者的動作。 Windows Time Service Manager 控制 Windows 時間服務的所有功能，以及所有時間樣本的聯合。 除了提供目前系統狀態的相關資訊（例如目前時間來源或上次更新系統時鐘的時間）之外，Windows Time Service Manager 也會負責在事件記錄檔中建立事件。  
  
時間同步處理常式包含下列步驟：  
  
-   輸入提供者會從設定的 NTP 時間來源要求和接收時間樣本。  
  
-   然後，這些時間範例會傳遞至 Windows Time Service Manager，以收集所有樣本，並將它們傳遞至時鐘專業領域子元件。  
  
-   時鐘專業領域子元件會套用 NTP 演算法，這會導致選取最佳時間範例。  
  
-   時鐘專業人員子元件會調整時脈速率或直接變更時間，以將系統時鐘的時間調整為最精確的時間。  
  
如果電腦已指定為時間伺服器，則會在此程式中的任何時間點，將時間傳送到任何要求同步處理的電腦。  
  
## <a name="windows-time-service-time-protocols"></a>Windows 時間服務時間通訊協定  

時間通訊協定會決定同步處理兩部電腦的時鐘的速度。 時間通訊協定負責判斷最佳的可用時間資訊並融合時鐘，以確保一致的時間會在不同的系統上維護。  
  
Windows 時間服務會使用網路時間通訊協定（NTP）來協助跨網路同步處理時間。 NTP 是一種網際網路時間通訊協定，其中包含同步處理時鐘所需的專業演算法。 NTP 是比在某些 Windows 版本中使用的簡易網路時間通訊協定（SNTP）更精確的時間通訊協定;不過，W32Time 會繼續支援 SNTP，使其與執行 SNTP 型時間服務的電腦（例如 Windows 2000）具有回溯相容性。  
  
### <a name="network-time-protocol"></a>網路時間通訊協定  
網路時間通訊協定（NTP）是作業系統中 Windows 時間服務所使用的預設時間同步處理通訊協定。 NTP 是容錯且高度可擴充的時間通訊協定，而且是使用指定的時間參照來同步處理電腦時鐘最常使用的通訊協定。  
  
NTP 時間同步處理會在一段時間內進行，並牽涉到透過網路傳送 NTP 封包。 NTP 封包包含時間戳記，其中包含來自用戶端的時間範例，以及參與時間同步處理的伺服器。  
  
NTP 依賴參考時鐘來定義最精確的使用時間，並將網路上的所有時鐘同步處理至該參考時鐘。 NTP 使用國際標準時間（UTC）做為目前時間的通用標準。 UTC 與時區無關，並可讓您在世界各地使用 NTP，而不論時區設定為何。  
  
#### <a name="ntp-algorithms"></a>NTP 演算法  
NTP 包含兩種演算法，這是一種時鐘篩選演算法和時鐘選擇演算法，可協助 Windows 時間服務判斷最佳時間取樣。 時鐘篩選演算法的設計，是要透過從查詢的時間來源接收到的時間樣本進行篩選，並判斷每個來源的最佳時間樣本。 然後，時鐘選取演算法會判斷網路上最精確的時間伺服器。 這項資訊接著會傳遞至時鐘專業領域演算法，使用收集來更正電腦本機時鐘的資訊，同時補償因網路延遲和電腦時鐘誤差而產生的錯誤。  
  
在輕量網路和伺服器負載的情況下，NTP 演算法最精確。 如同會將網路傳輸時間納入考慮的任何演算法，NTP 演算法可能會在極端網路擁塞的狀況下執行得不佳。 如需 NTP 演算法的詳細資訊，請參閱 IETF RFC 資料庫中的 RFC 1305。  
  
#### <a name="ntp-time-provider"></a>NTP 時間提供者  
Windows 時間服務是完整的時間同步處理套件，可支援各種硬體裝置和時間通訊協定。 若要啟用這種支援，服務會使用可插入的時間提供者。 時間提供者會負責取得精確的時間戳記（從網路或硬體），或透過網路將這些時間戳記提供給其他電腦。  
  
NTP 提供者是作業系統隨附的標準時間提供者。 NTP 提供者會遵循 NTP 第3版針對用戶端和伺服器所指定的標準，而且可以與 SNTP 用戶端和伺服器互動，以提供與 Windows 2000 和其他 SNTP 用戶端的回溯相容性。 Windows 時間服務中的 NTP 提供者包含下列兩個部分：  
  
-   **NtpServer 輸出提供者。** 這是回應網路上用戶端時間要求的時間伺服器。  
  
-   **NtpClient 輸入提供者。** 這是從其他來源（硬體裝置或 NTP 伺服器）取得時間資訊的時間用戶端，並可傳回適用于同步處理本機時鐘的時間樣本。  
  
雖然這兩個提供者的實際作業是密切相關的，但它們與時間服務無關。 從 Windows 2000 Server 開始，當 Windows 電腦連線到網路時，它會設定為 NTP 用戶端。 此外，執行 Windows Time 服務的電腦只會嘗試同步處理時間與網域控制站，或依預設手動指定的時間來源。 這些是慣用的時間提供者，因為它們會自動提供，安全的時間來源。  
  
#### <a name="ntp-security"></a>NTP 安全性  

在 AD DS 樹系中，Windows 時間服務會依賴標準網域安全性功能來強制執行時間資料的驗證。 網域成員電腦與作為時間伺服器的本機網域控制站之間傳送的 NTP 封包安全性是以共用金鑰驗證為基礎。 Windows 時間服務會使用電腦的 Kerberos 工作階段金鑰，在透過網路傳送的 NTP 封包上建立已驗證的簽章。 NTP 封包不會在 Net Logon 安全通道內傳輸。 相反地，當電腦向網域階層中的網域控制站要求時間時，Windows Time 服務會要求驗證時間。 接著，網域控制站會以64位值的形式傳回所需的資訊，而該資料已通過 Net Logon 服務的工作階段金鑰驗證。 如果傳回的 NTP 封包未以電腦的工作階段金鑰簽署，或簽署錯誤，則會拒絕時間。 所有這類驗證失敗都會記錄在事件記錄檔中。 如此一來，Windows Time 服務就會為 AD DS 樹系中的 NTP 資料提供安全性。  
  
一般來說，Windows 時間用戶端會自動取得從相同網域中的網域控制站進行同步處理的精確時間。 在樹系中，子網域的網域控制站會同步處理其父網域中的網域控制站的時間。 當時間伺服器將已驗證的 NTP 封包傳回給要求時間的用戶端時，封包的簽署方式是透過限域信任帳戶所定義的 Kerberos 工作階段金鑰。 當新的 AD DS 網域加入樹系，且 Net Logon 服務管理工作階段金鑰時，就會建立 [網域間信任帳戶]。 如此一來，在樹系根域中設定為可靠的網域控制站，就會成為父網域和子域中所有網域控制站的已驗證時間來源，並間接針對位於域樹的所有電腦。  
  
Windows 時間服務可以設定為在樹系之間運作，但請務必注意，這項設定並不安全。 例如，NTP 伺服器可能會在不同的樹系中提供。 不過，因為該電腦位於不同的樹系中，所以沒有任何 Kerberos 工作階段金鑰可用於簽署和驗證 NTP 封包。 若要從不同樹系中的電腦取得精確的時間同步處理，用戶端需要該電腦的網路存取權，而時間服務必須設定為使用位於另一個樹系中的特定時間來源。 如果手動將用戶端設定為從它自己的網域階層外的 NTP 伺服器存取時間，則在用戶端與時間伺服器之間傳送的 NTP 封包不會經過驗證，因此也不安全。 即使是執行樹系信任，Windows Time 服務也不是跨樹系的安全。 雖然 Net Logon 安全通道是 Windows 時間服務的驗證機制，但不支援跨樹系的驗證。  
  
#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>Windows 時間服務所支援的硬體裝置  
以硬體為基礎的時鐘（例如 GPS 或電臺時鐘）通常會用來做為高度精確的參照時鐘裝置。 根據預設，Windows 時間服務 NTP 時間提供者不支援將硬體裝置直接連線到電腦，雖然可以建立支援這種連線類型的軟體型獨立時間提供者。 這種類型的提供者（結合 Windows 時間服務）可以提供可靠且穩定的時間參考。  
  
硬體裝置（例如 cesium 時鐘或全球定位系統（GPS）接收器）會遵循標準來取得精確的時間定義，以提供準確的目前時間。 Cesium 時鐘非常穩定，不會受到溫度、壓力或濕度等因素的影響，但也非常昂貴。 GPS 接收者的運作成本較低，而且也是正確的參考時鐘。 GPS 接收者會從從 cesium 時鐘取得時間的衛星取得其時間。 如果沒有使用獨立的時間提供者，Windows 時間伺服器可以連接到外部 NTP 伺服器（透過電話或網際網路連接到硬體裝置）來取得其時間。 美國海軍天文臺之類的組織提供連線到非常可靠之參考時鐘的 NTP 伺服器。  
  
許多 GPS 接收者和其他時間裝置可以做為網路上的 NTP 伺服器。 您可以設定 AD DS 樹系，使其只在網路上作為 NTP 伺服器時，才從這些外部硬體裝置同步處理時間。 若要這麼做，請將網域控制站設定為樹系根目錄中的主域控制站（PDC）模擬器，以與 GPS 裝置所提供的 NTP 伺服器同步處理。 若要這麼做，請參閱在[樹系根域中的 PDC 模擬器上設定 Windows 時間服務](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)。  
  
### <a name="simple-network-time-protocol"></a>簡單的網路時間通訊協定  
簡單的網路時間通訊協定（SNTP）是一種簡化的時間通訊協定，適用于不需要 NTP 所提供精確度程度的伺服器和用戶端。 SNTP 是更基本的 NTP 版本，是 Windows 2000 中使用的主要時間通訊協定。 由於 SNTP 和 NTP 的網路封包格式完全相同，因此這兩種通訊協定是互通的。 兩者的主要差異在於，SNTP 不具有 NTP 提供的錯誤管理和複雜的篩選系統。 如需有關簡易網路時間通訊協定的詳細資訊，請參閱 IETF RFC 資料庫中的 RFC 1769。  
  
### <a name="time-protocol-interoperability"></a>時間通訊協定互通性  
Windows 時間服務可以在執行 Windows 2000、Windows XP 和 Windows Server 2003 之電腦的混合環境中運作，因為 Windows 2000 中使用的 SNTP 通訊協定可與 Windows XP 和 Windows Server 2003 中的 NTP 通訊協定互通。  
  
Windows NT Server 4.0 中的 time 服務（稱為 TimeServ）會跨 Windows NT 4.0 網路同步處理時間。 TimeServ 是*Microsoft WINDOWS NT 4.0 資源套件*中提供的附加元件功能，並不提供 Windows Server 2003 所需時間同步處理的可靠性程度。  
  
Windows 時間服務可以與執行 Windows NT 4.0 的電腦互通，因為它們可以與執行 Windows 2000 或 Windows Server 2003 的電腦同步處理時間;不過，執行 Windows 2000 或 Windows Server 2003 的電腦不會自動探索 Windows NT 4.0 時間伺服器。 例如，如果您的網域已設定為使用以網域階層為基礎的同步處理方法來同步處理時間，而您想要讓網域階層中的電腦與 Windows NT 4.0 網域控制站同步處理時間，則您必須設定這些手動與 Windows NT 4.0 網域控制站同步的電腦。  
  
Windows NT 4.0 使用比 Windows 時間服務使用更簡單的時間同步處理機制。 因此，為了確保整個網路的時間同步，建議您將任何 Windows NT 4.0 網域控制站升級至 Windows 2000 或 Windows Server 2003。  
  
## <a name="windows-time-service-processes-and-interactions"></a>Windows 時間服務處理和互動  

Windows 時間服務是設計用來同步處理網路上的電腦時鐘。 網路時間同步處理常式（也稱為時間聚合）會在整個網路中發生，因為每部電腦會從更精確的時間伺服器存取時間。 時間聚合牽涉到一個處理常式，由授權伺服器以 NTP 封包的形式，將目前的時間提供給用戶端電腦。 封包中提供的資訊指出是否需要對電腦的目前時鐘時間進行調整，以便與更精確的伺服器同步處理。  
  
在時間聚合程式中，網域成員會嘗試將時間與位於相同網域中的任何網域控制站同步處理。 如果電腦是網域控制站，則會嘗試與更多授權的網域控制站進行同步處理。  
  
執行 Windows XP Home Edition 的電腦或未加入網域的電腦不會嘗試與網域階層進行同步處理，但預設會設定為從 time.windows.com 取得時間。  
  
若要建立執行 Windows Server 2003 的電腦作為授權，電腦必須設定為可靠的時間來源。 根據預設，安裝在 Windows Server 2003 網域上的第一個網域控制站會自動設定為可靠的時間來源。 因為它是網域的授權電腦，所以必須設定為與外部時間來源同步處理，而不是網域階層。 此外，根據預設，所有其他的 Windows Server 2003 網域成員都會設定為與網域階層進行同步處理。  
  
建立 Windows Server 2003 網路之後，您可以將 Windows 時間服務設定為使用下列其中一個同步處理選項：  
  
-   以網域階層為基礎的同步處理  
  
-   手動指定的同步處理來源  
  
-   所有可用的同步處理機制  
  
-   無同步處理。  
  
下一節將討論這些同步處理類型。  
  
### <a name="domain-hierarchy-based-synchronization"></a>以網域階層為基礎的同步處理  

以網域階層為基礎的同步處理會使用 AD DS 網域階層，來尋找用來同步處理時間的可靠來源。 根據網域階層，Windows 時間服務會決定每個時間伺服器的精確度。 在 Windows Server 2003 樹系中，保留主域控制站（PDC）模擬器操作主機角色（位於樹系根域中）的電腦會保留最佳時間來源的位置，除非已設定另一個可靠的時間來源。 下圖說明網域階層中電腦之間的時間同步處理路徑。  
  
**AD DS 階層中的時間同步處理**  
![Windows 時間](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_ntw_adhc.gif)
  
#### <a name="reliable-time-source-configuration"></a>可靠的時間來源設定  
設定為可靠時間來源的電腦會被識別為時間服務的根目錄。 時間服務的根目錄是網域的授權伺服器，通常是設定為從外部 NTP 伺服器或硬體裝置取出時間。 您可以將時間伺服器設定為可靠的時間來源，以優化整個網域階層的時間傳輸方式。 如果網域控制站設定為可靠的時間來源，Net Logon 服務會在登入網路時，將網域控制站宣佈為可靠的時間來源。 當其他網域控制站尋找與同步處理的時間來源時，他們會先選擇可靠的來源（如果有的話）。  
  
#### <a name="time-source-selection"></a>時間來源選取  
時間來源選取進程可能會在網路上建立兩個問題：  
  
-   其他同步處理迴圈。  
  
-   增加網路流量中的磁片區。  
  
當網域控制站群組之間的時間保持一致時，同步處理網路中的迴圈就會發生，而相同的時間則會持續在沒有重新同步處理的其他可靠時間來源的情況下，于兩者之間共用。 Windows 時間服務的時間來源選取演算法是設計來保護這些類型的問題。  
  
電腦會使用下列其中一種方法來識別要同步處理的時間來源：  
  
-   如果電腦不是網域的成員，則必須將它設定為與指定的時間來源同步處理。  
  
-   如果電腦是網域內的成員伺服器或工作站，則根據預設，它會遵循 AD DS 階層，並將其時間與目前執行 Windows Time 服務的本機網域中的網域控制站同步處理。  
  
如果電腦是網域控制站，則最多會建立六個查詢，以找出要同步處理的另一個網域控制站。 每個查詢都是設計用來識別具有特定屬性的時間來源，例如網域控制站類型、特定位置，以及是否為可靠的時間來源。 時間來源也必須遵守下列條件約束：  
  
-   可靠的時間來源只能與父系網域中的網域控制站進行同步處理。  
  
-   PDC 模擬器可以在其自己的網域或父系網域中的任何網域控制站中，與可靠的時間來源進行同步處理。  
  
如果網域控制站無法與正在查詢的網域控制站類型同步處理，就不會進行查詢。 網域控制站知道在進行查詢之前，可以從何種類型的電腦取得時間。 例如，本機 PDC 模擬器不會嘗試查詢數位3或6，因為網域控制站不會嘗試與其本身進行同步處理。  
  
下表列出網域控制站用來尋找時間來源的查詢，以及執行查詢的順序。  
  
**網域控制站時間來源查詢**  
  
|查詢編號|網域控制站|Location|時間來源的可靠性|  
|----------------|---------------------|------------|------------------------------|  
|1|父系網域控制器|站上|偏好可靠的時間來源，但它可以與不可靠的時間來源進行同步處理（如果可用的話）。|  
|2|本機網域控制站|站上|只會與可靠的時間來源進行同步處理。|  
|3|本機 PDC 模擬器|站上|不適用。<br /><br />網域控制站不會嘗試與其本身進行同步處理。|  
|4|父系網域控制器|網站外|偏好可靠的時間來源，但它可以與不可靠的時間來源進行同步處理（如果可用的話）。|  
|5|本機網域控制站|網站外|只會與可靠的時間來源進行同步處理。|  
|6|本機 PDC 模擬器|網站外|不適用。<br /><br />網域控制站不會嘗試與其本身進行同步處理。| 
  
**注意**  
  
-   電腦永遠不會與其本身進行同步處理。 如果嘗試同步處理的電腦是本機 PDC 模擬器，則不會嘗試查詢3或6。  
  
每個查詢都會傳回可用來做為時間來源的網域控制站清單。 Windows Time 會指派每個網域控制站，根據網域控制站的可靠性和位置來查詢分數。 下表列出 Windows 時間指派給每個網域控制站類型的分數。  
  
**分數判斷**  
  
|網域控制站狀態|分數|  
|----------------------------|---------|  
|位於相同網站的網域控制站|8|  
|已標示為可靠時間來源的網域控制站|4|  
|位於父系網域中的網域控制站|2|  
|做為 PDC 模擬器的網域控制站|1|  
  
當 Windows Time 服務判斷它已識別出具有最佳分數的網域控制站時，就不會再進行任何查詢。 時間服務指派的分數是累計的，這表示位於相同網站的 PDC 模擬器會得到九分的分數。  
  
如果時間服務的根目錄未設定為與外部來源進行同步處理，則電腦的內部硬體時鐘會控管時間。  
  
### <a name="manually-specified-synchronization"></a>手動指定的同步處理  
手動指定的同步處理可讓您指定電腦取得時間的單一對等或對等清單。 如果電腦不是網域的成員，則必須手動將其設定為與指定的時間來源進行同步處理。 預設會將屬於網域成員的電腦設定為從網域階層進行同步處理，而手動指定的同步處理對於網域的樹系根目錄或未加入網域的電腦而言最為有用。 手動指定外部 NTP 伺服器以與網域的授權電腦同步，可提供可靠的時間。 不過，將您的網域的授權電腦設定為與硬體時鐘進行同步處理，其實是一個更好的解決方案，能為您的網域提供最精確、安全的時間。  
  
手動指定的時間來源不會經過驗證，除非為其寫入特定的時間提供者，因此很容易遭受攻擊者攻擊。 此外，如果電腦與手動指定的來源（而非驗證網域控制站）進行同步處理，這兩部電腦可能會不同步，導致 Kerberos 驗證失敗。 這可能會導致其他需要網路驗證的動作失敗，例如列印或檔案共用。 如果只有樹系根設定為與外部來源進行同步處理，則樹系中的所有其他電腦會彼此保持同步，使重新執行攻擊變得很棘手。  
  
### <a name="all-available-synchronization-mechanisms"></a>所有可用的同步處理機制  

[所有可用的同步處理機制] 選項是網路上使用者最有價值的同步處理方法。 這個方法允許與網域階層進行同步處理，而且如果網域階層變成無法使用，視設定而定，也可能會提供替代的時間來源。 如果用戶端無法同步處理網域階層的時間，則時間來源會自動切換回 [ **NtpServer** ] 設定所指定的時間來源。 這種同步處理方式最有可能提供準確的時間給用戶端。  

### <a name="stopping-time-synchronization"></a>停止時間同步處理  
在某些情況下，您會想要阻止電腦同步處理其時間。 例如，如果電腦嘗試透過撥號連線，從網際網路上的時間來源或透過 WAN 的另一個網站進行同步處理，可能會產生昂貴的電話費用。 當您停用該電腦上的同步處理時，會防止電腦嘗試透過撥號連線來存取時間來源。  
  
您也可以停用同步處理，以避免在事件記錄檔中產生錯誤。 每次電腦嘗試與無法使用的時間來源進行同步處理時，就會在事件記錄檔中產生錯誤。 如果從網路取出時間來源進行排程維護，而您不想要重新設定用戶端從另一個來源進行同步處理，您可以停用用戶端上的同步處理，以防止它在時間伺服器時嘗試同步處理無法使用。  
  
在指定為同步處理網路根目錄的電腦上停用同步處理是很有用的。 這表示根電腦信任其本機時鐘。 如果同步處理階層的根目錄未設定為**NoSync** ，而且無法與另一個時間來源進行同步處理，則用戶端不會接受這部電腦送出的封包，因為它的時間無法受信任。
  
用戶端所信任的唯一伺服器，即使它們未與另一個時間來源同步處理，也是用戶端已識別為可靠時間伺服器的時間。  
  
### <a name="disabling-the-windows-time-service"></a>停用 Windows 時間服務  
Windows 時間服務（W32Time）可以完全停用。 如果您選擇執行使用 NTP 的協力廠商時間同步處理產品，則必須停用 Windows 時間服務。 這是因為所有 NTP 伺服器都需要存取使用者資料包協定（UDP）埠123，而且只要 windows 時間服務在 Windows Server 2003 作業系統上執行，埠123仍然會保留 Windows 時間。  
  
## <a name="network-ports-used-by-windows-time-service"></a>Windows 時間服務所使用的網路埠  
Windows 時間服務會在網路上進行通訊，以識別可靠的時間來源、取得時間資訊，並提供時間資訊給其他電腦。 它會依照 NTP 和 SNTP Rfc 的定義來執行這項通訊。  
  
**Windows 時間服務的通訊埠指派**  
  
|服務名稱|UDP|TCP|  
|----------------|-------|-------|  
|NTP|123|不適用|  
|SNTP|123|不適用|  
  
## <a name="see-also"></a>請參閱  
[Windows 時間服務技術參考](windows-time-service-tech-ref.md)
[Windows 時間服務工具和設定](Windows-Time-Service-Tools-and-Settings.md)
[Microsoft 知識庫文章 902229](https://go.microsoft.com/fwlink/?LinkId=186066)