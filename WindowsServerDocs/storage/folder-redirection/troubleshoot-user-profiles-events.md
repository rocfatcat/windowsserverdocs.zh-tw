---
title: 針對具有事件的使用者設定檔進行疑難排解
description: 如何使用事件和追蹤記錄來疑難排解載入及卸載使用者設定檔的問題。
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: 9e927a77627e786015a928d798aafee13a2cc34b
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/27/2019
ms.locfileid: "71394375"
---
# <a name="troubleshoot-user-profiles-with-events"></a>針對具有事件的使用者設定檔進行疑難排解

>適用於：Windows 10、Windows 8、Windows 8.1、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012 和 Windows Server （半年通道）。

本主題討論如何使用事件和追蹤記錄，針對載入及卸載使用者設定檔的問題進行疑難排解。 下列各節說明如何使用三個記錄使用者設定檔資訊的事件記錄檔。

## <a name="step-1-checking-events-in-the-application-log"></a>步驟 1:檢查應用程式記錄檔中的事件

針對載入及卸載使用者設定檔的問題進行疑難排解的第一個步驟（包括漫遊使用者設定檔），是使用事件檢視器來檢查使用者設定檔服務記錄在應用程式記錄檔中的任何警告和錯誤事件。

以下說明如何在應用程式記錄檔中查看使用者設定檔服務事件：

1. 啟動事件檢視器。 若要這麼做，請開啟 [**控制台**]，選取 [**系統及安全性**]，然後在 [系統**管理工具**] 區段中，選取 [**查看事件記錄**]。 [事件檢視器] 視窗隨即開啟。
2. 在主控台樹中，先依序流覽至 [ **Windows 記錄**] 和 [**應用程式**]。
3. 在 [動作] 窗格中，選取 [**篩選目前的記錄**]。 [篩選目前的記錄] 對話方塊隨即開啟。
4. 在 [**事件來源**] 方塊中，選取 [**使用者設定檔服務**] 核取方塊，然後選取 **[確定]** 。
5. 檢查事件清單，特別注意錯誤事件。
6. 當您發現值得注意的事件時，請選取 [事件記錄檔線上說明] 連結，以顯示其他資訊和疑難排解程式。
7. 若要執行進一步的疑難排解，請注意值得注意的事件的日期和時間，然後檢查操作記錄（如步驟2中所述），以查看有關使用者設定檔服務在發生錯誤或警告事件時所執行之動作的詳細資料。

>[!NOTE]
>您可以放心地忽略「使用者設定檔服務」事件1530「Windows 偵測到您的登錄檔案仍由其他應用程式或服務使用中」。

## <a name="step-2-view-the-operational-log-for-the-user-profile-service"></a>步驟 2:查看使用者設定檔服務的操作記錄

如果您無法單獨使用應用程式記錄檔來解決此問題，請使用下列程式，在操作記錄中查看使用者設定檔服務事件。 此記錄檔會顯示服務的部分內部工作，並可協助找出發生問題的設定檔載入或卸載程式中的位置。

Windows 應用程式記錄檔和「使用者設定檔服務」作業記錄檔預設會在所有 Windows 安裝中啟用。

以下說明如何查看使用者設定檔服務的操作記錄：

1. 在事件檢視器主控台樹中，依序流覽至 [**應用程式及服務記錄**檔]、[ **Microsoft**]、[ **Windows**]、[**使用者設定檔服務**] 和 [**操作**]。
2. 檢查您在應用程式記錄檔中所記下的錯誤或警告事件時間前後發生的事件。

## <a name="step-3-enable-and-view-analytic-and-debug-logs"></a>步驟 3：啟用和查看分析和調試記錄

如果您需要比作業記錄提供的更多詳細資料，您可以在受影響的電腦上啟用分析和調試記錄。 此記錄層級更詳細，應停用，但在嘗試針對問題進行疑難排解時除外。

以下說明如何啟用及查看分析和偵錯工具記錄：

1. 在事件檢視器的 [**動作**] 窗格中，選取 [ **View**]，然後選取 [**顯示分析和調試記錄**]。
2. 依序流覽至 [**應用程式及服務記錄**檔]、[ **Microsoft**]、[ **Windows**]、[**使用者設定檔服務**] 和 [**診斷**]。
3. 選取 [**啟用記錄**]，然後選取 **[是]** 。 這會啟用 [診斷記錄]，這將會開始記錄。
4. 如果您需要更詳細的資訊，請參閱 @no__t 0Step 4：建立和解碼追蹤 @ no__t-0，以取得如何建立追蹤記錄檔的詳細資訊。
5. 當您完成問題的疑難排解時，流覽至 [**診斷**記錄]，選取 [**停用記錄**]，選取 [**查看**]，然後清除 [**顯示分析和偵錯工具記錄**] 核取方塊，以隱藏分析和偵錯工具記錄。

## <a name="step-4-creating-and-decoding-a-trace"></a>步驟 4：建立和解碼追蹤

如果您無法使用事件來解決此問題，您可以在重現問題時建立追蹤記錄（ETL 檔案），然後使用 Microsoft 符號伺服器的公用符號將其解碼。 追蹤記錄會提供有關使用者設定檔服務所執行之動作的非常特定資訊，並有助於找出發生失敗的位置。

使用 ETL 追蹤時，最好的策略是先取得最小的記錄檔。 記錄檔解碼後，搜尋記錄檔中是否有失敗。

以下說明如何建立和解碼使用者設定檔服務的追蹤：

1. 使用本機系統管理員群組成員的帳戶，登入使用者遇到問題的電腦。
2. 從提高許可權的命令提示字元輸入下列命令，其中 *\<Path @ no__t-2*是您先前建立之本機資料夾的路徑，例如 C： \\logs：
        
    ```PowerShell
    logman create trace -n RUP -o <Path>\RUP.etl -ets
    logman update RUP -p {eb7428f5-ab1f-4322-a4cc-1f1a9b2c5e98} 0x7FFFFFFF 0x7 -ets
    ```
3. 從 [開始] 畫面中，選取使用者名稱，然後選取 [**切換帳戶**]，小心不要登出系統管理員。 如果您使用的是遠端桌面，請關閉系統管理員會話，以建立使用者會話。
4. 重現問題。 重現問題的程式通常是以遇到問題的使用者身分登入、登出使用者，或同時登入。
5. 重現問題之後，再次以本機系統管理員的身分登入。
6. 從提高許可權的命令提示字元中執行下列命令，將記錄檔儲存至 ETL 檔案：
  
    ```PowerShell
    logman stop -n RUP -ets
    ```
7. 輸入下列命令，將 ETL 檔案匯出至目前目錄中人類可讀取的檔案（可能是您的主資料夾或% WINDIR% \\System32 資料夾）：
    
    ```PowerShell
    Tracerpt <path>\RUP.etl
    ```
8. 開啟**摘要 .txt**檔案和**dumpfile.xml**檔案（您可以在 Microsoft Excel 中開啟它們，以更輕鬆地查看記錄檔的完整詳細資料）。 尋找包含**fail**或**failed**的事件;您可以放心地忽略包含**未知**事件名稱的程式程式碼。

## <a name="more-information"></a>詳細資訊

* [部署漫遊使用者設定檔](deploy-roaming-user-profiles.md)