---
title: 透過有事件對使用者設定檔進行疑難排解
description: 如何使用事件和追蹤記錄，針對載入和卸載使用者設定檔的問題進行疑難排解。
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: e6417fc6453499387fbf721ef31121e07eccdfdd
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/07/2020
ms.locfileid: "87957626"
---
# <a name="troubleshoot-user-profiles-with-events"></a>透過有事件對使用者設定檔進行疑難排解

>適用於：Windows 10、Windows 8、Windows 8.1、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012 和 Windows Server (半年通道)。

本主題討論如何使用事件和追蹤記錄，針對對載入及卸載使用者設定檔的問題進行疑難排解。 下列各節說明如何使用記錄使用者設定檔資訊的三種事件記錄。

## <a name="step-1-checking-events-in-the-application-log"></a>步驟 1：檢查應用程式記錄檔中的事件

針對載入及卸載使用者設定檔的問題 (包括漫遊使用者設定檔) 進行疑難排解的第一個步驟，是使用事件檢視器來檢查應用程式記錄檔中使用者設定檔服務記錄的所有警告和錯誤事件。

以下說明如何在應用程式記錄檔中檢視使用者設定檔服務事件：

1. 啟動 [事件檢視器]。 若要這麼做，請開啟**控制台**，選取 [系統和安全性]  ，然後在 [管理工具]  區段中，選取 [檢視事件記錄]  。 [事件檢視器] 視窗隨即開啟。
2. 在主控台樹狀結構中，先瀏覽至 [Windows 記錄]  ，然後移至 [應用程式]  。
3. 在 [動作] 窗格中，選取 [篩選目前的記錄]  。 [篩選目前的記錄] 對話方塊隨即開啟。
4. 在 [事件來源]  方塊中，依序選取 [使用者設定檔服務]  核取方塊以及 [確定]  。
5. 檢閱事件清單，特別注意錯誤事件。
6. 發現值得注意的事件時，請選取 [事件記錄線上說明] 連結，顯示額外資訊和疑難排解程序。
7. 若要執行進一步的疑難排解，請注意值得注意事件的日期和時間，然後檢查作業記錄 (如步驟 2 中所述)，以檢視有關使用者設定檔服務在發生錯誤或警告事件時，所執行動作的詳細資料。

>[!NOTE]
>您可以放心地忽略使用者設定檔服務事件 1530「Windows 偵測到您的登錄檔案仍由其他應用程式或服務使用中」。

## <a name="step-2-view-the-operational-log-for-the-user-profile-service"></a>步驟 2：檢視使用者設定檔服務的作業記錄

如果您無法單獨使用應用程式記錄檔來解決此問題，請使用下列程序，在作業記錄中檢視使用者設定檔服務事件。 此記錄會顯示服務的部分內部工作，並可協助找出在設定檔載入或卸載程序中發生問題的位置。

Windows 應用程式記錄檔和使用者設定檔服務作業記錄檔預設會在所有 Windows 安裝中啟用。

以下說明如何檢視使用者設定檔服務的作業記錄：

1. 在事件檢視器主控台樹狀結構中，依序瀏覽至 [應用程式及服務記錄]  、[Microsoft]  、[Windows]  、[使用者設定檔服務]  及 [作業]  。
2. 檢查您在應用程式記錄檔中，記下的錯誤或警告事件時間前後發生的事件。

## <a name="step-3-enable-and-view-analytic-and-debug-logs"></a>步驟 3：啟用並檢視分析與偵錯記錄

如果您需要比作業記錄更詳細的資料，可以在受影響的電腦上啟用分析和偵錯記錄。 此記錄層級能提供更詳細的資訊，但除了嘗試對問題進行疑難排解期間，請停用此功能。

如何啟用和檢視分析與偵錯記錄：

1. 在事件檢視器的 [動作]  窗格中，選取 [檢視]  ，然後選取 [顯示分析和偵錯記錄]  。
2. 依序瀏覽至 [應用程式及服務記錄]  、[Microsoft]  、[Windows]  、[使用者設定檔服務]  及 [診斷]  。
3. 選取 [啟用記錄]  ，然後選取 [是]  。 這會啟用 [診斷記錄] 並開始記錄。
4. 如果需要更詳細的資訊，請參閱[步驟4：建立和解碼追蹤](#step-4-creating-and-decoding-a-trace)，以取得如何建立追蹤記錄的詳細資訊。
5. 完成問題的疑難排解時，請瀏覽至 [診斷]  記錄，依序選取 [停用記錄]  和 [檢視]  ，然後清除 [顯示分析和偵錯記錄]  核取方塊，以隱藏分析和偵錯記錄。

## <a name="step-4-creating-and-decoding-a-trace"></a>步驟 4：建立並將追蹤解碼

如果無法使用事件來解決問題，可以在重現問題時建立追蹤記錄 (ETL 檔案)，然後使用 Microsoft 符號伺服器的公用符號進行解碼。 追蹤記錄會提供有關使用者設定檔服務所執行之動作的特定資訊，並有助於找出發生失敗的位置。

使用 ETL 追蹤時，最好的策略是先擷取最小的記錄。 將記錄解碼後，搜尋失敗的記錄。

以下說明如何建立並將使用者設定檔服務的追蹤解碼：

1. 使用本機系統管理員群組成員的帳戶登入使用者遇到問題的電腦。
2. 在提升權限的命令提示字元中輸入下列命令，其中 *\<Path\>* 是您先前建立的本機資料夾路徑，C:\\logs:

    ```PowerShell
    logman create trace -n RUP -o <Path>\RUP.etl -ets
    logman update RUP -p {eb7428f5-ab1f-4322-a4cc-1f1a9b2c5e98} 0x7FFFFFFF 0x7 -ets
    ```
3. 從 [開始] 畫面中選取使用者名稱，然後選取 [交換帳戶]  ，小心不要登出系統管理員。 如果您使用的是遠端桌面，請關閉系統管理員工作階段，以建立使用者工作階段。
4. 重現問題。 重現問題的程序通常是以遇到問題的使用者身分登入、登出使用者，或同時進行。
5. 問題重現之後，再次以本機系統管理員的身分登入。
6. 在提升權限的命令提示字元中執行下列命令，將記錄儲存到 ETL 檔案中：

    ```PowerShell
    logman stop -n RUP -ets
    ```
7. 輸入下列命令，將 ETL 檔案匯出至目前目錄中人類可讀取的檔案 (可能是您的主資料夾或 % WINDIR%\\System32 資料夾)：

    ```PowerShell
    Tracerpt <path>\RUP.etl
    ```
8. 開啟 [Summary.txt]  檔案和 [Dumpfile.xml]  檔案 (您可以在 Microsoft Excel 中開啟，以更輕鬆地檢視記錄的完整詳細資料)。 尋找包含 [失敗]  或 [已失敗]  的事件；;您可以放心地忽略包含 [未知]  事件名稱的程式碼行。

## <a name="more-information"></a>其他資訊

* [部署漫遊使用者設定檔](deploy-roaming-user-profiles.md)