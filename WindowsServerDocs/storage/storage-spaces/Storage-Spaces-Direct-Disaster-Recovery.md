---
title: 超交集基礎結構的災害復原案例
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: 本文說明適用於目前的 Microsoft HCI （儲存空間直接存取） 的災害復原案例
ms.localizationpriority: medium
ms.openlocfilehash: c844c56c3a1717658bcdb970e78d45b5cdda861c
ms.sourcegitcommit: 48bb3e5c179dc520fa879b16c9afe09e07c87629
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/31/2019
ms.locfileid: "66453118"
---
# <a name="disaster-recovery-with-storage-spaces-direct"></a>使用儲存空間直接存取的災害復原

> 適用於：Windows Server 2019，Windows Server 2016

本主題提供可進行災害復原設定如何超交集基礎結構 (HCI) 上的案例。

許多公司執行超融合解決方案，並規劃災害提供持續或是快速回復到生產環境發生災害時的能力。 有數種方式來進行災害復原設定 HCI，本文件說明可供您立即使用的選項。

當發生災害時還原可用性的討論主要是因為已知為復原時間目標 (RTO)。 這是的持續時間為目標，服務必須先還原在避免對企業無法接受的結果。 在某些情況下，此程序可能會發生自動與實際執行環境幾乎立即還原。 在其他情況下，系統管理員手動介入的情況下必須還原服務。

今天很超交集的災害復原選項：

1. 多個叢集使用的儲存體複本
2. 叢集之間的 HYPER-V 複本
3. 備份與還原

## <a name="multiple-clusters-utilizing-storage-replica"></a>多個叢集使用的儲存體複本

[儲存體複本](../storage-replica/storage-replica-overview.md)可讓複寫的磁碟區，並支援同步和非同步複寫。 使用同步或非同步複寫之間選擇時，您應該考慮您的復原點目標 (RPO)。 復原點目標是您願意承擔才會視為癱瘓，失去的資料可能遺失的數量。 如果您使用同步複寫時，它會循序寫入兩端在相同的時間。 如果您使用非同步，寫入會複寫速度非常快，但仍可能會遺失。 您應該考慮的應用程式或檔案的使用量，以查看其最適合您。

儲存體複本是區塊層級的複製機制，與檔案層級;這表示，它並不重要複寫的資料的類型。 這使得超交集基礎結構的熱門選項。 儲存體複本也可以使用不同類型的複寫協力電腦，因此在上一個 HCI 將所有的一種類型的儲存體之間的磁碟機，並在其他的另一個型別儲存體便已綽綽有餘。 

儲存體複本的其中一個重要功能是，它可以執行 Azure 以及內部部署。 您可以設定內部部署至內部部署，Azure 至 Azure 或甚至是內部部署至 Azure （反之亦然）。

在此案例中，有兩個不同的獨立叢集。 如需設定 HCI 之間的儲存體複本，您可以遵循中的步驟[叢集對叢集儲存體複寫](../storage-replica/cluster-to-cluster-storage-replication.md)。

![儲存體複寫圖表](media/storage-spaces-direct-disaster-recovery/Disaster-Recovery-Figure1.png)

部署儲存體複本時，就會適用下列考量。 

1.  設定複寫是外部容錯移轉叢集。 
2.  選擇的複寫方法會取決於您的網路延遲和 RPO 需求。 同步複寫低延遲網路上的資料損毀一致性，以確保不會遺失資料的失敗一次。 非同步複寫具有較高的延遲，但每個站台的網路上的資料可能沒有完全相同複本失敗一次。 
3.  在發生災害，容錯移轉叢集之間不自動，且必須以手動方式協調，透過儲存體複本 PowerShell cmdlet。 在上圖中，ClusterA 是主要伺服器，ClusterB 是次要伺服器。 如果 ClusterA 故障時，您必須以手動方式將 ClusterB 設為主要之前您必須將資源。 備份 ClusterA 之後，您需要讓次要資料庫。 一旦已設定同步處理所有資料，進行變更，並交換回它們原本的設定方式的角色。
4.  因為儲存體複本只會複寫資料時，新的虛擬機器或相應放大檔案伺服器 (SOFS) 利用這項資料要複寫協力電腦上建立容錯移轉叢集管理員 」 內。

如果您有虛擬機器或 SOFS 叢集上執行，則可以使用儲存體複本。 將資源上線在複本 HCI 可以手動或自動透過使用 PowerShell 指令碼。

## <a name="hyper-v-replica"></a>Hyper-V 複本

[HYPER-V 複本](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica)超交集基礎結構上提供虛擬機器層級的複寫進行災害復原。 HYPER-V 複本可以做的是取得虛擬機器，並將它複寫至次要網站或 Azure （複本）。 然後從次要網站中，HYPER-V 複本可以複寫的虛擬機器至第三個 （延伸複本）。

![Hyper-v VM 複寫圖表](media/storage-spaces-direct-disaster-recovery/Disaster-Recovery-Figure2.png)

與 HYPER-V 複本複寫是由負責 HYPER-V。 當您第一次啟用複寫的虛擬機器時，有三個希望如何將初始複本傳送至對應的複本叢集的選項。

1.  透過網路傳送初始複本
2.  將初始複本傳送到外部媒體，以便可以將它複製到您的伺服器上以手動方式
3.  使用已建立在複本主機上的現有虛擬機器

另一個選項是的當您想要此初始複寫應該會發生。

1.  立即開始複寫
2.  排程初始複寫何時會發生的時間。 

以下是您需要其他考量：

- 哪些 VHD/VHDX 的您想要複寫。 您可以選擇將它們全部或其中只有一個複寫。
- 您想要儲存的復原點數目。 如果您想要有數個選項，了解哪個您想要還原的時間點，您會想要指定想要多少個。 如果您只想一個還原點，您可以也可選擇。
- 頻率，您想要有磁碟區陰影複製服務 (VSS) 複寫累加的陰影複製。
- 頻率變更複寫 （30 秒、 5 分鐘、 15 分鐘）。

當 HCI 參與 HYPER-V 複本時，您必須擁有[HYPER-V 複本代理人](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/)在每個叢集中建立的資源。 此資源達成幾件事：

1.  每個叢集連線到 HYPER-V 複本，提供您單一的命名空間。
2.  判斷哪一個複本 （或延伸的複本） 都會是收到時，它先複製該叢集內的節點。
3.  會追蹤的哪個節點擁有的複本 （或延伸的複本） 如果虛擬機器移動到另一個節點。 它需要此追蹤，以便進行複寫時，它可以將資訊傳送到適當的節點。

## <a name="backup-and-restore"></a>備份與還原

十分不談，但一樣重要的其中一個傳統的災害復原選項是整個叢集或叢集中節點的失敗。 在此案例中的其中一個選項會使用 Windows NT Backup。 

就一律要有的超交集基礎結構的定期備份的建議。 執行叢集服務時，如果您進行系統狀態備份，叢集登錄資料庫會是該備份的一部分。 還原叢集或資料庫有兩個不同的方法 （非授權和授權）。

### <a name="non-authoritative"></a>非系統授權

在非權威還原可以使用 Windows NT Backup 來完成，而且等於 只在叢集節點本身的完整還原。 如果您只需要一個叢集節點 （和叢集登錄資料庫） 還原所有目前叢集的資訊很好，您會使用與還原非權威。 可以透過 Windows NT Backup 介面或命令列 WBADMIN 完成非權威還原。EXE。

一旦您還原的節點時，就讓它加入叢集。 接下來就是它會送出至現有的執行叢集，並更新其資訊的所有目前的狀態有。

### <a name="authoritative"></a>授權

系統授權還原的叢集組態中，相反地，把叢集設定帶回到過去。 叢集資訊本身已經遺失且需要還原時，應該只完成這種類型的還原。 比方說，有人不小心刪除包含超過 1000 個共用的檔案伺服器，並傳回需要。 完成叢集的系統授權還原需要備份，從命令列執行。

在叢集節點上起始系統授權還原時，叢集服務已停止在 [叢集] 檢視中的其他所有節點上和叢集設定已凍結。 這就是為什麼很重要，在其執行還原的節點上的叢集服務啟動第一次讓形成叢集時使用的叢集組態的新複本。

若要執行系統授權還原，請完成下列步驟。

1.  執行 WBADMIN。從 系統管理命令提示字元的 EXE 以取得您想要安裝，並確保系統狀態是其中一個元件的備份的最新版本可以還原。

    ```powershell
    Wbadmin get versions
    ```

2.  判斷您擁有的版本備份中是否擁有叢集登錄資訊做為元件。 有幾個項目，您必須從這個命令、 版本以及在步驟 3 中使用應用程式/元件。 版本，例如，假設已完成備份 2018 年 1 月 3 日上午 2:04，而這是的一個您需要還原。

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  開始進行系統授權還原復原只叢集登錄您需要的版本。 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

一旦還原已執行，此節點必須是第一次啟動叢集服務和構成叢集。 所有其他節點則會需要啟動，並加入叢集。

## <a name="summary"></a>總結 

若要註冊加總這、 超融合式災害復原。 應該仔細地規劃出的項目 有幾個案例，可以最適合您的需求，並應該經過徹底測試。 要注意的一個項目是如果您已熟悉使用容錯移轉叢集在過去，延展式叢集有多年的非常受歡迎的選項。 有一堆與超融合解決方案的設計變更而且它根據復原。 如果您失去了在超交集叢集中的兩個節點，在整個叢集中會停機。 此案例中的，在超融合式環境中，則不支援自動縮放的案例。


