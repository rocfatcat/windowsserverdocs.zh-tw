---
title: 超融合式基礎結構的災害復原案例
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: 本文章說明現已針對 Microsoft HCI （儲存空間直接存取） 的嚴重損壞修復案例
ms.localizationpriority: medium
ms.openlocfilehash: 32bbf02ca78d5c6a2147162768c984d0e0b27e36
ms.sourcegitcommit: dfd25348ea3587e09ea8c2224237a3e8078422ae
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/16/2018
ms.locfileid: "4678607"
---
# 使用儲存空間直接存取的災害復原

> 適用於： Windows Server 2019、 Windows Server 2016

本主題提供如何超融合式基礎結構 (HCI) 上的案例可設定的災害復原。

許多公司會執行超融合式解決方案，並在發生嚴重損壞規劃可讓處於或回到生產快速地在發生嚴重損壞好像發生。 有數種方式來設定針對嚴重損壞修復 HCI 與本文件說明現今可供您的選項。

當發生嚴重損壞時還原可用性的討論為中心已知為復原時間目標 (RTO)。 這是時間的特定對象的位置服務必須以避免商務版無法接受後果還原的持續時間。 在某些情況下，此程序會自動與實際執行環境還原幾乎立即發生。 在其他情況下，系統管理員手動介入必須還原服務會發生。

今日是使用超融合的災害復原選項：

1. 多個叢集強調運用儲存體複本
2. 叢集之間的 HYPER-V 複本
3. 備份與還原

## 多個叢集強調運用儲存體複本

[儲存體複本](../storage-replica/storage-replica-overview.md)可讓複寫的磁碟區，並支援同步和非同步複寫。 在選擇之間使用同步或非同步複寫時，您應該考慮復原點目標 (RPO)。 復原點目標是您願意支付之前就會被視為主要遺失的可能的資料遺失的數量。 如果您使用同步複寫時，它會將循序寫入兩端在同一時間。 如果您使用非同步，寫入會非常快速複寫，但仍然可能會遺失。 您應該考慮以查看這最適合適用於您的應用程式或檔案使用量。

儲存體複本是一個區塊層級複製機制，相較於檔案層級;這表示，它並不重要複寫的資料的類型。 這可讓您受歡迎的選擇為超融合式基礎結構。 儲存體複本也可以利用不同類型的磁碟機之間複寫合作夥伴，因此讓所有的一種類型的存放裝置上一個 HCI 和另一個類型儲存在其他是最適合。 

儲存體複本的一個重要功能是，它可以在執行 Azure，以及內部部署。 您可以設定內部部署至內部，Azure 至 Azure 或甚至是內部部署至 Azure （反之亦然）。

在此案例中，有兩個不同的獨立叢集。 如需設定 HCI 之間的儲存體複本，您可以依照[叢集對叢集儲存體複寫](../storage-replica/cluster-to-cluster-storage-replication.md)中的步驟。

![儲存體複寫圖表](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure1.png)

下列考量適用於部署儲存體複本 」 時。 

1.  設定複寫是完成以外容錯移轉叢集。 
2.  選擇複寫的方法將會取決於您的網路延遲和 RPO 需求。 同步複寫低延遲的網路上的資料使用絕對一致性，以不確保遺失任何資料的失敗，一次。 非同步會向內複寫的資料透過網路與更高的延遲，但每個網站可能沒有相同複本失敗一次。 
3.  在發生嚴重損壞，容錯移轉叢集之間不是自動，且需要手動可透過儲存體複本 PowerShell cmdlet 協調。 上述圖表中 ClusterA 是主要而 ClusterB 是次要。 如果 ClusterA 故障時，您必須手動設定為主要 ClusterB，您可以將資源之前。 一旦 ClusterA 備份好時，您必須讓它次要伺服器。 一旦所有資料有已設定同步都處理，進行變更，而且交換角色回到他們原先已設定的方式。
4.  儲存體複本僅複寫的資料，因為新的虛擬機器或縮放比例出檔案伺服器 (SOFS) 利用此資料必須複本合作夥伴上建立容錯移轉叢集管理員內。

如果您有虛擬機器或在您的叢集上執行 SOFS，可以使用儲存體複本。 帶入複本 HCI 線上資源可以手動或透過使用 PowerShell 指令碼自動化。

## Hyper-V 複本

[HYPER-V 複本](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica)提供超融合式基礎結構上的虛擬機器的災害復原層級的複寫。 HYPER-V 複本可以採取什麼動作是採取虛擬機器，並將它複製到次要的網站或 Azure （複本）。 然後從第二個站台，HYPER-V 複本可以將複寫虛擬機器到第三個 （延伸的複本）。

![HYPER-V 複本圖表](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure2.png)

HYPER-V 複本的複寫是由負責 HYPER-V。 當您第一次啟用適用於複寫的虛擬機器時，有三個選項適用於您想在初始複本如何傳送到對應的複本叢集。

1.  在網路上傳送初始複製
2.  將初始複製傳送到外部媒體，以便可以將它複製到您的伺服器上手動
3.  使用現有的虛擬機器中已建立的複本主機

另一個選項是針對您想要應執行這個初始複寫。

1.  立即開始複寫
2.  排程在初始複寫時會發生的時間。 

您將需要其他考量是：

- 哪些 VHD/VHDX 的您想要複寫。 您可以選擇複寫它們的所有或只有一個。
- 您想要儲存的復原點數目。 如果您想要有幾個選項的相關項目在您想要還原的時間點，您會想要指定您想多少。 如果您只想要一個還原點，您可以也可選擇。
- 頻率，以及您想要讓磁碟區陰影複製服務 (VSS) 複寫增量陰影複製。
- 頻率，以及變更複寫 （30 秒，5 分鐘，15 分鐘）。

HCI 參與 HYPER-V 複本，您必須建立每個叢集中的[HYPER-V 複本代理程式](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/)資源。 此資源會進行幾件事：

1.  適用於連線至 HYPER-V 複本的每個叢集，提供您的單一命名空間。
2.  決定哪一個複本 （或延伸的複本） 將會位於時第一次收到複製該叢集內的節點。
3.  會追蹤的哪一個節點擁有複本 （或延伸的複本） 以便在虛擬機器移至另一個節點。 它需要追蹤，因此當複寫時花費的地方，它可以資訊傳送到適當的節點。

## 備份與還原

一個傳統發生嚴重損壞修復 \] 選項不討論太多，但一樣重要的是整個叢集或叢集中的節點失敗。 這個案例中使用任一選項可讓您使用的 Windows NT 備份。 

總是有定期備份超融合式基礎結構的建議。 當執行叢集服務時，如果您花系統狀態備份時，叢集登錄資料庫會是該備份的一部分。 還原叢集或資料庫有兩個不同的方法 （非授權和授權）。

### 非授權

非授權的還原可完成使用 Windows NT 備份和等於只是叢集節點本身的完整還原。 如果您只需要還原叢集節點 （與叢集登錄資料庫） 和所有目前叢集資訊良好，您會還原使用非授權。 非授權還原可以透過 Windows NT 備份介面或命令列 WBADMIN 來完成。EXE。

一旦您還原節點，讓它加入叢集。 會發生什麼事是資訊的會前往現有執行叢集並使用什麼是資訊的目前有更新的所有。

### 授權

相反地，授權還原的叢集設定中，會採用叢集設定回復的時間。 已遺失並需要還原本身的叢集資訊時，這種類型的還原應該只達到這個目的。 例如，有人意外刪除包含超過 1000 個共用的檔案伺服器和回需要。 完成叢集的授權還原需要從命令列會執行備份。

當授權還原起始叢集節點上時，叢集服務已停止叢集檢視中的所有其他節點上，並凍結叢集設定。 這就是為什麼是非常重要，讓叢集中的正確使用新的叢集設定複本上執行還原的節點的叢集服務第一次啟動。

若要執行透過授權還原，可以完成下列步驟。

1.  執行 WBADMIN。從 \ [系統管理命令提示字元 EXE 以取得最新版本的備份您想要安裝，並確保系統狀態其中一個元件，您可以還原。

    ```powershell
    Wbadmin get versions
    ```

2.  判斷是否版本備份，您必須有叢集登錄資訊在它做為元件。 有幾個項目，您將需要此命令、 版本和步驟 3 中使用應用程式/元件。 適用於版本，例如，假設備份已完成 2018 年 1 月 3 日上午 2:04，而這就是您需要還原。

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  開始授權還原復原只叢集登錄您需要的版本。 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

一旦還原已採取的地方，此節點必須是第一次啟動叢集服務和形成叢集。 所有其他節點則會需要啟動並加入叢集。

## 摘要 

若要所有最多加總這，超融合式災害復原是應該仔細計出的項目。 有數個案例可以最適合您的需求，且應進行全面測試。 注意的是一個項目是如果您已熟悉容錯移轉叢集在過去，延展式叢集有已多年非常受歡迎的選擇。 超融合式解決方案的設計變更的位元，它根據復原。 如果您遺失的超融合式叢集在兩個節點，整個叢集都會向下。 使用此正在的情況下，在超融合式環境中，不支援的延展式案例。


