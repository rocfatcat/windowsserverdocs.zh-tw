---
title: 了解叢集與集區仲裁
description: 使用特定的範例，說明複雜一點，了解叢集和集區仲裁。
keywords: 儲存空間直接存取，仲裁見證，S2D，叢集仲裁，集區仲裁叢集，集區
ms.prod: windows-server-threshold
ms.author: adagashe
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: adagashe
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 24890b191db8bc6934132857e830d4f77c394b02
ms.sourcegitcommit: 28dc7c7f1e44fee7ab2112228af329a9ce0e02ba
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/22/2019
ms.locfileid: "9024081"
---
# 了解叢集與集區仲裁

>適用於： Windows Server 2019、 Windows Server 2016

[Windows Server 容錯移轉叢集](../../failover-clustering/failover-clustering-overview.md)提供高可用性的工作負載。 這些資源會視為裝載資源的節點會向上; 如果高可用性不過，叢集通常需要執行，多個半數的節點這稱為 「 擁有*仲裁*。

仲裁設計來防止*拆分式*網路中沒有磁碟分割和節點的子集無法與彼此通訊時可能會發生的案例。 這可能會造成這兩個子集嘗試擁有工作負載，並撰寫相同的磁碟這可能會導致許多問題的節點。 不過，這就無法使用的仲裁這其中一個節點以繼續執行，因此只有其中一個這些群組都會保持上線的群組會強制的容錯移轉叢集的概念。

仲裁決定叢集可承受時，仍能夠線上的失敗的次數。 仲裁被設計來處理案例的子集叢集節點之間的通訊有問題時，讓多部伺服器不要嘗試同時裝載資源群組，以及同時撰寫相同的磁碟。 透過由的仲裁此概念，叢集會強制叢集服務停止在其中一個節點，以確保只有一個，則為 true 的擁有者的特定資源群組的子集。 一旦都已停止的節點同樣可以與主要群組的節點通訊，它們將會自動重新加入叢集並啟動其叢集服務。

在 Windows Server 2016 中，有兩個元件都有自己的仲裁機制系統：

- <strong>叢集仲裁</strong>： 這會在叢集層級運作 （亦即可以失去節點，並讓保持向上叢集）
- <strong>集區為仲裁</strong>： 啟用儲存空間直接存取時，這運作的集區層級 （亦即可以遺失節點和磁碟機，並讓設定保持集區）。 儲存集區已使用所設計，在叢集與非叢集案例中，這也是他們需要不同的仲裁機制的原因。

## 叢集仲裁概觀

下表提供每個案例的叢集仲裁結果的概觀：

| 伺服器節點 | 可以倖存一個伺服器節點失敗 | 一部伺服器節點失敗，則另一個可以倖存 | 可以倖存兩個同時發生的伺服器節點失敗 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 隨機化 50/50                               | 否                                                | 否                                                 |
| 2 + 見證  | 是                                 | 否                                                | 否                                                 |
| 3            | 是                                 | 隨機化 50/50                                             | 否                                                 |
| 3 + 見證  | 是                                 | 是                                               | 否                                                 |
| 4            | 是                                 | 是                                               | 隨機化 50/50                                              |
| 4 + 見證  | 是                                 | 是                                               | 是                                                |
| 5 和以上版本  | 是                                 | 是                                               | 是                                                |

### 叢集仲裁建議

- 如果您有兩個節點，見證是<strong>必要</strong>。
- 如果您有三或四個節點，見證是<strong>強烈建議</strong>。
- 如果您有網際網路存取，請使用<strong>[雲端見證](../../failover-clustering/deploy-cloud-witness.md)</strong>
- 如果您在與其他電腦或檔案共用 IT 環境中，請使用檔案共用見證

## 叢集仲裁的運作方式

當節點失敗時，或當節點的一些子集失去連絡人與另一個子集，留存節點需要確認它們構成保持線上叢集的*大部分*。 如果他們無法驗證的它們將離線。

但*大部分*的概念只適用於完全時 （例如，在五個節點叢集中的三個節點） 奇特的叢集中的節點總數。 因此，怎麼辦具有偶數節點 （說，四個節點的叢集） 的叢集中？

有兩個叢集可以讓*總數票數*奇特的方式：

1. 首先，它可以瀏覽*向上*其中一個新增額外的投票與*見證*。 這需要使用者設定。
2.  或者，它可以跳*往下*一個清空一個不幸節點的投票 （視自動發生）。

每當留存節點成功確認它們是*大部分*，*大部分*的定義會更新，成為存留者。 這可以讓叢集失去一個節點，然後另一個，然後另一個，等等。 這個概念的*總數目票數*，適應之後連續失敗稱為 「 <strong>*動態仲裁*</strong>。  

### 動態見證

動態見證切換見證，以確保*總數票數*奇特的投票。 如果沒有奇特的投票數，見證沒有投票。 如果有偶數票數，見證有投票。 動態見證可大幅減少叢集會向下因為見證失敗的風險。 叢集決定是否要使用的見證投票根據投票節點的叢集中可用的數目。

動態仲裁搭配動態見證，如下所述的方式。

### 動態仲裁行為

- 如果您有<strong>即使</strong>數量的節點和任何見證、*一個節點取得其投票歸零*。 例如，只有三個四個節點，以取得票數，因此*總數票數*是三個，而票數具有兩個存留者會被視為大部分。
- 如果您有<strong>奇特</strong>數量的節點和任何見證、*所有他們取得投票*。
- 如果您有<strong>即使</strong>數量的節點，再加上見證，*投票見證*，因此是奇特的總計。
- 如果您有<strong>奇特</strong>數量的節點，再加上見證，*不會投票見證*。

動態仲裁可讓您能夠將獲得票數指派給動態以避免遺失大部分的票數，並允許使用一個節點 （稱為最後競賽） 來執行叢集的節點。 做為範例，我們來看四個節點的叢集。 假設該仲裁需要 3 個投票。 

在此情況下，叢集會已經關閉如果失去兩個節點。

![圖表顯示四個叢集節點，其中每一個會獲得票數](media/understand-quorum/dynamic-quorum-base.png)

不過，動態仲裁會防止這種情況發生。 供仲裁所需的*總數目票數*現在會根據數量的節點可用來決定。 因此，您也可以使用動態仲裁，叢集會保持向上，即使您遺失三個節點。

![此圖顯示四個叢集節點，使用節點失敗的一個在時間，以及每個失敗後調整必要票數數目。](media/understand-quorum/dynamic-quorum-step-through.png)

一般的叢集中不會有儲存空間直接存取啟用適用於上述的案例。 不過，儲存空間直接存取啟用時，叢集只能支援兩個節點失敗。 這是[集區仲裁一節](#poolQuorum)中深入說明。

### 範例

#### 兩個節點，而見證。 
一個節點投票歸零，因此*大部分*投票決定不使用，總共有<strong>1 投票</strong>。 如果非投票節點意外故障，保養有 1/1 和叢集便會存在著。 如果投票節點意外故障，保養具有 0/1 和叢集停機。 如果投票節點正常關閉電源，投票轉移到另一個節點，而叢集便會存在著。 *<strong>這是它來設定見證重要的原因。</strong>*

![有兩個節點，而見證案例中所述的仲裁](media/understand-quorum/2-node-no-witness.png)

- 可以倖存一個伺服器故障： <strong>50%的機率</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>否</strong>。
- 可以一次倖存兩個伺服器故障：<strong>否</strong>。 

#### 在有兩個節點。 
這兩個節點投票，再加上見證票數，因此*大部分*決定不使用，總共有<strong>3 個票數</strong>。 如果任一節點故障，保養有 2/3 和叢集便會存在著。

![仲裁含有兩個節點的情況中所述的見證](media/understand-quorum/2-node-witness.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>否</strong>。
- 可以一次倖存兩個伺服器故障：<strong>否</strong>。 

#### 三個節點，而見證。
所有節點都投票，因此*大部分*決定不使用，總共有<strong>3 個票數</strong>。 如果任何節點會向下，存留者是 2/3，而且叢集便會存在著。 叢集會變成兩個節點，而見證 – 在這個時候，您就是在案例 1。

![含有三個節點，而見證的情況中所述的仲裁](media/understand-quorum/3-node-no-witness.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存： <strong>50%的機率</strong>。
- 可以一次倖存兩個伺服器故障：<strong>否</strong>。 

#### 在有三個節點。
所有節點都投票，所以一開始就不會都投票見證。 *大部分*決定不使用，總共有<strong>3 個票數</strong>。 一個失敗後，叢集會有兩個節點見證 – 是案例 2。 因此，現在兩個節點與見證投票。

![仲裁含有三個節點的情況中所述的見證](media/understand-quorum/3-node-witness.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>是</strong>。
- 可以一次倖存兩個伺服器故障：<strong>否</strong>。 

#### 四個節點，而見證
一個節點投票歸零，因此*大部分*決定不使用，總共有<strong>3 個票數</strong>。 一個失敗後，叢集會變成三個節點，且您急案例 3 中。

![使用四個節點，而見證案例中所述的仲裁](media/understand-quorum/4-node-no-witness.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>是</strong>。
- 可以一次倖存兩個伺服器故障： <strong>50%的機率</strong>。 

#### 在有四個節點。
所有節點票數和見證票數，因此*大部分*決定不使用，總共有<strong>5 票數</strong>。 一個失敗後，您就是在案例 4。 在兩個同時發生失敗之後, 您略過至案例 2。

![仲裁見證與說明在案例中有四個節點](media/understand-quorum/4-node-witness.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>是</strong>。
- 可以一次倖存兩個伺服器故障：<strong>是</strong>。 

#### 五個節點和外。
所有節點都投票，或所有但一個都投票，任何可讓奇特的總計。 儲存空間直接存取無法處理多個兩個節點向下逕，因此在這個時候，沒有見證是所需的或非常有用。

![在案例中具有五個節點及更新版本中所述的仲裁](media/understand-quorum/5-nodes.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>是</strong>。
- 可以一次倖存兩個伺服器故障：<strong>是</strong>。 

現在，我們了解仲裁的運作方式，讓我們看看類型的仲裁見證。

### 仲裁見證類型

容錯移轉叢集支援三種類型的仲裁見證：

- <strong>[雲端見證](../../failover-clustering\deploy-cloud-witness.md)</strong> -在無障礙的 Azure 儲存體 Blob 所有節點的叢集。 它會維持在 witness.log 檔案中，叢集的資訊，但不會儲存一份叢集資料庫。
- <strong>檔案共用見證</strong>– 在執行 Windows Server 檔案伺服器上設定 A SMB 檔案共用。 它會維持在 witness.log 檔案中，叢集的資訊，但不會儲存一份叢集資料庫。
- <strong>磁碟見證</strong>-也就是叢集可用的存放裝置群組中的小型叢集的磁碟。 此磁碟是 [高可用性，而且可以節點之間的容錯移轉。 它包含一份叢集資料庫。  <strong>*磁碟見證不支援使用儲存空間直接存取*</strong>。

## <a id="poolQuorum"></a>集區仲裁概觀

我們只會討論叢集仲裁，叢集層級會運作。 現在，讓我們深入了解集區仲裁，集區層級 （也就是您可能會遺失的節點和磁碟機，並有保持向上集區） 運作。 儲存集區已使用所設計，在叢集與非叢集案例中，這也是他們需要不同的仲裁機制的原因。

下表提供每個案例的集區仲裁結果的概觀：

| 伺服器節點 | 可以倖存一個伺服器節點失敗 | 一部伺服器節點失敗，則另一個可以倖存 | 可以倖存兩個同時發生的伺服器節點失敗 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 否                                  | 否                                                | 否                                                 |
| 2 + 見證  | 是                                 | 否                                                | 否                                                 |
| 3            | 是                                 | 否                                                | 否                                                 |
| 3 + 見證  | 是                                 | 否                                                | 否                                                 |
| 4            | 是                                 | 否                                                | 否                                                 |
| 4 + 見證  | 是                                 | 是                                               | 是                                                |
| 5 和以上版本  | 是                                 | 是                                               | 是                                                |

## 集區仲裁的運作方式

當磁碟機故障時，或磁碟機的一些子集失去連絡人與另一個子集，留存的磁碟機需要確認它們構成保持線上集區的*大部分*。 如果他們無法驗證的它們將離線。 集區是離線或保持上線根據它是否具有足夠的磁碟，供仲裁的實體 （50%+ 1）。 集區資源擁有者 （作用中的叢集節點） 可以是 + 1。

但集區仲裁運作方式從叢集仲裁以下列方式：

- 集區使用一個節點中的叢集為平局分隔作為見證來倖存一半的磁碟機消失 （集區資源擁有此節點）
- 沒有動態仲裁集區。
- 集區不會實作自己的移除投票的版本

### 範例

#### 使用對稱式配置的四個節點。 
每個 16 磁碟機都有一個投票和第二個節點也有一個投票 （因為它是集區資源擁有者）。 *大部分*決定不使用，總共有<strong>16 票數</strong>。 如果節點三和四向下，留存子集都有 8 個磁碟機和集區資源擁有者，也就是 9/16 投票。 因此，集區便會存在著。

![集區仲裁 1](media/understand-quorum/pool-1.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>是</strong>。
- 可以一次倖存兩個伺服器故障：<strong>是</strong>。 

#### 使用對稱式版面配置和磁碟機失敗的四個節點。 
每個 16 磁碟機都有一個投票和節點 2 也有一個投票 （因為它是集區資源擁有者）。 *大部分*決定不使用，總共有<strong>16 票數</strong>。 首先，磁碟機 7 當機。 如果節點三和四向下，留存子集都有 7 磁碟機和集區資源擁有者，也就是 8/16 投票。 因此，集區不會有大部分，而且會向下。

![集區仲裁 2](media/understand-quorum/pool-2.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>否</strong>。
- 可以一次倖存兩個伺服器故障：<strong>否</strong>。 

#### 使用非對稱式配置的四個節點。 
24 磁碟機的每一個都有一個投票和第二個節點也有一個投票 （因為它是集區資源擁有者）。 *大部分*決定不使用，總共有<strong>24 票數</strong>。 如果節點三和四向下，留存子集都有 8 個磁碟機和集區資源擁有者，也就是 9/24 投票。 因此，集區不會有大部分，而且會向下。

![集區仲裁 3](media/understand-quorum/pool-3.png)

- 可以倖存一個伺服器故障：<strong>是</strong>。
- 一部伺服器失敗，則另一個可以倖存：<strong>相依</strong>（無法支撐如果這兩個節點三和四向下，但可以倖存所有其他案例。
- 可以一次倖存兩個伺服器故障：<strong>相依</strong>（無法支撐如果這兩個節點三和四向下，但可以倖存所有其他案例。

### 集區仲裁建議

- 請確定您的叢集中的每個節點是對稱 （每個節點具有相同數量的磁碟機）
- 啟用三向鏡像與雙同位，因此，您可以容忍節點失敗，並保留虛擬磁碟上線。 請參閱我們[的磁碟區指引頁面](plan-volumes.md)，如需詳細資訊。
- 如果超過兩個節點是向下，或兩個節點和另一個節點上的磁碟是向下，磁碟區可能無法存取其資料的所有三個複本並因此下半年離線並且無法使用。 建議您將伺服器帶回或取代快速以確保大部分的復原類型的磁碟區中的所有資料的磁碟。

## 更多資訊

- [設定和管理仲裁](../../failover-clustering/manage-cluster-quorum.md)
- [部署雲端見證](../../failover-clustering/deploy-cloud-witness.md)
