---
title: 了解叢集和集區仲裁
description: 使用超出錯綜複雜的特定範例，了解叢集和集區仲裁。
keywords: 儲存空間直接存取，仲裁見證、 S2D，叢集仲裁，集區仲裁叢集中，集區
ms.prod: windows-server-threshold
ms.author: adagashe
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: adagashe
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 66d4796a6ffb453f6edb5fed20dba29b70f7ec4b
ms.sourcegitcommit: ed27ddbe316d543b7865bc10590b238290a2a1ad
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/09/2019
ms.locfileid: "65476112"
---
# <a name="understanding-cluster-and-pool-quorum"></a>了解叢集和集區仲裁

>適用於：Windows Server 2019，Windows Server 2016

[Windows Server Failover Clustering](../../failover-clustering/failover-clustering-overview.md)為工作負載提供高可用性。 這些資源會被視為高可用性，如果裝載資源的節點都已啟動;不過，叢集通常需要一半以上的節點正在執行，這稱為具有*仲裁*。

仲裁為了防止*裂腦*可能發生在當網路中沒有資料分割，而且節點的子集無法彼此通訊的案例。 這會導致這兩個子集的節點，以嘗試擁有工作負載，並寫入至相同的磁碟，可能會導致許多問題。 不過，這就無法使用的仲裁，這會強制只有其中一個節點，以繼續執行，因此只有其中一個這些群組會維持在線上的這些群組的容錯移轉叢集的概念。

仲裁會決定叢集可承受同時仍維持上線的失敗次數。 仲裁被設計來處理案例的叢集節點子集間的通訊發生問題時，讓多部伺服器不嘗試同時裝載資源群組，並同時寫入相同的磁碟。 擁有這個概念的仲裁，叢集會強制停止其中一個子集的節點，以確保只有一個，則為 true 的擁有者的特定資源群組中的叢集服務。 一旦已停止的節點同樣可以與節點的主要群組通訊，它們就會自動重新加入叢集，並啟動叢集服務。

在 Windows Server 2019 和 Windows Server 2016 中，有兩個都有自己的仲裁機制系統的元件：

- <strong>叢集仲裁</strong>:這會在叢集層級 （也就是您可以遺失節點且有維持叢集）
- <strong>集區仲裁</strong>:這會在集區層級上啟用儲存空間直接存取時 （也就是可以遺失節點和磁碟機，然後保持運作的集區）。 存放集區已設計來在叢集和非叢集的情況下，這也是為什麼它們有不同的仲裁的機制。

## <a name="cluster-quorum-overview"></a>叢集仲裁的概觀

下表提供每個案例的叢集仲裁結果的概觀：

| 伺服器節點 | 不會受一個伺服器節點失敗 | 不會受一部伺服器的節點失敗，則另一個 | 可以存留下來的兩個同步伺服器節點失敗 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 50/50                               | 否                                                | 否                                                 |
| 2 + 見證  | 是                                 | 否                                                | 否                                                 |
| 3            | 是                                 | 50/50                                             | 否                                                 |
| 3 + 見證  | 是                                 | 是                                               | 否                                                 |
| 4            | 是                                 | 是                                               | 50/50                                              |
| 4 + 見證  | 是                                 | 是                                               | 是                                                |
| 5 和更新版本  | 是                                 | 是                                               | 是                                                |

### <a name="cluster-quorum-recommendations"></a>叢集仲裁的建議

- 如果您有兩個節點，見證會<strong>必要</strong>。
- 您有三或四個節點，見證是否<strong>強烈建議</strong>。
- 如果您有網際網路存取時，使用<strong>[雲端見證](../../failover-clustering/deploy-cloud-witness.md)</strong>
- 如果您是在其他電腦和檔案共用的 IT 環境中，使用檔案共用見證

## <a name="how-cluster-quorum-works"></a>叢集仲裁的運作方式

當節點失敗時，或節點子集失去和另一個子集，仍正常運作的節點都必須確認它們構成*多數*維持線上狀態的叢集。 如果它們無法驗證的它們會變成離線狀態。

但的概念*多數*僅適用於完全在叢集中的節點總數時 （例如，在五個節點叢集中的三個節點） 的奇數。 因此，呢具有偶數數目的節點 （例如，四個節點叢集） 的叢集？

有兩種方式可以進行叢集*總投票數*奇數：

1. 首先，它可以放*向上*加上其中一個*見證*使用額外的一票。 這需要使用者設定。
2.  或者，它可以移*往下*一個清空 （視需要自動發生） 的一個背節點的投票。

每當存活節點成功確定它們是*多數*，定義*多數*更新為只是存留者之間。 這可讓叢集失去一個節點，然後另一個，然後另一個，等等。 此概念*總數投票*調整在連續失敗之後就所謂<strong>*動態仲裁*</strong>。  

### <a name="dynamic-witness"></a>動態見證

動態見證切換的投票見證，請確定*總投票數*是奇數。 如果有奇數數目的投票，見證不會有一票。 如果有偶數數目的投票，見證具有投票。 動態的見證會大幅降低叢集會因為見證失敗而停機的風險。 叢集會決定是否要使用見證投票可在叢集中的投票節點數目為基礎。

動態仲裁搭配動態的見證，如下所述的方式。

### <a name="dynamic-quorum-behavior"></a>動態仲裁行為

- 如果您有<strong>甚至</strong>的節點和沒有見證，數字*一個節點被歸其投票*。 例如，只有三個四個節點取得投票，因此*總投票數*為第三，將投票的兩個未回收物件會被視為多數。
- 如果您有<strong>奇數</strong>的節點和沒有見證，數字*都取得投票*。
- 如果您有<strong>甚至</strong>節點，再加上見證，數字*見證投票*，因此總計為奇數。
- 如果您有<strong>奇數</strong>節點，再加上見證，數字*投票見證不*。

動態仲裁可讓您將投票指派給節點，以動態方式以避免遺失多數票，並允許叢集以執行且 （又稱為上次存活） 的其中一個節點。 讓我們看一個四節點的叢集作為範例。 假設仲裁需要 3 個投票。 

在此情況下，叢集就已經關閉如果遺失兩個節點。

![圖表顯示四個叢集節點，其中每一個獲得票數](media/understand-quorum/dynamic-quorum-base.png)

不過，動態仲裁會讓這種情況。 *總投票數*所需的仲裁現在取決於可用節點數目。 因此，您也可以使用動態仲裁，叢集仍會保持運作，即使您遺失了三個節點。

![此圖表顯示四個叢集節點，節點發生故障的時間和調整每個失敗之後的必要投票數。](media/understand-quorum/dynamic-quorum-step-through.png)

上述的案例適用於沒有儲存空間直接存取啟用的一般叢集。 不過，儲存空間直接存取啟用時，叢集只能支援兩個節點失敗。 這會說明更[集區仲裁區段](#poolQuorum)。

### <a name="examples"></a>範例

#### <a name="two-nodes-without-a-witness"></a>不具見證的兩個節點。 
一個節點的投票空的因此*多數*投票決定共有<strong>1 投票</strong>。 如果非投票節點意外關閉，存活者只有 1/1，而且叢集不受影響。 如果投票節點意外關閉，存活者具有 0/1，而且叢集將會中斷。 如果投票節點順利關機，將 「 投票 」 會轉移至其他節點，和叢集不受影響。 *<strong>這就是為什麼很重要設定見證。</strong>*

![在具有兩個節點不具見證的情況下所述的仲裁](media/understand-quorum/2-node-no-witness.png)

- 不會受一伺服器失敗：<strong>50%的機率</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>否</strong>。
- 一次就能存活兩個伺服器失敗：<strong>否</strong>。 

#### <a name="two-nodes-with-a-witness"></a>含有見證的兩個節點。 
這兩個節點投票，加上見證投票，因此*多數*決定共有<strong>3 的投票</strong>。 如果任一個節點關閉時，存活者只有 2/3，而且叢集不受影響。

![說明在具有兩個節點的情況下搭配見證仲裁](media/understand-quorum/2-node-witness.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>否</strong>。
- 一次就能存活兩個伺服器失敗：<strong>否</strong>。 

#### <a name="three-nodes-without-a-witness"></a>不具見證的三個節點。
所有的節點投票，因此*多數*決定共有<strong>3 的投票</strong>。 如果任何節點故障時，未回收物件都是 2/3，叢集不受影響。 叢集變成不具見證的兩個節點 – 此時，您是在案例 1 中。

![說明在案例中使用不具見證的三個節點的仲裁](media/understand-quorum/3-node-no-witness.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>50%的機率</strong>。
- 一次就能存活兩個伺服器失敗：<strong>否</strong>。 

#### <a name="three-nodes-with-a-witness"></a>含有見證的三個節點。
所有的節點投票，讓見證不一開始進行投票。 *多數*決定共有<strong>3 的投票</strong>。 一個失敗之後，叢集會有兩個節點，見證 – 也就是案例 2。 因此，現在的兩個節點和見證投票。

![說明在具有三個節點的情況下搭配見證仲裁](media/understand-quorum/3-node-witness.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>是</strong>。
- 一次就能存活兩個伺服器失敗：<strong>否</strong>。 

#### <a name="four-nodes-without-a-witness"></a>不具見證的四個節點
一個節點的投票空的因此*多數*決定共有<strong>3 的投票</strong>。 一個失敗之後，叢集會變成三個節點，而您是在案例 3。

![說明在案例中使用不具見證的四個節點的仲裁](media/understand-quorum/4-node-no-witness.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>是</strong>。
- 一次就能存活兩個伺服器失敗：<strong>50%的機率</strong>。 

#### <a name="four-nodes-with-a-witness"></a>含有見證的四個節點。
所有的節點投票和見證投票中，因此*多數*決定共有<strong>5 投票</strong>。 一次失敗之後，您已在案例 4 中。 在兩個同時失敗之後, 您直接跳到 案例 2。

![說明在使用四個節點的情況下搭配見證仲裁](media/understand-quorum/4-node-witness.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>是</strong>。
- 一次就能存活兩個伺服器失敗：<strong>是</strong>。 

#### <a name="five-nodes-and-beyond"></a>五個節點及更新版本。
所有的節點投票，或所有保留一個投票，任何讓奇數的總計。 儲存空間直接存取無法處理兩個以上的節點下，所以在此階段，不含見證所需或最實用。

![在五個節點和更新版本的情況下所述的仲裁](media/understand-quorum/5-nodes.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>是</strong>。
- 一次就能存活兩個伺服器失敗：<strong>是</strong>。 

既然我們已經了解仲裁如何運作，讓我們看看仲裁見證的類型。

### <a name="quorum-witness-types"></a>仲裁見證類型

容錯移轉叢集支援三種類型的仲裁見證：

- <strong>[雲端見證](../../failover-clustering\deploy-cloud-witness.md)</strong> -Blob 存取的 Azure 儲存體叢集中的所有節點。 它會維持在存在於 witness.log 檔案中，叢集資訊，但不會儲存叢集資料庫的複本。
- <strong>檔案共用見證</strong>– 設定執行 Windows Server 檔案伺服器的 SMB 檔案共用。 它會維持在存在於 witness.log 檔案中，叢集資訊，但不會儲存叢集資料庫的複本。
- <strong>磁碟見證</strong>-小型的叢集的磁碟是叢集可用的存放裝置群組中。 此磁碟是高可用性，而且可以在節點之間的容錯移轉。 它包含叢集資料庫的複本。  <strong>*使用儲存空間直接存取不支援的磁碟見證*</strong>。

## <a id="poolQuorum"></a>集區仲裁概觀

我們剛剛有提到叢集仲裁，在叢集層級運作。 現在，讓我們深入了解集區仲裁，即會在集區層級 （也就是您可能會遺失節點和磁碟機，必須保持運作的集區） 上運作。 存放集區已設計來在叢集和非叢集的情況下，這也是為什麼它們有不同的仲裁的機制。

下表提供每個案例的集區仲裁結果的概觀：

| 伺服器節點 | 不會受一個伺服器節點失敗 | 不會受一部伺服器的節點失敗，則另一個 | 可以存留下來的兩個同步伺服器節點失敗 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 否                                  | 否                                                | 否                                                 |
| 2 + 見證  | 是                                 | 否                                                | 否                                                 |
| 3            | 是                                 | 否                                                | 否                                                 |
| 3 + 見證  | 是                                 | 否                                                | 否                                                 |
| 4            | 是                                 | 否                                                | 否                                                 |
| 4 + 見證  | 是                                 | 是                                               | 是                                                |
| 5 和更新版本  | 是                                 | 是                                               | 是                                                |

## <a name="how-pool-quorum-works"></a>集區仲裁的運作方式

當磁碟機失敗時，或磁碟機的一些失去和另一個子集，仍正常運作的磁碟機需要驗證，它們會構成*多數*維持線上狀態的集區。 如果它們無法驗證的它們會變成離線狀態。 集區會離線，或為線上狀態是否有足夠的磁碟，仲裁為基礎的實體 （50%+ 1）。 集區資源擁有者 （使用中叢集節點） 可以是 + 1。

但是，集區仲裁運作方式與不同叢集仲裁如下：

- 集區使用一個節點在叢集中作為見證，以做為延長存留一半的磁碟機不存在 （此集區資源擁有者的節點）
- 沒有動態仲裁集區。
- 集區不會實作自己的移除投票版本

### <a name="examples"></a>範例

#### <a name="four-nodes-with-a-symmetrical-layout"></a>使用對稱式配置的四個節點。 
每個 16 的磁碟機都有一個投票，第二個節點也有一票 （因為它是集區資源擁有者）。 *多數*決定共有<strong>16 投票</strong>。 如果三和四個節點關閉，仍正常運作的子集有 8 的磁碟機和集區資源擁有者，也就是 9/16 投票。 因此，不受影響的集區。

![集區仲裁 1](media/understand-quorum/pool-1.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>是</strong>。
- 一次就能存活兩個伺服器失敗：<strong>是</strong>。 

#### <a name="four-nodes-with-a-symmetrical-layout-and-drive-failure"></a>對稱式配置和磁碟機失敗的四個節點。 
每個 16 的磁碟機都有一個投票，節點 2 也有一票 （因為它是集區資源擁有者）。 *多數*決定共有<strong>16 投票</strong>。 首先，7 的磁碟機故障了。 如果三和四個節點關閉，仍正常運作的子集有 7 的磁碟機和集區資源擁有者，也就是 8/16 投票。 因此，集區沒有多數，而且當機。

![集區仲裁 2](media/understand-quorum/pool-2.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>否</strong>。
- 一次就能存活兩個伺服器失敗：<strong>否</strong>。 

#### <a name="four-nodes-with-a-non-symmetrical-layout"></a>使用非對稱式配置的四個節點。 
每個 24 的磁碟機都有一個投票，第二個節點也有一票 （因為它是集區資源擁有者）。 *多數*決定共有<strong>24 投票</strong>。 如果三和四個節點關閉，仍正常運作的子集有 8 的磁碟機和集區資源擁有者，也就是 9 月 24 投票。 因此，集區沒有多數，而且當機。

![集區仲裁 3](media/understand-quorum/pool-3.png)

- 不會受一伺服器失敗：<strong>是</strong>。
- 不會受一部伺服器失敗，則另一個：<strong>取決於</strong>（無法存活下來如果三和四個兩個節點發生故障，但不會受其他所有案例。
- 一次就能存活兩個伺服器失敗：<strong>取決於</strong>（無法存活下來如果三和四個兩個節點發生故障，但不會受其他所有案例。

### <a name="pool-quorum-recommendations"></a>集區仲裁建議

- 請確定在叢集中的每個節點為對稱 （每個節點有相同數目的磁碟機）
- 啟用三向鏡像或雙重同位檢查，以便您可以容忍節點失敗，並將保留虛擬磁碟已上線。 請參閱我們[磁碟區指引頁面](plan-volumes.md)如需詳細資訊。
- 超過兩個節點已關閉，或兩個節點和磁碟上的另一個節點關閉時，磁碟區不能存取所有的三個複本，他們的資料，並因此離線，並且無法使用。 建議您帶回伺服器，或取代快速以確保大部分的復原磁碟區中的所有資料磁碟。

## <a name="more-information"></a>詳細資訊

- [設定和管理仲裁](../../failover-clustering/manage-cluster-quorum.md)
- [部署雲端見證](../../failover-clustering/deploy-cloud-witness.md)
