---
title: 使用儲存體遷移服務遷移檔案伺服器
description: 搜尋引擎結果主題的簡短描述
author: jasongerend
ms.author: jgerend
manager: elizapo
ms.date: 02/13/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: f90ffe5b6a81ab1b4c2616dce08c98cbd8c065b4
ms.sourcegitcommit: a35ce5b166175c905edd09005b94e96ad48c57a7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/12/2019
ms.locfileid: "70936971"
---
# <a name="use-storage-migration-service-to-migrate-a-server"></a>使用儲存體遷移服務來遷移伺服器

本主題討論如何使用[儲存體遷移服務](overview.md)和 Windows 系統管理中心，將伺服器（包括其檔案和設定）遷移至另一部伺服器。 當您安裝服務並開啟任何必要的防火牆埠之後，遷移會執行三個步驟：清查您的伺服器、傳輸資料，以及切換到新的伺服器。

## <a name="step-0-install-storage-migration-service-and-check-firewall-ports"></a>步驟 0：安裝儲存體遷移服務並檢查防火牆埠

開始之前，請先安裝儲存體遷移服務，並確定所需的防火牆埠已開啟。

1. 檢查[存放裝置遷移服務需求](overview.md#requirements)，並在您的電腦或管理伺服器上安裝[Windows 系統管理中心](../../manage/windows-admin-center/understand/windows-admin-center.md)（如果您尚未這麼做的話）。
2. 在 Windows 系統管理中心，連接到執行 Windows Server 2019 的 orchestrator 伺服器。 <br>這是您將用來安裝儲存體遷移服務並用於管理遷移的伺服器。 如果您只是要遷移一部伺服器，您可以使用目的地伺服器，只要它正在執行 Windows Server 2019 即可。 我們建議您針對任何多伺服器遷移使用不同的協調流程伺服器。
1. 移至**伺服器管理員**（在 Windows 系統管理中心） >**儲存體遷移服務**，然後選取 [**安裝**] 以安裝儲存體遷移服務及其必要元件（如 [圖 1] 所示）。
    ![[儲存體遷移服務] 頁面的螢幕擷取畫面，其中](media/migrate/install.png)顯示 [安裝] 按鈕**圖1：安裝儲存體遷移服務**
1. 在執行 Windows Server 2019 的所有目的地伺服器上安裝儲存體遷移服務 proxy。 這會使在目的地伺服器上安裝時的傳送速率加倍。 <br>若要這麼做，請連線到 Windows 管理中心的目的地伺服器，然後移至**伺服器管理員**（在 Windows 系統管理中心） >**角色和功能**，選取 儲存體 **遷移服務 Proxy**，然後選取 **安裝**。
1. 在所有來源伺服器和任何執行 Windows Server 2012 R2 或 Windows Server 2016 的目的地伺服器上，于 Windows 系統管理中心中，連線到每部伺服器，移至**伺服器管理員**（在 Windows 系統管理中心） >**防火牆** >  **傳入規則**，然後檢查是否已啟用下列規則：
    - 檔案及印表機共用 (SMB-In)
    - Netlogon 服務（NP-IN）
    - Windows Management Instrumentation （DCOM）
    - Windows Management Instrumentation (WMI-In)

   > [!NOTE]
   > 如果您使用的是協力廠商防火牆，則要開啟的輸入埠範圍是 TCP/445 （SMB）、TCP/135 （RPC/DCOM 端點對應程式）和 TCP 1025-65535 （RPC/DCOM 暫時埠）。 儲存體遷移服務埠為 TCP/28940 （Orchestrator）和 TCP/28941 （Proxy）。

1. 如果您使用協調器伺服器來管理遷移，而且您想要下載事件或所傳輸之資料的記錄檔，請檢查該伺服器是否已啟用 [檔案及印表機共用（SMB）] 防火牆規則。

## <a name="step-1-create-a-job-and-inventory-your-servers-to-figure-out-what-to-migrate"></a>步驟 1:建立作業並清查您的伺服器，以找出要遷移的內容

在此步驟中，您會指定要遷移哪些伺服器，然後掃描它們以收集其檔案和設定的相關資訊。

1. 選取 [**新增作業**]，將作業命名為，然後選取 **[確定]** 。
2. 在 [**輸入認證**] 頁面上，輸入可在您要從中遷移之伺服器上執行的系統管理員認證，然後選取 **[下一步]** 。

   > [!NOTE]
   > 如果您選擇從 Linux Samba 伺服器進行遷移，則會有額外的步驟來提供 SSH 密碼或私密金鑰

3. 選取 [**新增裝置**]，輸入來源伺服器名稱，然後選取 **[確定]** 。 <br>針對您想要清查的任何其他伺服器重複此動作。

   > [!NOTE]
   > 如果您選擇從容錯移轉叢集進行遷移，請提供叢集檔案伺服器資源的名稱。

4. 選取 [**開始掃描**]。<br>當掃描完成時，頁面會更新以顯示。
    ![螢幕擷取畫面：顯示已準備好要](media/migrate/inventory.png)掃描**的伺服器 [圖 2]清查伺服器**
5. 選取每部伺服器以檢查已清查的共用、設定、網路介面卡和磁片區。 <br><br>儲存體遷移服務不會傳輸我們知道可能會干擾 Windows 操作的檔案或資料夾，因此在此版本中，您會看到位於 Windows system 資料夾中的任何共用的警告。 您必須在傳輸階段略過這些共用。 如需詳細資訊，請參閱[從傳輸中排除哪些檔案和資料夾](faq.md#what-files-and-folders-are-excluded-from-transfers)。
6. 選取 **[下一步]** 以繼續傳輸資料。

## <a name="step-2-transfer-data-from-your-old-servers-to-the-destination-servers"></a>步驟 2:將資料從舊伺服器傳輸到目的地伺服器

在此步驟中，您會在指定要將資料放在目的地伺服器上的位置之後，將它傳輸。

1. 在 [**傳送資料** > ] [**輸入認證**] 頁面上，輸入可在您要遷移至目的地伺服器的系統管理員認證，然後選取 **[下一步]** 。
2. 在 [**新增目的地裝置和**對應] 頁面上，會列出第一部來源伺服器。 輸入您要遷移的伺服器名稱，然後選取 [**掃描裝置**]。

   > [!NOTE]
   > 如果您選擇遷移到容錯移轉叢集，請提供叢集檔案伺服器資源的名稱。

3. 將來源磁片區對應到目的地磁片區，清除您不想要傳輸的任何共用（包括位於 Windows system 資料夾中的任何系統管理共用）的 [**包含**] 核取方塊，然後選取 **[下一步]** 。
   ![螢幕擷取畫面：顯示來源伺服器及其磁片區和共用，以及它們在目的地](media/migrate/transfer.png) **圖3的傳輸位置。來源伺服器及其存放裝置將傳送至其中**
4. 為其他來源伺服器新增目的地伺服器和對應，然後選取 **[下一步]** 。
5. 選擇性地調整傳輸設定，然後選取 **[下一步]** 。
6. 選取 [**驗證**]，然後選取 **[下一步]** 。
7. 選取 [**開始傳輸**] 以開始傳送資料。<br>第一次傳送時，我們會將目的地中的任何現有檔案移至備份檔案夾。 在後續的傳輸中，我們預設會重新整理目的地，而不會先進行備份。 <br>此外，儲存體遷移服務的智慧足以處理重迭的共用，我們不會在相同的作業中複製兩次相同的資料夾。
8. 在傳送完成之後，請查看目的地伺服器，確定所有專案都已正確傳輸。 只有當您想要下載任何未傳輸之檔案的記錄檔時，才選取 [**錯誤記錄**檔]。

   > [!NOTE]
   > 如果您想要保留傳輸的審核記錄，或打算在作業中執行多個轉移，請按一下 [**傳送記錄**] 或 [其他記錄儲存選項] 以儲存 CSV 複本。 每次後續的傳輸都會覆寫上一次執行的資料庫資訊。 

此時，您有三個選項：

- **移至下一個步驟**，移至，讓目的地伺服器採用來源伺服器的身分識別。
- **請考慮遷移完成，** 而不接管來源伺服器的身分識別。
- **再次傳輸**，只複製自從上次傳輸後已更新的檔案。

如果您的目標是要將檔案與 Azure 同步，您可以在傳輸檔案之後，或在移至目的地伺服器之後，使用 Azure 檔案同步來設定目的地伺服器（請參閱[規劃 Azure 檔案同步部署](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning)）。

## <a name="step-3-cut-over-to-the-new-servers"></a>步驟 3：切換到新的伺服器

在此步驟中，您會從來源伺服器切換到目的地伺服器，將 IP 位址和電腦名稱稱移至目的地伺服器。 完成此步驟之後，應用程式和使用者會透過您所遷移之伺服器的名稱和位址，存取新的伺服器。

1. 如果您離開了遷移作業，請在 Windows 系統管理中心移至 [**伺服器管理員** > 儲存體] [**遷移服務**]，然後選取您要完成的作業。 
2. 在 [**切換到新的伺服器** > ] 的 [**輸入認證**] 頁面上，選取 **[下一步]** 以使用您先前輸入的認證。

    > [!NOTE]
   > 如果您的目的地是叢集檔案伺服器，您可能需要提供具有許可權的認證，以從網域中移除叢集，然後以新名稱重新加入該叢集。 

3. 在 [**設定**切換] 頁面上，指定要接管每個來源裝置設定的網路介面卡。 這會在轉換的過程中，將 IP 位址從來源移到目的地。 您可以選擇略過所有網路遷移或特定介面。 如果您要在伺服器上剪下，一定要為來源介面指定 DHCP 或新的靜態 IP 位址。
4. 指定在轉換後要用於來源伺服器的 IP 位址，將其位址移至目的地。 您可以使用 DHCP 或靜態位址。 如果使用靜態位址，新的子網必須與舊的子網相同，否則轉換將會失敗。
    ![顯示來源伺服器及其 IP 位址和電腦名稱稱的螢幕擷取畫面，以及它們在切換之後，會被取代](media/migrate/cutover.png)為 [ **圖 4]：來源伺服器及其網路設定將如何移到目的地**
5. 指定在目的地伺服器接管其名稱之後，如何重新命名來源伺服器。 您可以使用隨機產生的名稱，或輸入一個。 然後選取 **[下一步]** 。
6. 在 [調整切換**設定**] 頁面上選取 **[下一步]** 。
7. 在 [**驗證來源和目的地裝置**] 頁面上選取 [**驗證**]，然後選取 **[下一步]** 。
8. 當您準備好要執行轉換時，請選取 [**開始**切換]。 <br>使用者和應用程式可能會在位址和名稱移動時遇到中斷，而且伺服器會重新開機數次，但不會受到遷移的影響。 轉換所需的時間長短取決於伺服器重新開機的速度，以及 Active Directory 和 DNS 複寫時間。

## <a name="see-also"></a>另請參閱

- [儲存體遷移服務總覽](overview.md)
- [儲存體遷移服務常見問題（FAQ）](faq.md)
- [規劃 Azure 檔案同步部署](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning)
