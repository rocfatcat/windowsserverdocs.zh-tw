---
title: defrag
description: 重組命令的參考文章，它會在本機磁片區上尋找和合併分散的檔案，以改善系統效能。
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: aaf1d1ac-996a-4282-9b4d-1e8245ff162c
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 65c1d22bd45734a667bfc46840fe652e3f2f5314
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/23/2020
ms.locfileid: "86958430"
---
# <a name="defrag"></a>defrag

> 適用于： Windows 10、Windows Server （半年通道）、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

尋找併合並本機磁片區上的分散檔案，以改善系統效能。

若要執行此命令，至少需要本機**Administrators**群組的成員資格或同等許可權。

## <a name="syntax"></a>語法

```
defrag <volumes> | /c | /e <volumes>    [/h] [/m [n]| [/u] [v]]
defrag <volumes> | /c | /e <volumes> /a [/h] [/m [n]| [/u] [v]]
defrag <volumes> | /c | /e <volumes> /x [/h] [/m [n]| [/u] [v]]
defrag <volume> [<parameters>]
```

### <a name="parameters"></a>參數

| 參數 | 描述 |
| --------- | ----------- |
| `<volume>` | 指定要進行磁碟重組或分析之磁片區的磁碟機號或掛接點路徑。 |
| /a | 在指定的磁片區上執行分析。 |
| /C | 在所有磁片區上執行操作。 |
| /d | 執行傳統磁碟重組（這是預設值）。 不過，在分層磁片區上，傳統的磁碟重組只會在容量層上執行。 |
| /e | 在除了指定的磁片區上執行作業。 |
| /g | 將指定磁片區上的儲存層優化。 |
| /h | 以一般優先權執行作業（預設值為 [低]）。 |
| /i [n] | 在每個磁片區上最多可執行 n 秒的層優化。 |
| /k | 在指定的磁片區上執行樓板匯總。 |
| /l | 在指定的磁片區上執行 retrim。 |
| /m [n] | 在背景中平行執行每個磁片區上的作業。 最多 n 個執行緒會平行優化儲存層。 |
| /o | 針對每種媒體類型執行適當的優化。 |
| /t | 追蹤在指定磁片區上已在進行中的作業。 |
| /U | 在螢幕上列印工作的進度。 |
| /v | 列印包含片段統計資料的詳細資訊輸出。 |
| /x | 在指定的磁片區上執行可用空間匯總。 |
| /? | 顯示此說明資訊。 |

#### <a name="remarks"></a>備註

- 您無法重組特定的檔案系統磁片區或磁片磁碟機，包括：

  - 檔案系統鎖定的磁片區。

  - 磁片區檔案系統標示為已中途，表示可能有損毀。<br>您必須先執行， `chkdsk` 才能重組此磁片區或磁片磁碟機。 您可以使用命令來判斷磁片區是否已變更 `fsutil dirty` 。

  - 網路磁碟機機。

  - CD-ROM。

  - 非**NTFS**、 **ReFS**、 **Fat**或**Fat32**的檔案系統磁片區。

- 您無法排程在位於 SSD 上的虛擬硬碟（VHD）上重組固態硬碟（SSD）或磁片區。

- 若要執行此程序，您必須是本機電腦上的 Administrators 群組成員或是已經委派您適當的權限。 如果該電腦已加入網域，則 Domain Admins 群組的成員便可以執行這項程序。 作為安全性最佳作法，請考慮使用 [**執行**身分] 來執行此程式。

- 磁片區必須至少有15% 的可用空間，才能完整重組並適當**地進行碎片**整理。 **磁碟重組**會使用此空間做為檔案片段的排序區域。 如果磁片區的可用空間少於15%，**磁碟重組**只會部分重組。 若要增加磁片區上的可用空間，請刪除不需要的檔案，或將它們移至另一個磁片。

- 當**磁碟重組**正在分析並重組磁片區時，它會顯示閃爍的游標。 當重組完成分析並重組磁片區時，**它會顯示**分析報表、磁碟重組報告或這兩個報表，然後結束到命令提示字元。

- 根據預設，如果您未指定 **/a**或 **/v** **參數，重組會同時顯示分析**和磁碟重組報告的摘要。

- 您可以輸入FileName.txt，將報表傳送至文字檔 **>** <em> </em>，其中*FileName.txt*是您指定的檔案名。 例如：`defrag volume /v > FileName.txt`

- 若要中斷磁碟重組程式，請在命令列中按**CTRL + C**。

- 執行**磁碟重組**命令和磁碟重組工具是互斥的。 如果您使用磁碟重組工具來重組磁片區，而您在命令列執行**磁碟重組**命令，則**磁碟重組**命令會失敗。 相反地，如果您執行**碎片**整理命令並開啟磁碟重組工具，磁碟重組工具中的重組選項將無法使用。

## <a name="examples"></a>範例

若要重組磁片磁碟機 C 上的磁片區，同時提供進度和詳細資訊輸出，請輸入：

```
defrag c: /u /v
```

若要在背景中以平行方式重組 C 和 D 磁片磁碟機上的磁片區，請輸入：

```
defrag c: d: /m
```

若要對裝載于 C 磁片磁碟機的磁片區執行分散分析，並提供進度，請輸入：

```
defrag c: mountpoint /a /u
```

若要重組所有具有一般優先順序的磁片區，並提供詳細資訊輸出，請輸入：

```
defrag /c /h /v
```

## <a name="scheduled-task"></a>排定的工作

磁碟重組程式會以維護工作的形式執行排程工作，這通常會每週執行一次。 身為系統管理員，您可以使用 [**優化磁片磁碟機**] 應用程式來變更工作執行的頻率。

- 從**排定的工作執行時，重組**會針對 ssd 使用下列原則指導方針：

  - **傳統的優化**程式。 包括**傳統的磁碟重組**，例如移動檔案以使其合理的連續和**retrim**。 這會每個月執行一次。 不過，如果略過**傳統磁碟重組**和**retrim** ，則不會執行**分析**。

  - 如果您以手動方式在 SSD 上執行**傳統磁碟重組**，則在正常排程的執行之間，下一個排定的工作回合會執行**分析**和**retrim**，但會略過該 ssd 上的**傳統磁碟重組**。

  - 如果您跳過**分析**，將不會在 [**優化磁片磁碟機**] 應用程式中看到更新的**上次運行**時間。 因此，**上次運行**時間最多可達一個月。

  - 您可能會發現排定的工作尚未重組所有的磁片區。 這通常是因為：

    - 進程不會喚醒要執行的電腦。

    - 電腦未插入。 如果電腦以電池電源執行，則不會執行此程式。

    - 電腦已啟動備份（從閒置狀態恢復）。

## <a name="additional-references"></a>其他參考

- [命令列語法關鍵](command-line-syntax-key.md)

- [chkdsk](chkdsk.md)

- [fsutil](fsutil.md)

- [fsutil dirty](fsutil-dirty.md)

- [優化-磁片區 Powershell](/powershell/module/storage/optimize-volume?view=win10-ps)
