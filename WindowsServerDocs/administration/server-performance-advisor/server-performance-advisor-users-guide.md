---
title: Server Performance Advisor 使用者指南
description: Server Performance Advisor 使用者指南
ms.assetid: be99a5a9-b9c0-436b-912c-e5c5839a533d
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: manage
ms.openlocfilehash: 97fab1a36db2e903b3a909bee9e2f1748f7841fd
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59834139"
---
# <a name="server-performance-advisor-users-guide"></a>Server Performance Advisor 使用者指南

>適用於：Windows Server （半年通道）、 Windows Server 2016、 Windows Server 2012 R2、 Windows Server 2012 中，Windows 10、 Windows 8

本使用者指南 Microsoft Server Performance Advisor (SPA) 提供有關如何使用 SPA 部署在各種伺服器角色的系統中找出效能瓶頸的指導方針。

SPA 可以協助您進行下列動作：

* 管理您伺服器的效能，並針對伺服器效能問題進行疑難排解。

* 提供資料的報表和相關常見的組態和效能問題的建議。

* 提供最佳的 pratice 建議根據所收集的資料。

> [!NOTE]
> SPA 主控台不會進行任何變更的伺服器。

如需開發 SPA Advisor 組件的詳細資訊，請參閱[伺服器效能警告器組件開發指南](server-performance-advisor-pack-development-guide.md)。

## <a name="server-performance-advisor-overview"></a>Server Performance Advisor 概觀


本節說明 SPA 的歷程記錄、 說明其目標對象和案例，並提供此工具的架構概觀。

### <a name="history-of-spa"></a>SPA 的歷程記錄

原始版本的 Microsoft Server Performance Advisor (SPA) 已於 2005年-2006年發行。 它主要被針對 Windows Server 2003，包括核心作業系統和伺服器角色，例如 Internet Information Services (IIS) 和 active directory。 此工具的目標是協助您評估您伺服器的效能，並針對伺服器效能問題進行疑難排解。

SPA 提供常見的組態與效能問題相關的系統管理員資料報告和建議。 SPA 會在伺服器上，例如效能計數器、 登錄機碼、 WMI 查詢、 組態檔和事件追蹤的 Windows (ETW)，從各種來源收集效能相關資料。 根據伺服器的效能資料收集，SPA 可以提供深入了解問題的建議可以改善與目前的伺服器效能情況。

已超過 1 百萬個下載原始的 SPA 工具，並協助許多系統管理員管理其伺服器的效能。 已經過非常成功的效能疑難排解的工具。

自發行以來的原始的 SPA，有幾項主要變更伺服器效能的世界中。 最值得注意的是，發行版本的 Windows Server 2012 R2、 Windows Server 2012、 Windows Server 2008 R2 和 Windows Server 2008，使用對應的伺服器角色網際網路資訊服務 (IIS) 8.5、iis 等的新版本。 較新版本的 Server Performance Advisor 擴充原始 SPA 的最新的伺服器作業系統和伺服器角色的功能。

雖然 SPA 3.1 會共用相同的設計目標和效能分析開發架構，與原始的工具，它已重寫與最新技術。 它也會有下列的主要改善項目：

* 可以執行分析，對執行 Windows Server 2012 R2、 Windows Server 2012、 Windows Server 2008 R2 和 Windows Server 2008 的伺服器。

* 支援遠端分析功能，可讓 SPA 3.1 來收集和分析資料，從中央主控台，完全無須要分析的伺服器上安裝的程式碼。

* 使用 Microsoft SQL Server 進行資料分析和儲存體，可讓處理並儲存大量的資料。

* 分開 Advisor 組件中的工具。 每個伺服器角色的效能分析邏輯是 advisor 組件可以發行或個別更新從工具的形式發行。

* 提供開發使用開放架構的 SQL 指令碼中的 Advisor 組件。 非 Microsoft 的協力廠商可以開發 advisor 組件，或從 Microsoft，以涵蓋特殊的需求擴充現有的 advisor 組件。

* 支援新的功能，例如並排顯示比較報告和趨勢和歷程記錄圖表來協助您找出異常狀況。

* 提供這類修改功能、 匯入和匯出臨界值，可協助您順利微調報表和通知，並與其他 SPA 使用者共用這些 tunings。

* 支援多個專案，可以用來群組目標的伺服器。

* 提供從週期性的資料收集，SPA 主控台內。

* 使用 Microsoft SQL Server （適用於進階使用者），可讓自訂查詢和產生報告。

* 自訂的 Windows PowerShell cmdlet 可用於使用 SPA

* 匯入及檢視報表從 SPA 3.0 資料庫具有回溯相容性

### <a name="target-audience"></a>目標對象

SPA 工具主要設計使管理各種伺服器角色中的少於 100 部伺服器的系統管理員。 它也供支援工程師收集效能資料，以及客戶針對效能問題進行疑難排解。

SPA 提供建議以協助您解決效能問題;不過，它根據不可能適用的特定伺服器環境的假設。 提供的 SPA 的建議應該考量的建議。 我們預期 SPA 使用者有充分的了解他們的系統組態、 使用案例，以及系統調整對整體系統行為的影響。 系統管理員應該決定應該套用至其環境是否 SPA 建議。

### <a href="" id="what-s-new-in-spa-3-1-"></a>哪些 s SPA 3.1 的新功能？

SPA 3.1 中新增下列功能和增強功能：

* Active directory Advisor 套件可協助您分析伺服器 s active directory 網域服務伺服器角色的整體效能。

* 新增遺失的 ETW 事件通知警示 advisor 組件中的開發人員支援，並將警示設為可見時在產生的報告和事件是因高頻率記錄很慢或高度爭用的磁碟

### <a name="target-scenarios"></a>目標情境

SPA 的目標案例如下：

* **伺服器環境**

    SPA 可輕鬆設定及維護。 它適用於伺服器環境中的使用 1 到 100 之間的伺服器。 SPA 不會調整，如果您嘗試管理 100 個以上的伺服器效能。 對於較大或更複雜的環境，您應該考慮使用 System Center Operations Manager。

* **效能疑難排解**

    您可以使用 SPA 當做效能疑難排解工具。 它讓您能夠收集高階效能資料，它會執行完整的文章，要讓您深入了解整體系統行為，資料處理和它旗標任何異常狀況。 當客戶懷疑效能問題時，您可以使用 SPA 來收集和分析來自伺服器的效能資料。

    SPA 會產生一份報告，您可以檢視。 SPA 報告提供反白顯示 潛在的問題，通知清單，以及資料區段，其中包括各種效能指數、 組態和設定伺服器。 您可以使用這份報表找出特定的效能問題，並尋找問題的解決方案中使用的建議。 與其他在不同時間或不同的伺服器所產生的報表，就可以比較報告。 您可以使用這項並排顯示比較，來判斷正常和異常行為的基準線之間的差異。

    **請注意**SPA 不是要偵錯 或 計量 工具。 此外，從伺服器的觀點來看，它可以視為唯讀的工具，而且不會修改伺服器設定。

     

* **監視效能的索引**

    您可以使用 SPA 來監視伺服器效能索引。 您可以選擇要收集效能資料，然後再執行 趨勢圖表或歷程記錄的圖表，以找出異常狀況的伺服器上定期執行 SPA。 您可以檢視特定分析的報告，找出效能問題的詳細資訊，然後使用建議或其他報表資料來解決此問題。

### <a name="spa-architecture"></a>SPA 架構

Windows 效能記錄檔及警示 (PLA) 呼叫中的通訊協定為基礎的 SPA 資料集合的邏輯。 PLA 允許從本機或遠端伺服器，例如效能計數器、 WMI 查詢，ETW 追蹤、 登錄機碼和組態檔中收集效能資料的程式。 SPA 執行時的效能分析的目標伺服器上，它會建立根據您選取特定 SPA Advisor 套件 PLA 資料收集器集合。 Advisor 套件包含在資料來源收集和儲存記錄的檔案共用。 SPA 資料集合只會儲存單一使用者帳戶;PLA 所使用的相同使用者帳戶也會用來寫入記錄檔中。

SPA 會使用 SQL Server 資料庫來儲存從目標伺服器所收集的效能記錄檔。 SPA 會從檔案共用的所有效能記錄檔都匯入資料庫，然後再使用處理資料，並產生報告的 在每個 advisor 組件內的資料分析邏輯。 Advisor 套件會分析已從目標伺服器收集，並產生的 SPA 報告的效能資料。 如需建置 advisor 套件的詳細資訊，請參閱[伺服器效能警告器組件開發指南](server-performance-advisor-pack-development-guide.md)。

SPA 主控台使用者介面和互動是建立成 SPAConsole.exe 的一部分。 您可以使用主控台來建立資料庫、 新增或移除 advisor 組件，管理目標伺服器、 執行效能分析，並檢視效能報告。

SPA 主控台可以執行下列作業系統上：

* Windows 8.1

* Windows 8

* Windows 7

* Windows Server 2012 R2

* Windows Server 2012

* Windows Server 2008 R2

* Windows Server 2008

在一般商務應用程式中，有三種層次： 展示層、 商務邏輯層和儲存層。 SPA 設計成兩個階層的產品，主控台和資料庫。 主控台會當做包含，特定處理序相關的邏輯與資料庫會充當儲存層和商務邏輯層的展示層。 主控台會擷取使用者輸入，並控制資料收集、 資料處理和產生報告的步驟。 SPA 不依賴 Windows 系統服務。

下圖顯示 SPA 系統的高階架構。 程序如下：

1.  從 SPA 主控台中，您可以執行效能分析指定的伺服器上。

2.  收集效能資料時，在目標伺服器上的 PLA 將記錄寫入上一步，由資料收集器集合工具所指定的檔案共用。

3.  在目標電腦上完成資料收集之後，SPA 主控台會匯入 SQL Server 資料庫的記錄檔。

4.  主控台會叫用特定警告器組件的資料處理邏輯。

5.  Advisor 套件處理資料，並呼叫 SPA Api 來 SPA 架構所定義的系統報表資料表中插入資料錄。

6.  若要檢視產生的報表，您可以使用主控台內的報表檢視器。 為了協助您排解效能問題，SPA 提供三種類型的報表： 單一報表、 並排顯示報告和趨勢或歷程記錄圖表。 如需報表的詳細資訊，請參閱[檢視報表](#bkmk-viewingreports)。

![spa 架構](../media/server-performance-advisor/spa-user-manual-architecture.png)

## <a name="getting-started-with-spa"></a>開始使用 SPA


### <a name="requirements"></a>需求

SPA 主控台可以安裝在 Windows 8.1，Windows 8、 Windows 7、 Windows Server 2012 R2、 Windows Server 2012、 Windows Server 2008 R2 和 Windows Server 2008 中。 不支援舊版的 Windows Server 作業系統上執行 SPA。 SPA 上執行 x86 或 x64，但它不支援 IA64 或 ARM 架構。

SPA 是建置在 Windows Presentation Foundation (WPF) 2.0 中，屬於 Microsoft.NET framework 4，因此需要.NET Framework 4。

您也需要 SPA 安裝所在的同一部電腦上安裝 SQL Server 2008 R2 Express。 SQL Server 2008 R2 Express 是免費的資料庫引擎，Microsoft 所發行。 您可以從 Microsoft 下載中心下載 Microsoft SQL Server 2008 R2 Express。 雖然我們建議 SQL Server 2008 R2 Express，也可能與 SPA 相容較新版本的 SQL Server。

**請注意**SPA 不包含 SQL Server 或.NET Framework SPA 安裝套件的一部分。 安裝 Microsoft SQL Server 2008 R2 和.NET Framework 4.0 之後，我們建議您執行 Windows Update，再安裝 SPA。

 

由於使用者可以建立和管理使用 SPA 的資料庫，用來執行 SPA 的使用者帳戶應該有相同 SQL Server 的系統管理員權限。

### <a href="" id="bkmk-setupspa"></a>設定 SPA

SPA 會封裝成.cab 檔，包含 SPA 架構，而 Windows PowerShell cmdlet，可在進階案例中，所有的二進位檔和下列 advisor 組件：核心作業系統、 HYPER-V、 active directory 和 IIS。 解壓縮.cab 檔案的資料夾之後，任何額外的安裝不是必要的。 不過，若要執行 SPA，您需要從啟用資料收集的目標伺服器，如下所示：

* 若要執行 PLA 資料收集，您用來執行 SPA 主控台的使用者帳戶必須是目標伺服器上 Administrators 安全性群組的一部分。 如果目標伺服器和主控台都在相同的網域，網域使用者帳戶必須是目標伺服器上 Administrators 安全性群組的一部分。 如果目標伺服器及主控台不在相同的網域，請使用相同的使用者名稱和密碼目標伺服器上建立系統管理使用者帳戶，您用來執行 SPA 主控台的使用者帳戶。

* 在伺服器上建立共用的資料夾的結果。

* 請確定您用來執行 SPA 主控台的使用者帳戶具有讀取和寫入至共用資料夾的權限。 PLA 會使用此帳戶寫入記錄檔的資料夾。
SPA 主控台會使用相同的帳戶，來讀取記錄檔並將它們匯入資料庫。

    **請注意**ETW 會實作循環緩衝區來儲存追蹤，並將它們移到共用資料夾時可能。 如果伺服器太忙碌，或寫入作業變慢，ETW 會在緩衝區已滿時，捨棄追蹤。 很重要的共用的資料夾位於較快速的 I/O 存取的伺服器上。 我們建議每個目標伺服器有緩慢的檔案 I/O 所造成的資料遺失降到最低的共用的資料夾。

     

* 對於 PLA 存取目標伺服器，來設定 Windows 防火牆以允許在目標伺服器上的遠端的效能記錄檔及警示的存取。 PLA 使用 TCP 通訊埠 139。

* 請確定**效能記錄檔與警示**服務正在執行。

* 如果主控台和目標伺服器位於不同子網路中，您也需要設定 [遠端 IP 位址] 欄位中輸入的防火牆規則，在**領域**上的設定**效能記錄及警示**頁面上，如下所示。

    ![pla 屬性](../media/server-performance-advisor/spa-user-manual-pla-firewall.png)

* 在主控台上，並在每部目標伺服器上開啟網路探索。

* 如果目標伺服器未加入網域，啟用下列登錄設定：**HKLM\\軟體\\Microsoft\\Windows\\Currentversion\\原則\\系統\\LocalAccountTokenFilterPolicy**。

**請注意**根據預設，SPA 將診斷記錄寫入至 SpaConsole.exe 所在的資料夾。 如果 SPA 安裝在 Program Files 資料夾下，SPA 是只能寫入記錄檔時 SpaConsole.exe 是執行系統管理員身分。

如果您想要執行主控台的電腦上的資料分析，您需要系統管理員身分執行 SPA。 PLA 會經歷不同的程式碼路徑，對本機電腦上，而這需要系統管理員權限執行時。

如果您想要針對您的伺服器執行 IIS 的 SPA Advisor 套件，您需要啟用 WMI 查詢和 IIS 伺服器的 ETW 追蹤。 您可以藉由啟用**追蹤**下方**健康情況和診斷**角色服務並**IIS 管理指令碼及工具**下**管理工具**的**網頁伺服器 (IIS)** 伺服器角色。

 

### <a name="creating-your-first-project"></a>建立第一個專案

一切都設定好之後，您可以建立第一個 SPA 專案。 上一節所述，SPA 會儲存在資料庫內的效能資料分析相關的一切資訊。 SPA 中的每個專案會對應至單一資料庫。 **第一次使用精靈**引導您完成下列步驟。

**若要建立 SPA 專案**

1.  啟動 SpaConsole.exe。 主控台會進入中斷連線的模式，其中 SPA 未連線到任何資料庫，而是空白的主視窗。

2.  若要建立新的專案，請按一下**檔案**，然後按一下**新的專案**。 這會啟動第一次使用精靈。 第一個頁面會顯示您使用精靈時所遵循的步驟：

    * 建立資料庫

    * 佈建的 advisor 組件

    * 將伺服器新增到目標伺服器清單

3.  按一下 [下一步] 。 **建立專案資料庫**頁面會要求您提供的 Microsoft SQL Server 執行個體，您要建立您的資料庫名稱。 例如，如果是在主控台的同一部電腦上，您可以使用**localhost\\&lt;您的 SQL 伺服器名稱&gt;**。

    **請注意**的 SQL Server 2008 R2 Express 安裝的預設執行個體名稱為 SQLExpress。 SQL Server 2008 R2 Express 在本機電腦上安裝的執行個體，資料庫通常會預設為**localhost\\SQLExpress**。 不過，它可能已變更 SQL Server 安裝期間，因此您必須先確定您使用正確的 SQL Server 執行個體名稱。

     

4.  提供資料庫名稱。 字母、 數字和底線 (\_) 允許使用做為有效字元的資料庫名稱。 合理的 SPA 的資料庫名稱，想要**SPA**。 如果您輸入無效的名稱，則會出現紅色錯誤圖示。 相關聯的工具提示可讓驗證失敗的原因。

    **請注意**很重要，要記住的資料庫名稱和伺服器執行個體名稱，因為這些是您的專案的唯一識別碼。 您必須提供這項資訊，如果您想要切換到此資料庫。

     

5.  您提供的伺服器執行個體名稱和資料庫名稱之後，第一次使用精靈會產生資料庫檔案的位置。

6.  在 [**建立專案的資料庫**頁面上，按一下**下一步]**。 第一次使用精靈建立資料庫，並在資料庫中產生所有的 SPA 相關的資料庫結構描述、 函數和預存程序。 此步驟可能需要幾秒鐘的時間取決於硬體和網路速度。

    **請注意**步驟失敗時，出現錯誤訊息。 一些常見的問題是：主控台無法連線到 SQL Server 執行個體，而權限不足以建立資料庫，或資料庫名稱已經存在。

     

7.  當上一個步驟成功時，您會看到**佈建的 advisor 套件**頁面。 它會列出在電腦上的所有 advisor 組件。 SPA 就會自動掃描命名的資料夾**APs** SPA 根目錄底下。 它會列出完整名稱、 版本和每個 advisor 組件的作者。

    **附註**如需如何使用 SPA 中的完整名稱和版本的詳細資訊，請參閱[管理 advisor 套件](#bkmk-manageadvisorpacks)

     

8.  選擇您想要在專案的資料庫中，佈建，然後按一下 [哪些 advisor 組件**下一步]**。 或者，您可以按一下**略過**移至下一個步驟中，不需要佈建的 advisor 中的任何組件。

    **請注意**您可以的隨時使用此工具佈建的 advisor 組件。 如需詳細資訊，請參閱 <<c0> [ 管理 advisor 組件](#bkmk-manageadvisorpacks)。

     

9.  在 **將伺服器新增**頁面上，針對要加入至目標伺服器清單中，有兩個必要的欄位，以填滿每一部伺服器：**伺服器名稱**並**檔案共用位置**。

    **附註**另外還有**備註**欄位中，主要是用來分類或找不到伺服器。 在您有多個伺服器執行個體，您可以匯入包含伺服器名稱，結果資料夾和選擇性註解後欄位的以逗號分隔值 (.csv) 檔案。 **備註**欄位用來描述伺服器，而且一詞可用來篩選資料集合的伺服器。 如果您要初始化伺服器透過.csv 檔案，檔案中的剖析錯誤不會載入伺服器。

     

10. 數個組態必須設為啟用 PLA 資料收集，如中所述[設定 SPA](#bkmk-setupspa)。 **將伺服器新增**頁面會提供可協助您疑難排解設定問題的測試組態功能。 選取電腦後，相關聯的核取方塊，然後按一下**測試連線**。 SPA 嘗試產生目標伺服器上設定資料收集器，它會嘗試匯入結果傳回至資料庫。 如果所有項目都正確，**狀態**示範**傳遞**。 如果失敗，則會顯示工具提示，描述失敗的原因。

11. 每一部伺服器會自動加入至資料庫即使它未通過組態測試。 若要從清單中移除伺服器，請在選取的伺服器名稱，然後按一下**移除**。

12. 所有項目完成時，按一下**完成**關閉第一次使用精靈。 如果您關閉之前完成它第一次使用精靈時，保存所有先前的步驟，都不復原自動。 您需要手動進行未來的變更。

## <a name="running-analysis"></a>執行分析


設定好資料庫之後，您可以在伺服器上執行效能分析。

每次 SPA 主控台啟動時，所使用的目前使用者的最後一個專案會自動開啟。 主視窗包含伺服器的清單。 每一部伺服器有四個屬性：伺服器名稱、 分析結果、 目前狀態和備註。

* **伺服器名稱**伺服器，也就是伺服器的識別項的名稱。 允許不重複的名稱。

* **分析結果**根據預設，它會顯示最新的效能分析的結果對伺服器執行。 如果沒有任何對伺服器執行的效能分析，就會顯示**沒有報告**。 如果沒有報告所引發的警告，它會顯示**警告**和最新的報告產生時的時間戳記。 如果在伺服器上最新的分析期間找不到任何問題，它會顯示**確定**和時間戳記。

    **請注意**如果您最近變更系統設定，我們建議您執行一次，若要評估變更的整體影響，並取得更新的報告系統狀態的分析。 SPA 不會追蹤到待測系統的組態變更。

     

* **目前的狀態**目前伺服器上執行的分析工作會顯示的效能狀態。 您可以按一下來取消執行中的工作**取消**指定紅色 X 的圖示。

* **備註**描述目前的目標伺服器。 比方說，您可以使用 「 伺服器 」 角色 (例如，SQL Server) 或位置 (例如，Kent) 來描述您的伺服器。 使用 SPA**伺服器名稱**並**備註**協助搜尋及尋找適當的伺服器。 您可以在搜尋文字方塊中輸入。 如果**伺服器名稱**或**備註**資料行所包含的完整字串，您在 [搜尋] 方塊中輸入該伺服器會顯示在伺服器清單。

下列控制項也可在主控台上：

* **重複**描述能夠定期重複集合，核取方塊，根據時間間隔。 對於大多數的伺服器安裝，您會想要擁有每小時重複執行，以有足夠的記錄分析的 SPA 集合。 如果您想要執行一次的集合，您不應該選取**重複**核取方塊。

* **移除循環**可讓您取消進行中的按鈕重複收集作業。 它會取消該重複的集合，但不是目前集合 （如果有的話） 正在進行中。 此選項可讓您重設新的重複的收集間隔，或手動執行集合。

啟動效能分析之前，先選取資料集合持續時間。 雖然收集更多資料，可協助提供更精確的映像的伺服器效能情況，它也會產生大量的記錄檔，而且它無法在伺服器上有更多的潛在影響。 選擇適當的資料集合期間，根據您特定需求。 每個 advisor 組件會定義最小的有效持續期間。 您選擇的資料集合持續時間必須超過所選的 advisor 組件的最小持續期間。

若要在目標伺服器上執行效能分析，選取您想要執行效能分析，然後按一下 伺服器 * * 執行分析 * * 對話方塊隨即出現，並會要求您選取要執行的伺服器上的 advisor 組件。 將選取的 advisor 組件同時執行。 產生的報表會根據相同的時間週期期間所收集的效能資料。

**附註**如果您選取可執行，重複執行效能分析的伺服器**移除循環**按鈕可讓您取消週期性的資料收集。 SPA 不允許在相同電腦上的多個資料集合工作階段，在相同的時間。

 

## <a href="" id="bkmk-viewingreports"></a>檢視報表


SPA，有三種類型的效能分析報表：單一報表、 並排顯示報告和趨勢和歷程記錄的圖形。

執行效能在分析後，產生的報告是每個目標電腦上執行 advisor 套件。 您可以從伺服器清單中的主視窗中，展開**分析結果**若要查看所有已執行特定的伺服器的 advisor 組件。 您可以按一下報表名稱，即可檢視單一報表。

有三個 advisor 組件名稱旁邊的圖示顯示最新的分析，在伺服器上執行的狀態：

* **最新**圖示顯示最新的效能分析，此 advisor 組件的伺服器上所產生的報表。

* **尋找**圖示會顯示的清單效能分析報表，可讓您挑選正確的報表。 **Advisor 套件**並**目標伺服器**欄位會預先填入的目前警告器組件與目標伺服器資訊。 預設時間範圍設為一週，並在結束日期設為今天。 如果您按一下**搜尋**按鈕在右上角中，您可以取得一份所有效能分析報表的時間範圍內所選取伺服器和 advisor 組件。

* **檢視圖表**圖示會開啟 趨勢和歷程圖檢視。

下圖顯示**最新**，**尋找**，並**檢視圖表**之後每個 advisor 組件的圖示：

![報表圖示](../media/server-performance-advisor/spa-user-manual-report-icons.png)

### <a name="searching-for-and-within-reports"></a>搜尋報表內以及

搜尋報表是藉由使用**報表總管**。 這可讓您依日期範圍、 伺服器名稱和 advisor 套件搜尋的報表。 這是建議用來尋找上次執行的報告以外的感興趣的報表。 上次執行的報表均可透過**檢視報表**該伺服器。

當您檢視特定報表時，您就可以輕鬆地瀏覽至下一步] 和 [上一個報表的時間，或查看相關的報表，例如在相同時間執行的不同 AP。 這些選項都是底下**動作**。

在報表內搜尋，也可以。 有數個報告**尋找**適用於在報表內搜尋快速的文字字串的字串搜尋方塊。 若要移除文字方塊中，您可以將它關閉。 若要啟動搜尋方塊中 （在已搜尋的文字的 windows)，您可以使用 Control + F 捷徑。 **尋找**方塊，可讓使用者使用，視指定區分大小寫的搜尋**大小寫須相符**選項。

下圖顯示**尋找**字串的 搜尋 方塊**電源**上**報表** 索引標籤。

![[尋找] 搜尋方塊](../media/server-performance-advisor/spa-user-manual-find-search-box.png)

### <a name="single-report"></a>單一報表

單一報表會顯示在單一電腦上的 advisor 組件的單一執行效能分析結果。 報表會顯示 advisor 組件的名稱、 目標伺服器、 的時間產生報告，以及資料收集的持續時間名稱。

單一的報表包含的通知區段和資料區段。

### <a name="notification-section"></a>通知區段

[通知] 區段包含一組效能分析規則。 每個通知會包含某些資料來源、 某些閾值的值和一些商務邏輯。 當您執行效能分析時，商務邏輯評估閾值以判斷規則是否通過或不針對資料來源。 如果沒有，則會出現警告通知您有關潛在的效能問題。 它也會提供建議來協助您解決問題。 [通知] 區段一律是單一的報表檢視中的第一個索引標籤。

[通知] 區段會分成兩個部分：**警告**並**其他通知**。

如果規則的資料來源符合特定的邏輯和臨界值設定為基礎的條件，警告會出現在**警告**區域。 警告包括下列部分：

* 警告圖示指出潛在的問題存在。

* 規則的名稱。 例如，**網路接收封包捨棄**是指向規則詳細資料頁面的連結中所述[管理 advisor 組件](#bkmk-manageadvisorpacks)。

* 有關潛在問題的簡單描述。

* 可能的解決辦法的潛在效能問題的的建議。

完全不同的設定和使用模式，可以有不同的伺服器，就無法設定臨界值和規則只適用於所有情況下的所有伺服器。 SPA 提供的功能，若要修改的閾值。 您也可以選擇停用規則，如果規則不會套用至您的案例。 根據預設，會啟用所有規則。 已停用的規則不會顯示在通知區域中。 如需詳細資訊，請參閱 <<c0> [ 管理 advisor 組件](#bkmk-manageadvisorpacks)。

**其他通知**區域包含的所有其他規則，其中就會引發任何警告或不適用此規則。 它包含類似的組件中找到**警告**區域。 最大的差異是，如果在引發任何警告或規則不適用，通常不建議提供。

### <a name="data-sections"></a>資料區段

Data 區段包含的效能資料 advisor 組件產生根據收集自目標伺服器的未經處理資料。 資料區段包含一組最上層區段和多個層級的小節。 最上層的區段會顯示為索引標籤。 在最上層區段下的所有子區段會顯示可展開的區域中。 您可以摺疊或展開各節協助集中專注於感興趣的區域，如下圖所示。

![資料區段](../media/server-performance-advisor/spa-user-manual-data-sections.png)

核心 OS SPA Advisor 組件和 IIS SPA Advisor 組件包含**系統概觀**一節。 本節包含最上層的資源使用狀況和組態的相關資訊。 其他最上層的區段代表區域的效能資料。 SPA 會顯示報表資料，以下列方式：

* **單一值**的索引鍵/值組。 索引鍵是字串，表示值的意義。 值可以是字串、 數值或布林值。 這通常用來顯示靜態的資訊，例如組態，例如 CPU 架構、 記憶體大小總計，以及 BIOS 版本，這不會變更一段時間。

* **列出值**這有時是索引鍵/值組，但清單值可以包含多個欄位。 比方說，CPU 的屬性可以具有多個資料行和多個資料列的資料表中所示。 每個資料列都代表一個 CPU 時，而每個資料行代表 CPU 的屬性。

* **統計資料**可以視為一種特殊類型的單一值。 它只能包含數值資料。 資料收集期間，許多數字的資料點的變動而不是停留時間常數。 例如，CPU 使用量 PLA 收集的效能計數器每次變更。 顯示單一值無法正確反映效能情況。 而不會顯示只有一個值，會使用這類動態數值的資料點的平均值、 最大值、 最小值和 90%的值。 90%的值代表該指定的集合內所有事件，該計數器等於或高於 90 百分位數的活動。

* **最上層清單**通常包含首要取用者特定的資源或發生特定事件的最上層實體。 例如，**方面的平均 CPU 使用率的前 10 個處理**包含的資料收集期間的平均 CPU 使用量最高的前十個處理程序。 因為 CPU 使用量也動態數值的資料點、 最大值、 最小值及 90%值等其他統計資料也包含在清單中，讓使用者能夠更完整的 CPU 耗用量。

如先前各節中所述，SPA 會依賴 PLA 收集 ETW 追蹤、 WMI 查詢、 效能計數器、 登錄機碼和組態檔來產生報告。 很重要，若要了解報表中每個資料點的資料來源。 SPA 提供這類資訊透過工具提示。 您可以停留在索引鍵資料行或檢視的資料來源的工具提示的資料列。 例如， **WMI:Win32\_DisDrive： 標題**表示資料來源是從 WMI 查詢，而 WMI 類別名稱是 Win32\_DiskDrive，且屬性為**標題**。

### <a href="" id="side-by-side-report-"></a>並排顯示報表

單一報表提供通知和資料 區段可協助使用者尋找潛在的效能問題，但通常很難直接查看單一報表來識別潛在的效能問題。 單一報表可能包含太多資料點，因此難以找出潛在的問題。

若要解決此問題，SPA 提供比較兩個報告的功能。 您可以比較基準報告，以協助找出差異的潛在問題的報表。

並排顯示報表可以是單一報表檢視器中的啟動。 使用者可以按一下**動作**，然後按一下**比較報告**選取報表。 才有意義的比較從相同的 advisor 組件的報表。 您可以選擇的時間、 下一份報告的時間或選取透過搜尋功能的任意報告中比較具有先前報表的報表。 比方說，來找出異常行為，您可以比較基準伺服器報表在不同的時間，在相同的電腦上所產生的報表，或有類似的伺服器角色的不同電腦上所產生的報表，然後載入。

並排顯示的報表看起來很像單一的報表。 它包含通知區段以及資料區段。 它包含相同數目的通知和資料區段做為單一報表檢視器。 唯一的差別是，報表會顯示以並排顯示方式。 每個區段包含目的地報告 （報告 2） 和資料來源報表 （報表 1）。產生報表的時間和資料收集期間，每個報表，並排顯示報表會顯示名稱的 「 advisor 」 組件 （報表左邊的 1） 和報表 2 在右側，目標伺服器的名稱。

如果您關閉**尋找** 對話方塊中，您可以重新啟用輸入 Control + f。這個對話方塊會尋找並反白顯示目前的區段內的文字字串。

在 [通知] 區段中，如果任何比較的兩個報表的結果是警告，它會列在**警告**區域。 否則，結果會列於**其他通知**區域。 因為並排顯示報表的索引鍵是要識別報表之間的差異，會不顯示任何規則的詳細的資訊。 使用者可以按一下規則名稱，以顯示規則詳細資料表單，如需規則的詳細資訊。

在資料區段中，資料會從報表左邊 1 的資料與從右邊的報表 2 資料的並排顯示方式。 SPA 顯示單一值，在相同資料表中，但而不是標記的資料行**值**，其名稱分別**報告 1**並**報表 2**分別。 並排顯示報表會顯示在並排顯示資料表中的所有其他形式的資料。

並排顯示報表檢視器也會提供有關資料來源的工具提示。

### <a name="historical-and-trend-charts"></a>歷程記錄和趨勢圖表

它只會使合理地顯示趨勢和歷程記錄圖表的特定伺服器與特定的建議程式組件。 您必須選擇時間範圍 （這預設為過去一週），然後按一下 **確定**即可啟動的趨勢和歷程圖檢視器。

趨勢和歷程圖檢視器有三個索引標籤： 歷程記錄圖表、 24 小時制的趨勢圖和 7 天的趨勢圖。

### <a name="historical-chart"></a>歷程記錄圖表

歷程記錄圖表會顯示一系列的數字的資料點，透過指定的時間範圍內的值。 例如，**平均要求延遲**過去 15 天內的單一伺服器上的 iis。 歷程記錄圖中的每個資料點代表一個效能分析工作階段中所採取的特定資料來源的值。

有幾種方式可使用的歷程圖表：

1.  若要協助您在特定時間的資料點的範例中，尋找是否有異常狀況，在每日的上午 2:00**平均要求延遲**的 IIS 會跳從大約 200 毫秒到 500 毫秒。

2.  若要協助相互關聯多個資料點。 例如，顯示**平均要求延遲**並**平均要求計數**一起，以在過去 15 天內。 報表可能會顯示，要求計數增加的同時找出，這可能表示要求延遲增加因增加的要求計數與要求延遲。

在歷程記錄圖中，使用者可以執行下列作業：

* 顯示多個資料數列在圖表區域中。 每個資料數列會顯示為一個折線圖，其中的報表檢視器。 每個線條圖表會自動調整以符合在報表檢視器中。

* 新增或移除歷程圖檢視器底部的 [資料序列] 清單中的資料數列。

* 顯示或隱藏 [資料序列] 清單中的資料數列。 使用者可以按一下特定的資料數列在清單中反白顯示圖表區域中對應的折線圖。

* 選取圖表區域內的時間週期拉近一段時間。 若要縮小，按一下  按鈕位於左下角的圖表。

* 按兩下特定資料點，以調查單一報表。

* 複製資料，並使其可供其他程式，例如 Microsoft Excel。 這可讓您利用圖表功能，在適當的 Microsoft Excel。

### <a name="trend-charts"></a>趨勢圖

許多重複的效能問題或對目標伺服器上執行的定期工作所造成。 比方說，娛樂導向的網站可能會收到多個點擊在週末期間，或備份工作排程磁碟可能會降低伺服器的效能每天上午 2:00。

趨勢圖可協助您找出這類效能問題。 效能問題可能會發生重複在各種不同的模式。 最常見的模式是每日的模式和每週的模式，而其中的效能問題發生的某天或週相同一天，同一小時內。 因此，SPA 提供 24 小時制的趨勢圖和 7 天的趨勢圖。

趨勢分析圖表上一組資料，提供更深層的調查，然後再透過查詢為基礎的當日時間的趨勢。 X 軸設為 24 小時的期間內，從 0 開始： 00 （午夜） 到 23:59 的結束。 SPA 不會同時顯示多個資料數列的趨勢。 您可以按一下**挑選資料數列**以選取要檢視資料數列。

若要處理資料，SPA 會尋找所有介於 0 所建立的快照集： 00，0:59，每個小時。 SPA 判斷最小值、 最大值、 平均值和標準差在該小時內，擷取的快照集的值，並為 k 線圖圖表它們。 SPA 會針對至 1 1:00:59，則到 2 2:00:59，並依此類推之間產生的快照集重複此程序。 如果沒有任何快照存在指定的小時，SPA 圖形上會讓該小時留白，並繼續進行下一個小時。

7 天的趨勢是非常類似於 「 24 小時制趨勢 」 圖表。 唯一的差別在於它分組資料數列，根據星期，而不是一天的小時。

您選取 趨勢和歷程記錄圖表中的資料數列會儲存為使用者喜好設定。 在下一次的趨勢和歷程圖檢視器的開啟相同的 advisor 組件，相同的資料數列集合會列出為預設值。

## <a name="managing-reports"></a>管理報表


### <a name="deleting-reports"></a>正在刪除報表

報表可以移除受 SPA 需要的報表數目降到最低。 根據報表的伺服器數目的頻率，建議您刪除不必要的報表。 雖然它可以管理的報表上，SPA 並沒有限制，基礎資料庫可能有大小限制。

**請注意**無法取消刪除已刪除的報表。

 

### <a name="exporting-and-importing-reports"></a>匯出和匯入報表

報表可以匯出至 XML 檔案傳輸到另一個的 SPA 主控台或另一位使用者的電子郵件。 匯出報表時，不會刪除報表。 若要從匯出目前檢視的報表**報表檢視器**，按一下**動作**，然後按一下**匯出**。 若要從匯出多個報表，**報表總管**，按一下**啟用多個選取項目**，從選取範圍 方塊中，選取多個報表，然後按一下**匯出**。 這會將 XML 格式的報表匯出到選取的目的地目錄中。

可以在 SPA 檢視匯出的報表。 匯入的報表不會新增至 SPA 資料庫。 它們主要是用來做為匯出報表的 XML 檢視器應用程式。 不需要匯入報表伺服器不會有相同的 advisor 組件安裝為原始的匯出的報表 SPA 主控台。

## <a href="" id="bkmk-manageadvisorpacks"></a>管理 advisor 套件


SPA 包含核心作業系統、 HYPER-V、 active directory 和 IIS 的 advisor pack。 SPA 提供開放的架構來開發 advisor 組件使用 SQL，所以也讓非 Microsoft 開發人員能夠建置 advisor 組件的版本。 有四個選項來管理 advisor 套件： 佈建、 自訂、 重設，或移除。

### <a name="provision-new-advisor-packs"></a>提供新的 advisor 組件

新的 advisor 組件可以發行，Microsoft 或非 Microsoft 開發人員。 Advisor 套件包含 provisionMetaData.xml 和一組描述邏輯的 SQL 指令碼。

**若要佈建的新的 advisor 組件**

1.  advisor 組件下的所有內容都複製 *%sparoot*\\Ap 目錄。

2.  在主視窗中，按一下**組態**，然後按一下**設定 Advisor 組件**。 **設定 Advisor 組件**對話方塊隨即開啟。

    **附註**此對話方塊是類似**佈建的 advisor 套件**中第一次使用精靈的頁面。 它會顯示一份可用來管理的 advisor 組件。 在清單中的每個 advisor 組件具有屬性名稱，例如安裝版本、 版本和作者。 名稱是 advisor 組件的完整名稱，並已安裝的版本是已經在專案中已佈建此 advisor 組件的版本。 Advisor 套件不是目前資料庫中，如果 [已安裝的版本] 文字方塊中會顯示**未安裝**。 [版本] 欄位表示歸檔 advisor packs 資料夾此 advisor 組件的版本。

     

3.  從清單中選取的建議程式組件。 如果尚未佈建的 advisor 組件，或如果在資料庫中，於 advisor 組件資料夾中有較新版本**佈建**按鈕已啟用。 按一下 [**佈建**] 按鈕。

4.  佈建完成時，**已安裝的版本**欄位都已選取的建議程式組件包含新的版本資訊。

### <a name="customize-advisor-packs"></a>自訂 advisor 組件

SPA 定義開放的架構，可讓使用者修改 advisor 組件。 使用者可以修改 advisor 組件檔案變更臨界值、 共用臨界值，以及啟用或停用規則。

如需如何變更，以及建置 advisor 組件的詳細資訊，請參閱[伺服器效能警告器組件開發指南](server-performance-advisor-pack-development-guide.md)。

### <a name="changing-thresholds"></a>變更臨界值

臨界值會用於 SPA，以判斷是否符合觸發條件的規則。 實際的臨界值的實際客戶案例可以明顯不同，因為工作負載、 硬體環境和商務需求。 預設臨界值可能不正確為目前的使用者案例，因此 SPA 提供的功能來修改現有的臨界值。

您可以在單一或並排顯示報表中的規則名稱，即可修改臨界值。 或者，若要管理特定的建議程式組件的所有規則，它們可以修改臨界值，從**組態**功能表。

**若要變更的臨界值**

1.  在 **組態**功能表上，按一下**設定 Advisor 組件**，按一下要修改，然後按一下 advisor 組件的名稱**設定**。

    **請注意**您會看到一份 advisor 套件中包含的所有規則。 Advisor 組件名稱左邊的核取方塊會指出是否啟用此規則。 如果規則已停用，它會隱藏所有報表。

     

2.  按一下您想要修改的特定規則。 **規則詳細資料**表單隨即開啟選取的規則。

規則詳細資料表單會包含有關特定規則的詳細的資訊。 它包含名稱、 描述、 狀態、 可能的結果，以及臨界值。 SPA 可支援兩種類型的規則結果**警告**並**確定**。 每個類型都沒有建議的文字，並建議。

某些規則沒有定義的臨界值。 例如， **HTTP 保持運作**iis 規則會檢查布林值的設定。 因此臨界值的清單可能是空的。 否則，會列出所有目前規則所使用的臨界值。 包含部分描述的臨界值規則中的使用方式的詳細的描述。

如果**規則詳細資料**啟動表單**組態** 功能表中，閾值 清單中有三個資料行： 名稱、 原始設定，以及變更設定。 如果啟動它時，從單一或並排顯示的報表，報表所使用的臨界值是還會包括。 使用者可以修改目前的臨界值中的值，進而**變更設定**資料行，然後按一下**儲存**將變更儲存到資料庫。

所有臨界值所做的變更才會套用到在變更後產生的報表。 現有的報表不會受到這些變更。

### <a name="sharing-thresholds"></a>共用的臨界值

如果您管理您的伺服器，在類似的情況下，您可以選擇使用相同的臨界值。 您可以匯出，並使用匯入特定的建議程式組件的臨界值**組態**功能表。 您可以選取特定的建議程式組件，然後按一下**設定**。 匯出的臨界值的檔案是以 XML 格式。

當匯入臨界值，SPA 驗證 XML 檔案格式，並驗證檔案符合所選的 advisor 組件。 如果成功，SPA 的所有值從檔案匯都入的臨界值載入目前的專案資料庫。 類似於先前的變更臨界值的案例，所有臨界值，變更才都會生效未來所產生的報表上。 不會影響現有的報表。

### <a name="enable-or-disable-rules"></a>啟用或停用規則

規則可以啟用或停用**規則詳細資料**表單。 您需要按一下**儲存**來保存所做的變更。 如果規則已停用，它並不會顯示在任何報表。 但基礎的商務邏輯就會觸發時產生報表，因此當您選擇重新啟用的規則，它會出現在報表中一次。

### <a name="reset-advisor-packs-to-original-state"></a>重設為原始狀態的 advisor 組件

您可能會決定修改資料庫中佈建的 advisor 組件。 以外變更臨界值，您可能也會改變 SQL 指令碼。 SPA 不支援變更報表中繼資料，或是加入或移除佈建的 advisor 組件的規則。 手動修改這些區域可能會導致非預期的行為。

如需變更的已佈建的 advisor 組件的詳細資訊，請參閱[伺服器效能警告器組件開發指南](server-performance-advisor-pack-development-guide.md)。

如果您想要復原的已佈建的 advisor 組件上所做的變更，您可以選擇重設的 advisor 組件。 這會覆寫所有的 SQL 指令碼重設所有值的預設臨界值和相關的建議程式組件。 這會保留所有現有的報表。

重設 advisor 套件可藉由使用**設定 Advisor 組件**表單。 您必須選取以重設，然後按一下 advisor 套件**重設**。

### <a name="remove-advisor-packs"></a>移除 advisor 套件

當不再需要的 advisor 組件時，使用者可以移除它從資料庫。 移除 advisor 套件會將 advisor 套件的相關資訊的所有項目從資料庫中，包括規則和臨界值，所有的 SQL 指令碼和所有報表中移除。 沒有任何動作可以回復。

移除 advisor 套件可藉由使用**設定 Advisor 組件**表單。 您必須選取以移除，然後按一下 advisor 套件**取消佈建**。

### <a name="update-existing-advisor-packs"></a>更新現有的 advisor 組件

更新現有的 advisor 組件，是非常類似於重 advisor 套件設為其原始狀態。 若要為較新版本更新 advisor 套件，複製新的 advisor 套件到 advisor 套件資料夾。 Advisor 套件會被視為現有 advisor 組件的更新，僅當沒有任何報表中繼資料變更時。 報表和識別碼的規則一定要相同。 否則，應該將它們視為兩個不同的 advisor 組件。

如果有商務邏輯變更，advisor 套件並無任何報表中繼資料變更，應該為它提供新的版本號碼，例如從 1.0 到 2.0。 如果沒有報告中繼資料變更，advisor 套件應該提供不同的完整名稱。 例如，無法變更試 Microsoft.ServerPerformanceAdvisor.IIS.V2 Microsoft.ServerPerformanceAdvisor.IIS.V1。

如果有較新版本的建議程式組件，清單中的**設定 Advisor 組件**表單會自動填滿**版本**advisor 套件的最新版本的資料行。 您可以選取 advisor 組件，然後按一下**重設**。 使用新的商務邏輯和臨界值警告器組件更新。 此 advisor 組件的所有報表都會保留都下來。

## <a name="managing-servers"></a>管理伺服器


SPA 提供管理目標伺服器的基本的功能。 您可以選擇將新的伺服器新增到目標伺服器清單、 從清單中，移除伺服器或修改伺服器的備註。

**若要新增或移除伺服器，或修改伺服器資訊**

1.  按一下 **組態**功能表上，按一下**設定伺服器**。

2.  在目前存在於專案資料庫的伺服器清單中，最後一個資料列是空的。 按一下資料列，並填寫各欄位。 **伺服器名稱**並**檔案共用位置**資料夾欄位是必要項目，以及伺服器名稱必須是唯一。

3.  輸入中的其他伺服器資訊**備註**每一部伺服器的資料行。

    **請注意**此欄位會使用任意文字格式，因此您可以使用它做為描述欄位。 或使用此欄位來標記伺服器，讓他們可以輕鬆找到在主視窗中，或到群組伺服器，例如，依位置或伺服器角色。

     

4.  如果您想要使用大量的伺服器中的 SPA，SPA 支援匯入逗點分隔值 (.csv) 格式。 這個檔案必須包含至少兩個欄位：**伺服器**並**檔案共用位置**。 第三個欄位中，**備註**是選擇性的但建議來組織您的伺服器。 您也可以匯出到.csv 檔案來判斷適當的格式，或備份您的伺服器設定的伺服器清單。

### <a name="searching-and-filtering"></a>搜尋和篩選

如果您管理多個伺服器時，SPA 提供基本支援，快速地在主視窗中尋找的伺服器。 您可以按一下資料行來排序的標頭會根據伺服器名稱、 分析結果、 目前的工作狀態或 「 備註 」。 您也可以選擇使用搜尋功能。 在主視窗的右上角，您可以輸入要搜尋的字串。 **目標伺服器**主視窗中的清單會篩選伺服器，並使其只顯示 伺服器名稱或備註包含搜尋字串的欄位，會使用字串。

下圖顯示如何將字串**delL**符合伺服器的字串**delL**的伺服器**備註**包含欄位**delL**.

![搜尋和篩選的範例](../media/server-performance-advisor/spa-user-manual-find-search-example.png)

## <a name="advanced-functionality"></a>進階的功能


### <a name="working-with-spa-windows-powershell-cmdlets"></a>使用 SPA Windows PowerShell cmdlet

SPA 主控台有週期性的資料收集的使用者介面的支援。 如果該功能不足，無法為您的環境，但也有進階的系統管理員可以使用自訂資料收集的 Windows PowerShell cmdlet。 這些 Windows PowerShell cmdlet 可讓系統管理員自動在目標伺服器上執行效能分析，並使用 SPA 的遠端客戶支援。 比方說，系統管理員可以撰寫指令碼來叫用來定期取樣的目標伺服器的效能條件的特定時間間隔內的 SPA cmdlet。

我們建議您關閉 SPAConsole.exe 應用程式，才能使用這些 cmdlet。

在執行任何 Windows PowerShell 指令程式之前，您需要註冊主控台電腦上的 cmdlet。

**若要註冊的 Windows PowerShell cmdlet**

1.  從提升權限的 Windows PowerShell 命令提示字元中輸入**registerSpaCmdlets.cmd**。 **順利登錄 SPA cmdlet**訊息隨即出現。

2.  執行**SPA PowerShell.cmd**。 如果您將會傳遞到 Windows PowerShell 指令碼檔案的路徑，該指令碼自動執行。 否則，它會開啟 Windows PowerShell 命令提示字元，即準備好要執行 SPA Windows PowerShell cmdlet。

下表描述的 SPA Windows PowerShell cmdlet:

| Cmdlet 名稱 | 參數 | 描述 |
| ------ | ------- | ------ |
| Start-SpaAnalysis | **-ServerName**目標伺服器的名稱。<br>**-AdvisorPackName** advisor 組件，以在伺服器上已排入佇列的完整名稱。 當在相同時間執行排定多個組件時，參數的值應格式化為 AP1name，AP2name。<br>**持續時間**收集資料的持續時間。<br>**-Credential**帳戶在目標伺服器上執行資料收集的使用者認證。<br>**-SqlInstanceName** SQL Server 執行個體的名稱。<br>**-SqlDatabaseName** SPA 專案資料庫的名稱。 | 指定的伺服器上啟動 SPA 資料收集工作階段。 |
| Stop-SpaAnalysis | **-SqlInstanceName** SQL Server 執行個體的名稱。<br>**-SqlDatabaseName** SPA 專案資料庫的名稱。<br>**-ServerName**目標伺服器的名稱。 | 嘗試停止執行 SPA 工作階段。 如果工作階段已完成，它會傳回而不執行任何動作。 |
| Get-SpaServer | **-SqlInstanceName** SQL Server 執行個體的名稱。<br>**-SqlDatabaseName** SPA 專案資料庫的名稱。 | 取得資料庫中的伺服器清單。 它會傳回物件，其中包含這些屬性的清單：名稱、 狀態、 檔案共用，以及備註。 |
| Get-SpaAdvisorPacks | **-SqlInstanceName** SQL Server 執行個體的名稱<br>**-SqlDatabaseName** SPA 專案資料庫的名稱 | 取得資料庫中的 [advisor] 組件清單。 它會傳回物件，其中包含這些屬性的清單：名稱、 DisplayName、 作者和版本。 |

Windows PowerShell 會提供將認證傳遞到加密的檔案，以啟用自動化案例的功能。 如需使用加密的檔案，將認證傳遞給 cmdlet 的詳細資訊，請參閱 <<c0> [ 建立 Windows PowerShell 指令碼，接受認證](https://technet.microsoft.com/magazine/ff714574.aspx)。

### <a name="automating-spa-report-collection-by-using-windows-powershell"></a>使用 Windows PowerShell 自動化 SPA 報告集合

下列程序會表示如何自動化 SPA 報表集合，使用 SPA Windows PowerShell cmdlet 的範例。

使用者認證可以加密，並透過 Windows PowerShell 快取中。 這些認證會用來登入遠端伺服器。 雖然並非針對 SPA，下列範例會示範這項技術：

``` syntax
$fileName = 'D:\temp\operator.txt'
$userName = 'domainname\operator'
 
# save credential to file
$(Get-Credential).Password | convertFrom-SecureString | Set-Content $fileName
 
# load credential from file
$credential = New-Object System.Management.Automation.PsCredential $userName, $(Get-Content $fileName | convertTo-SecureString)
 
# run command
.\start-SpaAnalysis  ServerName: Server1  Credential: $credential  AdvisorPackName:Microsoft.ServerPerformanceAdvisor.CoreOS.V1 10  Duration:10  SqlInstanceName: .\SQLExpress  SqlDatabaseName:SPA8294
```

您可以執行這個檔案之前，必須先執行**組 executionpolicy remoteSigned**

您可以從批次檔執行它使用下列命令：

``` syntax
PowerShell -command "& '.\RunSpa.ps1' "
```

### <a name="use-t-sql-to-generate-reports"></a>使用 T-SQL 來產生報告

SPA 報表資料可以擷取使用 SQL 來建置自訂的報表不，SPAConsole.exe 內提供。

比方說，下列 T-SQL 命令會提供前 10 個清單的伺服器 CPU 涵蓋過去三天的時間範圍：

``` syntax
select TOP 10
   MachineName,
   AverageCpu
FROM (
   select
      __MachineName MachineName,
      AVG(AverageValue) AverageCpu
   FROM [SPA].[Microsoft.ServerPerformanceAdvisor.CoreOS.V1].vwCpuPerformance
   WHERE __Creationtime > dateadd(DAY, -3, GETUTcdate())
      AND Name = N'% Processor time' AND CpuId = N'_Total'
   GROUP BY __MachineName
) t
OrdER BY t.AverageCpu DESC 
```

### <a name="working-with-multiple-projects"></a>使用多個專案

在某些情況下，您可能想要分割 SQL Server 資料庫所使用的 SPA。 這有助於減少 SQL Server 資料庫的資料大小，或協助您以邏輯方式分割伺服器。 在這些情況下，SPA 主控台支援多個專案。 您可以按一下來建立新的專案資料庫**檔案**，然後按一下**新的專案**。 第一次使用精靈 隨即出現，以協助建立新的專案資料庫。

建立專案之後，您可以按一下**檔案**，然後按一下**開啟專案**專案之間切換。 SPA 主控台不允許切換資料庫，當未處理的效能分析執行中目前開啟的專案。 這是要保護的效能資料的完整性。

當您選擇建立新的專案資料庫，或開啟另一個專案的資料庫時，會關閉目前的專案。 關閉目前的專案時，會關閉所有開啟的報表。

**請注意**SQL Server 2008 R2 Express 有 10 GB 資料庫的限制。 藉由使用多個專案，您可以使用一或多個 SQL Server 資料庫，並保持在 SQL Server 2008 R2 Express 限制為 10GB。

 

### <a name="logging-and-debugging"></a>記錄和偵錯

SPA 提供基本的記錄功能。 此外，它只會允許寫入記錄檔，位於 SPAConsole.exe 相同的資料夾中的記錄檔。 執行 SPA 主控台的使用者帳戶必須具有 SPA 安裝以確定可以將記錄寫入至記錄檔所在的資料夾的寫入權限。

SPA 包含下列有效的記錄層級：

* **參考**傾印 SPA 主控台接受，而且主要是設計用來進行偵錯的每個動作的記錄檔。

* **警告**記錄所有失敗和 SPA 主控台內發生的例外狀況。 某些失敗是只驗證的 SPA 主控台可以處理的失敗。

* **重要**記錄只有 「 失敗 」 和 「 不能由 SPA 主控台處理的例外狀況。 這些失敗會導致 SPA 主控台當機。 記錄檔會提供這類失敗的內容資訊。

根據預設，為警告的記錄層級，這表示，SPA 只會記錄失敗和 SPA 中發生的例外狀況。 可以變更記錄層級，藉由編輯**SpaConsole.exe.config** SpaConsole.exe 所在檔案的相同資料夾中。 所有記錄檔會寫入相同的資料夾中的 log.txt 檔案。

SPA 也提供一些基本的功能，進行偵錯。 若要開啟偵錯的 SPA，使用者需要以手動方式修改 SPA 專案資料庫。 此設定會儲存在組態資料表中。 使用者需要執行下列 SQL 指令碼，以將 SPA 專案變更為偵錯模式：

``` syntax
UPdate [Configurations] SET Value = N'true' WHERE Name = N'Debugmode'.
```

在偵錯模式中，SPA 架構會保留所有會產生效能分析過程中，因此您可以疑難排解問題的建議程式組件中的暫存資料。 此指令碼主要被設計來供 advisor 套件開發人員。

如需 SPA 中的偵錯功能的詳細資訊，請參閱[伺服器效能警告器組件開發指南](server-performance-advisor-pack-development-guide.md)。

### <a name="managing-the-database"></a>管理資料庫

### <a name="backup-and-restore-the-database"></a>備份和還原資料庫

SPA 主控台不會提供功能來備份及還原 SPA 資料庫。 您應該使用標準的 Microsoft SQL Server 工具和指令碼來備份和還原資料庫。

### <a name="clean-up-the-database"></a>清除資料庫

執行更多的效能分析時，SPA 專案資料庫可以成長的大小。 根據預設，SPA 會保留所有報表。 若要移除舊的報表，以協助改善效能。 您可以刪除透過報表**報表總管**介面。

## <a name="privacy-and-security"></a>隱私權和安全性


SPA 僅支援從目標伺服器的資料收集，SPA 主控台。 它不是將任何資訊傳送給 Microsoft 或非 Microsoft 開發人員。 如需 SPA 隱私權的詳細資訊，請參閱 Microsoft 軟體授權條款的 Server Performance Advisor。

SPA 所收集的所有資料會都儲存在專案的資料庫。 由於 ETW 追蹤的一部分，SPA 可能會收集可能會有高度的商務重要性的機密資訊。 您應該留意的潛在的風險與共用權限的 SPA 專案資料庫相關聯。 暫存記錄檔會儲存在每部目標電腦指定的共用資料夾中。 即使 SPA 嘗試刪除這些暫存記錄檔資料匯入完成時，不保證一定會刪除這些記錄檔。 您應該確定在共用的資料夾位於安全位置。

SPA advisor 組件包含 SQL 指令碼來剖析和分析效能記錄檔以產生效能報表。 SPA 會嘗試將限制權限下執行這些指令碼。 不過，仍有可能的指令碼可以從目標伺服器中收集透過 SPA 的機密資訊或取得或修改儲存於相同的 SPA 專案資料庫中的機密資訊。 您必須確定所有佈建到 SPA 專案資料庫建議程式組件是從信任的來源。

## <a name="errors-and-troubleshooting"></a>錯誤和疑難排解


### <a name="spaconsoleexe-does-not-start-or-write-log-file"></a>SPAConsole.exe 不啟動或寫入記錄檔

當您嘗試執行 SPAConsole.exe 第一次，如果未安裝.NET Framework 時，應用程式進行不啟動，或寫入記錄檔。 請確認 compatible.NET Framework 已安裝並使用正確開始 SPA 之前。

### <a name="locating-log-information"></a>尋找記錄檔資訊

SPA 中的 log.txt 檔案，SPA 資料夾下儲存失敗的資訊。 詳細的錯誤訊息和呼叫堆疊資訊會寫入此資料夾。 如果您遇到需要更多的資訊，來解譯的失敗，您可以開啟 log.txt 檔案，以查看錯誤詳細資料。

### <a name="database-size-limitations-for-sql-server-express"></a>SQL Server express 資料庫大小限制

SQL Server Express 有使用者資料庫的大小限制為 10 GB。 這個大小的資料庫具有的容量來存放 20,000 30,000 報表。 若要減少可能會觸達此資料庫限制，建議定期刪除報表和/或使用另一個版本的 SQL Server 沒有 10GB 使用者資料庫的限制。

### <a name="sql-server-express-log-size-and-disk-capacity"></a>SQL Server Express 記錄檔大小和磁碟容量

如果您使用 SQL Server Express，使用者資料庫是限制為 10 GB，但對應的記錄檔可能會超過 70 GB。 基於這些理由，我們建議 100 GB 或更多的可用磁碟空間的 SQL Server Express。 此磁碟空間應該就足以儲存大約 20,000 比 30,000 報表。 此記錄檔名為 SPADB\_log.ldf，而且它會在找到 **%Program Files %\\Microsoft SQL Server\\MSSQL10。SQLEXPRESS\\MSSQL\\資料**。

### <a name="failure-to-connect-to-target-server"></a>無法連線到目標伺服器

當您在目標伺服器上執行效能分析時，執行 SPA 主控台的使用者帳戶必須具有特定權限，才能排入佇列的目標伺服器上設定為 PLA 資料收集器。 若要變更為允許通過 PLA 通訊也需要 Windows 防火牆設定。 如需詳細的設定指示，請參閱[設定 SPA](#bkmk-setupspa)。

### <a name="failure-to-create-pla-data-collection-set-on-the-target-server"></a>無法建立目標伺服器上的 PLA 資料收集組

如果您收到無法建立 目標伺服器的訊息中的 PLA 資料收集組，請務必執行下列動作：

* 請確定**效能記錄檔與警示**服務正在執行

* 安全性設定**網路存取：不允許的密碼與認證用於網路驗證存放**已停用。 因為 SPA 需要使用者認證，以建立目標伺服器上的 資料收集器集合工具，必須停用的安全性設定。

### <a href="" id="running-spa-against-the-console-"></a>在主控台上執行 SPA

如果目標伺服器是 SPA 主控台相同 PLA 經歷不同的通道。 即使使用者帳戶系統管理員權限執行 SPA 主控台，PLA 就會失敗。 如果 SPA 主控台安裝在目標伺服器上，使用者需要先確定效能分析工作可以在主控台上執行的系統管理員身分啟動 SPA。

### <a name="running-multiple-consoles-at-the-same-time"></a>在此同時執行多個主控台

SPA 不支援同時針對相同的 SPA 專案資料庫執行的多個主控台。 SPA 也不提供的鎖定和同步處理機制，若要防止發生。 如果同時執行兩個 SPA 主控台，主控台將會根據這些 SPA 主控台正在執行的時間順序行為不一致。 若要避免這個問題，所有已排入佇列的效能分析工作階段應該從清單中移除之前的主控台，啟動分析處理它。

SPA 可以保護已成功產生的 SPA 的每個報表的完整性。 在此同時，SPA 不保證所有已排入佇列的分析工作會完成。 如果您看到不一致的狀態變更為效能分析工作階段，或宣告系統的錯誤找不到資料收集器集合工具所產生的效能記錄檔，很可能因多個執行針對相同的 SPA 主控台執行個體SPA 專案資料庫。

執行 SPA Windows PowerShell cmdlet 也可能會對資料庫執行之相同 SPA 的 SPA 主控台受到影響。 我們建議您關閉 SPA 主控台，然後再執行 SPA Windows PowerShell cmdlet。

### <a name="spaconsoleexe-recurring-collection-is-disrupted"></a>中斷 SPAConsole.exe 週期性集合

當您執行 SPAConsole.exe 且您使用週期性的資料集合 （例如，每小時的收集） 時，執行 SPAConsole.exe 的伺服器不應該在省電模式中，它可以暫停。 SPA 不會檢查原則省電。 此暫止的活動可能會中斷規則的週期性資料收集。

### <a name="lost-etw-events"></a>遺失的 ETW 事件

若要在目標伺服器上建立最小效能影響，PLA 可收集效能資訊時，使用低優先順序執行。 如果目標伺服器太忙碌，PLA 可以卸除的資料收集工作，若要在目標伺服器上執行的高優先順序工作會產生一些。 您應該考慮事件取得寫入磁碟 s I/O 的工作負載或更快的磁碟機，例如 SSD 的不 t 衝突的共用資料夾的設定。 當事件已卸除時，它們會報告在報表檢視因為遺失的事件可能會影響產生的效能度量的可靠性。

登錄或 WMI 查詢，以略過，也可能會導致特定權限問題。 不過，這是比較不可能發生比 ETW 事件遺失。 如此一來，資料收集器集合結果有時不包含要求的所有值。 您必須確定這種情況由 advisor 的所有組件的 T-SQL 指令碼。 如果資料不存在於資料集合結果中，會將它標示為要在報表中的任何資料。

由於 ETW 事件遺失是很常見的 PLA，所產生的資料點為基礎的 ETW 追蹤可能不會一致所產生的資料點的基礎，例如效能計數器。 比方說，就可以看到 IIS 的總 CPU 使用量為 80%（它來自效能計數器），而且，頂端 Url 只能使用 10%的所有 CPU 時間 （這是來自 ETW 追蹤的資料點）。 通常，一個資料點的資料來源可以透過資料點的工具提示來檢視。 您應該留意這類的資料遺失的影響。

若要避免這類事件遺失，則應該關閉到目標伺服器的結果資料夾。

如果資料收集器結果包含不完整的資料以外的 ETW 追蹤遺失及 advisor 套件開發人員有新增的支援 ETW 事件損失通知，資訊列會在單一的報表上顯示來通知使用者潛在資料遺失所造成不一致的報表。 中的 log.txt 檔案，可以找到詳細的資料遺失的資訊。

## <a name="glossary"></a>詞彙


以下是一些與 SPA 搭配使用的術語：

* **Advisor 套件**中繼資料和處理會從目標伺服器中收集效能記錄檔的 T-SQL 指令碼的集合。 然後，advisor 套件會從效能記錄資料產生報表。 Advisor 套件中的中繼資料會定義要從目標伺服器的效能度量收集的資料。 中繼資料也會定義一組規則、 臨界值和報表的格式。 大多數情況下，advisor 組件會寫入專為單一伺服器角色、 網際網路資訊服務的例如 (IIS)。

* **SPA 主控台**SpaConsole.exe，也就是 SPA 的中央部分。 不需要 SPA 不會在您要測試的目標伺服器上執行。 SPA 主控台的 SPA，包含所有的使用者介面，從設定專案以執行分析，並檢視報表。 根據設計，SPA 會是一個兩層式應用程式。 SPA 主控台包含 UI 層和商務邏輯層的一部分。 SPA 主控台排程和處理效能分析要求。

* **SPA 架構**提供所有的使用者介面、 效能記錄檔處理、 組態、 錯誤處理和資料庫 Api，以及管理程序。

* **SPA 專案**包含關於目標伺服器、 advisor 組件和效能分析的所有資訊的資料庫報告產生 advisor 組件的目標伺服器上。 您可以比較，然後檢視相同的 SPA 專案中的歷程記錄和趨勢圖表。 您可以建立多個專案。 SPA 專案無關，並沒有在專案之間共用的資料。

* **目標伺服器**實體電腦或使用特定的伺服器角色，例如 IIS 執行 Windows Server 的虛擬機器。

* **資料分析工作階段**特定目標伺服器上的效能分析。 資料分析工作階段可以包含多個 advisor 組件。 資料收集器集合工具從那些 advisor 組件會合併成單一的資料收集器集合工具。 單一資料分析工作階段的所有效能記錄檔會都收集在相同的時間期間。 分析執行相同的資料分析工作階段中的 advisor 組件所產生的報告，可協助使用者了解整體的效能情況，並找出效能問題的根本原因。

* **為 Windows 事件追蹤**Windows 中提供的高效能、 低負擔、 可擴充的追蹤系統。 它提供程式碼剖析和偵錯功能，可用來針對各種案例進行疑難排解。 SPA 做為資料來源會使用 ETW 事件，來產生效能報告。 如需 ETW 的一般資訊，請參閱[改善偵錯和效能調整使用 ETW](https://msdn.microsoft.com/magazine/cc163437.aspx)。

* **Windows Management Instrumentation (WMI)** 管理資料和作業，在 Windows 中的基礎結構。 您可以撰寫 WMI 指令碼或應用程式，以在遠端電腦上的系統管理工作自動化。 WMI 也提供其他部分的作業系統和產品的管理資料。 SPA 使用 WMI 類別資訊和資料點做為來源產生的效能報告。

* **效能計數器**用來提供作業系統或應用程式、 服務或驅動程式會執行程度的相關資訊。 效能計數器資料可協助判斷系統瓶頸並微調系統和應用程式的效能。 作業系統、 網路和裝置提供應用程式可以使用為使用者提供系統的執行程度的圖形化檢視的計數器資料。 SPA 使用效能計數器資訊和資料點做為來源來產生效能報告。

* **效能記錄檔及警示 (PLA)** 收集效能記錄及追蹤，並符合特定觸發程序時，會引發效能警示。 PLA 可用來收集效能計數器、 事件追蹤 Windows (ETW)、 WMI 查詢、 登錄機碼和組態檔。 PLA 也支援透過遠端程序呼叫 (RPC) 的遠端資料收集。 使用者定義資料收集器集合，其中包含要收集的資料、 資料收集、 資料集合的持續時間、 篩選和位置來儲存結果檔的頻率的相關資訊。 SPA 可以用以 PLA 從目標伺服器中收集所有效能資料。

* **單一報表**SPA 產生的報表，根據一個 advisor 組件與單一的目標伺服器上的一種資料分析工作階段。 它可以包含通知和各種資料區段。

* **並排顯示報表**SPA 報表來比較兩個相同的 advisor 組件的單一報表。 來自不同的目標伺服器，或是從相同的目標伺服器上的個別效能分析執行時，可能會產生兩個報表。 並排顯示的報表建立功能，來比較兩個報告，可協助使用者識別異常行為或其中一個報表中的設定。 並排顯示報表包含通知和各種資料區段。 在每個區段中，從這兩個報表的資料會列出由並存。

* **趨勢圖**SPA 報表用來調查效能問題的重複模式。 許多重複的效能問題是從伺服器或用戶端電腦，就會發生這個每日或每週，由排程的伺服器負載變更所造成。 SPA 提供的 24 小時制的趨勢圖和 7 天的趨勢圖，以找出這些問題。

    使用者可以選擇一或多個資料數列，一次，也就是一個數字的值，在單一報表中，這類**平均總 CPU 使用量**。 更具體來說，數字的值是從在指定的時間的執行個體的單一 AP 所產生的單一伺服器的純量值。 SPA 會將這些值分組 24 群組，其中每個小時的日期 （7 天報表，其中每一天的一週的七個）。 SPA 計算平均、 最小值、 最大值及針對每個群組的標準差。

* **歷程記錄圖表**SPA 報表用來顯示在特定的變更數字值內指定的伺服器和 advisor 的單一報表組件對經過一段時間。 使用者可以選擇多個資料數列，並一起顯示在歷程記錄圖表以了解不同的資料數列之間的相互關聯。

* **資料數列**從相同的資料來源收集一段時間的數值資料。 相同的來源表示資料必須來自相同的目標伺服器，例如一部伺服器上 IIS 的平均要求佇列長度。

* **規則**邏輯、 臨界值和描述的組合。 它們代表潛在的效能問題。 每個 advisor 套件包含多個規則。 每個規則會觸發報表的產生程序。 規則適用於單一報表中的資料的邏輯與臨界值。 如果符合這些準則，則會引發警告通知。 如果沒有，請通知設為**確定**狀態。 如果規則不適用，通知會設為 不適用 (**NA**) 狀態。

* **通知**規則會向使用者顯示的資訊。 它包含規則的狀態 (**[確定]**， **NA**，或有**警告**)，則規則，並解決效能問題的可能建議的名稱。
