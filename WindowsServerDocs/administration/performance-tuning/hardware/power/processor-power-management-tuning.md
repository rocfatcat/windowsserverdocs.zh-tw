---
title: 針對 Windows Server 平衡 」 電源計劃調整處理器電源管理 (PPM)
description: 針對 Windows Server 平衡 」 電源計劃調整處理器電源管理 (PPM)
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Qizha;TristanB
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 8a2ef4fd39554446aaac686e142ad24f53b4efaa
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59863049"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>針對 Windows Server 平衡 」 電源計劃調整處理器電源管理 (PPM)

從 Windows Server 2008 開始，Windows Server 提供三個電源計劃：**平衡**，**高效能**，以及**保護裝置的電源**。 **平衡**電源計劃是旨在提供一組典型的伺服器工作負載的最佳能源效率的預設選項。 本主題說明已用來決定的預設設定的工作負載**平衡**過去的數個 Windows 版本的配置。

如果您執行具有完全不同的工作負載特性或效能和電源需求比這些工作負載的伺服器系統時，您可能要考慮調整預設電源設定 （也就是建立自訂電源計劃）。 是一種微調的有用資訊的來源[伺服器的硬體能力的考量](../power.md)。 或者，您可能會決定**高效能**電源計劃是最適合您的環境，辨識，您可能會花費大量能源，但是某種程度的提升回應能力也會叫用。

>[!Important]
> 您應該利用電源原則所包含 Windows Server，除非您有特定需要建立的自訂承載，並已經非常了解，您的結果取決於您的工作負載的特性。

## <a name="windows-processor-power-tuning-methodology"></a>Windows 處理器電源微調方法


### <a name="tested-workloads"></a>測試工作負載

會選取工作負載，以涵蓋最佳的一組的 「 一般嗎？ Windows Server 工作負載。 顯然不是繼續這組來代表實際伺服器環境的整個範圍。

每個電源原則中的調整是由下列五個工作負載所驅動的資料：

-   **IIS Web 伺服器工作負載**

    Microsoft 的內部基準測試，稱為 Web 基本概念用來最佳化執行 IIS Web 伺服器的平台的能源效率。 安裝程式包含 web 伺服器和多個用戶端，以模擬 web 存取 」 流量。 散佈動態、 靜態熱的 （記憶體中），以及靜態冷 （需要磁碟存取） 的網頁為基礎的實際執行伺服器的統計研究。 若要推送完整的使用率 （測試頻譜的一端） 的伺服器的 CPU 核心，安裝程式會需要不夠快的網路和磁碟資源。

-   **SQL Server 資料庫工作負載**

    [TPC-E](http://www.tpc.org/tpce/default.asp)基準測試是受歡迎的基準測試的資料庫效能分析。 它用來產生 PPM 微調最佳化 OLTP 工作負載。 此工作負載有大量的磁碟 I/O，因此儲存體系統和記憶體大小的高效能需求。

-   **檔案伺服器工作負載**

    Microsoft 開發的基準測試呼叫[FSCT](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf)用來產生 SMB 檔案伺服器工作負載。 它會建立在伺服器上設定的大型檔案，並使用許多用戶端系統 （實際或虛擬化） 來產生檔案開啟、 關閉、 讀取及寫入作業。 作業集合根據統計研究的實際執行伺服器。 它會浮現 CPU、 磁碟和網路資源。

-   **SPECpower – JAVA 工作負載**

    [SPECpower\_ssj2008](http://spec.org/power_ssj2008/)是第一次的業界標準規格基準共同評估能力和效能特性。 它是使用不同的 CPU 負載層級的伺服器端 Java 工作負載。 它不需要許多磁碟或網路資源，但有特定需求的記憶體頻寬。 幾乎所有的 CPU 活動會在使用者模式;核心模式活動並沒有太大的影響，在基準測試的能力和效能特性，除了電源管理決策。

-   **應用程式伺服器的工作負載**

    [SAP SD](http://global.sap.com/campaigns/benchmark/index.epx)基準測試用來產生應用程式伺服器的工作負載。 使用兩層式安裝程式，以及資料庫和應用程式伺服器在相同的伺服器主機上。 此工作負載也會利用做為效能計量，這不同於其他測試的工作負載的回應時間。 因此它用來驗證的回應能力的 PPM 參數的影響。 不過，它不是要代表所有延遲的生產工作負載。

除了 SPECpower 基準測試的所有原本是設計為效能分析，並因此建立在尖峰負載層級執行。 是較常見的真實世界的實際執行伺服器和比較有趣的是中型到承擔的負載層級的但是**平衡**計劃最佳化。 我們刻意執行基準測試在不同負載層級從 100%（以 10%的步驟） 的 10%到使用各種節流方法 （例如，藉由減少的作用中使用者/用戶端數目）。

### <a name="hardware-configurations"></a>硬體設定

針對每個版本的 Windows 中，最新的實際執行伺服器用於電源計劃分析和最佳化程序。 在某些情況下，在進入生產階段前的發行排程比對的下一個 Windows 版本的系統上執行測試。

假設大部分伺服器會使用 1 到 4 處理器通訊端，銷售和向上延展伺服器會比較不可能有一個主要考量的能源效率，因為電源計劃最佳化測試主要通訊端 2 和 4 插槽系統上執行。 RAM、 磁碟和網路資源，針對每個測試的數量會選擇來允許每個系統，一直到其完整的容量，通常可以就地保留這類的實際伺服器環境的成本限制納入考量時執行合理的組態。

>[!Important]
> 即使系統可以執行在尖峰負載，我們通常最佳化的較低的負載層級，因為在其尖峰負載層級一致的方式執行的伺服器會是完善建議使用**高效能**電源計劃，除非能源效率是高優先順序。

### <a name="metrics"></a>計量

所有測試的基準測試的效能計量為使用的輸送量。 回應時間會被視為 （除了 SAP，其所在的主要度量) 的這些工作負載的 SLA 需求。 例如，執行基準測試會被視為 「 有效嗎？ 如果平均值或最大回應時間小於特定值。

因此，微調分析也 PPM 使用輸送量做為其效能計量。  在高負載層級 （100 %cpu 使用率），我們的目標是輸送量不應該降低電源管理最佳化的多個百分比。 不過主要的考量是效率最大化 power （如下列所定義） 中與低負載層級。

![電源效率公式](../../media/serverperf-ppm-formula.jpg)

在較低的頻率執行 「 CPU 核心可減少能源耗用量。 不過，較低的頻率通常減少輸送量並增加回應時間。 針對**平衡**電源計劃，是刻意設計的權衡取捨的回應能力和電源效率。 SAP 工作負載測試，以及其他的工作負載，回應時間的 Sla 確定回應時間增加不超過特定臨界值 （例如 5%)，針對這些特定的工作負載。

>[!Note]
> 如果工作負載會使用回應時間的效能計量，系統應該切換至**高效能**電源計劃或變更**平衡**所建議的電源計劃[建議快速回應時間的平衡 電源計劃參數](recommended-balanced-plan-parameters.md)。

### <a name="tuning-results"></a>微調結果

從 Windows Server 2008 開始，Microsoft 從事 Intel 和 AMD，以最佳化每個 Windows 版本的最新的伺服器處理器的 PPM 參數。 許許多多的 PPM 參數組合已在每個先前所討論的工作負載，以尋找最佳的電源效率，不同的負載層級上進行過測試。 做為軟體演算法已精簡和硬體電源架構進化版，每個新的 Windows Server 一律有更好或測試工作負載的各種等於比其舊版的電源效率。

下圖會提供電源效率的範例，在執行 Windows Server 2008 R2 的 4 插槽的實際執行伺服器上的不同 TPC-E 負載層級。 它會顯示在中型負載層級，相較於 Windows Server 2008 8%改進。

![電源效率比較](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>自訂微調建議

如果您的主要工作負載特性差異極大的五個工作負載，做為預設值**平衡**電源計劃 PPM 微調，您可以實驗改變一個或多個 PPM 參數，以尋找適合您環境。

數目和複雜度的參數，因為這可能是具挑戰性的工作，但如果您要尋找最佳的權衡取捨之間能源耗用量和工作負載效力，為您特定的環境，可能是值得花費心力。

 一組完整的可微調的 PPM 參數可在[處理器電源管理調整](https://msdn.microsoft.com/windows/hardware/gg566941.aspx)。 最簡單的 power 參數的一些開始使用可能是：

-   **處理器效能增加臨界值和處理器效能增加時間**– 較大的值效能回應緩慢增加的活動

-   **處理器效能降低臨界值**– 大型值 quicken 閒置期間的電源回應

-   **處理器效能降低時間**– 較大的值更逐漸降低效能，在閒置期間

-   **處理器效能增加原則**– 「 單一嗎？ 原則會減緩效能回應更高，而且持續活動;"Rocket 嗎？ 原則回應快速增加的活動

-   **處理器效能降低原則**– 「 單一嗎？ 原則更逐漸降低效能，再閒置的時間;"Rocket 嗎？ 原則會卸除 power 非常快速地進入閒置的時間時

>[!Important]
> 開始之前任何實驗，您應該先了解您的工作負載，可協助您做出正確的 PPM 參數選擇和減少微調工作。

### <a name="understand-high-level-performance-and-power-requirements"></a>了解高階效能和電源需求

如果您的工作負載是 「 即時嗎？ （例如容易瑕疵或其他顯示的使用者會影響） 或非常嚴格的回應性需求 （例如，股票經紀業務），而且如果能源消耗不是主要的準則，針對您的環境，您可能只應切換至**高效能**電源計劃。 否則，您應該了解您的工作負載的回應時間需求，並仍符合這些需求的最佳可能的電源效率的 PPM 參數來微調。

### <a name="understand-underlying-workload-characteristics"></a>了解基礎的工作負載特性

您應該知道您的工作負載，並設計實驗的參數集，進行微調。 例如，如果需要非常就 CPU 核心的頻率快速 （您或許有暴增的工作負載，與重大的閒置期間，但新的交易進來時，需要非常快速的回應性），則處理器效能增加原則可能需要設定為"rocket 嗎？ （就如同名稱所暗示，弄最大值，而不是進入一段時間的 CPU 核心頻率）。

如果您的工作負載非常暴增時，要開始逐步執行更快暴增到達之後的 CPU 頻率，可降低 PPM 檢查間隔。 如果您的工作負載不需要高執行緒並行存取，則可以啟用核心停車位，以強制執行較少的核心，也可能無法改善工作負載處理器快取叫用比率。

如果您只想要增加 CPU 頻率，在中度的使用量層級 （亦即，不輕度工作負載層級），則可以調整處理器效能增加/減少臨界值不回應，直到觀察到活動的特定層級。

### <a name="understand-periodic-behaviors"></a>了解定期的行為

可能有不同的效能需求日間和夜間或週末，或可能在不同時間執行的不同工作負載。 在此情況下，一組 PPM 參數可能不是最佳的所有時段。 因為可以設計多個自訂電源計劃，就能夠甚至調整為不同的時間週期，並透過指令碼或其他方法來動態系統設定的電源計劃之間切換。

同樣地，這會將可能需要有大幅的硬體升級或負載的變化時重複執行的最佳化程序，因此這是個問題的多少值將可獲得這種類型的微調，複雜度。

這就是為什麼 Windows 會提供**平衡**電源計劃，一開始，因為在許多情況下可能不值得花時間手動調整為特定的伺服器上的特定工作負載。

## <a name="see-also"></a>另請參閱
- [伺服器硬體的效能考量](../index.md)
- [伺服器硬體能力的考量](../power.md)
- [電力和效能調整](power-performance-tuning.md)
- [處理器電源管理調整](processor-power-management-tuning.md)
- [建議您平衡的方案參數](recommended-balanced-plan-parameters.md)
