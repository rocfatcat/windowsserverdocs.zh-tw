---
title: 處理器電源管理 (PPM) 微調 Windows Server 平衡電源計劃
description: 處理器電源管理 (PPM) 微調 Windows Server 平衡電源計劃
ms.topic: conceptual
ms.author: qizha;tristanb
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 9b45ad16981667eff626278daadbe8b39f5cc5c8
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/06/2020
ms.locfileid: "87896716"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>處理器電源管理 (PPM) 微調 Windows Server 平衡電源計劃

從 Windows Server 2008 開始，Windows Server 提供三個電源計劃：**平衡**、**高效**能和**省電**。 **平衡**的電源計劃是預設的選擇，目的是為一組一般伺服器工作負載提供最佳的能源效率。 本主題說明已用來判斷過去數個 Windows 版本之**平衡**配置預設設定的工作負載。

如果您執行的伺服器系統具有與這些工作負載截然不同的工作負載特性或效能和電源需求，您可能會想要考慮調整預設的電源設定 (例如，建立自訂的電源計劃) 。 有一個有用的微調資訊來源是[伺服器硬體電源考慮](../power.md)。 或者，您也可以決定**高效**能的電源計劃是您環境的正確選擇，並瞭解您可能會在 exchange 中遇到明顯的能源消耗，以達到某種程度增加的回應能力。

> [!IMPORTANT]
> 您應該利用 Windows Server 隨附的電源原則，除非您需要建立自訂應用程式的特定需求，而且有很好的瞭解，您的結果會隨著工作負載的特性而有所不同。

## <a name="windows-processor-power-tuning-methodology"></a>Windows 處理器電源微調方法

### <a name="tested-workloads"></a>測試的工作負載

系統會選取工作負載，以涵蓋一組最佳的「一般」 Windows Server 工作負載。 很明顯地，此集不適合用來代表真實世界伺服器環境的整體廣度。

每個電源原則中的微調是由下列五個工作負載所驅動的資料：

- **IIS Web 服務器工作負載**

    Microsoft 內部基準測試叫做 Web 基本概念，用來將執行 IIS 網頁伺服器的平臺的能源效率優化。 安裝套裝程式含一部 web 伺服器，以及模擬 web 存取流量的多個用戶端。 動態、靜態熱 (記憶體內部) 和靜態冷 (磁片存取的分佈，) 網頁是以實際執行伺服器的統計研究為基礎。 若要將伺服器的 CPU 核心推送至完整使用率 (測試的頻譜) 的一端，安裝程式需要足夠快速的網路和磁片資源。

- **SQL Server 資料庫工作負載**

    [TPC-E](http://www.tpc.org/tpce/default.asp)基準測試是適用于資料庫效能分析的熱門基準測試。 它是用來產生 PPM 微調優化的 OLTP 工作負載。 此工作負載具有大量的磁片 i/o，因此對儲存系統和記憶體大小具有高效能的需求。

- **檔案伺服器工作負載**

    Microsoft 開發的基準測試稱為[FSCT](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf) ，用來產生 SMB 檔案伺服器工作負載。 它會在伺服器上建立大型檔案集，並使用許多用戶端系統 (實際或虛擬化的) 來產生檔案開啟、關閉、讀取和寫入作業。 運算混合是以實際執行伺服器的統計研究為基礎。 它會強調 CPU、磁片和網路資源。

- **SPECpower – JAVA 工作負載**

    [SPECpower \_ ssj2008](http://spec.org/power_ssj2008/)是第一個業界標準的規格基準測試，會共同評估電源和效能特性。 這是具有不同 CPU 負載層級的伺服器端 JAVA 工作負載。 它不需要多個磁片或網路資源，但它有特定的記憶體頻寬需求。 幾乎所有的 CPU 活動都是在使用者模式中執行;核心模式活動對效能評定的能力和效能特性不會有太大的影響，但電源管理決策除外。

- **應用程式伺服器工作負載**

    [SAP-SD](http://global.sap.com/campaigns/benchmark/index.epx)基準測試是用來產生應用程式伺服器工作負載。 會使用兩層式設定，並在相同伺服器主機上的資料庫和應用程式伺服器。 此工作負載也會利用回應時間作為效能計量，這與其他測試的工作負載不同。 因此，它可用來驗證 PPM 參數對回應性的影響。 不過，它並不是要代表所有延遲敏感的生產工作負載。

除了 SPECpower 以外的所有基準測試最初都是針對效能分析所設計，因此會建立以尖峰負載層級執行。 不過，對於真實世界的實際執行伺服器而言，中等到淺負載層級更常見，而且對於**平衡**的計畫優化而言更有趣。 我們刻意從100% 到 10% (的負載層級，使用各種節流 (方法（例如，藉由減少作用中使用者/) 用戶端的數目），以10% 的步驟) 來執行效能評定。

### <a name="hardware-configurations"></a>硬體設定

針對每個 Windows 版本，最新的實際執行伺服器會用於電源計劃分析和優化程式。 在某些情況下，測試是在生產前系統上執行，其發行排程符合下一個 Windows 版本的版本。

假設大部分的伺服器都是以1到4個處理器通訊端來銷售，而且因為相應增加伺服器的能源效率較低而無法做為主要考慮，所以電源計劃優化測試主要是在2通訊端和4通訊端系統上執行。 系統會選擇每一項測試的 RAM、磁片和網路資源，以允許每個系統執行到其完整容量，同時考慮通常適用于真實世界伺服器環境的成本限制，例如保持合理的設定。

> [!IMPORTANT]
> 雖然系統可以在尖峰負載的情況下執行，但我們通常會針對較低的負載層級進行優化，因為在其尖峰負載層級上執行的伺服器一定會使用**高效**能電源計劃，除非能源效率是高優先順序。

### <a name="metrics"></a>計量

所有測試的效能評定都會使用輸送量做為效能度量。 回應時間會視為這些工作負載 (的 SLA 需求，但 SAP 除外，因為它是) 的主要度量。 例如，如果 mean 或最大回應時間小於特定值，基準測試執行就會被視為「有效」。

因此，PPM 微調分析也會使用輸送量作為其效能度量。  在最高的負載層級 (100% CPU 使用率) ，我們的目標是因為電源管理優化，輸送量應該不會減少超過幾%。 但主要的考慮是以中度和低負載層級的) 定義，將電源效率 (最大化。

![電力效益公式](../../media/serverperf-ppm-formula.jpg)

以較低頻率執行 CPU 核心可減少能源耗用量。 不過，較低頻率通常會降低輸送量並增加回應時間。 對於**平衡**的電源計劃，有一個刻意的回應性和電源效率取捨。 SAP 工作負載測試以及其他工作負載的回應時間 Sla，確保回應時間增加不會超過特定的閾值 (5% 作為這些特定工作負載的範例) 。

> [!NOTE]
> 如果工作負載使用回應時間做為效能計量，系統應該切換到**高效**能電源計劃，或變更**平衡**電源計劃，如[建議的平衡電源計劃參數，以取得快速回應時間](recommended-balanced-plan-parameters.md)。

### <a name="tuning-results"></a>微調結果

從 Windows Server 2008 開始，Microsoft 與 Intel 和 AMD 合作，為每個 Windows 版本的最新伺服器處理器優化 PPM 參數。 已在每個先前討論的工作負載上測試過大量 PPM 參數組合，以在不同的負載層級上尋找最佳的電源效率。 隨著軟體演算法的改良，隨著硬體電源架構的演進，每個新的 Windows Server 在經過測試的工作負載範圍內，一律會有比先前版本更好或同等的電源效率。

下圖提供在執行 Windows Server 2008 R2 的4通訊端生產伺服器上，不同的 TPC-E 負載層級下的電源效率範例。 相較于 Windows Server 2008，這會顯示中等負載層級的8% 改進。

![電源效率比較](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>自訂的微調建議

如果您的主要工作負載特性與用於預設**平衡**電源計劃 PPM 微調的五個工作負載截然不同，您可以藉由修改一或多個 ppm 參數來進行實驗，以找出最適合您的環境。

由於參數的數量和複雜度，這可能是一項很具挑戰性的工作，但如果您要尋找特定環境的能源耗用量和工作負載效力之間的最佳取捨，可能值得付出。

 您可以在[處理器電源管理微調](https://msdn.microsoft.com/windows/hardware/gg566941.aspx)中找到完整的可調式 PPM 參數集。 要開始使用的一些最簡單的電源參數可以是：

-   **處理器效能增加閾值和處理器效能增加時間**-較大的值會使效能回應變慢以增加活動

-   **處理器效能降低閾值**-quicken 電源回應到閒置期間的大數值

-   **處理器效能減少時間**-較大的值會在閒置期間逐漸降低效能

-   **處理器效能增加原則**–「單一」原則會減緩效能回應以增加和持續的活動;「Rocket」原則會快速回應增加的活動

-   **處理器效能降低原則**–「單一」原則更能以較長的閒置期間逐漸降低效能;「Rocket」原則在進入閒置期間時，會非常快速地卸載電源

>[!Important]
> 開始進行任何實驗之前，您應該先瞭解您的工作負載，這可協助您進行正確的 PPM 參數選擇，並減少微調工作。

### <a name="understand-high-level-performance-and-power-requirements"></a>瞭解高階效能和電源需求

如果您的工作負載是「即時」 (例如，容易受到瑕疵或其他可見的使用者影響) 或具有非常嚴格的回應性需求 (例如，股票經紀) ，而且如果能源耗用量不是您環境的主要準則，您可能只需要切換到**高效**能的電源計劃。 否則，您應該瞭解工作負載的回應時間需求，然後微調 PPM 參數，以取得仍然符合那些需求的最佳電源效率。

### <a name="understand-underlying-workload-characteristics"></a>瞭解基礎工作負載特性

您應該知道您的工作負載，並設計用於微調的實驗參數集。 例如，如果 CPU 核心的頻率需要非常快速地學習 (可能會有相當長的閒置期間的暴增工作負載，但是當新交易) 時，您需要非常快速的回應能力，然後處理器效能增加原則可能必須設定為「rocket」 (這種情況下，其名稱就是將 CPU 核心頻率寄到其最大值，而不是在一段時間內逐步執行) 。

如果您的工作負載非常暴增，您可以減少 PPM 檢查間隔，讓 CPU 頻率在突然增加後開始逐步執行。 如果您的工作負載沒有高執行緒並行，則可以啟用核心停車來強制工作負載在較少的核心上執行，這也可能會改善處理器快取點擊率。

如果您只想要增加中等使用率層級的 CPU 頻率 (也就是，而不是) 的工作負載層級，則處理器效能增加/減少閾值可以調整為不反應，直到觀察到特定層級的活動為止。

### <a name="understand-periodic-behaviors"></a>瞭解定期行為

白天和夜間或週末可能會有不同的效能需求，或是在不同時間執行的工作負載可能有所不同。 在此情況下，一組 PPM 參數可能不是所有時間週期的最佳方式。 由於可以設計多個自訂電源計劃，因此甚至可以針對不同的時間週期進行微調，並透過腳本或其他動態系統設定方式來切換電源計劃。

同樣地，這也增加了優化程式的複雜性，所以這是一項問題，就是要從這種微調類型獲得多少價值，這在有重大的硬體升級或工作負載變更時，可能需要重複。

這就是為什麼 Windows 會在一開始就提供**平衡**的電源計劃，因為在許多情況下，在特定伺服器上的特定工作負載，可能不值得手動調整。

## <a name="see-also"></a>另請參閱
- [伺服器硬體效能考量](../index.md)
- [伺服器硬體電源的考量](../power.md)
- [電源與效能調整](power-performance-tuning.md)
- [處理器電源管理](processor-power-management-tuning.md)
- [建議的平衡方案參數](recommended-balanced-plan-parameters.md)
