---
title: 處理器電源管理 (PPM) 微調 Windows Server 平衡的電源計劃
description: 處理器電源管理 (PPM) 微調 Windows Server 平衡的電源計劃
ms.topic: conceptual
ms.author: qizha
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: fd6b67aabcfe737e9fe0922801175e78a4c79360
ms.sourcegitcommit: 7cacfc38982c6006bee4eb756bcda353c4d3dd75
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/14/2020
ms.locfileid: "90077619"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>處理器電源管理 (PPM) 微調 Windows Server 平衡的電源計劃

從 Windows Server 2008 開始，Windows Server 提供三種電源計劃： **平衡**、 **高效**能和 **省電**。 **平衡**的電源計劃是預設的選擇，目的是為一組典型的伺服器工作負載提供最佳的能源效率。 本主題說明用來判斷過去數個 Windows 版本之 **平衡** 配置的預設設定的工作負載。

如果您執行的伺服器系統具有與這些工作負載截然不同的工作負載特性或效能與電源需求，您可能會想要考慮調整預設的電源設定 (例如，建立自訂電源計劃) 。 其中一個實用的微調資訊來源是 [伺服器硬體電源考慮](../power.md)。 或者，您可能會決定 **高效** 能電源計劃對您的環境而言是正確的選擇，因為您可能會在 exchange 中遇到嚴重的能源衝擊，以達到某種程度的回應速度。

> [!IMPORTANT]
> 除非您有特定需求，才能使用 Windows Server 隨附的電源原則，並非常瞭解您的結果會根據工作負載的特性而有所不同。

## <a name="windows-processor-power-tuning-methodology"></a>Windows 處理器電源微調方法

### <a name="tested-workloads"></a>測試的工作負載

選取工作負載以涵蓋一組最佳的「一般」 Windows Server 工作負載。 顯然，這組並非要代表整個廣度的真實世界伺服器環境。

每個電源原則中的微調都是由下列五個工作負載驅動的資料：

- **IIS 網頁伺服器工作負載**

    稱為「Web 基本概念」的 Microsoft 內部基準測試可用來將執行 IIS 網頁伺服器之平臺的能源效率優化。 此安裝套裝程式含 web 伺服器，以及模擬 web 存取流量的多個用戶端。 動態、靜態經常性 (記憶體內部) 的散發，以及必要的靜態冷 (磁片存取，) 網頁是以生產伺服器的統計研究為基礎。 若要將伺服器的 CPU 核心推送至完整使用率 (經過測試的頻譜) 的一端，則安裝程式需要足夠快速的網路和磁片資源。

- **SQL Server 資料庫工作負載**

    [TPC-E](http://www.tpc.org/tpce/default.asp)基準測試是適用于資料庫效能分析的熱門基準測試。 它是用來產生 PPM 微調優化的 OLTP 工作負載。 此工作負載有大量的磁片 i/o，因此對於儲存體系統和記憶體大小有高效能需求。

- **檔案伺服器工作負載**

    系統會使用名為 [FSCT](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf) 的 Microsoft 開發基準測試來產生 SMB 檔案伺服器工作負載。 它會在伺服器上建立大型檔案集，並使用許多用戶端系統 (實際或虛擬化) 來產生檔案開啟、關閉、讀取和寫入作業。 作業混合是以實際執行伺服器的統計研究為基礎。 它會強調 CPU、磁片和網路資源。

- **SPECpower – JAVA 工作負載**

    [SPECpower \_ ssj2008](http://spec.org/power_ssj2008/) 是第一個產業標準的規格基準測試，可共同評估電源和效能特性。 它是具有不同 CPU 負載層級的伺服器端 JAVA 工作負載。 它不需要太多磁片或網路資源，但有特定的記憶體頻寬需求。 幾乎所有的 CPU 活動都是在使用者模式下執行;除了電源管理決策以外，核心模式活動對效能評定的能力和效能特性沒有太大的影響。

- **應用程式伺服器工作負載**

    [SAP SD](http://global.sap.com/campaigns/benchmark/index.epx)基準測試可用來產生應用程式伺服器工作負載。 使用兩層式設定，並在相同伺服器主機上使用資料庫和應用程式伺服器。 此工作負載也會利用回應時間作為效能計量，這與其他已測試的工作負載不同。 因此，它可用來驗證 PPM 參數對回應性的影響。 不過，它並不是要代表所有延遲的生產工作負載。

除了 SPECpower 以外的所有基準測試最初都是針對效能分析而設計，因此會建立為在尖峰負載層級執行。 不過，對於真實世界的生產伺服器來說，中等到輕量的負載層級是較常見的，對於 **平衡** 的計畫優化而言更是有趣的。 我們刻意在不同的負載層級上執行基準測試，從100% 減少至 10% (在10% 步驟中使用各種節流方法)  (例如，藉由減少使用中的使用者/用戶端數目) 。

### <a name="hardware-configurations"></a>硬體設定

針對每個 Windows 版本，最新的生產伺服器會用於電源計劃分析和優化程式。 在某些情況下，測試是在發行排程符合下一個 Windows 版本的進入生產階段前系統上執行。

假設大部分的伺服器都使用1到4個處理器通訊端來銷售，而且因為擴充伺服器較不可能讓能源效率成為主要考慮，所以電源計劃優化測試主要是在2通訊端和4通訊端系統上執行。 選擇每個測試的 RAM、磁片和網路資源數量，讓每一部系統都能以最高的容量執行，同時考慮到一般適用于真實世界伺服器環境的成本限制，例如讓設定合理。

> [!IMPORTANT]
> 雖然系統可以在其尖峰負載執行，但我們通常會針對較低的負載層級進行優化，因為在其尖峰負載層級上執行的伺服器，最好是使用 **高效** 能的電源計劃，除非能源效率是高優先順序。

### <a name="metrics"></a>計量

所有測試的基準測試都會使用輸送量作為效能度量。 回應時間會視為這些工作負載的 SLA 需求 (但 SAP 除外，其為主要度量) 。 例如，如果 mean 或最大回應時間小於特定的值，則基準測試執行會被視為「有效」。

因此，PPM 微調分析也會使用輸送量作為其效能標準。  在最高負載層級 (100% 的 CPU 使用率) ，我們的目標是因為電源管理優化，所以輸送量不應減少超過數%。 但主要的考慮是將下列定義的電源效率最大化 (，如下列所定義) ：中度和低負載層級。

![電源效率公式](../../media/serverperf-ppm-formula.jpg)

以較低頻率執行 CPU 核心可減少能源耗用量。 不過，較低頻率通常會減少輸送量並增加回應時間。 對於 **平衡** 的電源計劃，有一項刻意的回應能力和電源效率。 SAP 工作負載測試，以及其他工作負載的回應時間 Sla，請確定回應時間增加不超過特定閾值 (5% 作為這些特定工作負載的範例) 。

> [!NOTE]
> 如果工作負載使用回應時間做為效能度量，系統應該切換至 **高效** 能電源計劃，或變更已 **平衡** 的電源計劃（如 [建議的平衡電源計劃參數中所建議），以獲得快速回應時間](recommended-balanced-plan-parameters.md)。

### <a name="tuning-results"></a>調整結果

從 Windows Server 2008 開始，Microsoft 與 Intel 和 AMD 合作，針對每個 Windows 版本的最新伺服器處理器優化 PPM 參數。 先前所討論的每個工作負載都已測試過大量的 PPM 參數組合，以找出不同負載層級的最佳電源效率。 隨著軟體演算法的改良和硬體電源架構的演進，每一部新的 Windows Server 在經過測試的工作負載範圍內，一律具有優於舊版的電源效率。

下圖提供在執行 Windows Server 2008 R2 的4通訊端生產伺服器上，不同 TPC-E 負載等級下的電源效率範例。 相較于 Windows Server 2008，其中的中等負載層級顯示了8% 的改進。

![電源效率比較](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>自訂的微調建議

如果您的主要工作負載特性與用於預設 **平衡** 電源計劃 PPM 微調的五個工作負載有很大的差異，您可以藉由變更一或多個 PPM 參數來進行實驗，以找出最適合您環境的工作負載。

由於參數的數目和複雜度，這可能是一項極具挑戰性的工作，但如果您想要在您的特定環境中尋找能源耗用量和工作負載效力之間的最佳取捨，則可能會很值得。

 您可以在 [處理器電源管理調整](/previous-versions/windows/hardware/design/dn613983(v=vs.85))中找到完整的可調式 PPM 參數集。 其中一些最簡單的電源參數可以是：

-   **處理器效能提高閾值和處理器效能增加時間** -較大的值會使效能回應變慢以增加活動

-   **處理器效能降低閾值** –大型值 quicken 閒置期間的電源回應

-   **處理器效能減少時間** -較大的值會在閒置期間更逐漸降低效能

-   **處理器效能增加原則** –「單一」原則會使效能回應變得更高和持續的活動;"Rocket" 原則會迅速回應增加的活動

-   **處理器效能降低原則** –「單一」原則會更逐漸減少較長閒置時間的效能;當輸入閒置期間時，"Rocket" 原則會非常快速地卸載電源

>[!Important]
> 開始進行任何實驗之前，您應該先瞭解您的工作負載，這可協助您進行正確的 PPM 參數選擇，並減少微調工作。

### <a name="understand-high-level-performance-and-power-requirements"></a>瞭解高階效能和電源需求

如果您的工作負載是「即時」 (例如，很容易受到瑕疵或其他可見的終端使用者影響) 或具有非常嚴格的回應性需求 (例如股票經紀人) ，而且如果能源耗用量不是您環境的主要準則，您可能只需要切換到 **高效** 能的電源計劃。 否則，您應該瞭解工作負載的回應時間需求，然後調整 PPM 參數，以取得仍符合這些需求的最可能電源效率。

### <a name="understand-underlying-workload-characteristics"></a>瞭解基礎工作負載特性

您應該知道您的工作負載，並設計用於微調的實驗參數集。 比方說，如果 CPU 核心的頻率學習得非常快速 (您可能有暴增的工作負載有相當長的閒置時間，但是，當新交易) 時，您需要非常快速的回應，然後處理器效能增加原則可能必須設定為 "rocket" (這種情況下，顧名思義，寄 CPU 核心頻率為其最大值，而不是在一段時間內逐步執行) 。

如果您的工作負載非常暴增，則可以減少 PPM 檢查間隔，讓 CPU 頻率在高載抵達之後更快開始執行。 如果您的工作負載沒有高執行緒並行，則可以啟用核心停車以強制工作負載在較少的核心上執行，這也可能改善處理器快取點擊率。

如果您只想要增加中等使用率等級的 CPU 頻率 (也就是，不是輕量工作負載層級) ，則處理器效能增加/減少閾值可以調整為不回應，直到觀察到特定層級的活動為止。

### <a name="understand-periodic-behaviors"></a>瞭解定期行為

日間、夜間或週末可能會有不同的效能需求，或者可能會有不同的工作負載在不同的時間執行。 在此情況下，一組 PPM 參數可能不是所有時間週期的最佳方式。 由於可以設計多個自訂電源計劃，甚至可以針對不同的時間週期進行調整，並透過腳本或其他動態系統組態方式在電源計劃之間切換。

同樣地，這也增加了優化程式的複雜度，因此有個問題，就是要從這種微調類型獲得多少價值，這可能需要在重大硬體升級或工作負載變更時重複。

這就是為什麼 Windows 在一開始就提供 **平衡** 的電源計劃，因為在許多情況下，在特定伺服器上進行特定工作負載的微調工作可能並不值得。

## <a name="see-also"></a>另請參閱
- [伺服器硬體效能考量](../index.md)
- [伺服器硬體電源的考量](../power.md)
- [電源與效能調整](power-performance-tuning.md)
- [處理器電源管理](processor-power-management-tuning.md)
- [建議的平衡方案參數](recommended-balanced-plan-parameters.md)